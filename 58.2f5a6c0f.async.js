(self.webpackChunkrh_template_umi=self.webpackChunkrh_template_umi||[]).push([[58],{263:function(Lt){function mt(dt){if(dt===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return dt}Lt.exports=mt},46507:function(Lt){function mt(dt,nt){if(!(dt instanceof nt))throw new TypeError("Cannot call a class as a function")}Lt.exports=mt},21364:function(Lt){function mt(nt,St){for(var vt=0;vt<St.length;vt++){var wt=St[vt];wt.enumerable=wt.enumerable||!1,wt.configurable=!0,"value"in wt&&(wt.writable=!0),Object.defineProperty(nt,wt.key,wt)}}function dt(nt,St,vt){return St&&mt(nt.prototype,St),vt&&mt(nt,vt),nt}Lt.exports=dt},25102:function(Lt,mt,dt){var nt=dt(74752),St=dt(63213),vt=dt(26416);function wt(Tt){var Pt=St();return function(){var Ct=nt(Tt),F;if(Pt){var $=nt(this).constructor;F=Reflect.construct(Ct,arguments,$)}else F=Ct.apply(this,arguments);return vt(this,F)}}Lt.exports=wt},74752:function(Lt){function mt(dt){return Lt.exports=mt=Object.setPrototypeOf?Object.getPrototypeOf:function(St){return St.__proto__||Object.getPrototypeOf(St)},mt(dt)}Lt.exports=mt},79764:function(Lt,mt,dt){var nt=dt(31748);function St(vt,wt){if(typeof wt!="function"&&wt!==null)throw new TypeError("Super expression must either be null or a function");vt.prototype=Object.create(wt&&wt.prototype,{constructor:{value:vt,writable:!0,configurable:!0}}),wt&&nt(vt,wt)}Lt.exports=St},63213:function(Lt){function mt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(dt){return!1}}Lt.exports=mt},26416:function(Lt,mt,dt){var nt=dt(74770),St=dt(263);function vt(wt,Tt){return Tt&&(nt(Tt)==="object"||typeof Tt=="function")?Tt:St(wt)}Lt.exports=vt},31748:function(Lt){function mt(dt,nt){return Lt.exports=mt=Object.setPrototypeOf||function(vt,wt){return vt.__proto__=wt,vt},mt(dt,nt)}Lt.exports=mt},74770:function(Lt){function mt(dt){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Lt.exports=mt=function(St){return typeof St}:Lt.exports=mt=function(St){return St&&typeof Symbol=="function"&&St.constructor===Symbol&&St!==Symbol.prototype?"symbol":typeof St},mt(dt)}Lt.exports=mt},9058:function(Lt,mt,dt){"use strict";dt.d(mt,{$E:function(){return nt},zR:function(){return vt},bs:function(){return wt}});function nt(w,C){w.beginPath(),w.ellipse(C.rect.x+C.rect.width/2,C.rect.y+C.rect.height/2,C.rect.width/2,C.rect.height/2,0,0,Math.PI*2),w.stroke(),w.beginPath(),w.fillStyle=w.strokeStyle,w.ellipse(C.rect.x+C.rect.width/2,C.rect.y+C.rect.height/2,C.rect.width/4,C.rect.height/4,0,0,Math.PI*2),w.fill()}var St=dt(16220);function vt(w){w.iconRect=new St.UL(0,0,0,0)}function wt(w){var C=w.rect.width*5/7,c=w.rect.height*5/7;w.textRect=new St.UL(w.rect.x+(w.rect.width-C)/2,w.rect.y+(w.rect.height-c)/2,C,c),w.fullTextRect=w.textRect}function Tt(w){w.iconRect=new Rect(0,0,0,0)}function Pt(w){w.textRect=new Rect(w.rect.x,w.rect.y,w.rect.width,w.rect.height),w.fullTextRect=w.textRect}function Et(w){w.anchors.push(new Point(w.rect.x,w.rect.y+w.rect.height/2,Direction.Left)),w.anchors.push(new Point(w.rect.ex,w.rect.y+w.rect.height/2,Direction.Right));for(var C=5,c=C;w.rect.x+c<w.rect.ex;c=c+C){var s=new Point(w.rect.x+c,w.rect.y,Direction.Up),l=new Point(w.rect.x+c,w.rect.ey,Direction.Bottom);s.hidden=!0,l.hidden=!0,w.anchors.push(s),w.anchors.push(l)}}function Ct(w){w.anchors.push(new Point(w.rect.x+w.rect.width/2,w.rect.y,Direction.Up)),w.anchors.push(new Point(w.rect.x+w.rect.width/2,w.rect.ey,Direction.Bottom));for(var C=5,c=C;w.rect.y+c<w.rect.ey;c=c+C){var s=new Point(w.rect.x,w.rect.y+c,Direction.Left),l=new Point(w.rect.ex,w.rect.y+c,Direction.Right);s.hidden=!0,l.hidden=!0,w.anchors.push(s),w.anchors.push(l)}}function F(w){w.iconRect=new Rect(0,0,0,0)}function $(w){w.textRect=new Rect(w.rect.x+10,w.rect.y,20,w.rect.height),w.fullTextRect=w.textRect}function R(w){w.iconRect=new Rect(0,0,0,0)}function P(w){w.textRect=new Rect(w.rect.x,w.rect.y,w.rect.width,40),w.fullTextRect=w.textRect}function x(){registerNode("activityFinal",activityFinal,null,activityFinalIconRect,activityFinalTextRect),registerNode("swimlaneV",swimlaneV,null,swimlaneVIconRect,swimlaneVTextRect),registerNode("swimlaneH",swimlaneH,null,swimlaneHIconRect,swimlaneHTextRect),registerNode("forkH",fork,forkHAnchors,forkIconRect,forkTextRect),registerNode("forkV",fork,forkVAnchors,forkIconRect,forkTextRect)}},16220:function(Lt,mt,dt){"use strict";dt.d(mt,{x1:function(){return Mt},NB:function(){return _t},aH:function(){return g},E9:function(){return R},UL:function(){return a},d3:function(){return gi},wC:function(){return qr},Dz:function(){return Jt},fs:function(){return Vr},C9:function(){return M},iZ:function(){return Re},s8:function(){return Ct}});var nt=dt(32362);function St(r){return{all:r=r||new Map,on:function(e,i){var n=r.get(e);n&&n.push(i)||r.set(e,[i])},off:function(e,i){var n=r.get(e);n&&n.splice(n.indexOf(i)>>>0,1)},emit:function(e,i){(r.get(e)||[]).slice().map(function(n){n(i)}),(r.get("*")||[]).slice().map(function(n){n(e,i)})}}}var vt;(function(r){r[r.Any=-1]="Any",r[r.CtrlOrAlt=0]="CtrlOrAlt",r[r.Ctrl=1]="Ctrl",r[r.Shift=2]="Shift",r[r.Alt=3]="Alt",r[r.Right=4]="Right"})(vt||(vt={}));var wt;(function(r){r[r.None=-1]="None",r[r.Document=0]="Document",r[r.Canvas=1]="Canvas"})(wt||(wt={}));var Tt=["fontColor","fontFamily","fontSize","lineHeight","textAlign","textBaseline"],Pt={cacheLen:30,refresh:30,fontColor:"#222222",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"center",textBaseline:"middle",color:"#222222",activeColor:"#1890ff",hoverColor:"#fa541c",anchorRadius:4,anchorFillStyle:"#fff",dockStrokeStyle:"#fa541c",dockFillStyle:"#fa541c",dragColor:"#1890ff",rotateCursor:"/assets/img/rotate.cur",hoverCursor:"pointer",minScale:.3,maxScale:5,anchorSize:5,keydown:wt.Document,viewPadding:0,gridSize:10,gridColor:"#f3f3f3",ruleColor:"#888888"};function Et(){return((1+Math.random())*65536|0).toString(16).substring(1)}function Ct(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function F(){return Et()+Ct()}function $(){return Ct()+Ct()}var R=function(){function r(t,e,i,n,o,p,S){this.x=t,this.y=e,this.direction=i,this.anchorIndex=n,this.id=o,this.hidden=p,this.autoAnchor=S}return r.prototype.floor=function(){this.x|=0,this.y|=0},r.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},r.prototype.clone=function(){var t=new r(this.x,this.y,this.direction,this.anchorIndex,this.id,this.hidden,this.autoAnchor);return this.data&&(t.data=this.data),this.mode&&(t.mode=this.mode),t},r.prototype.hit=function(t,e){return e===void 0&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},r.prototype.rotate=function(t,e){if(!t||t===360)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,n=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=n,this},r.prototype.isSameAs=function(t){return this.anchorIndex===t.anchorIndex&&this.direction===t.direction&&this.id===t.id},r}();window.topologyPoint=R,window.Le5leTopologyPoint=R;function P(r){for(var t={nodes:[],lines:[]},e=0,i=r;e<i.length;e++){var n=i[e];if(n.type){t.lines.push(n);continue}t.nodes.push(n),n.children&&(t.nodes.push.apply(t.nodes,P(n.children).nodes),t.lines.push.apply(t.lines,P(n.children).lines))}return t}function x(r,t){var e=[];return t.forEach(function(i){(i.id===r||i.tags.indexOf(r)>-1)&&e.push(i),i.children&&e.push.apply(e,x(r,i.children))}),e}function w(r,t){for(var e=[],i=0;i<t.length;i++)t[i].id===r||t[i].tags.indexOf(r)>-1?(e.push(t[i]),t.splice(i,1),--i):t[i].children&&e.push.apply(e,w(r,t[i].children));return e}function C(r,t){for(var e,i=0,n=r;i<n.length;i++){var o=n[i];if(!o.type&&!!o.children)for(var p=0,S=o.children;p<S.length;p++){var U=S[p];if(U.id===t.id)return o;if(!U.type&&U.children&&(e=C(U.children,t),e))return e}}return e}function c(r,t){if(t.length<3)return!1;for(var e=!1,i=t[t.length-1],n=0,o=t;n<o.length;n++){var p=o[n];i.y>r.y!=p.y>r.y&&p.x+(r.y-p.y)*(i.x-p.x)/(i.y-p.y)>r.x&&(e=!e),i=p}return e}function s(r,t,e,i){i===void 0&&(i=1);var n=Math.atan2(t.y-e.y,e.x-t.x);i=i>5?i:5;var o=Math.sin(n)*i,p=Math.cos(n)*i,S=[new R(t.x-o,t.y-p),new R(e.x-o,e.y-p),new R(e.x+o,e.y+p),new R(t.x+o,t.y+p)];return c(r,S)}function l(r,t){var e=Math.sqrt(Math.pow(Math.abs(r.x-t.x),2)+Math.pow(Math.abs(r.y-t.y),2));return e|0}function d(r,t,e,i){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M"+r.x+" "+r.y+" C"+t.x+" "+t.y+" "+e.x+" "+e.y+" "+i.x+" "+i.y),n.getTotalLength()|0}var a=function(){function r(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.center=new R(0,0),i<0&&(i=0),n<0&&(n=0),this.init()}return r.prototype.init=function(){this.ex=this.x+this.width,this.ey=this.y+this.height,this.calcCenter()},r.prototype.floor=function(){this.x|=0,this.y|=0,this.width|=0,this.height|=0,this.init()},r.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height),this.init()},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.hit=function(t,e){return e===void 0&&(e=0),t&&t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},r.prototype.hitByRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},r.prototype.hitRotate=function(t,e,i){for(var n=this.toPoints(),o=0,p=n;o<p.length;o++){var S=p[o];S.rotate(e,i)}return c(t,n)},r.prototype.calcCenter=function(){this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2},r.prototype.toPoints=function(){return[new R(this.x,this.y),new R(this.ex,this.y),new R(this.ex,this.ey),new R(this.x,this.ey)]},r.prototype.translate=function(t,e){this.x+=t,this.y+=e,this.ex+=t,this.ey+=e,this.calcCenter()},r.prototype.scale=function(t,e,i){e||(e=this.center),i===void 0&&(i=t),this.x=e.x-(e.x-this.x)*t,this.y=e.y-(e.y-this.y)*i,this.width*=t,this.height*=i,this.init()},r}();window.topologyRect=a;var u;(function(r){r[r.Click=0]="Click",r[r.DblClick=1]="DblClick",r[r.WebSocket=2]="WebSocket",r[r.Mqtt=3]="Mqtt",r[r.MoveIn=4]="MoveIn",r[r.MoveOut=5]="MoveOut",r[r.MouseUp=6]="MouseUp"})(u||(u={}));var v;(function(r){r[r.Link=0]="Link",r[r.StartAnimate=1]="StartAnimate",r[r.Function=2]="Function",r[r.WindowFn=3]="WindowFn",r[r.SetProps=4]="SetProps",r[r.PauseAnimate=5]="PauseAnimate",r[r.StopAnimate=6]="StopAnimate",r[r.Emit=7]="Emit"})(v||(v={}));function m(r){if(Array.isArray(r)){var t=[];return r.forEach(function(n){t.push(m(n))}),t}else if(typeof r=="object"){if(r===null)return null;if(r.constructor===RegExp)return r;var e={};for(var i in r)e[i]=m(r[i]);return e}return r}var g;(function(r){r[r.Node=0]="Node",r[r.Line=1]="Line"})(g||(g={}));var b=["link","doStartAnimate","doFn","doWindowFn","","doPauseAnimate","doStopAnimate","doEmit"],y={name:"",tags:[],visible:!0,rect:new a(0,0,0,0),fontColor:"",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,fontStyle:"normal",fontWeight:"normal",textAlign:"center",textBaseline:"middle",textBackground:"",animateCycleIndex:0,events:[],dash:0,lineDashOffset:0,lineWidth:1,strokeStyle:"",fillStyle:"",globalAlpha:1,rotate:0,offsetRotate:0,textMaxLine:0,textOffsetX:0,textOffsetY:0,animatePos:0},T={},O=function(){function r(){}return r.prototype.fromData=function(t,e){e?typeof e=="string"&&(e=JSON.parse(e)):e={},y.id=Ct(),t=Object.assign({},y,t);for(var i in t)this[i]=t[i];for(var i in e)this[i]=e[i];Array.isArray(this.tags)&&(this.tags=Object.assign([],this.tags)),this.rect&&(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height)),this.lineWidth=this.lineWidth||1,!this.fontColor&&e.font&&(this.fontColor=e.font.color||this.fontColor,this.fontFamily=e.font.fontFamily||this.fontFamily,this.fontSize=e.font.fontSize||this.fontSize,this.lineHeight=e.font.lineHeight||this.lineHeight,this.fontStyle=e.font.fontStyle||this.fontStyle,this.fontWeight=e.font.fontWeight||this.fontWeight,this.textAlign=e.font.textAlign||this.textAlign,this.textBaseline=e.font.textBaseline||this.textBaseline,this.textBackground=e.font.background||this.textBackground,delete this.font),this.events&&(this.events=m(this.events)),this.wheres&&(this.wheres=m(this.wheres)),typeof this.data=="object"&&(this.data=JSON.parse(JSON.stringify(this.data))),delete this.img,delete this.animateStart,delete this.animateReady},r.prototype.render=function(t){if(!!this.visible){if(this.from&&!this.to){if(this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.render(t)}return}if(t.save(),t.setAttrs&&t.setAttrs(this),(this.rotate||this.offsetRotate)&&(t.translate(this.rect.center.x,this.rect.center.y),t.rotate((this.rotate+this.offsetRotate)*Math.PI/180),t.translate(-this.rect.center.x,-this.rect.center.y)),this.lineWidth>1&&(t.lineWidth=this.lineWidth),this.strokeImage?this.strokeImage===this.lastStrokeImage&&this.strokeImg?t.strokeStyle=t.createPattern(this.strokeImg,"repeat"):this.loadStrokeImg():t.strokeStyle=this.strokeStyle||nt.Store.get(this.generateStoreKey("LT:color")),this.fillImage?this.fillImage===this.lastFillImage&&this.fillImg?t.fillStyle=t.createPattern(this.fillImg,"repeat"):this.loadFillImg():this.fillStyle&&(t.fillStyle=this.fillStyle),this.lineCap?t.lineCap=this.lineCap:this.type===g.Line&&(t.lineCap="round"),this.globalAlpha<1&&(t.globalAlpha=this.globalAlpha),this.lineDash)t.setLineDash(this.lineDash);else switch(this.dash){case 1:t.setLineDash([5,5]);break;case 2:t.setLineDash([10,10]);break;case 3:t.setLineDash([10,10,2,10]);break;case 4:t.setLineDash([1,16]);break}if(this.lineDashOffset&&(t.lineDashOffset=this.lineDashOffset),this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur),this.draw(t),t.restore(),this.children)for(var o=0,p=this.children;o<p.length;o++){var n=p[o];n.render(t)}}},r.prototype.loadFillImg=function(){var t=this;if(!!this.fillImage){var e=new Image;e.crossOrigin="anonymous",e.src=this.fillImage,e.onload=function(){t.lastFillImage=t.fillImage,t.fillImg=e,T[t.fillImage]={img:e},nt.Store.set(t.generateStoreKey("LT:imageLoaded"),!0)}}},r.prototype.loadStrokeImg=function(){var t=this;if(!!this.strokeImage){var e=new Image;e.crossOrigin="anonymous",e.src=this.strokeImage,e.onload=function(){t.lastStrokeImage=t.strokeImage,t.strokeImg=e,T[t.strokeImage]={img:e},nt.Store.set(t.generateStoreKey("LT:imageLoaded"),!0)}}},r.prototype.click=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.Click&&this[b[i.action]]&&this[b[i.action]](i.value,i.params)}},r.prototype.mouseUp=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MouseUp&&this[b[i.action]]&&this[b[i.action]](i.value,i.params)}},r.prototype.dblclick=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.DblClick&&this[b[i.action]]&&this[b[i.action]](i.value,i.params)}},r.prototype.moveIn=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MoveIn&&this[b[i.action]]&&this[b[i.action]](i.value,i.params)}},r.prototype.moveOut=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MoveOut&&this[b[i.action]]&&this[b[i.action]](i.value,i.params)}},r.prototype.doWheres=function(){var t=this;!this.wheres||this.wheres.forEach(function(e){if(e.fn instanceof Function)e.fn(t)&&e.actions&&e.actions.forEach(function(n){t.doAction(n)});else if(e.fn&&e.fn.trim()){var i=new Function("pen",e.fn);i(t)&&e.actions&&e.actions.forEach(function(n){t.doAction(n)})}else{var i=new Function("attr","return attr "+e.comparison+" "+e.value);i(t[e.key])&&e.actions&&e.actions.forEach(function(o){t.doAction(o)})}})},r.prototype.doAction=function(t){switch(t.do||t.action){case 0:case"Link":this.link(t.url||t.value,t._blank||t.params);break;case 1:case"StartAnimate":this.doStartAnimate(t.tag||t.value);break;case 5:case"PauseAnimate":this.doPauseAnimate(t.tag||t.value);break;case 6:case"StopAnimate":this.doStopAnimate(t.tag||t.value);break;case 2:case"Function":this.doFn(t.fn||t.value,t.params);break;case 3:case"WindowFn":this.doWindowFn(t.fn||t.value,t.params);break;case 7:case"Emit":this.doEmit(t.fn||t.value,t.params);break}},r.prototype.show=function(){return this.visible=!0,this},r.prototype.hide=function(){return this.visible=!1,this},r.prototype.isVisible=function(){return this.visible},r.prototype.getTID=function(){return this.TID},r.prototype.setTID=function(t){if(this.TID=t,this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.setTID(t)}return this},r.prototype.startAnimate=function(){this.animateStart=Date.now(),this.type===g.Node&&!this.animateReady&&this.initAnimate(),nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this}),this.playType===2&&this.play()},r.prototype.play=function(t){nt.Store.set(this.generateStoreKey("LT:play"),{pen:this,pause:t})},r.prototype.link=function(t,e){window.open(t,e===void 0?"_blank":e)},r.prototype.doStartAnimate=function(t,e){t?nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t}):this.startAnimate()},r.prototype.doPauseAnimate=function(t,e){t?nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t,stop:!0}):this.pauseAnimate()},r.prototype.doStopAnimate=function(t,e){t?nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t,stop:!0}):this.stopAnimate()},r.prototype.doFn=function(t,e){if(t instanceof Function)return t(this,e);var i=new Function("pen","params",t);i(this,e)},r.prototype.doWindowFn=function(t,e){window[t](this,e)},r.prototype.doEmit=function(t,e){nt.Store.set(this.generateStoreKey("LT:emit"),{event:t,params:e,pen:this})},r.prototype.generateStoreKey=function(t){return this.TID+"-"+t},r}();function M(r,t){var e=t.borderRadius,i=t.borderRadius;t.borderRadius<1&&(e=t.rect.width*t.borderRadius,i=t.rect.height*t.borderRadius);var n=e<i?e:i;t.rect.width<2*n&&(n=t.rect.width/2),t.rect.height<2*n&&(n=t.rect.height/2),r.beginPath(),r.moveTo(t.rect.x+n,t.rect.y),r.arcTo(t.rect.x+t.rect.width,t.rect.y,t.rect.x+t.rect.width,t.rect.y+t.rect.height,n),r.arcTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height,t.rect.x,t.rect.y+t.rect.height,n),r.arcTo(t.rect.x,t.rect.y+t.rect.height,t.rect.x,t.rect.y,n),r.arcTo(t.rect.x,t.rect.y,t.rect.x+t.rect.width,t.rect.y,n),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function V(r,t){r.beginPath(),r.ellipse(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height/2,t.rect.width/2,t.rect.height/2,0,0,Math.PI*2),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function N(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function Q(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height/2),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function tt(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function D(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x,t.rect.y+t.rect.height*2/3),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function k(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function A(r){var t=[],e="";r||(r="");for(var i=0;i<r.length;++i){var n=r.charCodeAt(i);if(n<33||n>126){e&&(t.push(e),e=""),t.push(r[i]);continue}else e+=r[i]}return e&&t.push(e),t}function L(r,t,e,i){for(var n=[],o=t[0]||"",p=1;p<t.length;++p){var S=t[p]||"",U=o+S,j=U.match(/[\u4e00-\u9fa5]/g)||"",rt=j.length;(U.length-rt)*i*.5+rt*i<e?o+=S:(n.push(o),o=S)}return n.push(o),n}function E(r,t){t.text&&!t.text.split&&(t.text+="");var e=[];switch(t.whiteSpace){case"nowrap":e.push(t.text);break;case"pre-line":e=t.text.split(/[\n]/g);break;default:for(var i=t.getTextRect(),n=t.text.split(/[\n]/g),o=0;o<n.length;++o){var p=L(r,A(n[o]),i.width,t.fontSize);e.push.apply(e,p)}break}return(t.displayFormat||t.displayFormat===0)&&e.forEach(function(S,U){var j=Number(S);isNaN(j)||(e[U]=j.toFixed(t.displayFormat))}),e}function q(r,t){for(var e=E(r,t),i=0,n=0,o=e;n<o.length;n++){var p=o[n];r.font=(t.fontStyle||"normal")+" normal "+(t.fontWeight||"normal")+" "+t.fontSize+"px/"+t.lineHeight+" "+t.fontFamily;var S=r.measureText(p),U=S.width;U>i&&(i=U)}return{width:i,height:e.length*t.fontSize*t.lineHeight}}function J(r,t,e,i,n,o){if(!(!t||!o)){var p=r.measureText(t).width;r.save(),r.fillStyle=o;var S=e-p/2,U=i-n/2;switch(r.textAlign){case"left":S=e;break;case"right":S=e-p;break}switch(r.textBaseline){case"top":U=i;break;case"bottom":U=i-n;break}r.fillRect(S,U,p,n),r.restore()}}function W(r,t,e,i,n,o,p,S,U){!S||S>t.length?S=t.length:S=Math.ceil(S);for(var j=0;j<S-1;++j)U&&J(r,t[j],e,i+j*p,p,U),r.fillText(t[j],e,i+j*p);if(S<t.length){var rt=(t[S-1]||"")+"...";t[S-1]&&r.measureText(rt).width>n&&(rt=t[S-1].substr(0,t[S-1].length-2)+"..."),U&&J(r,rt,e,i+(S-1)*p,p,U),r.fillText(rt,e,i+(S-1)*p)}else U&&J(r,t[S-1],e,i+(S-1)*p,p,U),r.fillText(t[S-1],e,i+(S-1)*p)}function z(r,t){if(!!t.text){t.text.split||(t.text+=""),r.save(),r.beginPath(),delete r.shadowColor,delete r.shadowBlur,r.font=(t.fontStyle||"normal")+" normal "+(t.fontWeight||"normal")+" "+t.fontSize+"px/"+t.lineHeight+" "+t.fontFamily,t.fontColor?r.fillStyle=t.fontColor:r.fillStyle=nt.Store.get(t.generateStoreKey("LT:fontColor")),t.textAlign&&(r.textAlign=t.textAlign),t.textBaseline&&(r.textBaseline=t.textBaseline);var e=t.getTextRect();if(!e){r.restore();return}var i=E(r,t),n=t.fontSize*t.lineHeight,o=t.textMaxLine>0&&t.textMaxLine<i.length?t.textMaxLine:i.length,p=e.x+e.width/2,S=e.y+(e.height-n*o)/2+n*4/7;switch(r.textAlign){case"left":p=e.x;break;case"right":p=e.x+e.width;break}switch(r.textBaseline){case"top":S=e.y+(n-t.fontSize)/2;break;case"bottom":S=e.ey-n*o+n;break}W(r,i,p+t.textOffsetX,S+t.textOffsetY,e.width,e.height,n,o,t.textBackground),r.restore()}}function K(r,t){r.save(),r.textAlign="center",r.textBaseline="middle";var e=t.getIconRect(),i=e.x+e.width/2,n=e.y+e.height/2;switch(t.imageAlign){case"top":n=e.y,r.textBaseline="top";break;case"bottom":n=e.ey,r.textBaseline="bottom";break;case"left":i=e.x,r.textAlign="left";break;case"right":i=e.ex,r.textAlign="right";break;case"left-top":i=e.x,n=e.y,r.textAlign="left",r.textBaseline="top";break;case"right-top":i=e.ex,n=e.y,r.textAlign="right",r.textBaseline="top";break;case"left-bottom":i=e.x,n=e.ey,r.textAlign="left",r.textBaseline="bottom";break;case"right-bottom":i=e.ex,n=e.ey,r.textAlign="right",r.textBaseline="bottom";break}t.iconSize>0?r.font=t.iconSize+"px "+t.iconFamily:e.width>e.height?r.font=e.height+"px "+t.iconFamily:r.font=e.width+"px "+t.iconFamily,r.fillStyle=t.iconColor||nt.Store.get(t.generateStoreKey("LT:iconColor"))||t.fontColor,t.iconRotate&&(r.translate(e.center.x,e.center.y),r.rotate(t.iconRotate*Math.PI/180),r.translate(-e.center.x,-e.center.y)),r.beginPath(),r.fillText(t.icon,i,n),r.restore()}function H(r,t){r.beginPath();var e=t.rect.y+t.rect.height/2;r.moveTo(t.rect.x,e),r.lineTo(t.rect.x+t.rect.width,e),r.stroke()}var _;(function(r){r[r.None=0]="None",r[r.Up=1]="Up",r[r.Right=2]="Right",r[r.Bottom=3]="Bottom",r[r.Left=4]="Left"})(_||(_={}));function G(r){r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,_.Up)),r.anchors.push(new R(r.rect.x+r.rect.width*3/4,r.rect.y+r.rect.height/2,_.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,_.Bottom)),r.anchors.push(new R(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height/2,_.Left))}function et(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height/2,_.Left)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,_.Right))}function Z(r){var t=r.rect.y+r.rect.height/2;r.anchors.push(new R(r.rect.x,t,_.Left)),r.anchors.push(new R(r.rect.x+r.rect.width,t,_.Right));for(var e=topology.data.scale||1,i=r.rect.x+5*e;i<r.rect.ex;i+=5*e){var n=new R(i,t,_.Bottom);n.hidden=!0,r.anchors.push(n)}}function at(r){var t=r.rect.width/2,e=r.rect.height/2;t>e?t=e:e=t;var i=r.rect.height/10;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function it(r){var t=r.rect.height/20;t<5&&(t=0),r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height*2/3-t,r.rect.width/2,r.rect.height/3-5);var e=r.rect.width*5/7,i=r.rect.height*5/7;r.fullTextRect=new a(r.rect.x+(r.rect.width-e)/2,r.rect.y+(r.rect.height-i)/2,e,i)}function st(r){var t=r.rect.width*2/7,e=r.rect.height*2/7;t>e?t=e:e=t;var i=t;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function h(r){r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height*2/3,r.rect.width/2,r.rect.height/3-5);var t=r.rect.width/2,e=r.rect.height*3/7;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height/2-5,t,e)}function f(r){var t=r.rect.width/3,e=r.rect.height/3;t>e?t=e:e=t;var i=r.rect.width/5;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function I(r){var t=r.rect.height/10;t<5&&(t=0),r.textRect=new a(r.rect.x+r.rect.width/3,r.rect.y+r.rect.height*2/3-t,r.rect.width/3,r.rect.height/3-5);var e=r.rect.width/2,i=r.rect.height*1/2;r.fullTextRect=new a(r.rect.x+(r.rect.width-e)/2,r.rect.y+r.rect.height/4,e,i)}function B(r){r.iconRect=new a(0,0,0,0)}function Y(r){r.textRect=new a(r.rect.x+r.rect.height/2,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height/2,r.rect.height/3),r.fullTextRect=r.textRect}function X(r){r.iconRect=new a(0,0,0,0)}function ot(r){r.textRect=new a(r.rect.x,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height/2,r.rect.height/3),r.fullTextRect=r.textRect}function ut(r){r.iconRect=new a(0,0,0,0)}function lt(r){r.textRect=new a(r.rect.x+r.rect.height/2,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height,r.rect.height/3),r.fullTextRect=r.textRect}function gt(r){r.iconRect=new a(0,0,0,0)}function bt(r){r.fullTextRect=new a(r.rect.x+10,r.rect.y+r.rect.height/2-20,r.rect.width-20,20),r.textRect=r.fullTextRect}function Wt(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y),r.lineTo(t.to.x,t.to.y),r.stroke()}function Dt(r,t){}function Ht(r){r.controlPoints=[]}var pt=50;function At(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y);for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.lineTo(n.x,n.y)}r.lineTo(t.to.x,t.to.y),r.stroke()}function Qt(r,t){r.save(),r.fillStyle="#fff",r.lineWidth=2;for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.beginPath(),r.arc(n.x,n.y,4,0,Math.PI*2),r.stroke(),r.fill()}r.restore()}function oe(r){r.controlPoints=[];var t=me(r.from,r.to);r.from.direction&&r.controlPoints.push(t);var e=me(r.to,r.from),i;switch(t.direction){case _.Up:i=De(t,e);break;case _.Right:i=Ue(t,e);break;case _.Bottom:i=Fe(t,e);break;case _.Left:i=ze(t,e);break}r.controlPoints.push.apply(r.controlPoints,i),r.to.direction&&r.controlPoints.push(e)}function Gt(r,t){if(!t.controlPoints||!t.controlPoints.length)return s(r,t.from,t.to,t.lineWidth/2);if(s(r,t.from,t.controlPoints[0])||s(r,t.to,t.controlPoints[t.controlPoints.length-1]))return!0;for(var e=0;e<t.controlPoints.length-1;++e)if(s(r,t.controlPoints[e],t.controlPoints[e+1]))return!0;return!1}function fe(r,t){var e=[t.from];e.push.apply(e,t.controlPoints),e.push(t.to);for(var i=0,n=e;i<n.length;i++){var o=n[i];Math.abs(r.x-o.x)<7&&(r.x=o.x),Math.abs(r.y-o.y)<7&&(r.y=o.y)}}function me(r,t){var e=r.clone();switch(r.direction){case _.Up:t.y<r.y?e.y-=Math.round((r.y-t.y)/2):e.y-=pt;break;case _.Right:t.x>r.x?e.x+=Math.round((t.x-r.x)/2):e.x+=pt;break;case _.Bottom:t.y>r.y?e.y+=Math.round((t.y-r.y)/2):e.y+=pt;break;case _.Left:t.x<r.x?e.x-=Math.round((r.x-t.x)/2):e.x-=pt;break}return e}function De(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.y>t.y)return t.direction===_.Up&&r.y-t.y>3*pt?r.x<t.x?t.x-r.x<pt?[new R(r.x-2*pt,r.y),new R(r.x-2*pt,t.y)]:[new R(r.x,t.y)]:r.x-t.x<pt?[new R(r.x+2*pt,r.y),new R(r.x+2*pt,t.y)]:[new R(r.x,t.y)]:t.direction===_.Left&&r.x>t.x||t.direction===_.Right&&r.x<t.x?[new R(t.x,r.y)]:[new R(r.x,t.y)];if(t.direction===_.Bottom){if(r.x<t.x)return se(r,t);var e=se(t,r);return[e[1],e[0]]}else return[new R(t.x,r.y)]}function Fe(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.y<t.y)return t.direction===_.Bottom&&t.y-r.y>3*pt?r.x<t.x?t.x-r.x<pt?[new R(r.x-2*pt,r.y),new R(r.x-2*pt,t.y)]:[new R(r.x,t.y)]:r.x-t.x<pt?[new R(r.x+2*pt,r.y),new R(r.x+2*pt,t.y)]:[new R(r.x,t.y)]:t.direction===_.Left&&r.x>t.x||t.direction===_.Right&&r.x<t.x?[new R(t.x,r.y)]:[new R(r.x,t.y)];if(t.direction===_.Up){if(r.x<t.x)return se(r,t);var e=se(t,r);return[e[1],e[0]]}else return[new R(t.x,r.y)]}function ze(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.x>t.x)return t.direction===_.Left&&r.x-t.x>3*pt?r.y<t.y?t.y-r.y<pt?[new R(r.x,r.y+2*pt),new R(t.x,r.y+2*pt)]:[new R(t.x,r.y)]:r.y-t.y<pt?[new R(r.x,r.y-2*pt),new R(t.x,r.y-2*pt)]:[new R(t.x,r.y)]:t.direction===_.Left||t.direction===_.Up&&r.y<t.y||t.direction===_.Bottom&&r.y>t.y?[new R(t.x,r.y)]:[new R(r.x,t.y)];if(t.direction===_.Right){if(r.y<t.y)return ae(r,t);var e=ae(t,r);return[e[1],e[0]]}else return[new R(r.x,t.y)]}function Ue(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.x<t.x)return t.direction===_.Right&&t.x-r.x>3*pt?r.y<t.y?t.y-r.y<pt?[new R(r.x,r.y-2*pt),new R(t.x,r.y-2*pt)]:[new R(t.x,r.y)]:r.y-t.y<pt?[new R(r.x,r.y+2*pt),new R(t.x,r.y+2*pt)]:[new R(t.x,r.y)]:t.direction===_.Right||t.direction===_.Up&&r.y<t.y||t.direction===_.Bottom&&r.y>t.y?[new R(t.x,r.y)]:[new R(r.x,t.y)];if(t.direction===_.Left){if(r.y<t.y)return ae(r,t);var e=ae(t,r);return[e[1],e[0]]}else return[new R(r.x,t.y)]}function se(r,t){var e=r.x+(t.x-r.x)/2;return[new R(e,r.y),new R(e,t.y)]}function ae(r,t){var e=r.y+(t.y-r.y)/2;return[new R(r.x,e),new R(t.x,e)]}function de(r){var t=parseInt,e=Math.round,i=r.length,n={};if(i>9){var o=r=r.split(","),p=o[0],S=o[1],U=o[2],j=o[3];if(i=r.length,i<3||i>4)return null;n.r=t(p[3]=="a"?p.slice(5):p.slice(4)),n.g=t(S),n.b=t(U),n.a=j?parseFloat(j):-1}else{if(i==8||i==6||i<4)return null;i<6&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]+(i>4?r[4]+r[4]:"")),r=t(r.slice(1),16),i==9||i==5?(n.r=r>>24&255,n.g=r>>16&255,n.b=r>>8&255,n.a=e((r&255)/.255)/1e3):(n.r=r>>16,n.g=r>>8&255,n.b=r&255,n.a=-1)}return n}function we(r,t,e,i){var n,o,p,S,U,j,rt,ht=Math.round,ct=typeof e=="string";return typeof r!="number"||r<-1||r>1||typeof t!="string"||t[0]!="r"&&t[0]!="#"||e&&!ct||(rt=t.length>9,rt=ct?e.length>9?!0:e=="c"?!rt:!1:rt,U=de(t),S=r<0,j=e&&e!="c"?de(e):S?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},r=S?r*-1:r,S=1-r,!U||!j)?null:(i?(n=ht(S*U.r+r*j.r),o=ht(S*U.g+r*j.g),p=ht(S*U.b+r*j.b)):(n=ht(Math.pow(S*Math.pow(U.r,2)+r*Math.pow(j.r,2),.5)),o=ht(Math.pow(S*Math.pow(U.g,2)+r*Math.pow(j.g,2),.5)),p=ht(Math.pow(S*Math.pow(U.b,2)+r*Math.pow(j.b,2),.5))),ct=U.a,j=j.a,U=ct>=0||j>=0,ct=U?ct<0?j:j<0?ct:ct*S+j*r:0,rt?"rgb"+(U?"a(":"(")+n+","+o+","+p+(U?","+ht(ct*1e3)/1e3:"")+")":"#"+(4294967296+n*16777216+o*65536+p*256+(U?ht(ct*255):0)).toString(16).slice(1,U?void 0:-2))}function Zt(r,t){var e=de(t)||{r:0,g:0,b:0};return e.a<0?"rgba("+e.r+","+e.g+","+e.b+","+r+")":"rgba("+e.r+","+e.g+","+e.b+","+(r+e.a)+")"}function jt(r,t){return+t?+t:!t||t[t.length-1]!=="%"?0:(t=t.substr(0,t.length-1),r*+t/100)}function je(r,t){var e=r.x-t.x,i=r.y-t.y;return Math.sqrt(e*e+i*i)}var Ke=80;function be(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y),r.bezierCurveTo(t.controlPoints[0].x,t.controlPoints[0].y,t.controlPoints[1].x,t.controlPoints[1].y,t.to.x,t.to.y),r.stroke()}function ke(r,t){r.save(),r.fillStyle=Zt(.5,r.strokeStyle+""),r.lineWidth=1,r.beginPath(),r.moveTo(t.from.x,t.from.y),r.lineTo(t.controlPoints[0].x,t.controlPoints[0].y),r.stroke(),r.beginPath(),r.moveTo(t.to.x,t.to.y),r.lineTo(t.controlPoints[1].x,t.controlPoints[1].y),r.stroke(),r.fillStyle="#fff",r.lineWidth=2;for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.beginPath(),r.arc(n.x,n.y,4,0,Math.PI*2),r.stroke(),r.fill()}r.restore()}function We(r){r.from.direction||(r.from.direction=_.Bottom),r.to.direction||(r.to.direction=(r.from.direction+2)%4,r.to.direction||(r.to.direction=_.Left)),r.controlPoints=[xe(r.from,r.to),xe(r.to,r.from)],nt.Store.set(he(r,"pts-")+r.id,void 0)}function Se(r,t){var e=nt.Store.get(he(t,"pts-")+t.id);if(!e){if(e=[t.from],t.controlPoints)for(var i=.01;i<1;i+=.01)e.push(Vt(i,t.from,t.controlPoints[0],t.controlPoints[1],t.to));e.push(t.to),nt.Store.set(he(t,"pts-")+t.id,e)}for(var n=e.length-1,i=0;i<n;++i)if(s(r,e[i],e[i+1]))return!0;return!1}function Vt(r,t,e,i,n){var o=t.x,p=t.y,S=n.x,U=n.y,j=e.x,rt=e.y,ht=i.x,ct=i.y,xt=o*(1-r)*(1-r)*(1-r)+3*j*r*(1-r)*(1-r)+3*ht*r*r*(1-r)+S*r*r*r,kt=p*(1-r)*(1-r)*(1-r)+3*rt*r*(1-r)*(1-r)+3*ct*r*r*(1-r)+U*r*r*r;return new R(xt,kt)}function xe(r,t){var e=new R(r.x,r.y,r.direction,r.anchorIndex,r.id),i=window.topologyControlPtDistance||Ke;if((r.direction===_.Up||r.direction===_.Bottom)&&Math.abs(r.x-t.x)<3)return t.y>r.y?(i=Math.round((t.y-r.y)/3),e.y+=i):(i=Math.round((r.y-t.y)/3),e.y-=i),e;if((r.direction===_.Left||r.direction===_.Right)&&Math.abs(r.y-t.y)<3)return t.x>r.x?(i=Math.round((t.x-r.x)/3),e.x+=i):(i=Math.round((r.x-t.x)/3),e.x-=i),e;switch(r.direction){case _.Up:e.y-=i;break;case _.Right:e.x+=i;break;case _.Bottom:e.y+=i;break;case _.Left:e.x-=i;break}return e}function he(r,t){return r.getTID()+"-"+t}var ce=20;function He(r){switch(r.from.direction||(r.from.direction=_.Bottom),r.to.direction||(r.to.direction=(r.from.direction+2)%4,r.to.direction||(r.to.direction=_.Left)),r.from.direction){case _.Up:r.controlPoints=[new R(r.from.x,r.from.y-ce),new R(r.from.x,r.to.y)];break;case _.Right:r.controlPoints=[new R(r.from.x+ce,r.from.y),new R(r.from.x,r.to.y)];break;case _.Bottom:r.controlPoints=[new R(r.from.x,r.from.y+ce),new R(r.from.x,r.to.y)];break;case _.Left:r.controlPoints=[new R(r.from.x-ce,r.from.y),new R(r.from.x,r.to.y)];break}nt.Store.set(he(r,"pts-")+r.id,void 0)}function Ce(r,t,e,i,n){i+=r.lineWidth*3;var o=r.lineWidth/10;r.lineWidth<2&&(r.lineWidth=2,o=0),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth+o*5,-e.y),r.moveTo(e.x,e.y+o),r.lineTo(e.x,e.y-o),r.lineTo(e.x-i,e.y-i/3),r.lineTo(e.x-i,e.y+i/3),r.closePath(),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function qe(r,t,e,i){Ce(r,t,e,i,nt.Store.get("LT:bkColor")||"#fff")}function Te(r,t,e,i,n){i+=r.lineWidth*3;var o=i/2,p=r.lineWidth/10;r.lineWidth<2&&(r.lineWidth=2,p=0),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth+p*5,-e.y),r.moveTo(e.x,e.y+p),r.lineTo(e.x,e.y-p),r.lineTo(e.x-o,e.y-o/2),r.lineTo(e.x-i,e.y-p),r.lineTo(e.x-i,e.y+p),r.lineTo(e.x-o,e.y+o/2),r.closePath(),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function Ve(r,t,e,i){Te(r,t,e,i,nt.Store.get("LT:bkColor")||"#fff")}function Ie(r,t,e,i,n){i+=r.lineWidth*3;var o=i/2;r.lineWidth<2&&(r.lineWidth=2),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x,-e.y-r.lineWidth/10),r.arc(e.x-o-r.lineWidth/2,e.y,o,0,2*Math.PI),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function Ye(r,t,e,i){Ie(r,t,e,i,nt.Store.get("LT:bkColor")||"#fff")}function Xe(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height/2,_.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,_.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,_.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,_.Bottom));for(var t=5;t<360;t+=5)if(t%90!=0){var e=Math.round(t/90),i=new R(r.rect.center.x+Math.sin(t/180*Math.PI)*r.rect.width/2,r.rect.center.y+Math.cos(t/180*Math.PI)*r.rect.height/2,e);i.hidden=!0,r.anchors.push(i)}}function Qe(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3),r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3),r.stroke()}function Ge(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),e.x>t.x?(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3)):(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3)),r.stroke()}function Je(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),e.x<t.x?(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3)):(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3)),r.stroke()}function $e(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*2/5),r.lineTo(t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height),r.lineTo(t.rect.x+t.rect.width/5,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height*2/5),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function Ze(r){var t=r.rect.width/2,e=r.rect.height/2;t>e?t=e:e=t;var i=r.rect.height/7;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function tr(r){r.textRect=new a(r.rect.x+r.rect.width/5,r.rect.y+r.rect.height*5/7,r.rect.width*3/5,r.rect.height/4);var t=r.rect.width*3/5,e=r.rect.height*3/5;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height/4,t,e)}function er(r){r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,_.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height*2/5,_.Right)),r.anchors.push(new R(r.rect.x+r.rect.width*4/5,r.rect.y+r.rect.height,_.Bottom)),r.anchors.push(new R(r.rect.x+r.rect.width/5,r.rect.y+r.rect.height,_.Bottom)),r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height*2/5,_.Left))}function rr(r,t){r.beginPath();var e=t.rect.width/5;r.moveTo(t.rect.x+e,t.rect.y),r.lineTo(t.rect.x+t.rect.width-e,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.width-e,t.rect.y+t.rect.height),r.lineTo(t.rect.x+e,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height/2),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ir(r){r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,_.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,_.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,_.Bottom)),r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height/2,_.Left));var t=new R(r.rect.x+r.rect.width/10,r.rect.y+r.rect.height/4,_.Left);t.hidden=!0,r.anchors.push(t);var e=new R(r.rect.x+r.rect.width/10,r.rect.y+r.rect.height*3/4,_.Left);e.hidden=!0,r.anchors.push(e);var i=new R(r.rect.x+r.rect.width*9/10,r.rect.y+r.rect.height/4,_.Right);i.hidden=!0,r.anchors.push(i);var n=new R(r.rect.x+r.rect.width*9/10,r.rect.y+r.rect.height*3/4,_.Right);n.hidden=!0,r.anchors.push(n)}function nr(r){var t=r.rect.width*3/5,e=r.rect.height*3/4;r.iconRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,e-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function or(r){var t=r.rect.width*3/5,e=r.rect.height/4;r.textRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.rect.height-e+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,e),r.fullTextRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function sr(r,t){r.beginPath();for(var e=0;e<5;++e)r.lineTo(Math.cos((18+72*e)/180*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin((18+72*e)/180*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2),r.lineTo(Math.cos((54+72*e)/180*Math.PI)*t.rect.width/4+t.rect.x+t.rect.width/2,-Math.sin((54+72*e)/180*Math.PI)*t.rect.width/4+t.rect.y+t.rect.height/2);r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ar(r){r.anchors.push(new R(Math.cos(18/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin(18/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,_.Right)),r.anchors.push(new R(Math.cos((18+72)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,_.Up)),r.anchors.push(new R(Math.cos((18+72*2)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*2)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,_.Left)),r.anchors.push(new R(Math.cos((18+72*3)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*3)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,_.Bottom)),r.anchors.push(new R(Math.cos((18+72*4)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*4)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,_.Bottom))}function hr(r){r.iconRect=new a(0,0,0,0)}function cr(r){var t=r.rect.width*2/5,e=r.rect.height*2/5;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+(r.rect.height-e)/2,t,e),r.textRect=r.fullTextRect}function lr(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/5,t.rect.y+t.rect.height*13/16),r.bezierCurveTo(t.rect.x-t.rect.width/15,t.rect.y+t.rect.height*13/16,t.rect.x-t.rect.width/15,t.rect.y+t.rect.height*7/16,t.rect.x+t.rect.width/5,t.rect.y+t.rect.height*7/16),r.bezierCurveTo(t.rect.x+t.rect.width/5,t.rect.y,t.rect.x+t.rect.width*4/5,t.rect.y,t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height*7/16),r.bezierCurveTo(t.rect.x+t.rect.width*16/15,t.rect.y+t.rect.height*7/16,t.rect.x+t.rect.width*16/15,t.rect.y+t.rect.height*13/16,t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height*13/16),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ur(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height*3/5,_.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height/9,_.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height*3/5,_.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height*4/5,_.Bottom))}function fr(r){r.iconRect=new a(0,0,0,0)}function dr(r){r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height/4,r.rect.width/2,r.rect.height*6/11),r.fullTextRect=r.textRect}function pr(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x+t.rect.width*8/16,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x+t.rect.width/4,t.rect.ey),r.lineTo(t.rect.x+t.rect.width*5/16,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x,t.rect.y+t.rect.height*3/4),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function yr(r){r.iconRect=new a(0,0,0,0),r.fullIconRect=r.iconRect}function vr(r){r.textRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height*3/4-r.paddingTopNum-r.paddingBottomNum),r.fullTextRect=r.textRect}function gr(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height*3/8,_.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,_.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height*3/8,_.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/4,r.rect.ey,_.Bottom))}function mr(r,t){r.beginPath();var e=t.rect.width/6;r.moveTo(t.rect.x,t.rect.y),r.lineTo(t.rect.ex-e,t.rect.y),r.lineTo(t.rect.ex,t.rect.y+e),r.lineTo(t.rect.ex,t.rect.ey),r.lineTo(t.rect.x,t.rect.ey),r.closePath(),r.moveTo(t.rect.ex-e,t.rect.y),r.lineTo(t.rect.ex-e,t.rect.y+e),r.lineTo(t.rect.ex,t.rect.y+e),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function wr(r){var t=0,e=0;r.text&&(r.paddingRightNum?t=r.paddingRightNum:e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1)),r.iconRect=new a(r.rect.x,r.rect.y,r.rect.width-t,r.rect.height-e),r.fullIconRect=r.rect}function br(r){if(r.paddingRightNum){var t=r.paddingRightNum-5;r.textRect=new a(r.rect.x+r.rect.width-t,r.rect.y,t,r.rect.height-r.textOffsetY*2)}else{var e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1);r.textRect=new a(r.rect.x,r.rect.y+r.rect.height-e,r.rect.width-r.textOffsetX*2,e)}r.fullTextRect=r.rect}function kr(r){var t=0,e=0;r.text&&(r.paddingRightNum?t=r.paddingRightNum:e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1)),r.anchors.push(new R(r.rect.x,r.rect.y+(r.rect.height-e)/2,_.Left)),r.anchors.push(new R(r.rect.x+(r.rect.width-t)/2,r.rect.y,_.Up)),r.anchors.push(new R(r.rect.x+r.rect.width-t,r.rect.y+(r.rect.height-e)/2,_.Right)),r.anchors.push(new R(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height-e,_.Bottom))}var pe=function(){function r(t,e,i,n,o,p){o===void 0&&(o=""),p===void 0&&(p=""),this.points=[],this.fillStyle="",this.strokeStyle="",this.points.push(t),this.points.push(e),this.points.push(i),this.points.push(n),this.fillStyle=o,this.strokeStyle=p||o}return r.prototype.render=function(t){t.save(),t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.beginPath();for(var e=0;e<this.points.length;++e)e?t.lineTo(this.points[e].x,this.points[e].y):t.moveTo(this.points[e].x,this.points[e].y);t.closePath(),this.fillStyle&&t.fill(),t.stroke(),t.restore()},r}(),Sr=function(){function r(t,e,i,n,o){n===void 0&&(n="#ddd"),o===void 0&&(o="#ccc"),this.surfaces=[];var p=e*Math.sin(45*Math.PI/180),S=new R(t.x,t.y+p),U=new R(t.ex-p,t.y+p),j=new R(t.ex-p,t.ey),rt=new R(t.x,t.ey);this.surfaces.push(new pe(S,U,j,rt,n,o)),this.surfaces.push(new pe(S,new R(t.x+p,t.y),new R(t.ex,t.y),U,we(.5,n),o)),this.surfaces.push(new pe(U,new R(t.ex,t.y),new R(t.ex,t.ey-p),j,we(.6,n),o))}return r.prototype.render=function(t){for(var e=0,i=this.surfaces;e<i.length;e++){var n=i[e];n.render(t)}},r}();function xr(r,t){new Sr(t.rect,t.z,t.zRotate,t.fillStyle,t.strokeStyle).render(r)}function Cr(r){var t=r.z*Math.sin(45*Math.PI/180);r.anchors.push(new R(r.rect.x,r.rect.ey-(r.rect.height-t)/2,_.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+t/2,_.Up)),r.anchors.push(new R(r.rect.ex-t/2,r.rect.y+r.rect.height/2,_.Right)),r.anchors.push(new R(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height,_.Bottom))}function Tr(r){r.fullIconRect=r.fullTextRect,r.iconRect=new a(r.fullIconRect.x,r.fullIconRect.y,r.fullIconRect.width,r.fullIconRect.height*2/3)}function Ir(r){var t=r.z*Math.sin(45*Math.PI/180);r.fullTextRect=new a(r.rect.x,r.rect.y+t,r.rect.width-t,r.rect.height-t),r.textRect=new a(r.fullTextRect.x+10,r.fullTextRect.y+r.fullTextRect.height*2/3,r.fullTextRect.width-20,r.fullTextRect.height/3-5)}function Lr(r,t){r.beginPath();var e=t.rect.width/4,i=t.rect.x+t.rect.width/2;r.arc(i,t.rect.y+e,e,0,Math.PI*2),r.moveTo(t.rect.x,t.rect.y+e*3),r.lineTo(t.rect.ex,t.rect.y+e*3),r.moveTo(i,t.rect.y+e*2),r.lineTo(i,t.rect.y+e*4),r.moveTo(i,t.rect.y+e*4),r.lineTo(t.rect.x,t.rect.ey),r.moveTo(i,t.rect.y+e*4),r.lineTo(t.rect.ex,t.rect.ey),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function Pr(r){r.iconRect=new a(0,0,0,0)}function Rr(r){r.textRect=void 0,r.fullTextRect=r.textRect}function Le(r){r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function Pe(r){var t=r.rect.height-r.paddingTopNum-r.paddingBottomNum;r.textRect=new a(r.rect.x+r.paddingLeftNum+t,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum-t,t),r.fullTextRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t)}function Er(r,t){!t.points||!t.points[0]||(r.beginPath(),r.moveTo(t.points[0].x,t.points[0].y),t.points.forEach(function(e){r.lineTo(e.x,e.y)}),t.closePath&&!t.doing&&r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke())}function Ar(r){if(!(!r.points||!r.points.length)){var t=r.points[0],e=r.points[r.points.length-1];t.x<e.x?(r.anchors.push(new R(t.x,t.y,_.Left)),r.anchors.push(new R(e.x,e.y,_.Right))):(r.anchors.push(new R(t.x,t.y,_.Right)),r.anchors.push(new R(e.x,e.y,_.Left)))}}function _r(r){for(var t=Nr(r),e=5,i=0;i<e;i++)if(i!==2){var n=r.rect.x+r.rect.width*(i+1)/(e+1),o=r.rect.y;n<r.rect.x+t?o=ue(r.rect.x+t,o+t,n,t,-1):n>r.rect.x+r.rect.width-t&&(o=ue(r.rect.x+r.rect.width-t,o+t,n,t,-1)),r.anchors.push(new R(n,o,_.Up))}for(var p=3,i=0;i<p;i++){var o=r.rect.y+r.rect.height*(i+1)/(p+1),n=r.rect.x+r.rect.width;o<r.rect.y+t?n=le(n-t,r.rect.y+t,o,t):o>r.rect.y+r.rect.height-t&&(n=le(n-t,r.rect.y+r.rect.height-t,o,t)),r.anchors.push(new R(n,o,_.Right))}for(var S=5,i=0;i<S;i++)if(i!==2){var n=r.rect.x+r.rect.width*(i+1)/(S+1),o=r.rect.y+r.rect.height;n<r.rect.x+t?o=ue(r.rect.x+t,o-t,n,t):n>r.rect.x+r.rect.width-t&&(o=ue(r.rect.x+r.rect.width-t,o-t,n,t)),r.anchors.push(new R(n,o,_.Bottom))}for(var U=3,i=0;i<U;i++){var o=r.rect.y+r.rect.height*(i+1)/(U+1),n=r.rect.x;o<r.rect.y+t?n=le(n+t,r.rect.y+t,o,t,-1):o>r.rect.y+r.rect.height-t&&(n=le(n+t,r.rect.y+r.rect.height-t,o,t,-1)),r.anchors.push(new R(n,o,_.Left))}}function Nr(r){var t=r.borderRadius,e=r.borderRadius;r.borderRadius<1&&(t=r.rect.width*r.borderRadius,e=r.rect.height*r.borderRadius);var i=t<e?t:e;return r.rect.width<2*i&&(i=r.rect.width/2),r.rect.height<2*i&&(i=r.rect.height/2),i}function le(r,t,e,i,n){return n===void 0&&(n=1),n*Math.sqrt(Math.pow(i,2)-Math.pow(e-t,2))+r}function ue(r,t,e,i,n){return n===void 0&&(n=1),n*Math.sqrt(Math.pow(i,2)-Math.pow(e-r,2))+t}function Mr(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height),r.closePath(),r.stroke()}function Or(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height,4)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height,2))}function Br(r,t){if(!(!t.points||!t.points[1])){r.beginPath(),r.moveTo(t.points[0].x,t.points[0].y);for(var e=1;e<t.points.length;)if(t.points[e].data)if(t.points[e+2])r.bezierCurveTo(t.points[e].x,t.points[e].y,t.points[e+1].x,t.points[e+1].y,t.points[e+2].x,t.points[e+2].y),e+=2;else break;else r.lineTo(t.points[e].x,t.points[e].y),++e;t.closePath&&!t.doing&&r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}}var Rt={},Ot={},Ft={},zt={},Nt={},qt={};function Dr(){Rt.combine=M,Rt.div=M,Rt.graffiti=Er,zt.graffiti=Ar,Rt.lines=Br,Rt.square=M,Rt.rectangle=M,Ot.rectangle=Le,Ft.rectangle=Pe,Rt.circle=V,Ot.circle=at,Ft.circle=it,zt.circle=Xe,Rt.triangle=N,zt.triangle=G,Ot.triangle=st,Ft.triangle=h,Rt.diamond=Q,Ot.diamond=f,Ft.diamond=I,Rt.hexagon=rr,Ot.hexagon=nr,Ft.hexagon=or,zt.hexagon=ir,Rt.pentagon=$e,Ot.pentagon=Ze,Ft.pentagon=tr,zt.pentagon=er,Rt.pentagram=sr,Ot.pentagram=hr,Ft.pentagram=cr,zt.pentagram=ar,Rt.leftArrow=tt,zt.leftArrow=et,Ot.leftArrow=B,Ft.leftArrow=Y,Rt.rightArrow=D,zt.rightArrow=et,Ot.rightArrow=X,Ft.rightArrow=ot,Rt.twowayArrow=k,zt.twowayArrow=et,Ot.twowayArrow=ut,Ft.twowayArrow=lt,Rt.cloud=lr,zt.cloud=ur,Ot.cloud=fr,Ft.cloud=dr,Rt.message=pr,zt.message=gr,Ot.message=yr,Ft.message=vr,Rt.file=mr,Rt.text=z,Ot.text=gt,Rt.line=H,zt.line=Z,Ot.line=gt,Ft.line=bt,Rt.image=function(r,t){},Ot.image=wr,Ft.image=br,zt.image=kr,Rt.cube=xr,zt.cube=Cr,Ot.cube=Tr,Ft.cube=Ir,Rt.people=Lr,Ot.people=Pr,Ft.people=Rr,Rt.mindNode=M,zt.mindNode=_r,Ot.mindNode=Le,Ft.mindNode=Pe,Rt.mindLine=Mr,zt.mindLine=Or,Nt.line={drawFn:Wt,drawControlPointsFn:Dt,controlPointsFn:Ht,pointIn:Gt},Nt.polyline={drawFn:At,drawControlPointsFn:Qt,controlPointsFn:oe,dockControlPointFn:fe,pointIn:Gt},Nt.curve={drawFn:be,drawControlPointsFn:ke,controlPointsFn:We,pointIn:Se},Nt.mind={drawFn:be,drawControlPointsFn:ke,controlPointsFn:He,pointIn:Se},qt.triangleSolid=Ce,qt.triangle=qe,qt.diamondSolid=Te,qt.diamond=Ve,qt.circleSolid=Ie,qt.circle=Ye,qt.line=Qe,qt.lineUp=Ge,qt.lineDown=Je}Dr();function Re(r,t,e,i,n,o){return Rt[r]&&o?!1:(Rt[r]=t,zt[r]=e,Ot[r]=i,Ft[r]=n,!0)}function Fr(r,t,e,i,n,o,p,S,U,j){return j===void 0&&(j=!0),Nt[r]&&!j?!1:(Nt[r]={drawFn:t,drawControlPointsFn:e,controlPointsFn:i,dockControlPointFn:n,pointIn:o,getLength:p,getCenter:S,getPointByPos:U},!0)}function bi(r,t,e){return qt[r]&&e?!1:(qt[r]=t,!0)}window.registerTopologyNode=Re,window.registerTopologyLine=Fr;var zr=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Mt=function(r){zr(t,r);function t(e){var i=r.call(this)||this,n={name:"curve",fromArrow:"",toArrow:"",controlPoints:[],fromArrowSize:5,toArrowSize:5,borderWidth:0,borderColor:"#000000",animateColor:"",animateSpan:1,animateFromSize:0,animateToSize:0,animateDotSize:3,textBackground:"#ffffff"};if(i.fromData(n,e),i.type=g.Line,e.from&&(i.from=new R(e.from.x,e.from.y,e.from.direction,e.from.anchorIndex,e.from.id,e.from.hidden,e.autoAnchor)),e.to&&(i.to=new R(e.to.x,e.to.y,e.to.direction,e.to.anchorIndex,e.to.id,e.to.hidden,e.autoAnchor)),e.name==="mind"&&(!e.controlPoints||e.controlPoints.length>2))e.controlPoints=void 0,i.calcControlPoints(!0);else if(e.controlPoints){i.controlPoints=[];for(var o=0,p=e.controlPoints;o<p.length;o++){var S=p[o];i.controlPoints.push(new R(S.x,S.y,S.direction,S.anchorIndex,S.id))}}return e.children&&(i.children=[],e.children.forEach(function(U){i.children.push(new t(U))})),i}return t.prototype.setFrom=function(e,i){i===void 0&&(i=""),this.from=e,this.fromArrow=i,this.textRect=void 0},t.prototype.setTo=function(e,i){i===void 0&&(i="triangleSolid"),this.to=e,this.toArrow=i,this.textRect=void 0},t.prototype.calcControlPoints=function(e){this.name!=="line"&&this.manualCps&&!e||(this.textRect=void 0,this.from&&this.to&&Nt[this.name]&&Nt[this.name].controlPointsFn(this))},t.prototype.draw=function(e){if(this.animateDot){if(e.fillStyle=e.strokeStyle,this.animateType==="dot"){e.beginPath(),e.arc(this.animateDot.x,this.animateDot.y,this.animateDotSize,0,2*Math.PI,!1),e.fill();return}else if(this.animateType==="comet"){var i=this.getBubbles();e.save();for(var n=0,o=i;n<o.length;n++){var p=o[n];e.globalAlpha=p.a,e.beginPath(),e.arc(p.pos.x,p.pos.y,p.r,0,2*Math.PI,!1),e.fill()}e.restore()}}switch(!this.isAnimate&&this.borderWidth>0&&this.borderColor&&(e.save(),this.lineJoin&&(e.lineJoin=this.lineJoin),e.lineWidth=this.lineWidth+this.borderWidth,e.strokeStyle=this.borderColor,Nt[this.name]&&Nt[this.name].drawFn(e,this),e.restore()),this.strokeType){case 1:this.strokeLinearGradient(e);break}(!this.isAnimate||this.animateType!=="comet")&&Nt[this.name]&&(this.lineJoin&&(e.lineJoin=this.lineJoin),Nt[this.name].drawFn(e,this));var S=nt.Store.get(this.generateStoreKey("LT:scale"))||1;if(this.fromArrow&&qt[this.fromArrow]){e.save(),e.beginPath(),e.lineDashOffset=0,e.setLineDash([]),e.fillStyle=this.fromArrowColor||e.strokeStyle,e.strokeStyle=e.fillStyle;var U=this.to;this.name==="curve"?U=Vt(.95-this.lineWidth/100,this.to,this.controlPoints[1],this.controlPoints[0],this.from):this.name!=="line"&&this.controlPoints.length&&(U=this.controlPoints[0]),qt[this.fromArrow](e,U,this.from,this.fromArrowSize*S),e.restore()}if(this.toArrow&&qt[this.toArrow]){e.save(),e.beginPath(),e.lineDashOffset=0,e.setLineDash([]),e.fillStyle=this.toArrowColor||e.strokeStyle,e.strokeStyle=e.fillStyle;var U=this.from;this.name==="curve"?U=Vt(.95-this.lineWidth/100,this.from,this.controlPoints[0],this.controlPoints[1],this.to):this.name==="mind"?U=Vt(.96-this.lineWidth/100,this.from,this.controlPoints[0],this.controlPoints[1],this.to):this.name!=="line"&&this.controlPoints.length&&(U=this.controlPoints[this.controlPoints.length-1]),qt[this.toArrow](e,U,this.to,this.toArrowSize*S),e.restore()}this.text&&!this.isAnimate&&!this.hiddenText&&(this.textRect||this.calcTextRect(),z(e,this))},t.prototype.pointIn=function(e){return Nt[this.name].pointIn(e,this)},t.prototype.getLen=function(){switch(this.name){case"line":return l(this.from,this.to);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return l(this.from,this.to);for(var e=0,i=this.from,n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];e+=l(i,p),i=p}return e+=l(i,this.to),e|0;case"curve":case"mind":return d(this.from,this.controlPoints[0],this.controlPoints[1],this.to);default:if(Nt[this.name].getLength)return Nt[this.name].getLength(this)}return 0},t.prototype.strokeLinearGradient=function(e){if(!(!this.lineGradientFromColor||!this.lineGradientToColor)){var i=this.from,n=this.to,o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.lineGradientFromColor),o.addColorStop(1,this.lineGradientToColor),e.strokeStyle=o}},t.prototype.calcTextRect=function(){if(!this.from||!this.to){this.textRect=void 0;return}var e=this.getCenter(),i=Math.abs(this.from.x-this.to.x);i<100&&(i=100),this.text&&!this.text.split&&(this.text+="");var n=this.lineHeight*this.fontSize*(this.textMaxLine||this.text&&this.text.split(`
`).length||1);this.textRect=new a(e.x-i/2,e.y-n/2,i,n)},t.prototype.getTextRect=function(){return this.calcTextRect(),this.textRect},t.prototype.getCenter=function(){var e=new R(this.from.x,this.from.y);switch(this.name){case"line":e=this.getLineCenter(this.from,this.to);break;case"polyline":var i=Math.round(this.controlPoints.length/2);e=this.getLineCenter(this.controlPoints[i-1]||this.from,this.controlPoints[i]||this.to);break;case"curve":e=Vt(.5,this.to,this.controlPoints[1],this.controlPoints[0],this.from);break;default:Nt[this.name].getCenter&&(e=Nt[this.name].getCenter(this))}return e},t.prototype.getLineCenter=function(e,i){return new R((e.x+i.x)/2,(e.y+i.y)/2)},t.prototype.getPointByPos=function(e){if(e<=0)return this.from;switch(this.name){case"line":return this.getLinePtByPos(this.from,this.to,e);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return this.getLinePtByPos(this.from,this.to,e);for(var i=[].concat(this.controlPoints,this.to),n=this.from,o=0,p=i;o<p.length;o++){var S=p[o],U=l(n,S);if(e>U)e-=U,n=S;else return this.getLinePtByPos(n,S,e)}return this.to;case"curve":return Vt(e/this.getLen(),this.from,this.controlPoints[0],this.controlPoints[1],this.to);default:if(Nt[this.name].getPointByPos)return Nt[this.name].getPointByPos(e,this)}return null},t.prototype.getPointByReversePos=function(e){if(e<=0)return this.to;switch(this.name){case"line":return this.getLinePtByPos(this.to,this.from,e);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return this.getLinePtByPos(this.to,this.from,e);var i=[];this.controlPoints.forEach(function(j){i.unshift(j)}),i.unshift(this.to);for(var n=this.to,o=0,p=i;o<p.length;o++){var S=p[o],U=l(n,S);if(e>U)e-=U,n=S;else return this.getLinePtByPos(n,S,e)}return this.from;case"curve":return Vt(e/this.getLen(),this.to,this.controlPoints[1],this.controlPoints[0],this.from);default:if(Nt[this.name].getPointByReversePos)return Nt[this.name].getPointByReversePos(e,this)}return null},t.prototype.getLinePtByPos=function(e,i,n){var o=l(e,i);if(n<=0)return e;if(n>=o)return i;var p,S;return p=e.x+(i.x-e.x)*(n/o),S=e.y+(i.y-e.y)*(n/o),new R(p,S)},t.prototype.calcRectInParent=function(e){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum;this.name==="lines"?Array.isArray(this.children)&&this.children.length>0&&(this.rectInParent={x:(this.children[0].from.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.children[0].from.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:0,height:0,rotate:0}):this.rectInParent={x:(this.from.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.from.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:0,height:0,rotate:0}},t.prototype.calcRectByParent=function(e){if(!!this.rectInParent){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum,o=e.rect.x+e.paddingLeftNum+jt(i,this.rectInParent.x)+jt(i,this.rectInParent.marginLeft),p=e.rect.y+e.paddingTopNum+jt(n,this.rectInParent.y)+jt(i,this.rectInParent.marginTop);if(this.rectInParent.marginLeft===void 0&&this.rectInParent.marginRight&&(o-=jt(i,this.rectInParent.marginRight)),this.rectInParent.marginTop===void 0&&this.rectInParent.marginBottom&&(p-=jt(i,this.rectInParent.marginBottom)),this.name==="lines"){if(Array.isArray(this.children)&&this.children.length>0){var S=this.children[0].from.x,U=this.children[0].from.y;this.translate(o-S,p-U)}}else this.translate(o-this.from.x,p-this.from.y)}},t.prototype.initAnimate=function(){this.animateStart=0,this.animateDot=void 0,this.animatePos=0},t.prototype.pauseAnimate=function(){nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0})},t.prototype.stopAnimate=function(){var e=this;this.pauseAnimate(),this.initAnimate(),setTimeout(function(){nt.Store.set(e.generateStoreKey("LT:render"),{pen:e,stop:!0})},50)},t.prototype.animate=function(e){switch(this.animatePos+=this.animateSpan,this.animateType){case"beads":this.animateReverse?this.lineDashOffset=this.animatePos:this.lineDashOffset=-this.animatePos;var i=this.lineWidth;i<5&&(i=5),this.animateLineDash?this.lineDash=this.animateLineDash:this.lineDash=[i,i*2];break;case"dot":case"comet":this.lineDash=void 0;var n=void 0;this.animateReverse?n=this.getPointByReversePos(this.animatePos+this.animateToSize):n=this.getPointByPos(this.animatePos+this.animateFromSize),this.animateDot=n;break;default:this.animateReverse?this.lineDash=[0,this.length-this.animatePos+1,this.animatePos]:this.lineDash=[this.animatePos,this.length-this.animatePos+1];break}if(this.animatePos>this.length+this.animateSpan-this.animateFromSize-this.animateToSize){if(++this.animateCycleIndex>=this.animateCycle&&this.animateCycle>0){this.animateStart=0,this.initAnimate(),nt.Store.set(this.generateStoreKey("animateEnd"),this);return}this.animatePos=this.animateSpan}},t.prototype.getBubbles=function(){for(var e=[],i=0;i<30&&this.animatePos-i>0;++i)this.animateReverse?e.push({pos:this.getPointByReversePos(this.animatePos-i*2+this.animateToSize),a:1-i*.03,r:this.lineWidth-i*.01}):e.push({pos:this.getPointByPos(this.animatePos-i*2+this.animateFromSize),a:1-i*.03,r:this.lineWidth-i*.01});return e},t.prototype.round=function(){this.from.round(),this.to.round()},t.prototype.translate=function(e,i){if(this.from){this.from.x+=e,this.from.y+=i,this.to.x+=e,this.to.y+=i,this.text&&(this.textRect=void 0);for(var n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];p.x+=e,p.y+=i}}if(this.children)for(var S=0,U=this.children;S<U.length;S++){var j=U[S];j.translate(e,i)}nt.Store.set(this.generateStoreKey("pts-")+this.id,void 0)},t.prototype.scale=function(e,i){if(this.from){this.from.x=i.x-(i.x-this.from.x)*e,this.from.y=i.y-(i.y-this.from.y)*e,this.to.x=i.x-(i.x-this.to.x)*e,this.to.y=i.y-(i.y-this.to.y)*e,this.lineWidth*=e,this.borderWidth*=e,this.fontSize*=e,this.text&&(this.textRect=void 0),this.textOffsetX*=e,this.textOffsetY*=e;for(var n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];p.x=i.x-(i.x-p.x)*e,p.y=i.y-(i.y-p.y)*e}}if(this.children)for(var S=0,U=this.children;S<U.length;S++){var j=U[S];j.scale(e,i)}nt.Store.set(this.generateStoreKey("pts-")+this.id,void 0)},t.prototype.hit=function(e,i){if(i===void 0&&(i=0),this.from.hit(e,i)||this.to.hit(e,i))return this},t.prototype.clone=function(){return new t(this)},t}(O);function Ur(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height/2,_.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,_.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,_.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,_.Bottom))}function jr(r){r.image&&r.imageWidth?r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.imageWidth,r.imageHeight):r.icon&&r.iconSize?r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.iconSize,r.iconSize):r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height*3/4-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function Kr(r){var t=r.rect.height-r.paddingTopNum-r.paddingBottomNum;r.textRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum+t*3/4,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t/4),r.fullTextRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t)}var Wr=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Hr=function(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var i=Array(r),n=0,t=0;t<e;t++)for(var o=arguments[t],p=0,S=o.length;p<S;p++,n++)i[n]=o[p];return i},Ee=["TID","events","wheres","text","fontFamily","fontSize","lineHeight","fontStyle","fontWeight","textAlign","textBaseline","textBackground","iconFamily","icon","iconSize"],_t=function(r){Wr(t,r);function t(e,i){var n=r.call(this)||this;n.imageRatio=!0,n.points=[],n.anchors=[],n.manualAnchors=[],n.rotatedAnchors=[],n.animateDuration=0,n.animateFrames=[],n.animateFrame=0;var o={zRotate:0,borderRadius:0,imageAlign:"center",gradientAngle:0,gradientRadius:.01,paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,animateFrame:0,children:[]};if(n.fromData(o,e),n.type=g.Node,i||(delete n.elementLoaded,delete n.elementRendered),delete n.animateReady,e.children&&e.children[0]&&e.children[0].parentRect&&(n.paddingLeft=e.children[0].parentRect.offsetX,n.paddingRight=0,n.paddingTop=e.children[0].parentRect.offsetY,n.paddingBottom=0),e.parentRect&&(n.rectInParent={x:e.parentRect.x*100+"%",y:e.parentRect.y*100+"%",width:e.parentRect.width*100+"%",height:e.parentRect.height*100+"%",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,rotate:e.parentRect.rotate},n.paddingTop=e.parentRect.marginY,n.paddingBottom=e.parentRect.marginY,n.paddingLeft=e.parentRect.marginX,n.paddingRight=e.parentRect.marginX),e.points&&(n.points=[],e.points.forEach(function(j){n.points.push(new R(j.x,j.y))})),e.manualAnchors&&(n.manualAnchors=[],e.manualAnchors.forEach(function(j){var rt=new R(j.x,j.y);rt.id=e.id,n.manualAnchors.push(rt)})),i&&(n.animateFrames=void 0),!i&&e.animateFrames&&e.animateFrames.length){for(var p=0,S=e.animateFrames;p<S.length;p++){var U=S[p];U.children=void 0,U.initState&&(U.initState=t.cloneState(U.initState)),U.state=t.cloneState(U.state)}n.animateFrames=e.animateFrames}return n.animateType=e.animateType?e.animateType:e.animateDuration?"custom":"",n.init(i),e.init&&e.img&&!e.image&&(n.img=e.img),e.children&&(n.children=[],e.children.forEach(function(j){var rt;switch(j.TID=n.TID,j.type){case g.Line:rt=new Mt(j),rt.calcRectByParent(n);break;default:t.prototype.calcRectByParent.apply(j,[n]),rt=new t(j),rt.parentId=n.id,rt.init(i);break}n.children.push(rt)})),n}return Object.defineProperty(t.prototype,"dockWatchers",{get:function(){return Hr([this.rect.center],this.rect.toPoints())},set:function(i){},enumerable:!0,configurable:!0}),t.cloneState=function(e){var i=new t(e,!0);return Ee.forEach(function(n){delete i[n]}),i},t.prototype.restore=function(e){if(!e&&this.animateReady&&(e=t.cloneState(this.animateReady)),!!e){for(var i in this)if(e[i]!==void 0&&i.indexOf("animate")<0&&i.indexOf("Animate")<0){if(Ee.includes(i))continue;this[i]=e[i],i==="rect"&&(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height))}this.init(!0)}},t.prototype.checkData=function(){this.rect.width=this.rect.width<0?0:this.rect.width,this.rect.height=this.rect.height<0?0:this.rect.height,this.rect.calcCenter||(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height))},t.prototype.init=function(e){this.checkData(),this.calcAbsPadding(),Ft[this.name]?Ft[this.name](this):Kr(this),Ot[this.name]?Ot[this.name](this):jr(this),this.calcAnchors(),this.elementRendered=!1,e||this.addToDiv()},t.prototype.addToDiv=function(){(this.audio||this.video||this.iframe||this.elementId||this.gif)&&nt.Store.set(this.generateStoreKey("LT:addDiv"),this)},t.prototype.removeFromDiv=function(){nt.Store.set(this.generateStoreKey("LT:removeDiv"),this)},t.prototype.hasGif=function(){if(this.gif)return!0;if(this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];if(n.type===g.Node&&n.hasGif&&n.hasGif())return!0}return!1},t.prototype.calcAbsPadding=function(){this.paddingLeftNum=jt(this.rect.width,this.paddingLeft),this.paddingRightNum=jt(this.rect.width,this.paddingRight),this.paddingTopNum=jt(this.rect.height,this.paddingTop),this.paddingBottomNum=jt(this.rect.height,this.paddingBottom)},t.prototype.draw=function(e){if(!!Rt[this.name]){switch(this.bkType){case 1:this.drawBkLinearGradient(e);break;case 2:this.drawBkRadialGradient(e);break}switch(this.strokeType){case 1:this.strokeLinearGradient(e);break}Rt[this.name](e,this),this.image||this.img&&this.elementId===""?this.drawImg(e):this.icon&&(e.save(),e.shadowColor="",e.shadowBlur=0,K(e,this),e.restore()),this.name!=="text"&&this.text&&!this.hiddenText&&z(e,this)}},t.prototype.strokeLinearGradient=function(e){if(!(!this.lineGradientFromColor||!this.lineGradientToColor)){var i=new R(this.rect.x,this.rect.center.y),n=new R(this.rect.ex,this.rect.center.y);this.lineGradientAngle%90==0&&this.lineGradientAngle%180?this.lineGradientAngle%270?(i.x=this.rect.center.x,i.y=this.rect.y,n.x=this.rect.center.x,n.y=this.rect.ey):(i.x=this.rect.center.x,i.y=this.rect.ey,n.x=this.rect.center.x,n.y=this.rect.y):this.lineGradientAngle&&(i.rotate(this.lineGradientAngle,this.rect.center),n.rotate(this.lineGradientAngle,this.rect.center));var o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.lineGradientFromColor),o.addColorStop(1,this.lineGradientToColor),e.strokeStyle=o}},t.prototype.drawBkLinearGradient=function(e){if(!(!this.gradientFromColor||!this.gradientToColor)){var i=new R(this.rect.x,this.rect.center.y),n=new R(this.rect.ex,this.rect.center.y);this.gradientAngle%90==0&&this.gradientAngle%180?this.gradientAngle%270?(i.x=this.rect.center.x,i.y=this.rect.y,n.x=this.rect.center.x,n.y=this.rect.ey):(i.x=this.rect.center.x,i.y=this.rect.ey,n.x=this.rect.center.x,n.y=this.rect.y):this.gradientAngle&&(i.rotate(this.gradientAngle,this.rect.center),n.rotate(this.gradientAngle,this.rect.center));var o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.gradientFromColor),o.addColorStop(1,this.gradientToColor),e.fillStyle=o}},t.prototype.drawBkRadialGradient=function(e){if(!(!this.gradientFromColor||!this.gradientToColor)){var i=this.rect.width;i<this.rect.height&&(i=this.rect.height),i*=.5;var n=e.createRadialGradient(this.rect.center.x,this.rect.center.y,i*this.gradientRadius,this.rect.center.x,this.rect.center.y,i);n.addColorStop(0,this.gradientFromColor),n.addColorStop(1,this.gradientToColor),e.fillStyle=n}},t.prototype.drawImg=function(e){var i=this;this.lastImage!==this.image&&(this.img=void 0,this.lastImage&&this.lastImage.indexOf(".gif")>0&&nt.Store.set(this.generateStoreKey("LT:addDiv"),this));var n=this.image&&this.image.indexOf(".gif")>0;if(n){if(this.img){this.TID&&!this.elementLoaded&&(this.elementLoaded=!0,nt.Store.set(this.generateStoreKey("LT:addDiv"),this));return}}else if(this.img){e.save(),e.shadowColor="",e.shadowBlur=0;var o=this.getIconRect(),p=o.x,S=o.y,U=o.width,j=o.height;switch(this.imageWidth&&(U=this.imageWidth),this.imageHeight&&(j=this.imageHeight),this.imgNaturalWidth&&this.imgNaturalHeight&&this.imageRatio&&(this.imageWidth?j=this.imgNaturalHeight/this.imgNaturalWidth*U:U=this.imgNaturalWidth/this.imgNaturalHeight*j),p+=(o.width-U)/2,S+=(o.height-j)/2,this.imageAlign){case"top":S=o.y;break;case"bottom":S=o.ey-j;break;case"left":p=o.x;break;case"right":p=o.ex-U;break;case"left-top":p=o.x,S=o.y;break;case"right-top":p=o.ex-U,S=o.y;break;case"left-bottom":p=o.x,S=o.ey-j;break;case"right-bottom":p=o.ex-U,S=o.ey-j;break}this.iconRotate&&(e.translate(o.center.x,o.center.y),e.rotate(this.iconRotate*Math.PI/180),e.translate(-o.center.x,-o.center.y)),this.imageHide||e.drawImage(this.img,p,S,U,j),e.restore();return}else if(T[this.image]){this.img=T[this.image].img,this.lastImage=this.image,this.imgNaturalWidth=this.img.naturalWidth,this.imgNaturalHeight=this.img.naturalHeight,this.drawImg(e);return}if(!!this.image){var rt=new Image;rt.crossOrigin="anonymous",rt.src=this.image,rt.onload=function(){i.lastImage=i.image,i.imgNaturalWidth=rt.naturalWidth,i.imgNaturalHeight=rt.naturalHeight,i.img=rt,T[i.image]={img:rt},nt.Store.set(i.generateStoreKey("LT:imageLoaded"),!0),!i.gif&&n&&(i.gif=!0,i.TID&&(i.elementLoaded=!0,nt.Store.set(i.generateStoreKey("LT:addDiv"),i)))}}},t.prototype.calcAnchors=function(){var e=this;this.anchors=[],zt[this.name]?zt[this.name](this):Ur(this),this.manualAnchors&&this.manualAnchors.forEach(function(i){var n=Math.abs(i.x-e.rect.center.x),o=Math.abs(i.y-e.rect.center.y);n>o?i.x<e.rect.center.x?i.direction=_.Left:i.direction=_.Right:i.y<e.rect.center.y?i.direction=_.Up:i.direction=_.Bottom,e.anchors.push(i)}),this.calcRotateAnchors()},t.prototype.calcRotateAnchors=function(e){e===void 0&&(e=this.rotate),this.rotatedAnchors=[];for(var i=0,n=this.anchors;i<n.length;i++){var o=n[i];this.rotatedAnchors.push(o.clone().rotate(e,this.rect.center))}},t.prototype.getTextRect=function(){var e=this.textRect;return!this.icon&&!this.image&&(e=this.fullTextRect),e},t.prototype.getIconRect=function(){var e=this.iconRect;return this.text||(e=this.fullIconRect||this.fullTextRect||this.rect),e},t.prototype.calcRectByParent=function(e){if(!!this.rectInParent){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum,o=e.rect.x+e.paddingLeftNum+jt(i,this.rectInParent.x)+jt(i,this.rectInParent.marginLeft),p=e.rect.y+e.paddingTopNum+jt(n,this.rectInParent.y)+jt(i,this.rectInParent.marginTop),S=jt(i,this.rectInParent.width),U=jt(n,this.rectInParent.height);this.rectInParent.marginLeft===void 0&&this.rectInParent.marginRight&&(o-=jt(i,this.rectInParent.marginRight)),this.rectInParent.marginTop===void 0&&this.rectInParent.marginBottom&&(p-=jt(i,this.rectInParent.marginBottom)),this.rect=new a(o,p,S,U),this.rectInParent.rotate||(this.rectInParent.rotate=0);var j=e.rotate+e.offsetRotate;this.rotate=this.rectInParent.rotate+j,this.rectInParent.rect||(this.rectInParent.rect=this.rect.clone())}},t.prototype.calcChildrenRect=function(){if(!!this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.calcRectByParent(this),n.type===g.Node&&(n.init(),n.calcChildrenRect())}},t.prototype.calcRectInParent=function(e){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum;this.rectInParent={x:(this.rect.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.rect.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:this.rect.width*100/i+"%",height:this.rect.height*100/n+"%",rotate:this.rectInParent?this.rectInParent.rotate||0:this.rotate||0,rect:this.rect.clone()}},t.prototype.initAnimate=function(){if(!!this.animateFrames){for(var e=0,i=0;i<this.animateFrames.length;++i)this.animateFrames[i].start=e,e+=this.animateFrames[i].duration,this.animateFrames[i].end=e,this.animateFrames[i].initState=t.cloneState(i?this.animateFrames[i-1].state:this),this.animateFrames[i].offsetRect=new a(this.animateFrames[i].state.rect.x-this.animateFrames[i].initState.rect.x,this.animateFrames[i].state.rect.y-this.animateFrames[i].initState.rect.y,this.animateFrames[i].state.rect.width-this.animateFrames[i].initState.rect.width,this.animateFrames[i].state.rect.height-this.animateFrames[i].initState.rect.height);this.animateDuration=e,this.animateReady=t.cloneState(this),this.animatePos=0,this.animateFrame=0}},t.prototype.pauseAnimate=function(){this.animateFrame=this._animateFrame,this.animatePos=this._animatePos,nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0})},t.prototype.stopAnimate=function(){this.animateStart=0,nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0}),this.restore(),this.initAnimate(),nt.Store.set(this.generateStoreKey("LT:render"),{pen:this,stop:!0})},t.prototype.animate=function(e){var i=this;if(!(this.animateStart<1)){var n=e-this.animateStart;if(this.animateFrame>0&&(this.animateFrames.forEach(function(rt,ht){i.animateFrame<ht+1&&(n+=rt.duration)}),n+=this.animatePos),n>this.animateDuration){if(this.animatePos=0,this.animateFrame=0,this.restore(),this.animateCycle>0&&++this.animateCycleIndex>=this.animateCycle){this.animateStart=0,this.animateCycleIndex=0,nt.Store.set(this.generateStoreKey("animateEnd"),this),this.animateAlone||nt.Store.set(this.generateStoreKey("LT:rectChanged"),this);return}this.animateStart=e,n=0}for(var o=!1,p=0;p<this.animateFrames.length;++p){var S=this.animateFrames[p];if(n>=S.start&&n<S.end){S.state.dash&&(this.dash=S.state.dash),S.state.strokeStyle&&(this.strokeStyle=S.state.strokeStyle),S.state.fillStyle&&(this.fillStyle=S.state.fillStyle),S.state.text&&(this.text=S.state.text),S.state.fontColor&&(this.fontColor=S.state.fontColor),S.state.fontFamily&&(this.fontFamily=S.state.fontFamily),S.state.fontSize&&(this.fontSize=S.state.fontSize),S.state.lineHeight&&(this.lineHeight=S.state.lineHeight),S.state.fontStyle&&(this.fontStyle=S.state.fontStyle),S.state.fontWeight&&(this.fontWeight=S.state.fontWeight),S.state.textAlign&&(this.textAlign=S.state.textAlign),S.state.textBaseline&&(this.textBaseline=S.state.textBaseline),S.state.textBackground&&(this.textBackground=S.state.textBackground),S.state.iconFamily&&(this.iconFamily=S.state.iconFamily),S.state.icon&&(this.icon=S.state.icon),S.state.iconSize&&(this.iconSize=S.state.iconSize),S.state.iconColor&&(this.iconColor=S.state.iconColor),this.visible=S.state.visible,this._animateFrame=p+1,this._animateFrame>this.animateFrame&&(this.animateFrame=0,this.animatePos=0),this._animatePos=n-S.start;var U=this._animatePos/S.duration;if(S.linear){if(S.state.rect.x!==S.initState.rect.x&&(this.rect.x=S.initState.rect.x+S.offsetRect.x*U,o=!0),S.state.rect.y!==S.initState.rect.y&&(this.rect.y=S.initState.rect.y+S.offsetRect.y*U,o=!0),S.state.rect.width!==S.initState.rect.width&&(this.rect.width=S.initState.rect.width+S.offsetRect.width*U,o=!0),S.state.rect.height!==S.initState.rect.height&&(this.rect.height=S.initState.rect.height+S.offsetRect.height*U,o=!0),this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calcCenter(),S.initState.z!==void 0&&S.state.z!==S.initState.z&&(this.z=S.initState.z+(S.state.z-S.initState.z)*U,o=!0),S.state.borderRadius!==S.initState.borderRadius&&(this.borderRadius=S.initState.borderRadius+(S.state.borderRadius-S.initState.borderRadius)*U),S.state.lineWidth!==S.initState.lineWidth&&(this.lineWidth=S.initState.lineWidth+(S.state.lineWidth-S.initState.lineWidth)*U),S.state.rotate!==S.initState.rotate&&(this.rotate=S.initState.rotate+(S.state.rotate-S.initState.rotate)*U,o=!0),S.state.globalAlpha!==S.initState.globalAlpha&&(this.globalAlpha=S.initState.globalAlpha+(S.state.globalAlpha-S.initState.globalAlpha)*U),S.state.lineDashOffset&&(this.lineDashOffset?this.lineDashOffset+=S.state.lineDashOffset:this.lineDashOffset=S.state.lineDashOffset),S.state.value!==S.initState.value&&(this.value=(S.initState.value||0)+((S.state.value||0)-(S.initState.value||0))*U),S.state.num!==S.initState.num&&(this.num=(S.initState.num||0)+((S.state.num||0)-(S.initState.num||0))*U),S.state.num1!==S.initState.num1&&(this.num1=(S.initState.num1||0)+((S.state.num1||0)-(S.initState.num1||0))*U),S.state.num2!==S.initState.num2&&(this.num2=(S.initState.num2||0)+((S.state.num2||0)-(S.initState.num2||0))*U),S.state.num3!==S.initState.num3&&(this.num3=(S.initState.num3||0)+((S.state.num3||0)-(S.initState.num3||0))*U),S.state.data)for(var j in S.state.data)typeof S.state.data[j]=="number"?this.data[j]=(S.initState.data[j]||0)+((S.state.data[j]||0)-(S.initState.data[j]||0))*U:S.state.data[j]!==void 0&&S.state.data[j]!==void 0&&(this.data[j]=S.state.data[j])}else this.rect=S.state.rect,this.lineWidth=S.state.lineWidth,this.rotate=S.state.rotate,this.globalAlpha=S.state.globalAlpha,this.lineDashOffset=S.state.lineDashOffset}}o&&(this.init(!0),this.animateAlone||nt.Store.set(this.generateStoreKey("LT:rectChanged"),this))}},t.prototype.scale=function(e,i){if(i||(i=this.rect.center),this.oldRect=this.rect.clone(),this.rect.x=i.x-(i.x-this.rect.x)*e,this.rect.y=i.y-(i.y-this.rect.y)*e,this.textOffsetX*=e,this.textOffsetY*=e,this.z*=e,this.rect.width*=e,this.rect.height*=e,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.lineWidth*=e,this.imageWidth&&(this.imageWidth*=e),this.imageHeight&&(this.imageHeight*=e),this.lastImage=void 0,this.fontSize*=e,this.iconSize*=e,typeof this.paddingLeft=="number"&&(this.paddingLeft*=e),typeof this.paddingTop=="number"&&(this.paddingTop*=e),typeof this.paddingRight=="number"&&(this.paddingRight*=e),typeof this.paddingBottom=="number"&&(this.paddingBottom*=e),this.rectInParent&&(typeof this.rectInParent.x=="number"&&(this.rectInParent.x*=e),typeof this.rectInParent.y=="number"&&(this.rectInParent.y*=e),typeof this.rectInParent.width=="number"&&(this.rectInParent.width*=e),typeof this.rectInParent.height=="number"&&(this.rectInParent.height*=e),typeof this.rectInParent.marginLeft=="number"&&(this.rectInParent.marginLeft*=e),typeof this.rectInParent.marginTop=="number"&&(this.rectInParent.marginTop*=e),typeof this.rectInParent.marginRight=="number"&&(this.rectInParent.marginRight*=e),typeof this.rectInParent.marginBottom=="number"&&(this.rectInParent.marginBottom*=e)),this.rect.calcCenter(),this.animateFrames&&this.animateFrames.length)for(var n=0,o=this.animateFrames;n<o.length;n++){var p=o[n];p.initState&&(p.initState.scale||(p.initState=new t(p.initState)),p.initState.scale(e,i)),p.state&&(p.state.scale||(p.state=new t(p.state)),p.state.scale(e,i)),p.initState&&p.state&&(p.state.fontSize=p.initState.fontSize)}if(this.scalePoints(e,e),this.elementRendered=!1,this.init(),this.children)for(var S=0,U=this.children;S<U.length;S++){var p=U[S];p.scale(e,i)}this.animateReady&&this.animateReady.scale&&this.animateReady.scale(e,i)},t.prototype.scalePoints=function(e,i){var n=this;(this.points||this.manualAnchors)&&this.oldRect&&(e||(e=this.rect.width/this.oldRect.width),i||(i=this.rect.height/this.oldRect.height),this.points&&this.points.forEach(function(o){o.x=n.rect.x+(o.x-n.oldRect.x)*e,o.y=n.rect.y+(o.y-n.oldRect.y)*i}),this.manualAnchors&&this.manualAnchors.forEach(function(o){o.x=n.rect.x+(o.x-n.oldRect.x)*e,o.y=n.rect.y+(o.y-n.oldRect.y)*i}))},t.prototype.translate=function(e,i){if(this.rect.x+=e,this.rect.y+=i,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calcCenter(),this.animateReady&&this.animateReady.translate(e,i),this.animateFrames&&this.animateFrames.length)for(var n=0,o=this.animateFrames;n<o.length;n++){var p=o[n],S=p.initState,U=p.state;S&&S.translate&&S.translate(e,i),U&&U.translate&&U.translate(e,i)}if(this.points&&this.points.forEach(function(ct){ct.x+=e,ct.y+=i}),this.manualAnchors&&this.manualAnchors.forEach(function(ct){ct.x+=e,ct.y+=i}),this.init(),this.children)for(var j=0,rt=this.children;j<rt.length;j++){var ht=rt[j];ht.translate(e,i)}},t.prototype.initRect=function(){if(this.rect.init(),this.children){this.calcChildrenRect();for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n instanceof t&&n.initRect()}}},t.prototype.pushPoint=function(e){var i=this;this.points.push(e),this.rect||(this.rect=new a(0,0,0,0)),this.points.forEach(function(n){(!i.rect.x||i.rect.x>n.x)&&(i.rect.x=n.x),(!i.rect.y||i.rect.y>n.y)&&(i.rect.y=n.y),i.rect.ex<n.x&&(i.rect.ex=n.x),i.rect.ey<n.y&&(i.rect.ey=n.y)}),this.rect.width=this.rect.ex-this.rect.x,this.rect.height=this.rect.ey-this.rect.y},t.prototype.nearestAnchor=function(e){for(var i=99999,n=0,o=0;o<this.rotatedAnchors.length;++o){var p=je(e,this.rotatedAnchors[o]);i>p&&(i=p,n=o)}return{index:n,direction:this.rotatedAnchors[n].direction}},t.prototype.hitInSelf=function(e,i){if(i===void 0&&(i=0),this.rotate%360==0)return this.rect.hit(e,i);for(var n=this.rect.toPoints(),o=0,p=n;o<p.length;o++){var S=p[o];S.rotate(this.rotate,this.rect.center)}return c(e,n)},t.prototype.hit=function(e,i){i===void 0&&(i=0);var n;if(this.hitInSelf(e,i)&&(n=this),this.children)for(var o=this.children.length,p=o-1;p>-1;--p){var S=this.children[p],U=S.hit(e,i);if(U){n=U;break}}return n},t.prototype.round=function(){if(this.rect.round(),this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.rect.round()}},t.prototype.clone=function(){var e=new t(this);return e.setTID(this.TID),e.elementRendered=!1,e.elementLoaded=!1,this.name!=="div"&&(e.elementId=void 0),e},t}(O),Kt;(function(r){r[r.None=0]="None",r[r.Readonly=1]="Readonly",r[r.NoMove=2]="NoMove",r[r.NoEvent=10]="NoEvent"})(Kt||(Kt={}));var $t;(function(r){r[r.Default=0]="Default",r[r.In=1]="In",r[r.Out=2]="Out"})($t||($t={}));function qr(r){var t=document.createElement("div");return t.style.position="absolute",t.style.outline="none",t.style.left="-9999px",t.style.bottom="-9999px",t.style.width=r.rect.width+"px",t.style.height=r.rect.height+"px",r.elementId&&(t.id=r.elementId),t}function ki(r){var t=document.createElement("input");return t.style.position="absolute",t.style.outline="none",t.style.left="-9999px",t.style.bottom="-9999px",t.style.width=r.rect.width+"px",t.style.height=r.rect.height+"px",t.style.border="1px solid #cdcdcd",t.classList.add("set-text-input"),r.elementId&&(t.id=r.elementId),t}function Vr(r,t,e){var i=document.createElement("script");i.type="text/javascript",i.src=r,i.addEventListener("load",function(){t&&t(),e&&nt.Store.set("LT:render",!0)}),document.body.appendChild(i)}function Jt(r){for(var t=[],e=0,i=r;e<i.length;e++){var n=i[e];if(n instanceof _t){var o=n.rect.toPoints();if(n.rotate)for(var p=0,S=o;p<S.length;p++){var U=S[p];U.rotate(n.rotate,n.rect.center)}t.push.apply(t,o)}else if(n instanceof Mt){if(n.children)n.children.forEach(function(It){if(t.push(It.from),t.push(It.to),Array.isArray(It.controlPoints)&&t.push.apply(t,It.controlPoints),It.name==="curve")for(var Bt=.01;Bt<1;Bt+=.02)t.push(Vt(Bt,It.from,It.controlPoints[0],It.controlPoints[1],It.to))});else if(n.from&&(t.push(n.from),t.push(n.to),Array.isArray(n.controlPoints)&&t.push.apply(t,n.controlPoints),n.name==="curve"))for(var j=.01;j<1;j+=.02)t.push(Vt(j,n.from,n.controlPoints[0],n.controlPoints[1],n.to))}}var rt=ye(t),ht=rt.x1,ct=rt.y1,xt=rt.x2,kt=rt.y2;return new a(ht,ct,xt-ht,kt-ct)}function ye(r){for(var t=Infinity,e=Infinity,i=-Infinity,n=-Infinity,o=0,p=r;o<p.length;o++){var S=p[o],U=S.x,j=S.y;isNaN(U)||isNaN(j)||(t=Math.min(t,U),e=Math.min(e,j),i=Math.max(i,U),n=Math.max(n,j))}return{x1:t,y1:e,x2:i,y2:n}}function Yr(r,t){return!(r.x>t.ex||r.ex<t.x||r.ey<t.y||r.y>t.ey)}function Xr(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=new a(r[0].x,r[0].y,r[0].width,r[0].height),i=1;i<r.length;i++){var n=r[i];n&&(e.x>n.x&&(e.x=n.x),e.y>n.y&&(e.y=n.y),e.ex<n.ex&&(e.ex=n.ex),e.ey<n.ey&&(e.ey=n.ey))}return new a(e.x,e.y,e.ex-e.x,e.ey-e.y)}function Qr(){return/Android|webOS|iPad|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}function Gr(){var r=indexedDB.open("topology-caches");r.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains("caches")&&e.deleteObjectStore("caches"),e.createObjectStore("caches",{keyPath:"dbIndex"})},r.onsuccess=function(t){var e=r.result;if(!!e.objectStoreNames.contains("caches")){var i=e.transaction(["caches"],"readwrite").objectStore("caches");i.clear()}},r.onerror=function(t){console.warn("\u6570\u636E\u5E93\u6253\u5F00\u5931\u8D25"+t)}}function Ae(r){var t=indexedDB.open("topology-caches");t.onsuccess=function(e){var i=t.result;if(!!i.objectStoreNames.contains("caches")){var n=i.transaction(["caches"],"readwrite").objectStore("caches");n.delete(IDBKeyRange.lowerBound(r))}},t.onupgradeneeded=function(e){var i=e.target.result;i.objectStoreNames.contains("caches")&&i.deleteObjectStore("caches"),i.createObjectStore("caches",{keyPath:"dbIndex"})}}function Jr(r,t,e){var i=indexedDB.open("topology-caches");i.onsuccess=function(n){var o=i.result;if(!!o.objectStoreNames.contains("caches")){var p=o.transaction(["caches"],"readwrite").objectStore("caches");r.dbIndex=t,p.add(r);var S=p.count();S.onsuccess=function(){S.result>e&&p.delete(t-e)}}},i.onupgradeneeded=function(n){var o=n.target.result;o.objectStoreNames.contains("caches")&&o.deleteObjectStore("caches"),o.createObjectStore("caches",{keyPath:"dbIndex"})}}function _e(r){return new Promise(function(t,e){var i=indexedDB.open("topology-caches");i.onsuccess=function(n){var o=i.result;if(!o.objectStoreNames.contains("caches")){t(null);return}var p=o.transaction(["caches"]).objectStore("caches"),S=p.get(r);S.onsuccess=function(){t(S.result)}},i.onupgradeneeded=function(n){var o=n.target.result;o.objectStoreNames.contains("caches")&&o.deleteObjectStore("caches"),o.createObjectStore("caches",{keyPath:"dbIndex"})}})}function te(r,t){var e={pens:[],lineName:"curve",fromArrow:"",toArrow:"triangleSolid",scale:1,locked:Kt.None,x:0,y:0};if(typeof r=="string"&&(r=JSON.parse(r)),e=Object.assign(e,r),e.pens=[],r){if(r.nodes){for(var i=0,n=r.nodes;i<n.length;i++){var o=n[i];o.TID=t,e.pens.push(new _t(o))}for(var p=0,S=r.lines;p<S.length;p++){var o=S[p];o.TID=t,e.pens.push(new Mt(o))}}r.pens&&r.pens.forEach(function(j){t&&(j.TID=t),j.type?e.pens.push(new Mt(j)):e.pens.push(new _t(j))}),r.bkImageRect&&(e.bkImageRect=new a(r.bkImageRect.x,r.bkImageRect.y,r.bkImageRect.width,r.bkImageRect.height))}if(e.mqttOptions){var U="";typeof e.mqttOptions=="object"?U=JSON.stringify(e.mqttOptions):U=e.mqttOptions+"",e.mqttOptions=JSON.parse(U)}else e.mqttOptions={clientId:Ct()};return t&&nt.Store.set(t+"-topology-data",e),e}var re=function(){function r(t){var e=this;this.TID=t,this.subcribe=nt.Store.subscribe(this.generateStoreKey("topology-data"),function(i){e.data=i})}return r.prototype.generateStoreKey=function(t){return this.TID+"-"+t},r.prototype.destroy=function(){this.subcribe.unsubscribe()},r}(),$r=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Ne=function(r){$r(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,n)||this;return o.parentElem=e,o.options=i,o.canvas=document.createElement("canvas"),o.width=0,o.height=0,o.subcribe=nt.Store.subscribe(o.generateStoreKey("topology-data"),function(p){o.data=p}),o.canvas.style.position="absolute",o.canvas.style.left="0",o.canvas.style.top="0",o.canvas.style.outline="none",t.dpiRatio||(!i.extDpiRatio&&i.extDpiRatio!==0&&(window&&window.devicePixelRatio>1?i.extDpiRatio=.25:i.extDpiRatio=0),t.dpiRatio=(window?window.devicePixelRatio:0)+i.extDpiRatio,t.dpiRatio<1&&(t.dpiRatio=1)),o}return t.prototype.resize=function(e){e?(this.width=e.width|0,this.height=e.height|0):(this.options.width&&this.options.width!=="auto"?this.width=+this.options.width:this.width=this.parentElem.clientWidth,this.options.height&&this.options.height!=="auto"?this.height=+this.options.height:this.height=this.parentElem.clientHeight),this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width*t.dpiRatio|0,this.canvas.height=this.height*t.dpiRatio|0,this.canvas.getContext("2d").scale(t.dpiRatio,t.dpiRatio),nt.Store.set(this.generateStoreKey("LT:size"),{width:this.canvas.width,height:this.canvas.height})},t.prototype.render=function(){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.getDpiRatio=function(){return t.dpiRatio},t.prototype.destroy=function(){this.subcribe.unsubscribe()},t.dpiRatio=0,t}(re),Zr=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),ti=function(r){Zr(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,e,i,n)||this;return o.parentElem=e,o.options=i,o.activeLayer=nt.Store.get(o.generateStoreKey("LT:ActiveLayer")),o.hoverLayer=nt.Store.get(o.generateStoreKey("LT:HoverLayer")),o.animateLayer=nt.Store.get(o.generateStoreKey("LT:AnimateLayer")),nt.Store.set(o.generateStoreKey("LT:offscreen"),o.canvas),o}return t.prototype.render=function(){r.prototype.render.call(this);var e=this.canvas.getContext("2d");e.strokeStyle=this.options.color;for(var i=new a(-this.data.x,-this.data.y,this.width,this.height),n=0,o=this.data.pens;n<o.length;n++){var p=o[n];p.getTID()||p.setTID(this.TID),!(!Yr(p.rect,i)&&p.type===g.Node)&&p.render(e)}this.activeLayer.render(e),this.animateLayer.render(e),this.hoverLayer.render(e)},t}(Ne),ei=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),ri=function(r){ei(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,e,i,n)||this;return o.parentElem=e,o.options=i,o.render=function(){if(o.data&&o.data.bkImage&&!o.bkImg){o.loadBkImg(o.render);return}if(!(!o.width||!o.height||!o.offscreen)){var p=o.canvas.getContext("2d");p.clearRect(0,0,o.canvas.width,o.canvas.height),(o.data.bkColor||o.options.bkColor)&&(p.fillStyle=o.data.bkColor||o.options.bkColor,p.fillRect(0,0,o.width,o.height)),o.bkImg&&o.data.bkImageRect&&p.drawImage(o.bkImg,o.data.bkImageRect.x,o.data.bkImageRect.y,o.data.bkImageRect.width,o.data.bkImageRect.height),(o.data.grid||o.options.grid)&&o.grid(),(o.data.rule||o.options.rule)&&o.rule(),p.drawImage(o.offscreen,0,0,o.width,o.height)}},o.offscreen=nt.Store.get(o.generateStoreKey("LT:offscreen")),o.parentElem.appendChild(o.canvas),o.data=nt.Store.get(o.generateStoreKey("topology-data")),o}return t.prototype.loadBkImg=function(e){var i=this;!this.data.bkImage||(this.bkImg=new Image,this.bkImg.crossOrigin="anonymous",this.bkImg.src=this.data.bkImage,this.bkImg.onload=function(){i.data.bkImageRect||(i.data.bkImageRect=new a(0,0,i.bkImg.naturalWidth,i.bkImg.naturalHeight)),e&&e()})},t.prototype.clearBkImg=function(){this.bkImg=void 0},t.prototype.rule=function(){var e=this.canvas.getContext("2d");e.save(),e.lineWidth=1,e.strokeStyle=Zt(.7,this.data.ruleColor||this.options.ruleColor||"#888"),e.beginPath();for(var i=10;i<this.width;i+=10)e.moveTo(i,0),e.lineTo(i,5);for(var i=10;i<this.height;i+=10)e.moveTo(0,i),e.lineTo(5,i);e.stroke(),e.beginPath(),e.strokeStyle=this.data.ruleColor||this.options.ruleColor||"#888",e.fillStyle=e.strokeStyle;for(var i=100;i<this.width;i+=100)e.moveTo(i,0),e.lineTo(i,10),e.fillText(i.toString(),i+4,16);for(var i=100;i<this.height;i+=100)e.moveTo(0,i),e.lineTo(10,i);e.stroke();for(var i=100;i<this.height;i+=100)e.save(),e.beginPath(),e.translate(16,i-4),e.rotate(270*Math.PI/180),e.fillText(i.toString(),0,0),e.restore();e.restore()},t.prototype.grid=function(){var e=this.canvas.getContext("2d");e.save(),e.lineWidth=1,e.strokeStyle=this.data.gridColor||this.options.gridColor||"#f3f3f3",e.beginPath();for(var i=this.data.gridSize||this.options.gridSize,n=i;n<this.width;n+=i)e.moveTo(n,0),e.lineTo(n,this.height);for(var n=i;n<this.height;n+=i)e.moveTo(0,n),e.lineTo(this.width,n);e.stroke(),e.restore()},t}(Ne),ii=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),ni=function(r){ii(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.hoverAnchorIndex=-1,n.dockLineX=0,n.dockLineY=0,nt.Store.set(n.generateStoreKey("LT:HoverLayer"),n),n}return t.prototype.lineTo=function(e,i){i===void 0&&(i="triangleSolid"),!(!this.line||this.line.locked)&&(this.line.setTo(e,i),(this.line.from.id||this.line.to.id)&&this.line.calcControlPoints(),nt.Store.set(this.generateStoreKey("pts-")+this.line.id,void 0),nt.Store.set(this.generateStoreKey("LT:updateLines"),[this.line]))},t.prototype.lineFrom=function(e){this.line.locked||(this.line.setFrom(e,this.line.fromArrow),(this.line.from.id||this.line.to.id)&&this.line.calcControlPoints(),nt.Store.set(this.generateStoreKey("pts-")+this.line.id,void 0),nt.Store.set(this.generateStoreKey("LT:updateLines"),[this.line]))},t.prototype.render=function(e){var i=this;if(!(this.data.locked===Kt.NoEvent||this.options.hoverColor==="transparent")){if(e.fillStyle=this.options.hoverColor,e.save(),this.options.alwaysAnchor&&this.data.pens.forEach(function(p){if(p.type!==g.Line&&!p.hideAnchor){for(var S=0,U=p.rotatedAnchors;S<U.length;S++){var j=U[S];j.hidden||(e.beginPath(),e.arc(j.x,j.y,j.radius||i.options.anchorRadius,0,Math.PI*2),e.strokeStyle=j.strokeStyle||i.options.hoverColor,e.fillStyle=j.fillStyle||i.options.anchorFillStyle,e.fill(),e.stroke())}i.options.autoAnchor&&(e.beginPath(),e.arc(p.rect.center.x,p.rect.center.y,p.rect.center.radius||i.options.anchorRadius,0,Math.PI*2),e.strokeStyle=i.options.hoverColor,e.fillStyle=i.options.anchorFillStyle,e.fill(),e.stroke())}}),e.restore(),this.node&&!this.data.locked){if(this.node.getTID()||this.node.setTID(this.TID),this.root=this.getRoot(this.node)||this.node,this.root&&(e.save(),e.strokeStyle=this.options.dragColor,e.globalAlpha=.2,this.root.rotate&&(e.translate(this.root.rect.center.x,this.root.rect.center.y),e.rotate((this.root.rotate+this.root.offsetRotate)*Math.PI/180),e.translate(-this.root.rect.center.x,-this.root.rect.center.y)),e.beginPath(),e.strokeRect(this.root.rect.x,this.root.rect.y,this.root.rect.width,this.root.rect.height),e.restore()),!this.options.hideAnchor)for(var n=0;n<this.node.rotatedAnchors.length;++n)this.node.locked||this.node.hideAnchor||this.node.rotatedAnchors[n].hidden&&this.hoverAnchorIndex!==n||(e.beginPath(),e.arc(this.node.rotatedAnchors[n].x,this.node.rotatedAnchors[n].y,this.node.rotatedAnchors[n].radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.node.rotatedAnchors[n].strokeStyle||this.options.hoverColor,e.fillStyle=this.node.rotatedAnchors[n].fillStyle||this.options.anchorFillStyle,e.fill(),e.stroke());this.options.autoAnchor&&(e.beginPath(),e.arc(this.node.rect.center.x,this.node.rect.center.y,this.node.rect.center.radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.options.hoverColor,e.fillStyle=this.options.anchorFillStyle,e.fill(),e.stroke())}if(this.line&&!this.data.locked&&(this.root=this.getRoot(this.line),this.root&&(e.save(),e.strokeStyle=this.options.dragColor,e.globalAlpha=.2,this.root.rotate&&(e.translate(this.root.rect.center.x,this.root.rect.center.y),e.rotate((this.root.rotate+this.root.offsetRotate)*Math.PI/180),e.translate(-this.root.rect.center.x,-this.root.rect.center.y)),e.beginPath(),e.strokeRect(this.root.rect.x,this.root.rect.y,this.root.rect.width,this.root.rect.height),e.restore())),this.dockAnchor&&(e.save(),e.beginPath(),e.arc(this.dockAnchor.x,this.dockAnchor.y,this.dockAnchor.radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.options.dockStrokeStyle,e.fillStyle=this.options.dockFillStyle,e.fill(),e.stroke(),e.restore()),this.hoverLineCP&&(e.beginPath(),e.arc(this.hoverLineCP.x,this.hoverLineCP.y,5,0,Math.PI*2),e.fill()),e.strokeStyle=Zt(.5,this.options.hoverColor),e.lineWidth=1,this.dockLineX>0){var o=nt.Store.get(this.generateStoreKey("LT:size"));e.beginPath(),e.moveTo(this.dockLineX,-this.data.y),e.lineTo(this.dockLineX,o.height),e.stroke()}if(this.dockLineY>0){var o=nt.Store.get(this.generateStoreKey("LT:size"));e.beginPath(),e.moveTo(-this.data.x,this.dockLineY),e.lineTo(o.width,this.dockLineY),e.stroke()}this.dragRect&&(e.fillStyle=Zt(.2,this.options.dragColor),e.strokeStyle=this.options.dragColor,e.beginPath(),e.strokeRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height),e.fillRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height))}},t.prototype.getRoot=function(e){if(!e.parentId)return null;for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o.id===e.parentId){var p=this.getRoot(o);return p||o}}return null},t.prototype.clear=function(){this.node=void 0,this.line=void 0},t}(re),oi=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),si=function(r){oi(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.rotateCPs=[],n.sizeCPs=[],n.pens=[],n.rotate=0,n.lastOffsetX=0,n.lastOffsetY=0,n.initialSizeCPs=[],n.nodeRects=[],n.childrenRects={},n.childrenRotate={},n.dockWatchers=[],n.rotating=!1,nt.Store.set(n.generateStoreKey("LT:ActiveLayer"),n),n}return t.prototype.calcControlPoints=function(){if(this.pens.length===1&&this.pens[0]instanceof _t){if(this.rect=this.pens[0].rect,this.sizeCPs=this.pens[0].rect.toPoints(),this.rotateCPs=[new R(this.pens[0].rect.x+this.pens[0].rect.width/2,this.pens[0].rect.y-35),new R(this.pens[0].rect.x+this.pens[0].rect.width/2,this.pens[0].rect.y)],this.rotate||this.pens[0].rotate){for(var e=0,i=this.sizeCPs;e<i.length;e++){var n=i[e];this.pens[0].rotate&&n.rotate(this.pens[0].rotate,this.pens[0].rect.center),this.rotate&&n.rotate(this.rotate,this.rect.center)}for(var o=0,p=this.rotateCPs;o<p.length;o++){var n=p[o];this.pens[0].rotate&&n.rotate(this.pens[0].rotate,this.pens[0].rect.center),this.rotate&&n.rotate(this.rotate,this.rect.center)}}(this.options.hideRotateCP||this.pens[0].hideRotateCP)&&(this.rotateCPs=[new R(-1e3,-1e3),new R(-1e3,-1e3)]);return}var S=ye(this.getPoints()),U=S.x1,j=S.y1,rt=S.x2,ht=S.y2;this.rect=new a(U,j,rt-U,ht-j),this.sizeCPs=[new R(U,j),new R(rt,j),new R(rt,ht),new R(U,ht)],this.rotateCPs=[new R(U+(rt-U)/2,j-35),new R(U+(rt-U)/2,j)],this.options.hideRotateCP&&(this.rotateCPs=[new R(-1e3,-1e3),new R(-1e3,-1e3)])},t.prototype.locked=function(){for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];if(!n.locked)return!1}return!0},t.prototype.getPoints=function(){for(var e=[],i=0,n=this.pens;i<n.length;i++){var o=n[i];if(o.type===g.Node){var p=o.rect.toPoints();if(o.rotate)for(var S=0,U=p;S<U.length;S++){var j=U[S];j.rotate(o.rotate,o.rect.center)}e.push.apply(e,p)}else if(o instanceof Mt){if(o.children)o.children.forEach(function(ht){if(e.push(ht.from),e.push(ht.to),ht.name==="curve")for(var ct=.01;ct<1;ct+=.02)e.push(Vt(ct,ht.from,ht.controlPoints[0],ht.controlPoints[1],ht.to))});else if(o.from&&(e.push(o.from),e.push(o.to),o.name==="curve"))for(var rt=.01;rt<1;rt+=.02)e.push(Vt(rt,o.from,o.controlPoints[0],o.controlPoints[1],o.to))}}return e},t.prototype.clear=function(){this.pens=[],this.sizeCPs=[],this.rotateCPs=[],nt.Store.set(this.generateStoreKey("LT:activeNode"),void 0)},t.prototype.saveNodeRects=function(){this.nodeRects=[],this.childrenRects={};for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];n.type&&n.from?this.nodeRects.push(new a(n.from.x,n.from.y,n.rect.width,n.rect.height)):this.nodeRects.push(new a(n.rect.x,n.rect.y,n.rect.width,n.rect.height)),this.saveChildrenRects(n)}this.initialSizeCPs=[];for(var o=0,p=this.sizeCPs;o<p.length;o++){var n=p[o];this.initialSizeCPs.push(n.clone())}this.getDockWatchers()},t.prototype.saveChildrenRects=function(e){if(!(e.type||!e.children))for(var i=0,n=e.children;i<n.length;i++){var o=n[i];this.childrenRects[o.id]=new a(o.rect.x,o.rect.y,o.rect.width,o.rect.height),this.childrenRotate[o.id]=o.rotate,this.saveChildrenRects(o)}},t.prototype.resize=function(e,i,n){var o=new R(i.x,i.y),p=new R(n.x,n.y);this.pens.length===1&&this.pens[0].rotate%360&&(o.rotate(-this.pens[0].rotate,this.nodeRects[0].center),p.rotate(-this.pens[0].rotate,this.nodeRects[0].center));var S=p.x-o.x,U=p.y-o.y,j=S-this.lastOffsetX,rt=U-this.lastOffsetY;this.lastOffsetX=S,this.lastOffsetY=U;var ht=this.activeRect.width,ct=this.activeRect.height;switch(n.shiftKey&&(rt=j*ct/ht),e){case 0:if(this.activeRect.width-j<5||this.activeRect.height-rt<5)return;n.shiftKey?(j=-j,rt=-rt,this.activeRect.ex+=j,this.activeRect.ey+=rt,this.activeRect.width+=j,this.activeRect.height+=rt):(this.activeRect.x+=j,this.activeRect.y+=rt,this.activeRect.width-=j,this.activeRect.height-=rt);break;case 1:if(this.activeRect.width+j<5||this.activeRect.height-rt<5)return;n.shiftKey?(this.activeRect.ex+=j,this.activeRect.ey+=rt,this.activeRect.width+=j,this.activeRect.height+=rt):(this.activeRect.ex+=j,this.activeRect.y+=rt,this.activeRect.width+=j,this.activeRect.height-=rt);break;case 2:if(this.activeRect.width+j<5||this.activeRect.height+rt<5)return;this.activeRect.ex+=j,this.activeRect.ey+=rt,this.activeRect.width+=j,this.activeRect.height+=rt;break;case 3:if(this.activeRect.width-j<5||this.activeRect.height+rt<5)return;n.shiftKey?(j=-j,rt=-rt,this.activeRect.ex+=j,this.activeRect.ey+=rt,this.activeRect.width+=j,this.activeRect.height+=rt):(this.activeRect.x+=j,this.activeRect.ey+=rt,this.activeRect.width-=j,this.activeRect.height+=rt);break}for(var xt=this.activeRect.width/ht,kt=this.activeRect.height/ct,It=0,Bt=this.pens;It<Bt.length;It++){var ft=Bt[It];if(!ft.locked){switch(ft.type){case g.Line:break;default:switch(ft.oldRect=ft.rect.clone(),!this.options.disableSizeX&&!n.ctrlKey&&!ft.disableSizeX&&(ft.rect.width*=xt,ft.imageWidth&&(ft.imageWidth*=xt)),!this.options.disableSizeY&&!n.altKey&&!ft.disableSizeY&&(ft.rect.height*=kt,ft.imageHeight&&(ft.imageHeight*=kt)),(!this.options.disableSizeX&&n.shiftKey&&!ft.disableSizeX||!this.options.disableSizeY&&n.shiftKey&&!ft.disableSizeY)&&(ft.rect.width*=xt,ft.rect.height*=kt,ft.imageWidth&&(ft.imageWidth*=xt),ft.imageHeight&&(ft.imageHeight*=kt)),e){case 0:ft.rect.x=ft.rect.ex-ft.rect.width,ft.rect.y=ft.rect.ey-ft.rect.height;break;case 1:ft.rect.ex=ft.rect.x+ft.rect.width,ft.rect.y=ft.rect.ey-ft.rect.height;break;case 2:ft.rect.ex=ft.rect.x+ft.rect.width,ft.rect.ey=ft.rect.y+ft.rect.height;break;case 3:ft.rect.x=ft.rect.ex-ft.rect.width,ft.rect.ey=ft.rect.y+ft.rect.height;break}ft.scalePoints(),ft.rect.calcCenter(),ft.init(),ft.calcChildrenRect();break}if(ft.parentId)for(var Xt=void 0,Yt=0,ie=this.data.pens;Yt<ie.length;Yt++){var ne=ie[Yt];if(ne.id===ft.parentId){Xt=ne,ft.calcRectInParent(Xt);break}}}}this.updateLines()},t.prototype.move=function(e,i){if(this.nodeRects.length===this.pens.length){for(var n=0,o=function(ht){if(ht.locked)return"continue";if(ht instanceof _t){var ct=p.nodeRects[n].x+e-ht.rect.x,xt=p.nodeRects[n].y+i-ht.rect.y;ht.translate(ct,xt);for(var kt=p.getLinesOfNode(ht),It=0,Bt=kt;It<Bt.length;It++){var ft=Bt[It];ft.translate(ct,xt)}if(ht.calcChildrenRect(),ht.parentId&&!ht.locked)for(var Xt=void 0,Yt=0,ie=p.data.pens;Yt<ie.length;Yt++){var ne=ie[Yt];if(ne.id===ht.parentId){Xt=ne,ht.calcRectInParent(Xt);break}}}if(ht instanceof Mt&&ht.from){var Oe=p.nodeRects[n].x+e-ht.from.x,Be=p.nodeRects[n].y+i-ht.from.y;if(ht.parentId){var mi=x(ht.parentId,p.data.pens);mi.forEach(function(wi){wi.translate(Oe,Be)})}else ht.translate(Oe,Be)}++n},p=this,S=0,U=this.pens;S<U.length;S++){var j=U[S];o(j)}this.updateLines(),this.topology.dispatch("move",this.pens)}},t.prototype.getLinesOfNode=function(e){for(var i=[],n=P([e]),o=0,p=this.data.pens;o<p.length;o++){var S=p[o];if(S instanceof Mt){for(var U=S,j=!1,rt=!1,ht=0,ct=n.nodes;ht<ct.length;ht++){var xt=ct[ht];U.from&&U.from.id===xt.id&&(j=!0),U.to&&U.to.id===xt.id&&(rt=!0)}j&&rt&&i.push(U)}}return i},t.prototype.updateLines=function(e){e||(e=this.pens);var i=P(this.data.pens),n=i.lines,o=i.nodes;this.options.autoAnchor||(o=P(e).nodes);for(var p=[],S=0,U=n;S<U.length;S++)for(var j=U[S],rt=0,ht=o;rt<ht.length;rt++){var ct=ht[rt],xt=0;if(j.from&&j.from.id===ct.id){if(j.from.autoAnchor){var kt=ct.nearestAnchor(j.to);kt.index>-1&&(j.from.anchorIndex=kt.index,j.from.direction=kt.direction)}j.from.anchorIndex>=0&&(j.from.x=ct.rotatedAnchors[j.from.anchorIndex].x,j.from.y=ct.rotatedAnchors[j.from.anchorIndex].y,++xt)}if(j.to&&j.to.id===ct.id){if(j.to.autoAnchor){var kt=ct.nearestAnchor(j.from);kt.index>-1&&(j.to.anchorIndex=kt.index,j.to.direction=kt.direction)}j.to.anchorIndex>=0&&(j.to.x=ct.rotatedAnchors[j.to.anchorIndex].x,j.to.y=ct.rotatedAnchors[j.to.anchorIndex].y,++xt)}xt&&!this.data.manualCps&&j.calcControlPoints(),j.textRect=void 0,nt.Store.set(this.generateStoreKey("pts-")+j.id,void 0),p.push(j)}nt.Store.set(this.generateStoreKey("LT:updateLines"),p)},t.prototype.offsetRotate=function(e){this.rotating=!0;for(var i=0,n=0,o=this.pens;n<o.length;n++){var p=o[n];if(p instanceof _t){var S=this.nodeRects[i].center.clone();this.pens.length>1&&S.rotate(e,this.rect.center),p.rect.x=S.x-p.rect.width/2,p.rect.y=S.y-p.rect.height/2,p.rect.ex=p.rect.x+p.rect.width,p.rect.ey=p.rect.y+p.rect.height,p.rect.calcCenter(),p.init(),p.offsetRotate=e,p.calcRotateAnchors(p.rotate+p.offsetRotate),this.rotateChildren(p),++i}}this.rotate=e,this.topology.dispatch("rotated",this.pens)},t.prototype.rotateChildren=function(e){if(!(e.type!==g.Node||!e.children))for(var i=0,n=e.children;i<n.length;i++){var o=n[i];if(o.type===g.Node){var p=this.childrenRects[o.id].center.clone(),S=this.childrenRects[o.id].center.clone().rotate(this.rotate,this.rect.center),U=this.childrenRects[o.id].clone();U.translate(S.x-p.x,S.y-p.y),o.rect=U,o.rotate=this.childrenRotate[o.id]+this.rotate,o.init(),this.rotateChildren(o)}}},t.prototype.updateRotate=function(){for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];n.rotate+=n.offsetRotate,n.type===g.Node&&n.rectInParent&&(n.rectInParent.rotate+=n.offsetRotate),n.offsetRotate=0}this.rotate=0,this.rotating=!1},t.prototype.add=function(e){this.has(e)||(this.pens.push(e),e instanceof _t&&nt.Store.set(this.generateStoreKey("LT:activeNode"),e))},t.prototype.setPens=function(e){this.pens=e,this.pens.length===1&&this.pens[0]instanceof _t&&nt.Store.set(this.generateStoreKey("LT:activeNode"),this.pens[0])},t.prototype.has=function(e){for(var i=0,n=this.pens;i<n.length;i++){var o=n[i];if(o.id===e.id)return!0}return!1},t.prototype.hasInAll=function(e,i){i||(i=this.pens);for(var n=0,o=i;n<o.length;n++){var p=o[n];if(p.id===e.id)return!0;if(p.children){var S=this.hasInAll(e,p.children);if(S)return!0}}return!1},t.prototype.render=function(e){var i=this;if(!(this.data.locked>Kt.Readonly||this.options.activeColor==="transparent")&&!!this.pens.length){this.pens.forEach(function(ct){ct.getTID()||ct.setTID(i.TID)}),(this.pens.length===1||!this.rotating)&&this.calcControlPoints(),e.save(),e.strokeStyle=this.options.activeColor,e.fillStyle="#fff",e.lineWidth=1;for(var n=this.TID,o=nt.Store.get(this.generateStoreKey("LT:scale"))||1,p=0,S=this.pens;p<S.length;p++){var U=S[p];if(this.data.locked&&U instanceof _t){var j=new _t(U);j.setTID(n),j.data=void 0,j.fillStyle=void 0,j.bkType=0,j.icon="",j.image="",j.text="",j.strokeStyle!=="transparent"&&(j.strokeStyle="#ffffff",j.lineWidth+=2,j.render(e),j.strokeStyle=this.options.activeColor,j.lineWidth-=2),j.render(e)}if(U instanceof Mt){var j=new Mt(U);j.lineWidth*=2,j.toArrowSize=(j.toArrowSize*o-1.5*j.lineWidth)/o,j.fromArrowSize=(j.fromArrowSize*o-1.5*j.lineWidth)/o,j.setTID(n),j.strokeStyle=Zt(.2,this.options.activeColor),j.borderWidth=4,j.borderColor=Zt(.1,this.options.activeColor),j.fromArrowColor=this.options.activeColor,j.toArrowColor=this.options.activeColor,j.render(e),!this.data.locked&&!U.locked&&Nt[U.name]&&Nt[U.name].drawControlPointsFn(e,U)}}if(this.pens.length===1&&this.pens[0].type===g.Line){e.restore();return}if(this.rotate&&this.pens.length>1&&(e.translate(this.rect.center.x,this.rect.center.y),e.rotate(this.rotate*Math.PI/180),e.translate(-this.rect.center.x,-this.rect.center.y)),this.data.locked||this.locked()){e.restore();return}if(e.save(),e.globalAlpha=.3,e.translate(.5,.5),e.beginPath(),e.moveTo(this.sizeCPs[0].x,this.sizeCPs[0].y),e.lineTo(this.sizeCPs[1].x,this.sizeCPs[1].y),e.lineTo(this.sizeCPs[2].x,this.sizeCPs[2].y),e.lineTo(this.sizeCPs[3].x,this.sizeCPs[3].y),e.closePath(),e.stroke(),e.restore(),e.beginPath(),e.moveTo(this.rotateCPs[0].x,this.rotateCPs[0].y),e.lineTo(this.rotateCPs[1].x,this.rotateCPs[1].y),e.stroke(),e.beginPath(),e.arc(this.rotateCPs[0].x,this.rotateCPs[0].y,5,0,Math.PI*2),e.fill(),e.stroke(),!this.options.hideSizeCP&&(this.pens.length>1||!this.pens[0].hideSizeCP)){e.lineWidth=1;for(var rt=0,ht=this.sizeCPs;rt<ht.length;rt++){var U=ht[rt];e.save(),e.beginPath(),this.pens.length===1&&(this.pens[0].rotate||this.rotate)&&(e.translate(U.x,U.y),e.rotate((this.pens[0].rotate+this.rotate)*Math.PI/180),e.translate(-U.x,-U.y)),e.fillRect(U.x-4.5,U.y-4.5,8,8),e.strokeRect(U.x-5.5,U.y-5.5,10,10),e.restore()}}e.restore()}},t.prototype.calcActiveRect=function(){this.pens.length===1?(this.pens[0].rect.height===0&&(this.pens[0].rect.height=1),this.activeRect=m(this.pens[0].rect)):this.activeRect=Jt(this.pens)},t.prototype.getDockWatchers=function(){if(this.pens.length===1){this.dockWatchers=this.nodeRects[0].toPoints(),this.dockWatchers.unshift(this.nodeRects[0].center);return}!this.rect||(this.dockWatchers=this.rect.toPoints(),this.dockWatchers.unshift(this.rect.center))},t}(re),ai=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),hi=function(r){ai(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.pens=new Map,n.lastNow=0,nt.Store.set(n.generateStoreKey("LT:AnimateLayer"),n),n.options.animateColor||(n.options.animateColor="#ff6600"),n.subscribeUpdate=nt.Store.subscribe(n.generateStoreKey("LT:updateLines"),function(o){n.updateLines(o)}),n.subscribePlay=nt.Store.subscribe(n.generateStoreKey("LT:AnimatePlay"),function(o){if(o.stop){if(o.tag){var p=x(o.tag,n.data.pens);p.forEach(function(S){n.pens.has(S.id)&&(n.pens.get(S.id).animateStart=0)})}o.pen&&n.pens.has(o.pen.id)&&(n.pens.get(o.pen.id).animateStart=0)}else o.pen&&(n.pens.has(o.pen.id)?n.pens.get(o.pen.id).animateStart=Date.now():o.pen.type?n.pens.set(o.pen.id,n.getAnimateLine(o.pen)):n.pens.set(o.pen.id,o.pen)),o.tag&&n.readyPlay(o.tag,!1);n.animate()}),n}return t.prototype.getAnimateLine=function(e){var i=new Mt(e);return i.data=i.id,i.id=Ct(),i.setTID(this.TID),i.isAnimate=!0,i.toArrow="",i.fromArrow&&i.fromArrow.indexOf("line")<0&&(i.animateFromSize=i.fromArrowSize+i.lineWidth*5),i.toArrow&&i.toArrow.indexOf("line")<0&&(i.animateToSize=i.toArrowSize+i.lineWidth*5),i.animateStart=e.animateStart,i.lineCap="round",i.fillStyle="#fff",i.strokeStyle=i.animateColor||this.options.animateColor,i.length=i.getLen(),i.fromArrowColor||(i.fromArrowColor=i.strokeStyle||nt.Store.get(this.generateStoreKey("LT:color"))),i.toArrowColor||(i.toArrowColor=i.strokeStyle||nt.Store.get(this.generateStoreKey("LT:color"))),i},t.prototype.findLine=function(e){for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o.id===e.data)return o}},t.prototype.readyPlay=function(e,i,n){var o=this,p=new Map;n||(n=this.data.pens),n.forEach(function(S){S.setTID(o.TID),!(!S.visible||p.get(S.id))&&((i&&S.animatePlay||e&&S.tags.indexOf(e)>-1)&&(!S.animateStart||S.animateStart<1)&&(S.animateStart=Date.now()),S instanceof _t?(S.animateStart>0&&(S.animateReady||S.initAnimate(),p.set(S.id,S)),S.children&&S.children.length&&o.readyPlay(e,i,S.children)):S.animateStart>0?p.set(S.id,o.getAnimateLine(S)):o.pens.has(S.id)&&(o.pens.get(S.id).animateStart=0))}),p.forEach(function(S){S.type?o.pens.set(S.data,S):o.pens.set(S.id,S)})},t.prototype.animate=function(){var e=this;this.timer&&cancelAnimationFrame(this.timer),this.timer=requestAnimationFrame(function(){var i=Date.now();if(i-e.lastNow<e.options.refresh){e.animate();return}e.lastNow=i;var n=!1;e.pens.forEach(function(o){if(!o.animateStart||o.animateStart<1){if(o.type){e.pens.delete(o.data);var p=e.findLine(o);p&&(p.animateStart=0,p.animatePos=o.animatePos)}else e.pens.delete(o.id);return}if(!(o.animateStart>i)){if(o.animateFn?typeof o.animateFn=="function"?o.animateFn():window&&window[o.animateFn]&&window[o.animateFn]():o.animate(i),o.animateStart<1){if(o.type?e.pens.delete(o.data):e.pens.delete(o.id),o.type===g.Line){var p=e.findLine(o);p&&(p.animateStart=0,p.animatePos=o.animatePos)}o.nextAnimate&&e.readyPlay(o.nextAnimate,!1)}n=!0}}),n&&(nt.Store.set(e.generateStoreKey("LT:render"),!0),e.animate())})},t.prototype.updateLines=function(e){this.pens.forEach(function(i,n){if(i instanceof Mt)for(var o=0,p=e;o<p.length;o++){var S=p[o];i.data===S.id&&(i.from=S.from,i.to=S.to,i.controlPoints=S.controlPoints,i.length=i.getLen())}})},t.prototype.render=function(e){var i=this;this.pens.forEach(function(n,o){n.visible&&n instanceof Mt&&(n.getTID()||n.setTID(i.TID),n.render(e))})},t.prototype.stop=function(){this.pens.clear(),this.timer&&(cancelAnimationFrame(this.timer),this.timer=null)},t.prototype.destroy=function(){this.stop(),this.subscribeUpdate.unsubscribe(),this.subscribePlay.unsubscribe()},t}(re),ci=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Ut={},li=function(r){ci(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,n)||this;return o.parentElem=e,o.options=i,o.canvas=document.createElement("div"),o.player=document.createElement("div"),o.audios={},o.iframes={},o.elements={},o.gifs={},o.addDiv=function(p){if(p.audio&&(o.audios[p.id]&&o.audios[p.id].media.src!==p.audio&&(o.audios[p.id].media.src=p.audio),setTimeout(function(){o.setElemPosition(p,o.audios[p.id]&&o.audios[p.id].player||o.addMedia(p,"audio"))})),p.video&&(Ut[p.id]&&Ut[p.id].media.src!==p.video&&(Ut[p.id].media.src=p.video),setTimeout(function(){o.setElemPosition(p,Ut[p.id]&&Ut[p.id].player||o.addMedia(p,"video"))})),p.iframe&&(o.iframes[p.id]?(o.iframes[p.id].src!==p.iframe&&(o.iframes[p.id].src=p.iframe),o.setElemPosition(p,o.iframes[p.id])):(o.addIframe(p),setTimeout(function(){o.addDiv(p)}))),p.elementId&&(o.elements[p.id]||(o.elements[p.id]=document.getElementById(p.elementId),o.elements[p.id]&&o.canvas.appendChild(o.elements[p.id])),o.setElemPosition(p,o.elements[p.id])),p.gif&&(p.image.indexOf(".gif")<0?(p.gif=!1,o.canvas.removeChild(o.gifs[p.id]),o.gifs[p.id]=void 0):p.img&&(o.gifs[p.id]&&o.gifs[p.id].src!==p.image&&(o.gifs[p.id].src=p.image),o.setElemPosition(p,o.gifs[p.id]||o.addGif(p)))),p.children)for(var S=0,U=p.children;S<U.length;S++){var j=U[S];j.type!==g.Line&&o.addDiv(j)}},o.createPlayer=function(){o.player.style.position="fixed",o.player.style.outline="none",o.player.style.top="-99999px",o.player.style.height="40px",o.player.style.padding="10px 15px",o.player.style.background="rgba(200,200,200,.1)",o.player.style.display="flex",o.player.style.alignItems="center",o.player.style.userSelect="initial",o.player.style.pointerEvents="initial",o.player.style.zIndex="1",o.playBtn=document.createElement("i"),o.currentTime=document.createElement("span"),o.progress=document.createElement("div"),o.progressCurrent=document.createElement("div"),o.loop=document.createElement("i");var p=document.createElement("i");o.playBtn.className=o.options.playIcon,o.playBtn.style.fontSize="18px",o.playBtn.style.lineHeight="20px",o.playBtn.style.cursor="pointer",o.currentTime.style.padding="0 10px",o.currentTime.innerText="0 / 0",o.progress.style.position="relative",o.progress.style.flexGrow="1",o.progress.style.top="0",o.progress.style.height="4px",o.progress.style.background="#ccc",o.progress.style.borderRadius="2px",o.progress.style.overflow="hidden",o.progress.style.cursor="pointer",o.progressCurrent.style.position="absolute",o.progressCurrent.style.left="0",o.progressCurrent.style.top="0",o.progressCurrent.style.bottom="0",o.progressCurrent.style.width="0",o.progressCurrent.style.background="#52c41a",o.loop.style.margin="0 10px",o.loop.style.padding="2px 5px",o.loop.style.borderRadius="2px",o.loop.className=o.options.loopIcon,o.loop.style.fontSize="18px",o.loop.style.lineHeight="20px",o.loop.style.cursor="pointer",p.className=o.options.fullScreenIcon,p.style.fontSize="17px",p.style.lineHeight="20px",p.style.cursor="pointer",o.player.appendChild(o.playBtn),o.player.appendChild(o.currentTime),o.player.appendChild(o.progress),o.progress.appendChild(o.progressCurrent),o.player.appendChild(o.loop),o.player.appendChild(p),o.playBtn.onclick=function(){o.media.paused?(o.media.play(),o.playBtn.className=o.options.pauseIcon):(o.media.pause(),o.playBtn.className=o.options.playIcon)},o.progress.onclick=function(S){o.media.currentTime=S.offsetX/o.progress.clientWidth*o.media.duration},o.loop.onclick=function(){o.media.loop=!o.media.loop,o.curNode.playLoop=o.media.loop,o.media.loop?o.loop.style.background="#ddd":o.loop.style.background="none"},p.onclick=function(){o.media.requestFullscreen()}},o.getMediaCurrent=function(){!o.media||(o.currentTime.innerText=o.formatSeconds(o.media.currentTime)+" / "+o.formatSeconds(o.media.duration),o.progressCurrent.style.width=o.media.currentTime/o.media.duration*o.progress.clientWidth+"px")},o.addMedia=function(p,S){var U=document.createElement("div"),j=document.createElement("div"),rt=document.createElement(S);return U.id=p.id,j.style.position="absolute",j.style.outline="none",j.style.left="0",j.style.bottom="0",j.style.height="2px",j.style.background="#52c41a",rt.style.position="absolute",rt.style.outline="none",rt.style.left="0",rt.style.right="0",rt.style.top="0",rt.style.bottom="0",S==="video"&&(rt.style.width=p.rect.width+"px",rt.style.height=p.rect.height+"px"),U.style.background="transparent",p.playType===1&&(rt.autoplay=!0),rt.loop=p.playLoop,rt.ontimeupdate=function(){j.style.width=rt.currentTime/rt.duration*p.rect.width+"px",o.getMediaCurrent(),o.media===rt&&(p.playLoop?(rt.loop=!0,o.loop.style.background="#ddd"):(rt.loop=!1,o.loop.style.background="none"))},rt.onended=function(){nt.Store.set(o.generateStoreKey("mediaEnd"),p),o.media===rt&&(o.playBtn.className=o.options.playIcon),o.play(p.nextPlay)},rt.onloadedmetadata=function(){o.getMediaCurrent()},rt.src=p[S],U.appendChild(rt),U.appendChild(j),S==="video"?Ut[p.id]={player:U,current:j,media:rt}:o.audios[p.id]={player:U,current:j,media:rt},o.canvas.appendChild(U),U},o.setElemPosition=function(p,S){!S||(S.style.position="absolute",S.style.outline="none",S.style.left=p.rect.x+o.data.x+"px",S.style.top=p.rect.y+o.data.y+"px",S.style.width=p.rect.width+"px",S.style.height=p.rect.height+"px",S.style.display=p.visible?"inline":"none",(p.rotate!=null||p.offsetRotate!=null)&&(S.style.transform="rotate("+(p.rotate+p.offsetRotate)+"deg)"),p.video&&Ut[p.id]&&Ut[p.id].media&&(Ut[p.id].media.style.width="100%",Ut[p.id].media.style.height="100%"),o.data.locked>Kt.None||p.locked>Kt.None?(S.style.userSelect="initial",S.style.pointerEvents="initial"):(S.style.userSelect="none",S.style.pointerEvents="none"),p.globalAlpha<=1&&(S.style.opacity=String(p.globalAlpha)))},o.removeDiv=function(p){if(o.curNode&&p.id===o.curNode.id&&(o.curNode=void 0,o.media=void 0,o.player.style.top="-99999px"),p.audio&&(o.canvas.removeChild(o.audios[p.id].player),o.audios[p.id]=void 0),p.video&&(o.canvas.removeChild(Ut[p.id].player),Ut[p.id]=void 0),p.iframe&&(o.canvas.removeChild(o.iframes[p.id]),o.iframes[p.id]=void 0),p.elementId&&(o.canvas.removeChild(o.elements[p.id]),o.elements[p.id]=void 0,p.elementId=""),p.gif&&(o.canvas.removeChild(o.gifs[p.id]),o.gifs[p.id]=void 0),p.children)for(var S=0,U=p.children;S<U.length;S++){var j=U[S];j.type!==g.Line&&o.removeDiv(j)}},o.options.playIcon||(o.options.playIcon="t-icon t-play"),o.options.pauseIcon||(o.options.pauseIcon="t-icon t-pause"),o.options.fullScreenIcon||(o.options.fullScreenIcon="t-icon t-full-screen"),o.options.loopIcon||(o.options.loopIcon="t-icon t-loop"),o.canvas.style.position="absolute",o.canvas.style.left="0",o.canvas.style.top="0",o.canvas.style.outline="none",o.canvas.style.background="transparent",e.appendChild(o.canvas),e.appendChild(o.player),o.createPlayer(),o.subcribeDiv=nt.Store.subscribe(o.generateStoreKey("LT:addDiv"),o.addDiv),o.subcribeDiv=nt.Store.subscribe(o.generateStoreKey("LT:removeDiv"),o.removeDiv),o.subcribePlay=nt.Store.subscribe(o.generateStoreKey("LT:play"),function(p){o.playOne(p.pen,p.pause)}),o.subcribeNode=nt.Store.subscribe(o.generateStoreKey("LT:activeNode"),function(p){if(!p||!p.video&&!p.audio){o.player.style.top="-99999px";return}if(p.audio&&o.audios[p.id])o.media=o.audios[p.id].media;else if(p.video&&Ut[p.id])o.media=Ut[p.id].media;else return;o.curNode=p;var S=o.parentElem.getBoundingClientRect();o.player.style.top=S.top+o.parentElem.clientHeight-40+"px",o.player.style.left=S.left+"px",o.player.style.width=o.parentElem.clientWidth+"px",o.getMediaCurrent(),o.media.paused?o.playBtn.className=o.options.playIcon:o.playBtn.className=o.options.pauseIcon}),document.addEventListener("fullscreenchange",function(p){!o.media||(document.fullscreen?(o.media.controls=!0,o.media.style.userSelect="initial",o.media.style.pointerEvents="initial"):(o.media.style.userSelect="none",o.media.style.pointerEvents="none",o.media.controls=!1))}),o}return t.prototype.play=function(e,i){var n=this;if(!!e){var o=x(e,this.data.pens);o.forEach(function(p){n.playOne(p,i)})}},t.prototype.playOne=function(e,i){e.audio&&this.audios[e.id]&&this.audios[e.id].media?i?this.audios[e.id].media.pause():this.audios[e.id].media.paused&&this.audios[e.id].media.play():e.video&&Ut[e.id].media&&(i?Ut[e.id].media.pause():Ut[e.id].media.paused&&Ut[e.id].media.play())},t.prototype.addIframe=function(e){var i=document.createElement("iframe");return i.scrolling="no",i.frameBorder="0",i.src=e.iframe,this.iframes[e.id]=i,this.canvas.appendChild(i),i},t.prototype.addGif=function(e){return this.gifs[e.id]=e.img,this.canvas.appendChild(e.img),e.img},t.prototype.clear=function(e){if(this.canvas.innerHTML="",this.audios={},Ut={},this.iframes={},this.elements={},this.gifs={},!e)for(var i in T)delete T[i];this.player.style.top="-99999px"},t.prototype.formatSeconds=function(e){var i=Math.floor(e/3600),n=Math.floor(e/60)%60,o=Math.floor(e%60),p=o+"";return n?p=n+":"+o:p="0:"+o,i&&(p=i+":"+n+":"+o),p},t.prototype.resize=function(e){e?(this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px"):(this.options.width&&this.options.width!=="auto"?this.canvas.style.width=this.options.width+"px":this.canvas.style.width=this.parentElem.clientWidth+"px",this.options.height&&this.options.height!=="auto"?this.canvas.style.height=this.options.height+"px":this.canvas.style.height=this.parentElem.clientHeight-8+"px")},t.prototype.render=function(){for(var e=0,i=this.data.pens;e<i.length;e++){var n=i[e];n.getTID()||n.setTID(this.TID),this.addDiv(n)}},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.clear(),this.subcribeDiv.unsubscribe(),this.subcribeNode.unsubscribe(),this.subcribePlay.unsubscribe()},t}(re),ve=function(t){var e=0,i=0,n=0,o=0;if(typeof t=="number")e=i=n=o=t;else if(typeof t=="string"){var p=parseInt(t,10);e=i=n=o=p}else Array.isArray(t)&&(e=t[0],n=ge(t[1])?t[0]:t[1],o=ge(t[2])?t[0]:t[2],i=ge(t[3])?n:t[3]);return[e,n,o,i]};function ge(r){return r==null}var ui=function(){function r(t,e){this.url=t,this.cb=e,this.fns={},this.init()}return r.prototype.init=function(){var t=this;this.socket=new WebSocket(this.url),this.socket.onmessage=this.cb,this.socket.onclose=function(){console.info("Canvas websocket closed and reconneting..."),t.init()}},r.prototype.close=function(){this.socket.onclose=void 0,this.socket.close()},r}(),fi=dt(99053),di=function(){function r(t,e,i,n){this.url=t,this.options=e,this.topics=i,this.cb=n,this.fns={},this.init()}return r.prototype.init=function(){this.client=fi.connect(this.url,this.options),this.client.on("message",this.cb),this.topics&&this.client.subscribe(this.topics.split(","))},r.prototype.publish=function(t,e){this.client.publish(t,e)},r.prototype.close=function(){this.client.end()},r}(),pi={i8:"0.5.36"},yi=function(){function r(t){var e=this;this.parent=t,this.onMouseDownH=function(p){p.preventDefault(),p.stopPropagation(),e.isDownH=p.x,e.x=e.parent.data.x||0,e.lastScrollX=e.scrollX},this.onMouseDownV=function(p){p.preventDefault(),p.stopPropagation(),e.isDownV=p.y,e.y=e.parent.data.y||0,e.lastScrollY=e.scrollY},this.onMouseMove=function(p){if(e.isDownH){var S=p.x-e.isDownH;e.scrollX=e.lastScrollX+S,e.h.style.left=e.scrollX+"px",e.parent.data.x=e.x-S*e.rect.width/e.parent.parentElem.clientWidth}if(e.isDownV){var U=p.y-e.isDownV;e.scrollY=e.lastScrollY+U,e.v.style.top=e.scrollY+"px",e.parent.data.y=e.y-U*e.rect.height/e.parent.parentElem.clientHeight}(e.isDownH||e.isDownV)&&(e.parent.render(),e.parent.divLayer.render())},this.onMouseUp=function(p){!e.isDownH&&!e.isDownV||(e.isDownH=void 0,e.isDownV=void 0,e.scrollX<20?(e.scrollX=20,e.h.style.left=e.scrollX+"px"):e.scrollX>e.parent.parentElem.clientWidth-e.hSize-20&&(e.scrollX=e.parent.parentElem.clientWidth-e.hSize-20,e.h.style.left=e.scrollX+"px"),e.scrollY<20?(e.scrollY=20,e.v.style.top=e.scrollY+"px"):e.scrollY>e.parent.parentElem.clientHeight-e.vSize-20&&(e.scrollY=e.parent.parentElem.clientHeight-e.vSize-20,e.v.style.top=e.scrollY+"px"),e.resize())},this.h=document.createElement("div"),this.v=document.createElement("div"),this.parent.parentElem.appendChild(this.h),this.parent.parentElem.appendChild(this.v),this.h.className="topology-scroll h",this.h.onmousedown=this.onMouseDownH,this.v.className="topology-scroll v",this.v.onmousedown=this.onMouseDownV,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp);for(var i,n=0;n<document.styleSheets.length;n++)document.styleSheets[n].title==="le5le/scroll"&&(i=document.styleSheets[n]);if(!i){var o=document.createElement("style");o.type="text/css",o.title="le5le.com/scroll",document.head.appendChild(o),o=document.createElement("style"),o.type="text/css",document.head.appendChild(o),i=o.sheet,i.insertRule(".topology-scroll{position:absolute;width:8px;height:200px;background:#dddddd;border-radius:10px;z-index:20;cursor:default;}"),i.insertRule(".topology-scroll:hover{background:#cccccc;cursor:pointer}"),i.insertRule(".topology-scroll.v{right:0;top:calc(50% - 100px);}"),i.insertRule(".topology-scroll.h{bottom:2px;left:calc(50% - 100px);width:200px;height:8px;}")}this.init()}return r.prototype.init=function(){this.resize(),this.initPos()},r.prototype.initPos=function(){this.scrollX=(this.parent.parentElem.clientWidth-this.hSize)/2,this.scrollY=(this.parent.parentElem.clientHeight-this.vSize)/2,this.h.style.left=this.scrollX+"px",this.v.style.top=this.scrollY+"px"},r.prototype.resize=function(){this.rect=Jt(this.parent.data.pens),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.parent.data.x>0?this.rect.width+=this.parent.data.x+(this.rect.x>0?0:this.rect.x):this.rect.width-=this.parent.data.x+(this.rect.x>0?0:this.rect.x),this.parent.data.y>0?this.rect.height+=this.parent.data.y+(this.rect.y>0?0:this.rect.y):this.rect.height-=this.parent.data.y+(this.rect.y>0?0:this.rect.y),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.hSize=1e3*this.parent.parentElem.clientWidth/this.rect.width/3,this.vSize=1e3*this.parent.parentElem.clientHeight/this.rect.height/3,this.h.style.width=this.hSize+"px",this.v.style.height=this.vSize+"px"},r.prototype.show=function(){this.isShow=!0,this.h.style.display="block",this.v.style.display="block",document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},r.prototype.hide=function(){this.isShow=!1,this.h.style.display="none",this.v.style.display="none",this.destroy()},r.prototype.translate=function(t,e){t&&(this.scrollX-=t*this.parent.parentElem.clientWidth/this.rect.width,this.h.style.left=this.scrollX+"px"),e&&(this.scrollY-=e*this.parent.parentElem.clientHeight/this.rect.height,this.v.style.top=this.scrollY+"px")},r.prototype.wheel=function(t){var e=10;t&&(e=-10),this.scrollY+=e,this.v.style.top=this.scrollY+"px",this.parent.data.y-=e*this.rect.height/this.parent.parentElem.clientHeight,this.parent.render(),this.parent.divLayer.render()},r.prototype.destroy=function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},r}(),ee=function(){return ee=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},ee.apply(this,arguments)},vi=["nw-resize","ne-resize","se-resize","sw-resize"],yt;(function(r){r[r.None=0]="None",r[r.Line=1]="Line",r[r.LineFrom=2]="LineFrom",r[r.LineTo=3]="LineTo",r[r.LineControlPoint=4]="LineControlPoint",r[r.Nodes=5]="Nodes",r[r.ResizeCP=6]="ResizeCP",r[r.HoverAnchors=7]="HoverAnchors",r[r.AutoAnchor=8]="AutoAnchor",r[r.Rotate=9]="Rotate",r[r.GraffitiReady=10]="GraffitiReady",r[r.Graffiti=11]="Graffiti",r[r.LinesReady=12]="LinesReady",r[r.Lines=13]="Lines"})(yt||(yt={}));var Me=10,gi=function(){function r(t,e){var i=this;e===void 0&&(e={}),this.VERSION=pi.i8,this.id=Ct(),this.data=te(void 0,this.id),this.caches={index:0,dbIndex:0,list:[]},this.touchStart=0,this.input=document.createElement("textarea"),this.lastTranlated={x:0,y:0},this.moveIn={type:yt.None,activeAnchorIndex:0,hoverAnchorIndex:0,hoverNode:void 0,hoverLine:void 0,activeNode:void 0,lineControlPoint:void 0},this.needCache=!1,this.tip="",this.scheduledAnimationFrame=!1,this.scrolling=!1,this.rendering=!1,this.alreadyCopy=!1,this.onScroll=function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},this.preventDefault=function(n){n.preventDefault()},this.winResize=function(){var n;n&&clearTimeout(n),n=setTimeout(function(){i.resize()},100)},this.calibrateMouse=function(n){return n.x-=i.data.x,n.y-=i.data.y,n},this.subscribeSocket=function(){if(!i.data.socketFn)return!1;i.data.socketEvent||(i.data.socketEvent=!0);try{var n=new Function("e",i.data.socketFn);i.socketFn&&(i.off("websocket",i.socketFn),i.off("mqtt",i.socketFn)),i.on("websocket",n),i.on("mqtt",n),i.socketFn=n}catch(o){return console.error("Create the function for socket:",o),!1}return!0},this.onMouseMove=function(n){var o;if(!(i.scheduledAnimationFrame||((o=i.data)===null||o===void 0?void 0:o.locked)===Kt.NoEvent)){if(i.mouseDown&&!i.mouseDown.restore&&n.buttons!==1&&n.buttons!==2){i.onmouseup(n);return}if(i.mouseDown&&(i.data.locked||i.spaceDown||!i.moveIn.type)){var p=!!i.data.locked;switch(i.options.translateKey){case vt.Right:n.buttons==2&&(p=!0);break;case vt.Any:p=!0;break;case vt.Ctrl:n.ctrlKey&&(p=!0);break;case vt.Shift:n.shiftKey&&(p=!0);break;case vt.Alt:n.altKey&&(p=!0);break;default:(n.ctrlKey||n.altKey||n.buttons==2)&&(p=!0)}if(i.spaceDown||!i.options.disableTranslate&&p&&i.data.locked<Kt.NoMove)return i.translate(n.x,n.y,!0),!1}i.data.locked&&i.mouseDown||(i.scheduledAnimationFrame=!0,i.raf&&cancelAnimationFrame(i.raf),i.raf=requestAnimationFrame(function(){i.raf=void 0;var S=i.calibrateMouse({x:n.x,y:n.y});if(i.moveIn.type===yt.Lines){i.hoverLayer.line&&(i.hoverLayer.lineTo(new R(S.x,S.y),""),n.shiftKey||n.ctrlKey||n.altKey||n.buttons==2?(i.hoverLayer.line.name="curve",i.hoverLayer.line.calcControlPoints()):i.hoverLayer.line.name="line",i.render()),i.scheduledAnimationFrame=!1;return}if(!i.mouseDown){i.getMoveIn(S),i.moveIn.hoverNode!==i.lastHoverNode&&(i.lastHoverNode&&(i.lastHoverNode.moveOut(),i.dispatch("moveOutNode",i.lastHoverNode),i.hideTip(),i.hoverLayer.node=void 0),i.moveIn.hoverNode&&(i.hoverLayer.node=i.moveIn.hoverNode,i.moveIn.hoverNode.moveIn(),i.dispatch("moveInNode",Object.assign(i.moveIn.hoverNode,{evs:{x:n.pageX,y:n.pageY}})),i.showTip(i.moveIn.hoverNode,S))),i.moveIn.hoverLine!==i.lastHoverLine&&!i.moveIn.hoverNode&&(i.lastHoverLine&&(i.lastHoverLine.moveOut(),i.dispatch("moveOutLine",i.lastHoverLine),i.hideTip()),i.moveIn.hoverLine&&(i.hoverLayer.line=i.moveIn.hoverLine,i.moveIn.hoverLine.moveIn(),i.dispatch("moveInLine",Object.assign(i.moveIn.hoverLine,{evs:{x:n.pageX,y:n.pageY}})),i.showTip(i.moveIn.hoverLine,S))),i.moveIn.type===yt.LineControlPoint?i.hoverLayer.hoverLineCP=i.moveIn.lineControlPoint:i.hoverLayer.hoverLineCP&&(i.hoverLayer.hoverLineCP=void 0),(i.moveIn.hoverNode!==i.lastHoverNode||i.moveIn.type===yt.HoverAnchors||i.hoverLayer.lasthoverLineCP!==i.hoverLayer.hoverLineCP)&&(i.hoverLayer.lasthoverLineCP=i.hoverLayer.hoverLineCP,i.render()),i.scheduledAnimationFrame=!1;return}var U=n.x+50>i.parentElem.clientWidth+i.parentElem.scrollLeft,j=n.y+50>i.parentElem.clientHeight+i.parentElem.scrollTop;if(!i.options.disableMoveOutParent&&(U||j)){i.dispatch("moveOutParent",n);var rt=0,ht=0;n.x+50>i.divLayer.canvas.clientWidth&&(rt=-5),n.y+50>i.divLayer.canvas.clientHeight&&(ht=-5),i.translate(rt,ht,!1)}switch(i.hideTip(),i.moveIn.type){case yt.None:i.hoverLayer.dragRect=new a(i.mouseDown.x-i.data.x,i.mouseDown.y-i.data.y,n.x-i.mouseDown.x,n.y-i.mouseDown.y);break;case yt.Nodes:if(i.activeLayer.locked()||i.data.locked)break;if(n.ctrlKey&&!i.alreadyCopy)i.alreadyCopy=!0,i.copy(),i.paste(),i.needCache=!0;else{var rt=n.x-i.mouseDown.x,ht=n.y-i.mouseDown.y;if(rt||ht){var ct=i.getDockPos(rt,ht,n.ctrlKey||n.shiftKey||n.altKey);i.activeLayer.move(ct.x?ct.x:rt,ct.y?ct.y:ht),i.needCache=!0}}break;case yt.ResizeCP:{var rt=n.x-i.mouseDown.x,ht=n.y-i.mouseDown.y;if(rt||ht){var ct=i.getDockPos(rt,ht,n.ctrlKey||n.shiftKey||n.altKey),xt=Object.assign({},n);ct.x&&(xt.x=ct.x+i.mouseDown.x),ct.y&&(xt.y=ct.y+i.mouseDown.y),i.activeLayer.resize(i.moveIn.activeAnchorIndex,i.mouseDown,xt),i.dispatch("resizePens",i.activeLayer.pens),i.needCache=!0}break}case yt.LineTo:case yt.HoverAnchors:case yt.AutoAnchor:if(i.hoverLayer.dockAnchor&&i.hoverLayer.dockAnchor.hit(n,10))break;var kt=i.data.toArrow;i.moveIn.hoverLine&&(kt=i.moveIn.hoverLine.toArrow),i.hoverLayer.line&&(kt=i.hoverLayer.line.toArrow),i.hoverLayer.line&&(i.activeLayer.pens=[i.hoverLayer.line]);var It=i.hoverLayer.line.to.id;if(n.ctrlKey||n.shiftKey||n.altKey)i.hoverLayer.lineTo(new R(S.x,S.y),kt);else{var Bt=i.getLineDock(new R(S.x,S.y),$t.In);It=Bt.id,i.hoverLayer.lineTo(Bt,kt)}if(i.hoverLayer.line.to.id=It,i.hoverLayer.line.parentId){var ft=i.find(It);ft&&ft.from&&(ft.from.x=i.hoverLayer.line.to.x,ft.from.y=i.hoverLayer.line.to.y)}i.needCache=!0;break;case yt.LineFrom:var Xt=i.hoverLayer.line.from.id;if(n.ctrlKey||n.shiftKey||n.altKey)i.hoverLayer.lineFrom(new R(S.x,S.y));else{var Yt=i.getLineDock(new R(S.x,S.y),$t.Out);Xt=Yt.id,i.hoverLayer.lineFrom(Yt)}if(i.hoverLayer.line.from.id=Xt,i.hoverLayer.line.parentId){var ft=i.find(Xt);ft&&ft.to&&(ft.to.x=i.hoverLayer.line.from.x,ft.to.y=i.hoverLayer.line.from.y)}i.needCache=!0;break;case yt.Line:{var rt=n.x-i.mouseDown.x,ht=n.y-i.mouseDown.y;(rt||ht)&&(i.activeLayer.move(rt,ht),i.hoverLayer.line.children?i.animateLayer.updateLines(i.hoverLayer.line.children):i.animateLayer.updateLines([i.hoverLayer.line]),i.needCache=!0)}break;case yt.LineControlPoint:i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id].x=S.x,i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id].y=S.y,i.moveIn.hoverLine.textRect=void 0,Nt[i.moveIn.hoverLine.name]&&Nt[i.moveIn.hoverLine.name].dockControlPointFn&&Nt[i.moveIn.hoverLine.name].dockControlPointFn(i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id],i.moveIn.hoverLine),i.needCache=!0,nt.Store.set(i.generateStoreKey("LT:updateLines"),[i.moveIn.hoverLine]);break;case yt.Rotate:i.activeLayer.pens.length&&(i.activeLayer.offsetRotate(i.getAngle(S)),i.activeLayer.updateLines()),i.needCache=!0;break;case yt.Graffiti:i.moveIn.hoverNode.pushPoint(new R(S.x,S.y));break}i.render(),i.scheduledAnimationFrame=!1}))}},this.onmousedown=function(n){if(!(n.button!==0&&n.button!==2)){switch(i.mouseDown=n,n.altKey&&(i.divLayer.canvas.style.cursor="move"),i.inputObj&&i.setNodeText(),i.moveIn.type){case yt.None:i.activeLayer.clear(),i.hoverLayer.clear(),i.dispatch("space",i.mouseDown);break;case yt.Line:case yt.LineControlPoint:n.ctrlKey||n.shiftKey?(i.activeLayer.add(i.moveIn.hoverLine),i.dispatch("multi",i.activeLayer.pens)):(i.activeLayer.pens=[i.moveIn.hoverLine],i.dispatch("line"+(n.button===2?"RightClick":""),Object.assign(i.moveIn.hoverLine,{evs:{x:n.pageX,y:n.pageY}}))),i.hoverLayer.line=i.moveIn.hoverLine,i.hoverLayer.initLine=new Mt(i.moveIn.hoverLine),(i.data.locked||i.moveIn.hoverLine.locked)&&i.moveIn.hoverLine.click();break;case yt.LineFrom:case yt.LineTo:i.activeLayer.pens=[i.moveIn.hoverLine],i.dispatch("line",i.moveIn.hoverLine),i.hoverLayer.line=i.moveIn.hoverLine;break;case yt.HoverAnchors:i.hoverLayer.line=i.addLine({name:i.data.lineName,from:new R(i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].x,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].y,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].direction,i.moveIn.hoverAnchorIndex,i.moveIn.hoverNode.id),fromArrow:i.data.fromArrow,to:new R(i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].x,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].y),toArrow:i.data.toArrow,strokeStyle:i.options.color,lineWidth:i.data.lineWidth}),i.dispatch("anchor",{anchor:i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex],anchorIndex:i.moveIn.hoverAnchorIndex,node:i.moveIn.hoverNode,line:i.hoverLayer.line});break;case yt.AutoAnchor:i.hoverLayer.line=i.addLine({name:i.data.lineName,from:new R(i.moveIn.hoverNode.rect.center.x,i.moveIn.hoverNode.rect.center.y,_.None,0,i.moveIn.hoverNode.id),fromArrow:i.data.fromArrow,to:new R(i.moveIn.hoverNode.rect.center.x,i.moveIn.hoverNode.rect.center.y),toArrow:i.data.toArrow,strokeStyle:i.options.color,lineWidth:i.data.lineWidth}),i.hoverLayer.line.from.autoAnchor=!0,i.dispatch("nodeCenter",i.moveIn.hoverNode);break;case yt.Nodes:if(!i.moveIn.activeNode)break;n.ctrlKey||n.shiftKey?i.moveIn.hoverNode&&i.activeLayer.hasInAll(i.moveIn.hoverNode)?(i.activeLayer.setPens([i.moveIn.hoverNode]),i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.hoverNode)):i.activeLayer.has(i.moveIn.activeNode)||(i.activeLayer.add(i.moveIn.activeNode),i.activeLayer.pens.length>1?i.dispatch("multi",i.activeLayer.pens):i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.activeNode)):n.altKey?i.moveIn.hoverNode?(i.activeLayer.setPens([i.moveIn.hoverNode]),i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.hoverNode)):i.moveIn.hoverLine&&(i.activeLayer.setPens([i.moveIn.hoverLine]),i.dispatch("line",i.moveIn.hoverLine)):i.activeLayer.pens.length<2&&(i.activeLayer.setPens([i.moveIn.activeNode]),i.dispatch("node"+(n.button===2?"RightClick":""),Object.assign(i.moveIn.activeNode,{evs:{x:n.pageX,y:n.pageY}}))),(i.data.locked||i.moveIn.activeNode.locked)&&i.moveIn.activeNode.click(),i.activeLayer.calcActiveRect();break;case yt.Graffiti:var o=i.calibrateMouse({x:n.x,y:n.y});i.moveIn.hoverNode.pushPoint(new R(o.x,o.y));break}i.activeLayer.pens.length&&i.activeLayer.saveNodeRects(),i.render()}},this.onmouseup=function(n){if(!!i.mouseDown){if(i.mouseDown=void 0,i.lastTranlated.x=0,i.lastTranlated.y=0,i.hoverLayer.dockAnchor=void 0,i.hoverLayer.dockLineX=0,i.hoverLayer.dockLineY=0,i.divLayer.canvas.style.cursor="default",i.alreadyCopy=!1,i.hoverLayer.dragRect)i.getPensInRect(i.hoverLayer.dragRect),i.activeLayer.pens&&i.activeLayer.pens.length>1?i.dispatch("multi",i.activeLayer.pens):i.activeLayer.pens&&i.activeLayer.pens[0]&&i.activeLayer.pens[0].type===g.Line?i.dispatch("line"+(n.button===2?"RightClick":""),i.activeLayer.pens[0]):i.activeLayer.pens&&i.activeLayer.pens[0]&&i.activeLayer.pens[0].type===g.Node&&i.dispatch("node"+(n.button===2?"RightClick":""),i.activeLayer.pens[0]),i.activeLayer.calcActiveRect();else{var o=i.calibrateMouse({x:n.x,y:n.y});switch(i.moveIn.type){case yt.Nodes:if(n.ctrlKey&&n.shiftKey&&n.altKey){i.moveIn.hoverNode.manualAnchors||(i.moveIn.hoverNode.manualAnchors=[]);var p=new R(o.x,o.y);p.id=i.moveIn.hoverNode.id,i.moveIn.hoverNode.manualAnchors.push(p),i.moveIn.hoverNode.calcAnchors(),i.needCache=!0}(i.data.locked||i.moveIn.activeNode.locked)&&i.moveIn.activeNode.mouseUp();break;case yt.Line:case yt.LineControlPoint:(i.data.locked||i.moveIn.hoverLine.locked)&&i.moveIn.hoverLine.mouseUp();break;case yt.HoverAnchors:if(i.hoverLayer.line){var S=void 0,U=i.hoverLayer.line,j=U.from,rt=U.to;if(i.hoverLayer.line.to.id){if(!i.options.disableRepeatLine)S=!0;else{var ht=i.data.pens.filter(function(kt){return kt.type===g.Line&&kt.from.isSameAs(i.hoverLayer.line.from)&&kt.to.isSameAs(i.hoverLayer.line.to)});S=ht.length<=1}j.id===rt.id&&j.anchorIndex===rt.anchorIndex&&(S=!1)}else S=!i.options.disableEmptyLine&&!i.hoverLayer.line.disableEmptyLine,S=S&&Math.pow(j.x-rt.x,2)+Math.pow(j.y-rt.y,2)>25;S?(i.activeLayer.pens=[i.hoverLayer.line],i.dispatch("addLine",i.hoverLayer.line)):(i.data.pens.pop(),i.activeLayer.clear())}i.offscreen.render(),i.hoverLayer.line=void 0;break;case yt.AutoAnchor:(i.hoverLayer.line.disableEmptyLine||i.options.disableEmptyLine)&&(!i.hoverLayer.line.from.id||!i.hoverLayer.line.to.id)?(i.needCache=!0,i.activeLayer.clear(),i.data.pens.splice(i.findIndex(i.hoverLayer.line),1)):(i.activeLayer.updateLines(),i.dispatch("addLine",i.hoverLayer.line));break;case yt.Rotate:i.activeLayer.updateRotate();break;case yt.LineControlPoint:nt.Store.set(i.generateStoreKey("pts-")+i.moveIn.hoverLine.id,void 0);break;case yt.LineFrom:case yt.LineTo:(i.hoverLayer.line.disableEmptyLine||i.options.disableEmptyLine)&&(!i.hoverLayer.line.from.id||!i.hoverLayer.line.to.id)&&(i.needCache=!0,i.activeLayer.clear(),i.data.pens.splice(i.findIndex(i.hoverLayer.line),1)),i.hoverLayer.line.from.id&&i.hoverLayer.line.to.id&&i.dispatch("lineOn",Object.assign(i.hoverLayer.line,{lineOnDirection:i.moveIn.type}));break;case yt.Graffiti:!i.moveIn.hoverNode.points||i.moveIn.hoverNode.points.length<2?(i.moveIn.type=yt.None,i.data.pens.pop()):(i.moveIn.type=yt.Nodes,i.moveIn.hoverNode.doing=void 0,i.moveIn.hoverNode.calcAnchors(),i.activeLayer.setPens([i.moveIn.hoverNode]),i.hoverLayer.node=i.moveIn.hoverNode,i.needCache=!0);break;case yt.Lines:var ct=void 0;i.moveIn.hoverLine.children&&i.moveIn.hoverLine.children.length&&(ct=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1]),ct||(i.moveIn.hoverLine.children=[]);var xt=new Mt({parentId:i.moveIn.hoverLine.id,name:"line",from:new R(o.x,o.y),fromArrow:ct?"":i.data.fromArrow,to:new R(o.x,o.y),toArrow:"",strokeStyle:i.options.color,lineWidth:i.data.lineWidth});ct&&(xt.from.id=ct.id,xt.from.x=ct.to.x,xt.from.y=ct.to.y,ct.to.id=xt.id),i.moveIn.hoverLine.children.push(xt),i.hoverLayer.line=xt,i.dispatch("addLineInLines",{previous:ct,line:xt})}}i.hoverLayer.dragRect=void 0,i.activeLayer.lastOffsetX=0,i.activeLayer.lastOffsetY=0,i.render(),i.needCache&&i.cache(),i.needCache=!1}},this.ondblclick=function(){i.moveIn.hoverNode?(i.dispatch("dblclick",i.moveIn.hoverNode),i.data.locked||i.moveIn.hoverNode.locked||i.moveIn.hoverNode.hideInput||i.options.hideInput||i.showInput(i.moveIn.hoverNode),i.moveIn.hoverNode.dblclick()):i.moveIn.hoverLine&&(i.dispatch("dblclick",i.moveIn.hoverLine),i.data.locked||i.moveIn.hoverLine.locked||i.moveIn.hoverLine.hideInput||i.options.hideInput||i.showInput(i.moveIn.hoverLine),i.moveIn.hoverLine.dblclick())},this.onkeydown=function(n){if(!(i.data.locked||n.target.tagName==="INPUT"||n.target.tagName==="TEXTAREA")){var o=!1,p=0,S=0;switch(n.key){case" ":i.spaceDown=!0;break;case"a":case"A":i.activeLayer.setPens(i.data.pens),o=!0;break;case"Delete":case"Backspace":n.ctrlKey||n.metaKey?i.deleteAnchors():i.delete();break;case"ArrowLeft":p=-5,(n.ctrlKey||n.metaKey)&&(p=-1),o=!0;break;case"ArrowUp":S=-5,(n.ctrlKey||n.metaKey)&&(S=-1),o=!0;break;case"ArrowRight":p=5,(n.ctrlKey||n.metaKey)&&(p=1),o=!0;break;case"ArrowDown":S=5,(n.ctrlKey||n.metaKey)&&(S=1),o=!0;break;case"x":case"X":i.cut();break;case"c":case"C":i.copy();break;case"v":case"V":i.paste();break;case"y":case"Y":(n.ctrlKey||n.metaKey)&&i.redo();break;case"z":case"Z":n.shiftKey?i.redo():(n.ctrlKey||n.metaKey)&&i.undo();break;case"Enter":if(i.moveIn.type===yt.Lines){if(i.moveIn.type=yt.None,i.moveIn.hoverLine.doing="",i.hoverLayer.line.getLen()<10&&(i.moveIn.hoverLine.children.pop(),i.hoverLayer.line=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1]),i.moveIn.hoverLine.isNode){var U=[];i.moveIn.hoverLine.children.forEach(function(It){U.push(It.from),It.controlPoints&&It.controlPoints.forEach(function(Bt){Bt.data=!0,U.push(Bt)}),U.push(It.to)});var j=ye(U),rt=j.x1,ht=j.y1,ct=j.x2,xt=j.y2,kt=new _t({name:"lines",rect:new a(rt,ht,ct-rt,xt-ht),points:U,closePath:i.moveIn.hoverLine.closePath});i.activeLayer.add(kt),i.data.pens.pop(),i.data.pens.push(kt)}else i.hoverLayer.line.toArrow=i.data.toArrow,i.activeLayer.add(i.moveIn.hoverLine);i.moveIn.hoverLine=void 0}o=!0;break;case"Escape":i.moveIn.type===yt.Lines&&(i.moveIn.type=yt.None,i.moveIn.hoverLine.children.pop(),i.hoverLayer.line=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1],i.hoverLayer.line.toArrow=i.data.toArrow,i.moveIn.hoverLine.doing="",i.moveIn.hoverLine=void 0),o=!0;break}!o||(n.preventDefault(),n.stopPropagation(),(p||S)&&(i.activeLayer.saveNodeRects(),i.activeLayer.move(p,S),i.animateLayer.animate()),i.render(),i.cache())}},this._emitter=St(),this.options=Object.assign({},Pt,e),nt.Store.set(this.generateStoreKey("LT:color"),this.options.color||"#222222"),nt.Store.set(this.generateStoreKey("LT:fontColor"),this.options.fontColor||"#222222"),this.setupDom(t),this.setupSubscribe(),this.setupMouseEvent(),setTimeout(function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},500),setTimeout(function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},1e3),this.cache(),window.topology=this,this.dispatch("loaded")}return Object.defineProperty(r.prototype,"ramCaches",{get:function(){return 5},enumerable:!0,configurable:!0}),r.prototype.setupDom=function(t){typeof t=="string"?this.parentElem=document.getElementById(t):this.parentElem=t,this.parentElem.style.position="relative",this.parentElem.style.overflow="auto",this.parentElem.onresize=this.winResize,window.addEventListener("resize",this.winResize);var e=this.id;this.activeLayer=new si(this.options,e),this.activeLayer.topology=this,this.hoverLayer=new ni(this.options,e),this.animateLayer=new hi(this.options,e),this.offscreen=new ti(this.parentElem,this.options,e),this.canvas=new ri(this.parentElem,this.options,e),this.divLayer=new li(this.parentElem,this.options,e),this.options.scroll&&(this.scrollDom=new yi(this)),this.input.style.position="absolute",this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.input.style.height="0",this.input.style.outline="none",this.input.style.border="1px solid #cdcdcd",this.input.style.resize="none",this.parentElem.appendChild(this.input),this.createMarkdownTip(),this.resize()},r.prototype.setupSubscribe=function(){var t=this;this.subcribe=nt.Store.subscribe(this.generateStoreKey("LT:render"),function(){t.render()}),this.subcribeRender=nt.Store.subscribe("LT:render",function(){t.render()}),this.subcribeImage=nt.Store.subscribe(this.generateStoreKey("LT:imageLoaded"),function(){t.imageTimer&&clearTimeout(t.imageTimer),t.imageTimer=setTimeout(function(){t.render()},100)}),this.subcribeAnimateMoved=nt.Store.subscribe(this.generateStoreKey("LT:rectChanged"),function(e){t.activeLayer.updateLines([e])}),this.subcribeMediaEnd=nt.Store.subscribe(this.generateStoreKey("mediaEnd"),function(e){e.nextPlay&&(t.animateLayer.readyPlay(e.nextPlay),t.animateLayer.animate()),t.dispatch("mediaEnd",e)}),this.subcribeAnimateEnd=nt.Store.subscribe(this.generateStoreKey("animateEnd"),function(e){if(!!e){switch(e.type){case g.Node:t.offscreen.render();break}t.dispatch("animateEnd",e)}}),this.subcribeEmit=nt.Store.subscribe(this.generateStoreKey("LT:emit"),function(e){t.emit(e.event,e)})},r.prototype.setupMouseEvent=function(){var t=this;switch(this.canvasPos=this.divLayer.canvas.getBoundingClientRect(),this.parentElem.addEventListener("scroll",this.onScroll),window.addEventListener("scroll",this.onScroll),this.divLayer.canvas.ondragover=function(e){return e.preventDefault()},this.divLayer.canvas.ondrop=function(e){if(!t.data.locked)try{var i=e.dataTransfer.getData("Topology")||e.dataTransfer.getData("Text");if(!i)return;var n=JSON.parse(i);e.preventDefault();var o=t.calibrateMouse({x:e.offsetX,y:e.offsetY});t.dropNodes(Array.isArray(n)?n:[n],o.x,o.y),t.activeLayer.calcActiveRect()}catch(p){}},Qr()?(this.options.refresh=50,document.addEventListener("gesturestart",this.preventDefault),this.divLayer.canvas.ontouchstart=function(e){t.touchStart=Date.now();var i=new R(e.changedTouches[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.changedTouches[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));if(e.touches.length>1){t.touches=e.touches,t.touchScale=t.data.scale,t.lastTranlated.x=i.x,t.lastTranlated.y=i.y;return}var n=t.calibrateMouse({x:i.x,y:i.y});t.getMoveIn(n),t.hoverLayer.node=t.moveIn.hoverNode,t.hoverLayer.line=t.moveIn.hoverLine,t.lastTranlated.x=i.x,t.lastTranlated.y=i.y,t.onmousedown({x:i.x,y:i.y,ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:0})},this.divLayer.canvas.ontouchmove=function(e){e.stopPropagation();var i=e.touches,n=i.length;!t.touchCenter&&n>1&&(t.touchCenter={x:i[0].pageX+(i[1].pageX-i[0].pageX)/2,y:i[0].pageY+(i[1].pageY-i[0].pageY)/2},t.calibrateMouse(t.touchCenter));var o=Date.now();if(!(o-t.touchStart<50)){if(n>1){if(n===2){var p=e.scale||Math.hypot(i[0].pageX-i[1].pageX,i[0].pageY-i[1].pageY)/Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY);e.preventDefault(),t.scaleTo(p*t.touchScale,t.touchCenter)}else if(n===3){var S=new R(i[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),i[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.translate(S.x,S.y,!0)}return}e.preventDefault();var U=new R(e.touches[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.touches[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.onMouseMove({x:U.x,y:U.y,ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,buttons:1})}},this.divLayer.canvas.ontouchend=function(e){t.touches=void 0,t.touchCenter=void 0,t.ontouchend(e)}):(this.divLayer.canvas.onmousedown=function(e){if(!(e.target.nodeName==="INPUT"&&e.target.type==="range"&&t.data.locked)){t.touchedNode&&(t.touchedNode.name==="graffiti"?(t.touchedNode.rect=new a(0,0,0,0),t.addNode(t.touchedNode),t.touchedNode=void 0):t.touchedNode.name==="lines"&&(t.addLine(t.touchedNode),t.touchedNode=void 0));var i={x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:e.button,pageX:e.pageX,pageY:e.pageY};t.lastTranlated.x=i.x,t.lastTranlated.y=i.y,t.onmousedown(i)}},this.divLayer.canvas.onmousemove=function(e){t.onMouseMove({x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,buttons:e.buttons,pageX:e.pageX,pageY:e.pageY})},this.divLayer.canvas.onmouseup=function(e){var i={x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:e.button},n=t.hoverLayer.dragRect;if(t.onmouseup(i),!(!t.touchedNode||t.data.locked)){if(n)t.touchedNode=ee(ee({},t.touchedNode),{rect:n});else{var o=t.data,p=o.x,S=o.y;t.touchedNode.rect.x=e.pageX-window.scrollX-t.canvasPos.x-t.touchedNode.rect.width/2-p,t.touchedNode.rect.y=e.pageY-window.scrollY-t.canvasPos.y-t.touchedNode.rect.height/2-S}var U=new _t(t.touchedNode);t.addNode(U,!0),t.activeLayer.calcActiveRect(),t.touchedNode=void 0}}),this.divLayer.canvas.ondblclick=this.ondblclick,this.divLayer.canvas.tabIndex=0,this.divLayer.canvas.onblur=function(){t.mouseDown=void 0},this.divLayer.canvas.onwheel=function(e){if(t.options.scroll&&!e.ctrlKey&&t.scrollDom){t.scrollDom.wheel(e.deltaY<0);return}if(t.data.locked!==Kt.NoEvent){var i=new Date().getTime();if(i-t.touchStart<20){e.preventDefault(),e.stopPropagation();return}if(t.touchStart=new Date().getTime(),!t.options.disableScale){switch(t.options.scaleKey){case vt.Ctrl:if(!e.ctrlKey&&!e.metaKey)return;break;case vt.Shift:if(!e.shiftKey)return;break;case vt.Alt:if(!e.altKey)return;break}e.preventDefault(),e.stopPropagation();var n=new R(e.x-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.y-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.calibrateMouse(n);var o=t.data.scale;return e.deltaY<0?o+=.1:o-=.1,t.scaleTo(o,n),t.divLayer.canvas.focus(),!1}}},this.options.keydown){case wt.Document:document.addEventListener("keydown",this.onkeydown),document.addEventListener("keyup",function(){t.spaceDown=!1});break;case wt.Canvas:this.divLayer.canvas.addEventListener("keydown",this.onkeydown),this.divLayer.canvas.addEventListener("keyup",function(){t.spaceDown=!1});break}},r.prototype.ontouchend=function(t){var e=new R(t.changedTouches[0].pageX-window.scrollX-(this.canvasPos.left||this.canvasPos.x),t.changedTouches[0].pageY-window.scrollY-(this.canvasPos.top||this.canvasPos.y)),i=this.hoverLayer.dragRect;if(this.onmouseup({x:e.x,y:e.y,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,button:0}),!(!this.touchedNode||this.data.locked)){if(i)this.touchedNode=ee(ee({},this.touchedNode),{rect:i});else{var n=this.data,o=n.x,p=n.y;this.touchedNode.rect.x=t.changedTouches[0].pageX-window.scrollX-this.canvasPos.x-this.touchedNode.rect.width/2-o,this.touchedNode.rect.y=t.changedTouches[0].pageY-window.scrollY-this.canvasPos.y-this.touchedNode.rect.height/2-p}var S=new _t(this.touchedNode);this.addNode(S,!0),this.activeLayer.calcActiveRect(),this.touchedNode=void 0}},r.prototype.resize=function(t){this.canvas.resize(t),this.offscreen.resize(t),this.divLayer.resize(t),this.render(),this.dispatch("resize",t),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.init()},r.prototype.dropNodes=function(t,e,i){var n=this,o=0,p=0;if(t.length&&t[0].rect){var S=t[0].rect;o=S.x,p=S.y}var U;t.forEach(function(j){if(j.id=Ct(),j.name==="graffiti"){j.rect=new a(0,0,0,0),n.addNode(j);return}else if(j.name==="lines"){n.addLine(j),n.mouseDown={x:e,y:i},n.onmouseup(n.mouseDown);return}if(!U)j.rect.x=e-j.rect.width/2<<0,j.rect.y=i-j.rect.height/2<<0,U=j;else{var rt=j.rect,ht=rt.x-o,ct=rt.y-p;j.rect.x=U.rect.x+ht,j.rect.y=U.rect.y+ct}j.type===g.Line?n.addLine(Object.assign({name:"line",from:new R(j.rect.x,j.rect.y),fromArrow:n.data.fromArrow,to:new R(j.rect.x+j.rect.width,j.rect.y+j.rect.height),toArrow:n.data.toArrow,strokeStyle:n.options.color},j),!0):n.addNode(j,!0)}),this.divLayer.canvas.focus()},r.prototype.addNode=function(t,e){var i=this;return e===void 0&&(e=!1),Rt[t.name]?(t.TID=this.id,t.init||(t=new _t(t)),!t.strokeStyle&&this.options.color&&(t.strokeStyle=this.options.color),Tt.forEach(function(n){t[n]||(t[n]=i.options[n])}),this.data.scale!==1&&t.scale(this.data.scale),this.data.pens.push(t),e&&(t.name==="echarts"?setTimeout(function(){i.activeLayer.pens=[t],i.render()},50):this.activeLayer.pens=[t]),t.name!=="graffiti"||!t.doing?(this.render(),this.animate(!0),this.cache()):(this.moveIn.type=yt.Graffiti,this.moveIn.hoverNode=t),this.dispatch("addNode",t),t):null},r.prototype.addLine=function(t,e){return e===void 0&&(e=!1),t.type===g.Node&&(t.isNode=!0),t.TID=this.id,t.clone||(t=new Mt(t),t.calcControlPoints(!0)),this.data.scale!==1&&(t.name!=="lines"?t.scale(this.data.scale,t.getCenter()):t.fontSize*=this.data.scale),this.data.pens.push(t),t.name!=="lines"||!t.doing?e&&(this.activeLayer.setPens([t]),this.render(),this.animate(!0),this.cache(),this.dispatch("addLine",t)):(this.activeLayer.clear(),this.hoverLayer.line=void 0,this.moveIn.type=yt.Lines,this.moveIn.hoverLine=t),t},r.prototype.render=function(t){if(t&&(this.activeLayer.pens=[],this.hoverLayer.node=void 0,this.hoverLayer.line=void 0),this.rendering)return this;this.rendering=!0;var e=this.offscreen.canvas.getContext("2d");e.clearRect(0,0,this.offscreen.canvas.width,this.offscreen.canvas.height),e.save(),e.translate(this.data.x,this.data.y),this.offscreen.render(),e.restore(),this.canvas.render(),this.rendering=!1},r.prototype.open=function(t){typeof t!="string"&&t&&t.mqttOptions&&!t.mqttOptions.customClientId&&(t.mqttOptions.clientId=Ct()),this.canvas.clearBkImg(),this.data=te(t,this.id),this.subscribeSocket(),nt.Store.set(this.generateStoreKey("LT:scale"),this.data.scale),this.dispatch("scale",this.data.scale),nt.Store.set("LT:bkColor",this.data.bkColor),this.lock(this.data.locked),this.caches.list=[],Gr(),this.caches.dbIndex=-1,this.cache(),this.divLayer.clear(),this.animateLayer.stop(),this.render(!0),this.parentElem.scrollLeft=0,this.parentElem.scrollTop=0,this.animate(!0),this.openSocket(),this.openMqtt(),this.doInitJS(),this.dispatch("opened"),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.init()},r.prototype.doInitJS=function(){if(this.data.initJS&&this.data.initJS.trim()){var t=new Function(this.data.initJS);t()}},r.prototype.openSocket=function(t){var e=this;this.closeSocket(),(t||this.data.websocket)&&(this.socket=new ui(t||this.data.websocket,function(i){e.data.socketEvent!==1&&e.doSocket(i.data),e.data.socketEvent&&e.dispatch("websocket",i.data)}))},r.prototype.closeSocket=function(){this.socket&&this.socket.close()},r.prototype.openMqtt=function(t,e){var i=this;this.closeMqtt(),(t||this.data.mqttUrl)&&(this.mqtt=new di(t||this.data.mqttUrl,e||this.data.mqttOptions,this.data.mqttTopics,function(n,o){i.data.socketEvent!==1&&i.doSocket(o.toString(),u.Mqtt),i.data.socketEvent&&i.dispatch("mqtt",{topic:n,message:o})}))},r.prototype.closeMqtt=function(){this.mqtt&&this.mqtt.close()},r.prototype.doSocket=function(t,e){var i=this;e===void 0&&(e=u.WebSocket);try{t=JSON.parse(t),Array.isArray(t)||(t=[t]),t.forEach(function(n){var o=[];n.actions&&(o=n.actions,delete n.actions);var p=x(n.id||n.tag,i.data.pens);p.forEach(function(S){(S.id===n.id||S.tags&&S.tags.indexOf(n.tag)>-1)&&(S.fromData(S,n),S.doWheres(),S.events&&S.events.forEach(function(U){U.type===e&&(U.params=n,o.push(U))}),o&&o.forEach(function(U){S.doAction(U)}))}),i.willRender()})}catch(n){console.warn(n)}},r.prototype.overflow=function(t){t===void 0&&(t=50);var e=this.getRect(),i=e.width,n=e.height;i<e.ex&&(i=e.ex+t),i<this.canvas.width&&(i=this.canvas.width),n<e.ey&&(n=e.ey+t),n<this.canvas.height&&(n=this.canvas.height);var o={width:i,height:n};return this.resize(o),o},r.prototype.setNodeText=function(){this.inputObj.text=this.input.value,this.inputObj.name==="image"&&this.inputObj.init(),this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.cache(),this.offscreen.render(),this.dispatch("setText",this.inputObj),this.inputObj=void 0},r.prototype.getMoveIn=function(t){if(!(this.moveIn.type>=yt.Graffiti)){if(this.lastHoverNode=this.moveIn.hoverNode,this.lastHoverLine=this.moveIn.hoverLine,this.moveIn.type=yt.None,this.moveIn.hoverNode=void 0,this.moveIn.lineControlPoint=void 0,this.moveIn.hoverLine=void 0,this.hoverLayer.hoverAnchorIndex=-1,!this.data.locked&&!(this.activeLayer.pens.length===1&&this.activeLayer.pens[0].type)&&!this.activeLayer.locked()&&this.activeLayer.rotateCPs[0]&&this.activeLayer.rotateCPs[0].hit(t,15)){this.moveIn.type=yt.Rotate;var e=this.options.rotateCursor;this.divLayer.canvas.style.cursor=e.includes("/")?'url("'+e+'"), auto':e;return}if(this.activeLayer.pens.length>1&&c(t,this.activeLayer.sizeCPs)&&(this.moveIn.type=yt.Nodes),!this.data.locked&&!this.activeLayer.locked()&&!this.options.hideSizeCP&&(this.activeLayer.pens.length>1||!this.activeLayer.pens[0].type&&!this.activeLayer.pens[0].hideSizeCP)){for(var i=0;i<this.activeLayer.sizeCPs.length;++i)if(this.activeLayer.sizeCPs[i].hit(t,10)){this.moveIn.type=yt.ResizeCP,this.moveIn.activeAnchorIndex=i,this.divLayer.canvas.style.cursor=vi[i];return}}if(!this.data.locked)for(var n=0,o=this.activeLayer.pens;n<o.length;n++){var p=o[n];if(p instanceof Mt&&!p.locked){for(var i=0;i<p.controlPoints.length;++i)if(!p.locked&&p.controlPoints[i].hit(t,10)){p.controlPoints[i].id=i,this.moveIn.type=yt.LineControlPoint,this.moveIn.lineControlPoint=p.controlPoints[i],this.moveIn.hoverLine=p,this.divLayer.canvas.style.cursor="pointer";return}if(this.inLine(t,p))return}}this.divLayer.canvas.style.cursor="default";for(var S=this.data.pens.length,U,i=S-1;i>-1;--i)if(this.data.pens[i].type===g.Node&&this.inNode(t,this.data.pens[i])){U&&this.moveIn.type!==yt.HoverAnchors&&this.inLine(t,U);return}else this.data.pens[i].type===g.Line&&this.inLine(t,this.data.pens[i])&&(U=this.data.pens[i])}},r.prototype.inChildNode=function(t,e){if(!e)return null;for(var i=e.length,n=i-1;n>-1;--n){var o=e[n];if(!(!o.visible||o.locked===Kt.NoEvent)){if(o.type===g.Line){if(this.inLine(t,o))return o;continue}var p=this.inChildNode(t,o.children);if(p||(p=this.inNode(t,o,!0),p))return p}}return null},r.prototype.inNode=function(t,e,i){if(i===void 0&&(i=!1),this.data.locked===Kt.NoEvent||!e.visible||e.locked===Kt.NoEvent)return null;var n=this.inChildNode(t,e.children);if(n)return this.moveIn.type<yt.HoverAnchors&&(this.moveIn.type=yt.Nodes,n.stand?this.moveIn.activeNode=n:this.moveIn.activeNode=e),n;if(e.hitInSelf(t)){if(this.moveIn.hoverNode=e,this.moveIn.type=yt.Nodes,!this.data.locked&&!e.locked?this.divLayer.canvas.style.cursor="move":this.divLayer.canvas.style.cursor=this.options.hoverCursor,!this.data.locked&&!e.locked&&!(this.options.hideAnchor||e.hideAnchor||e.rect.width<20||e.rect.height<20)){for(var o=0;o<e.rotatedAnchors.length;++o)if(e.rotatedAnchors[o].hit(t,this.options.anchorSize)){if(!this.mouseDown&&e.rotatedAnchors[o].mode===$t.In)continue;this.moveIn.type=yt.HoverAnchors,this.moveIn.hoverAnchorIndex=o,this.hoverLayer.hoverAnchorIndex=o,this.divLayer.canvas.style.cursor="crosshair";break}this.options.autoAnchor&&e.rect.center.hit(t,this.options.anchorSize)&&(this.moveIn.hoverNode=e,this.moveIn.type=yt.AutoAnchor,this.divLayer.canvas.style.cursor="crosshair")}return i||(this.moveIn.activeNode=this.moveIn.hoverNode),e}if(this.options.hideAnchor||e.hideAnchor||this.data.locked||e.locked)return null;if(e.hitInSelf(t,this.options.anchorSize)){for(var o=0;o<e.rotatedAnchors.length;++o)if(e.rotatedAnchors[o].hit(t,this.options.anchorSize)){if(!this.mouseDown&&e.rotatedAnchors[o].mode===$t.In)continue;return this.moveIn.hoverNode=e,this.moveIn.type=yt.HoverAnchors,this.moveIn.hoverAnchorIndex=o,this.hoverLayer.hoverAnchorIndex=o,this.divLayer.canvas.style.cursor="crosshair",i||(this.moveIn.activeNode=e),e}}return null},r.prototype.inLine=function(t,e){if(this.data.locked===Kt.NoEvent||!e.visible||e.locked===Kt.NoEvent)return null;if(e.children)for(var i=0,n=e.children;i<n.length;i++){var o=n[i],p=this.inLine(t,o);if(p)return p}if(e.from){if(e.from.hit(t,this.options.anchorSize))return this.moveIn.type=yt.LineFrom,this.moveIn.hoverLine=e,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",e;if(e.to.hit(t,this.options.anchorSize))return this.moveIn.type=yt.LineTo,this.moveIn.hoverLine=e,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",e;if(e.pointIn(t))return this.moveIn.type=yt.Line,this.moveIn.hoverLine=e,this.divLayer.canvas.style.cursor=this.options.hoverCursor,e}return null},r.prototype.getLineDock=function(t,e){e===void 0&&(e=$t.Default),this.hoverLayer.dockAnchor=void 0;for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o instanceof _t){var p=o.hit(t,10);if(!p)continue;if(p.type===g.Line){if(p.from.hit(t,10)){t.x=p.from.x,t.y=p.from.y,this.hoverLayer.dockAnchor=p.from;break}if(p.to.hit(t,10)){t.x=p.to.x,t.y=p.to.y,this.hoverLayer.dockAnchor=p.to;break}break}this.hoverLayer.node=p,this.options.autoAnchor&&p.rect.center.hit(t,10)&&(t.id=p.id,t.autoAnchor=!0,t.x=p.rect.center.x,t.y=p.rect.center.y,this.hoverLayer.dockAnchor=p.rect.center);for(var S=0;S<p.rotatedAnchors.length;++S)if(!(p.rotatedAnchors[S].mode&&p.rotatedAnchors[S].mode!==e)&&p.rotatedAnchors[S].hit(t,10)){t.id=p.id,t.anchorIndex=S,t.autoAnchor=!1,t.direction=p.rotatedAnchors[S].direction,t.x=p.rotatedAnchors[S].x,t.y=p.rotatedAnchors[S].y,this.hoverLayer.dockAnchor=p.rotatedAnchors[S];break}if(this.hoverLayer.dockAnchor)break}else if(o instanceof Mt){if(o.id===this.hoverLayer.line.id)continue;if(o.children){for(var U=!1,j=0,rt=o.children;j<rt.length;j++){var ht=rt[j];if(ht.from.hit(t,10)){t.x=ht.from.x,t.y=ht.from.y,this.hoverLayer.dockAnchor=ht.from,U=!0;break}if(ht.to.hit(t,10)){t.x=ht.to.x,t.y=ht.to.y,this.hoverLayer.dockAnchor=ht.to,U=!0;break}if(ht.controlPoints)for(var ct=0,xt=ht.controlPoints;ct<xt.length;ct++){var kt=xt[ct];if(kt.hit(t,10)){t.x=kt.x,t.y=kt.y,this.hoverLayer.dockAnchor=kt,U=!0;break}}}if(U)continue}else{if(o.from.hit(t,10)){t.x=o.from.x,t.y=o.from.y,this.hoverLayer.dockAnchor=o.from;continue}if(o.to.hit(t,10)){t.x=o.to.x,t.y=o.to.y,this.hoverLayer.dockAnchor=o.to;continue}if(o.controlPoints)for(var It=0,Bt=o.controlPoints;It<Bt.length;It++){var kt=Bt[It];if(kt.hit(t,10)){t.x=kt.x,t.y=kt.y,this.hoverLayer.dockAnchor=kt;break}}}}}return t},r.prototype.getPensInRect=function(t){var e=this;t.width<0&&(t.width=-t.width,t.x=t.ex,t.ex=t.x+t.width),t.height<0&&(t.height=-t.height,t.y=t.ey,t.ey=t.y+t.height),this.activeLayer.pens=[];for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];o.locked!==Kt.NoEvent&&(o instanceof _t&&t.hitByRect(o.rect)&&this.activeLayer.add(o),o instanceof Mt&&(o.children?o.children.forEach(function(p){t.hit(p.from)&&t.hit(p.to)&&e.activeLayer.add(p)}):t.hit(o.from)&&t.hit(o.to)&&this.activeLayer.add(o)))}},r.prototype.getAngle=function(t){if(t.x===this.activeLayer.rect.center.x)return t.y<=this.activeLayer.rect.center.y?0:180;if(t.y===this.activeLayer.rect.center.y)return t.x<this.activeLayer.rect.center.x?270:90;var e=t.x-this.activeLayer.rect.center.x,i=t.y-this.activeLayer.rect.center.y,n=Math.atan(Math.abs(e/i))/(2*Math.PI)*360;return e>0&&i>0?n=180-n:e<0&&i>0?n+=180:e<0&&i<0&&(n=360-n),this.activeLayer.pens.length===1?n-this.activeLayer.pens[0].rotate:n},r.prototype.showInput=function(t){this.inputObj=t;var e=t.getTextRect();!e||(this.input.value=t.text||"",this.input.style.left=e.x+this.data.x+"px",this.input.style.top=e.y+this.data.y+"px",this.input.style.width=e.width+"px",this.input.style.height=e.height+"px",this.input.style.zIndex="1000",t.rotate/360?this.input.style.transform="rotate("+t.rotate+"deg)":this.input.style.transform=void 0,this.input.classList.add("set-text-input"),this.input.focus())},r.prototype.getRect=function(t){t||(t=this.data.pens);var e=Jt(t);return new a(e.x+this.data.x,e.y+this.data.y,e.width,e.height)},r.prototype.getDockPos=function(t,e,i){this.hoverLayer.dockLineX=0,this.hoverLayer.dockLineY=0;var n={x:0,y:0};if(i||this.options.disableDockLine)return n;for(var o=0,p=0,S=Me,U=Me,j=0,rt=this.activeLayer.dockWatchers;j<rt.length;j++)for(var ht=rt[j],ct=0,xt=this.data.pens;ct<xt.length;ct++){var kt=xt[ct];if(!(!(kt instanceof _t)||this.activeLayer.has(kt)||kt.name==="text"))for(var It=0,Bt=kt.dockWatchers;It<Bt.length;It++){var ft=Bt[It];o=Math.abs(ft.x-ht.x-t),o<S&&(S=-99999,n.x=ft.x-ht.x,this.hoverLayer.dockLineX=ft.x|0),p=Math.abs(ft.y-ht.y-e),p<U&&(U=-99999,n.y=ft.y-ht.y,this.hoverLayer.dockLineY=ft.y|0)}}return n},r.prototype.cache=function(){if(!(this.options.cacheLen==0||this.data.locked)){this.caches.index<this.caches.list.length-1&&(this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1),Ae(this.caches.dbIndex+1));var t=this.pureData();this.caches.list.push(t),Jr(t,this.caches.dbIndex+1,this.options.cacheLen),this.caches.list.length>this.ramCaches&&this.caches.list.shift(),this.caches.index=this.caches.list.length-1,this.caches.dbIndex++}},r.prototype.cacheReplace=function(t){if(this.options.cacheLen!=0&&t&&t.length){for(var e={},i=0,n=t.length;i<n;i++){var o=t[i],p=o.id;o instanceof _t?e[p]=new _t(o):o instanceof Mt&&(e[p]=new Mt(o))}var S=this.caches.list[0];if(!S)return;for(var i=0,n=S.pens.length;i<n;i++){var p=S.pens[i].id;e[p]&&(S.pens[i]=e[p])}}},r.prototype.undo=function(t,e){var i=this;if(t===void 0&&(t=!1),this.options.cacheLen!=0&&!(!e&&this.data.locked||this.caches.index<1)){if(this.divLayer.clear(!0),this.animateLayer.stop(),this.caches.dbIndex--,this.data=te(this.caches.list[--this.caches.index],this.id),this.render(!0),this.divLayer.render(),t&&(this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1),Ae(this.caches.dbIndex)),this.caches.index<=this.caches.list.length/2-1){var n=this.caches.index-0+1;_e(this.caches.dbIndex-n).then(function(o){o&&(i.caches.list.pop(),i.caches.list.unshift(o),i.caches.index++)})}this.dispatch("undo",this.data)}},r.prototype.redo=function(t){var e=this;if(this.options.cacheLen!=0&&!(!t&&this.data.locked||this.caches.index>this.caches.list.length-2)){if(this.divLayer.clear(!0),this.caches.dbIndex++,this.data=te(this.caches.list[++this.caches.index],this.id),this.render(!0),this.divLayer.render(),this.caches.index>=this.caches.list.length/2){var i=this.caches.list.length-this.caches.index;_e(this.caches.dbIndex+i).then(function(n){n&&(e.caches.list.shift(),e.caches.list.push(n),e.caches.index--)})}this.dispatch("redo",this.data)}},r.prototype.toImage=function(t,e){t===void 0&&(t=0),e===void 0&&(e=void 0);var i;this.data.bkImageRect&&(i=new a(this.data.bkImageRect.x-this.data.x,this.data.bkImageRect.y-this.data.y,this.data.bkImageRect.width,this.data.bkImageRect.height));var n=Xr(Jt(this.data.pens),i),o=ve(t||0);n.x-=o[3],n.y-=o[0],n.width+=o[3]+o[1],n.height+=o[0]+o[2],n.init();var p=this.offscreen.getDpiRatio();n.scale(p),i&&i.scale(p,n.center);var S=document.createElement("canvas");S.width=n.width,S.height=n.height;var U=S.getContext("2d");(this.data.bkColor||this.options.bkColor)&&(U.fillStyle=this.data.bkColor||this.options.bkColor,U.fillRect(0,0,S.width,S.height)),this.data.bkImage&&i&&U.drawImage(this.canvas.bkImg,i.x-n.x,i.y-n.y,i.width,i.height);for(var j=0,rt=this.data.pens;j<rt.length;j++){var ht=rt[j],ct=void 0;ht.type?ct=new Mt(ht):(ct=new _t(ht,!0),ct.animateFrames=[],ct.img=ht.img,ct.elementId="",ct.elementLoaded=!0,ct.elementRendered=!0),ct.scale(p,n.center),ct.translate(-n.x,-n.y,!0),ct.render(U)}return U.scale(1/p,1/p),e&&S.toBlob(e),S.toDataURL("image/png",1)},r.prototype.saveAsImage=function(t,e){e===void 0&&(e=0);var i=document.createElement("a");i.setAttribute("download",t||"le5le.topology.png"),i.setAttribute("href",this.toImage(e));var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),i.dispatchEvent(n)},r.prototype.delete=function(t,e){if(!(this.data.locked&&!e)){var i=[];if(typeof t=="string")i=w(t,this.data.pens);else for(var n=t||this.activeLayer.pens,o=0;o<n.length;o++){var p=n[o];if(p.type===g.Line&&p.parentId){var S=x(p.parentId,this.data.pens)[0];S&&S.name==="lines"&&(p=S)}w(p.id,this.data.pens).length&&(i.push(p),--o,p.type===g.Node&&this.divLayer.removeDiv(p),this.options.disableEmptyLine&&this.delEmptyLines(p.id),this.animateLayer.pens.delete(p.id))}i.length&&(this.render(!0),this.cache(),this.dispatch("delete",i))}},r.prototype.deleteAnchors=function(t,e){if(!(this.data.locked&&!e)){var i=t||this.activeLayer.pens;i.forEach(function(n){n.type===g.Node&&(n.manualAnchors=void 0,n.calcAnchors())})}},r.prototype.delEmptyLines=function(t){for(var e=0;e<this.data.pens.length;e++)if(this.data.pens[e].type===g.Line){var i=this.data.pens[e];(!i.from.id||!i.to.id||i.from.id===t||i.to.id===t)&&(this.data.pens.splice(e,1),this.animateLayer.pens.delete(i.id),--e)}},r.prototype.cut=function(){if(!this.data.locked){this.clipboard=te({pens:[]});for(var t=0;t<this.activeLayer.pens.length;t++){var e=this.activeLayer.pens[t];this.clipboard.pens.push(e.clone());var i=this.findIndex(e);i>-1&&(e.type===g.Node&&this.divLayer.removeDiv(this.data.pens[i]),this.data.pens.splice(i,1))}this.cache(),this.activeLayer.clear(),this.hoverLayer.node=void 0,this.moveIn.hoverLine=void 0,this.moveIn.hoverNode=void 0,this.render(),this.dispatch("delete",this.clipboard.pens)}},r.prototype.copy=function(){this.clipboard=te({pens:[]});for(var t=0,e=this.activeLayer.pens;t<e.length;t++){var i=e[t];this.clipboard.pens.push(i.clone()),i.parentId=null}this.dispatch("copy",this.clipboard)},r.prototype.paste=function(){if(!(!this.clipboard||this.data.locked)){this.hoverLayer.node=void 0,this.hoverLayer.line=void 0,this.activeLayer.pens=[];for(var t={},e=0,i=this.clipboard.pens;e<i.length;e++){var n=i[e];n.type||(this.pastePen(n,t,20),this.data.pens.push(n),this.activeLayer.add(n))}for(var o=0,p=this.clipboard.pens;o<p.length;o++){var n=p[o];n.type&&(this.pastePen(n,t,20),this.data.pens.push(n),this.activeLayer.add(n))}this.render(),this.animate(!0),this.cache(),this.copy(),this.dispatch("paste",this.clipboard.pens)}},r.prototype.pastePen=function(t,e,i,n){if(e===void 0&&(e={}),i===void 0&&(i=0),t.type){if(t instanceof Mt){t.id=Ct(),n&&(t.parentId=n),t.from=new R(t.from.x+i,t.from.y+i,t.from.direction,t.from.anchorIndex,e[t.from.id]),t.to=new R(t.to.x+i,t.to.y+i,t.to.direction,t.to.anchorIndex,e[t.to.id]);for(var p=[],S=0,U=t.controlPoints;S<U.length;S++){var j=U[S];p.push(new R(j.x+i,j.y+i))}t.controlPoints=p}}else{var o=t.id;t.id=Ct(),e[o]=t.id,n&&(t.parentId=n),t.rect.x+=i,t.rect.ex+=i,t.rect.y+=i,t.rect.ey+=i,t.manualAnchors&&t.manualAnchors.forEach(function(xt){xt.x+=i,xt.y+=i}),t.points&&t.points.forEach(function(xt){xt.x+=i,xt.y+=i}),t.init()}if(t.children)for(var rt=0,ht=t.children;rt<ht.length;rt++){var ct=ht[rt];this.pastePen(ct,e,i,t.id)}},r.prototype.animate=function(t){t===void 0&&(t=!1),this.animateLayer.readyPlay(void 0,t),this.animateLayer.animate()},r.prototype.updateProps=function(t,e){t===void 0&&(t=!0),e||(e=this.activeLayer.pens);for(var i=0,n=e;i<n.length;i++){var o=n[i];if(o instanceof _t){if(o.autoRect){var p=this.canvas.canvas.getContext("2d"),S=q(p,o);o.rect.width=S.width+o.lineWidth*2,o.rect.height=S.height}o.init(),o.initRect()}}this.activeLayer.updateLines(e),this.activeLayer.calcControlPoints(),this.activeLayer.saveNodeRects(),this.render(),t&&this.cache()},r.prototype.lock=function(t){this.data.locked=t;for(var e=0,i=this.data.pens;e<i.length;e++){var n=i[e];n.addToDiv&&n.addToDiv()}this.dispatch("locked",this.data.locked)},r.prototype.lockPens=function(t,e){for(var i=0,n=this.data.pens;i<n.length;i++)for(var o=n[i],p=0,S=t;p<S.length;p++){var U=S[p];if(o.id===U.id){o.locked=e,o.addToDiv&&o.addToDiv();break}}this.dispatch("lockPens",{pens:t,lock:e})},r.prototype.up=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1&&i!==e.length-1)e.splice(i+2,0,e[i]),e.splice(i,1);else{var n=C(e,t);if(!n)return;this.up(t,n.children)}},r.prototype.top=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1)e.push(e[i]),e.splice(i,1);else{var n=C(e,t);if(!n)return;this.top(t,n.children)}},r.prototype.down=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1&&i!==0)e.splice(i-1,0,e[i]),e.splice(i+1,1);else{var n=C(e,t);if(!n)return;this.down(t,n.children)}},r.prototype.bottom=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1)e.unshift(e[i]),e.splice(i+1,1);else{var n=C(e,t);if(!n)return;this.bottom(t,n.children)}},r.prototype.getParent=function(t){return C(this.data.pens,t)},r.prototype.combine=function(t,e){e===void 0&&(e=!1),t||(t=this.activeLayer.pens);for(var i=Jt(t),n=0,o=t;n<o.length;n++){var p=o[n],S=this.findIndex(p);S>-1&&this.data.pens.splice(S,1)}for(var U=new _t({name:"combine",rect:new a(i.x,i.y,i.width,i.height),text:"",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,strokeStyle:"transparent",children:[]}),S=0;S<t.length;++S)if(t[S].type===g.Node&&i.width===t[S].rect.width&&i.height===t[S].rect.height){U=t[S],U.children||(U.children=[]),t.splice(S,1);break}for(var j=0,rt=t;j<rt.length;j++){var p=rt[j];p.stand=e,p.parentId=U.id,p.calcRectInParent(U),U.children.push(p)}this.data.pens.push(U),this.activeLayer.setPens([U]),this.dispatch("combine",U),this.cache()},r.prototype.uncombine=function(t){if(t||(t=this.activeLayer.pens[0]),t instanceof _t){for(var e=0,i=t.children;e<i.length;e++){var n=i[e];n.parentId=void 0,n.rectInParent=void 0,n.locked=Kt.None,this.data.pens.push(n)}var o=this.findIndex(t);o>-1&&t.name==="combine"?this.data.pens.splice(o,1):t.children=void 0,this.cache(),this.activeLayer.clear(),this.hoverLayer.clear(),this.dispatch("uncombine",t)}},r.prototype.find=function(t,e,i){var n;Array.isArray(e)?n=e:(n=this.data.pens,i=e);var o=x(t,n);return i?o:o.length===0?null:o.length===1?o[0]:o},r.prototype.findIndex=function(t,e){return e||(e=this.data.pens),e.findIndex(function(i){return i.id===t.id})},r.prototype.play=function(t,e){this.divLayer.play(t,e)},r.prototype.translate=function(t,e,i,n){var o=this;i||(this.lastTranlated.x=0,this.lastTranlated.y=0);var p=t-this.lastTranlated.x,S=e-this.lastTranlated.y;this.data.x+=p,this.data.y+=S,this.data.bkImageRect&&!this.data.bkImageStatic&&this.data.bkImageRect.translate(p,S),nt.Store.set(this.generateStoreKey("LT:updateLines"),this.data.pens),this.lastTranlated.x=t,this.lastTranlated.y=e,this.render(),this.divLayer.render(),this.animateLayer.stop(),this.cacheTimer&&clearTimeout(this.cacheTimer),this.cacheTimer=setTimeout(function(){var U;o.animateLayer.readyPlay(void 0,!0),o.animateLayer.animate(),(U=o.cache)===null||U===void 0||U.call(o)},300),n||this.dispatch("translate",{x:t,y:e}),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.translate(t,e)},r.prototype.scale=function(t,e){this.data.scale*t<this.options.minScale?(t=this.options.minScale/this.data.scale,this.data.scale=this.options.minScale):this.data.scale*t>this.options.maxScale?(t=this.options.maxScale/this.data.scale,this.data.scale=this.options.maxScale):this.data.scale=Math.round(this.data.scale*t*100)/100,!e&&(e=Jt(this.data.pens).center);for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];o.scale(t,e)}if(this.data.bkImageRect&&!this.data.bkImageStatic){var p=new R(e.x+this.data.x,e.y+this.data.y);this.data.bkImageRect.scale(t,p)}nt.Store.set(this.generateStoreKey("LT:updateLines"),this.data.pens),nt.Store.set(this.generateStoreKey("LT:scale"),this.data.scale),this.render(),this.cache(),this.dispatch("scale",this.data.scale)},r.prototype.scaleTo=function(t,e){this.scale(t/this.data.scale,e)},r.prototype.round=function(){for(var t=0,e=this.data.pens;t<e.length;t++){var i=e[t];i instanceof _t&&i.round()}},r.prototype.centerView=function(t){if(!!this.hasView()){var e=this.getRect(),i=this.getViewCenter(t),n=e.center;this.translate(i.x-n.x,i.y-n.y);var o=this.canvas.parentElem,p=(o.scrollWidth-o.offsetWidth)/2,S=(o.scrollHeight-o.offsetHeight)/2;return o.scrollTo(p,S),!0}},r.prototype.fitView=function(t){if(!!this.hasView()){var e=this.canvas.parentElem,i=e.offsetWidth,n=e.offsetHeight;this.resize({width:i,height:n});var o=ve(t||this.options.viewPadding),p=this.getRect(),S=(i-o[1]-o[3])/p.width,U=(n-o[0]-o[2])/p.height,j=S;S>U&&(j=U),this.scale(j),this.centerView(t)}},r.prototype.hasView=function(){return!!this.data.pens.length},r.prototype.getViewCenter=function(t){var e=ve(t||this.options.viewPadding),i=this.canvas,n=i.width,o=i.height;return{x:(n-e[1]-e[3])/2+e[3],y:(o-e[0]-e[2])/2+e[0]}},r.prototype.generateStoreKey=function(t){return this.id+"-"+t},r.prototype.createMarkdownTip=function(){this.tipMarkdown=document.createElement("div"),this.tipMarkdown.className="topology-markdown",this.tipMarkdown.style.position="fixed",this.tipMarkdown.style.zIndex="-1",this.tipMarkdown.style.left="-9999px",this.tipMarkdown.style.padding="8px 0",this.tipMarkdownContent=document.createElement("div"),this.tipMarkdownContent.style.maxWidth="320px",this.tipMarkdownContent.style.outline="none",this.tipMarkdownContent.style.borderRadius="4px",this.tipMarkdownContent.style.backgroundColor="rgba(0,0,0,.6)",this.tipMarkdownContent.style.color="#fff",this.tipMarkdownContent.style.padding="8px 16px",this.tipMarkdownContent.style.lineHeight="1.8",this.tipMarkdownContent.style.overflowY="auto",this.tipMarkdownContent.style.minHeight="30px",this.tipMarkdownContent.style.maxHeight="400px",this.tipMarkdown.appendChild(this.tipMarkdownContent),this.tipMarkdownArrowUp=document.createElement("div"),this.tipMarkdownArrowUp.className="arrow",this.tipMarkdownArrowUp.style.position="absolute",this.tipMarkdownArrowUp.style.border="6px solid transparent",this.tipMarkdownArrowUp.style.backgroundColor="transparent",this.tipMarkdownArrowUp.style.left="50%",this.tipMarkdownArrowUp.style.transform="translateX(-50%)",this.tipMarkdownArrowUp.style.top="-4px",this.tipMarkdown.appendChild(this.tipMarkdownArrowUp),this.tipMarkdownArrowDown=document.createElement("div"),this.tipMarkdownArrowDown.className="arrow",this.tipMarkdownArrowDown.style.position="absolute",this.tipMarkdownArrowDown.style.border="6px solid transparent",this.tipMarkdownArrowDown.style.left="50%",this.tipMarkdownArrowDown.style.transform="translateX(-50%)",this.tipMarkdownArrowDown.style.backgroundColor="transparent",this.tipMarkdownArrowDown.style.bottom="-4px",this.tipMarkdown.appendChild(this.tipMarkdownArrowDown),document.body.appendChild(this.tipMarkdown)},r.prototype.showTip=function(t,e){if(!(!t||t.id===this.tip||this.data.tooltip===!1||this.data.tooltip===0)){if(t.title){this.divLayer.canvas.title=t.title,this.tip=t.id;return}t.tipId&&(this.tipElem=document.getElementById(t.tipId));var i=this.tipElem;if(t.markdown){i=this.tipMarkdown;var n=window.marked;n?this.tipMarkdownContent.innerHTML=n(t.markdown):this.tipMarkdownContent.innerHTML=t.markdown;for(var o=this.tipMarkdownContent.getElementsByTagName("A"),p=0;p<o.length;++p)o[p].setAttribute("target","_blank")}if(!!i){var S=this.parentElem.getBoundingClientRect(),U=i.getBoundingClientRect(),j=(S.left||S.x)-(U.width-t.rect.width)/2+this.data.x,rt=(S.top||S.y)-U.height-t.rect.height+this.data.y;j+=t.type?e.x:t.rect.x,rt+=t.type?e.y:t.rect.ey,rt>0?(this.tipMarkdownArrowUp.style.borderBottomColor="transparent",this.tipMarkdownArrowDown.style.borderTopColor="rgba(0,0,0,.6)"):(rt+=U.height+t.rect.height,this.tipMarkdownArrowUp.style.borderBottomColor="rgba(0,0,0,.6)",this.tipMarkdownArrowDown.style.borderTopColor="transparent"),i.style.display="block",i.style.position="fixed",i.style.left=j+"px",i.style.top=rt+"px",i.style.zIndex="100",this.tip=t.id,this.dispatch("tip",i)}}},r.prototype.hideTip=function(){!this.tip||(this.tipMarkdown.style.left="-9999px",this.tipMarkdown.style.zIndex="-1",this.tipElem&&(this.tipElem.style.left="-9999px",this.tipElem.style.zIndex="-1",this.tipElem=void 0),this.divLayer.canvas.title="",this.tip="")},r.prototype.scroll=function(t,e){var i=this;this.scrolling||(this.scrolling=!0,this.parentElem.scrollLeft+=t,this.parentElem.scrollTop+=e,setTimeout(function(){i.scrolling=!1},700))},r.prototype.toComponent=function(t){t||(t=this.data.pens);for(var e=Jt(t),i=new _t({name:"combine",rect:new a(e.x,e.y,e.width,e.height),text:"",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,strokeStyle:"transparent",children:[]}),n=0,o=t;n<o.length;n++){var p=o[n];if(p.type===g.Node&&e.width===p.rect.width&&e.height===p.rect.height){i=p,i.children||(i.children=[]);break}}for(var S=0,U=t;S<U.length;S++){var p=U[S];p!==i&&(p.parentId=i.id,p.calcRectInParent(i),i.children.push(p))}return i},r.prototype.clearBkImg=function(){this.canvas.clearBkImg()},r.prototype.dispatch=function(t,e){return this.options.on&&this.options.on(t,e),this.emit(t,e),this},r.prototype.on=function(t,e){return this._emitter.on(t,e),this},r.prototype.off=function(t,e){return this._emitter.off(t,e),this},r.prototype.emit=function(t,e){return this._emitter.emit(t,e),this},r.prototype.getValue=function(t,e){e===void 0&&(e="text");var i=this.find(t);if(!!i&&(Array.isArray(i)&&(i=i[0]),!!i))return i[e]},r.prototype.setValue=function(t,e,i){i===void 0&&(i="text"),typeof t=="object"&&(e=t,t=t.id||t.tag);var n=x(t,this.data.pens);n.forEach(function(o){(o.id===t||o.tags&&o.tags.indexOf(t)>-1)&&(typeof e=="object"?o.fromData(o,e):o[i]=e,o.doWheres(),o.type===g.Node&&(o.animateReady=_t.cloneState(o)))}),this.willRender()},r.prototype.willRender=function(){var t=this;this.actionTimer||(this.actionTimer=setTimeout(function(){t.render(),t.actionTimer=void 0},100))},r.prototype.setLineName=function(t,e){e===void 0&&(e=!0),this.data.pens.forEach(function(i){i.type&&(i.name=t,i.calcControlPoints())}),e&&this.render()},r.prototype.setColor=function(t){this.options.color=t,nt.Store.set(this.generateStoreKey("LT:color"),t),this.options.fontColor=t,nt.Store.set(this.generateStoreKey("LT:fontColor"),t)},r.prototype.setFontColor=function(t){this.options.fontColor=t,nt.Store.set(this.generateStoreKey("LT:fontColor"),t)},r.prototype.setIconColor=function(t){nt.Store.set(this.generateStoreKey("LT:iconColor"),t)},r.prototype.setBkColor=function(t){this.data.bkColor=t,nt.Store.set("LT:bkColor",t)},r.prototype.pureData=function(){var t=this,e=JSON.parse(JSON.stringify(this.data));return e.pens.forEach(function(i){for(var n in i)(i[n]===void 0||i[n]===void 0)&&delete i[n];if(delete i.TID,delete i.animateCycleIndex,delete i.img,delete i.lastImage,delete i.fillImg,delete i.strokeImg,delete i.lastFillImage,delete i.lastStrokeImage,delete i.imgNaturalWidth,delete i.imgNaturalHeight,delete i.anchors,delete i.rotatedAnchors,delete i.dockWatchers,delete i.elementLoaded,delete i.elementRendered,delete i.animateReady,i.animateFrames&&i.animateFrames.length)for(var o=0,p=i.animateFrames;o<p.length;o++){var S=p[o];S.initState&&(delete S.initState.TID,delete S.initState.animateCycleIndex,delete S.initState.img,delete S.initState.lastImage,delete S.initState.imgNaturalWidth,delete S.initState.imgNaturalHeight,delete S.initState.anchors,delete S.initState.rotatedAnchors,delete S.initState.dockWatchers,delete S.initState.elementLoaded,delete S.initState.elementRendered,delete S.initState.fillImg,delete S.initState.strokeImg,delete S.initState.lastFillImage,delete S.initState.lastStrokeImage),S.state&&(delete S.state.TID,delete S.state.animateCycleIndex,delete S.state.img,delete S.state.lastImage,delete S.state.imgNaturalWidth,delete S.state.imgNaturalHeight,delete S.state.anchors,delete S.state.rotatedAnchors,delete S.state.dockWatchers,delete S.state.elementLoaded,delete S.state.elementRendered,delete S.state.fillImg,delete S.state.strokeImg,delete S.state.lastFillImage,delete S.state.lastStrokeImage)}t.pureDataChildren(i)}),e},r.prototype.pureDataChildren=function(t){var e=this;!t.children||t.children.forEach(function(i){for(var n in i)(i[n]===void 0||i[n]===void 0||i[n]==="")&&delete i[n];delete i.TID,delete i.animateCycleIndex,delete i.img,delete i.lastImage,delete i.imgNaturalWidth,delete i.imgNaturalHeight,delete i.anchors,delete i.rotatedAnchors,delete i.dockWatchers,delete i.elementLoaded,delete i.elementRendered,delete i.animateReady,e.pureDataChildren(i)})},r.prototype.destroy=function(){switch(this.scrollDom&&this.scrollDom.destroy(),this.subcribe.unsubscribe(),this.subcribeRender.unsubscribe(),this.subcribeImage.unsubscribe(),this.subcribeAnimateEnd.unsubscribe(),this.subcribeAnimateMoved.unsubscribe(),this.subcribeMediaEnd.unsubscribe(),this.subcribeEmit.unsubscribe(),this.animateLayer.destroy(),this.divLayer.destroy(),this.canvas.destroy(),this.activeLayer.destroy(),this.hoverLayer.destroy(),this.offscreen.destroy(),document.body.removeChild(this.tipMarkdown),window.removeEventListener("resize",this.winResize),this.parentElem.removeEventListener("scroll",this.onScroll),window.removeEventListener("scroll",this.onScroll),document.removeEventListener("gesturestart",this.preventDefault),this.options.keydown){case wt.Document:document.removeEventListener("keydown",this.onkeydown);break;case wt.Canvas:this.divLayer.canvas.removeEventListener("keydown",this.onkeydown);break}this.closeSocket(),this.closeMqtt(),this.socketFn&&(this.off("websocket",this.socketFn),this.off("mqtt",this.socketFn)),this.cache=void 0,this.data=void 0,window.topology=void 0},r}()},19720:function(Lt,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var dt=function(){function nt(){}return nt.get=function(St){var vt,wt=new RegExp("(^| )"+St+"=([^;]*)(;|$)");return(vt=document.cookie.match(wt))?decodeURIComponent(vt[2]):""},nt.set=function(St,vt,wt){var Tt=window,Pt=Tt.escape(St)+"="+Tt.escape(vt)+";";if(wt||(wt={}),wt.expires){var Et=new Date(new Date().getTime()+wt.expires*1e3*60*60*24);Pt+="expires="+Et.toUTCString()+";"}wt.path&&(Pt+="path="+wt.path+";"),wt.domain&&(Pt+="domain="+wt.domain+";"),document.cookie=Pt},nt.delete=function(St,vt){nt.get(St)&&(vt||(vt={}),vt.expires=-1,nt.set(St,"",vt))},nt}();mt.Cookie=dt},32362:function(Lt,mt,dt){"use strict";function nt(St){for(var vt in St)mt.hasOwnProperty(vt)||(mt[vt]=St[vt])}Object.defineProperty(mt,"__esModule",{value:!0}),nt(dt(19720)),nt(dt(52960)),nt(dt(37763))},17346:function(Lt,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0}),mt.data={},mt.observers={}},37763:function(Lt,mt,dt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var nt=dt(17346),St=function(){function vt(wt,Tt,Pt){this.key="",this.id=wt,this.key=Tt,this.fn=Pt}return vt.prototype.unsubscribe=function(){delete nt.observers[this.id]},vt}();mt.Observer=St},52960:function(Lt,mt,dt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var nt=dt(17346),St=dt(37763),vt=dt(32904),wt=function(){function Tt(){this.data={},this.observers={}}return Tt.prototype.get=function(Pt){return Tt.get(Pt,this.data)},Tt.prototype.set=function(Pt,Et){Tt.set(Pt,Et,this.data,this.observers)},Tt.prototype.updated=function(Pt){Tt.updated(Pt,this.data,this.observers)},Tt.prototype.subscribe=function(Pt,Et){return Tt.subscribe(Pt,Et,this.data,this.observers)},Tt.get=function(Pt,Et){if(Et||(Et=nt.data),Pt===void 0)return Et;for(var Ct=Pt.split("."),F=0,$=Ct;F<$.length;F++){var R=$[F];if(Et=Et[R],Et===void 0)break}return Et},Tt.set=function(Pt,Et,Ct,F){Ct||(Ct=nt.data),F||(F=nt.observers);for(var $=Pt.split("."),R=Ct,P=0;P<$.length-1;++P)R[$[P]]||(R[$[P]]={}),R=R[$[P]];R[$[$.length-1]]=Et;for(var x in F)Pt.indexOf(F[x].key)===0&&F[x].fn(Tt.get(F[x].key,Ct))},Tt.updated=function(Pt,Et,Ct){Ct||(Ct=nt.observers);for(var F in Ct)Pt.indexOf(Ct[F].key)===0&&Ct[F].fn(Tt.get(Ct[F].key,Et))},Tt.subscribe=function(Pt,Et,Ct,F){F||(F=nt.observers);var $=vt.s8(),R=new St.Observer($,Pt,Et);F[$]=R;var P=Tt.get(Pt,Ct);return P!==void 0&&Et(P),R},Tt}();mt.Store=wt},32904:function(Lt,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});function dt(){return((1+Math.random())*65536|0).toString(16).substring(1)}mt.s4=dt;function nt(){return dt()+dt()}mt.s8=nt},99053:function(Lt,mt,dt){var nt=dt(94043),St=dt(79764),vt=dt(25102),wt=dt(21364),Tt=dt(46507),Pt=dt(30352),Et=dt(37306),Ct=dt(93450);(function(F){Lt.exports=F()})(function(){return function(){return function F($,R,P){function x(c,s){if(!R[c]){if(!$[c]){var l=void 0;if(!s&&l)return require(c,!0);if(w)return w(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var a=R[c]={exports:{}};$[c][0].call(a.exports,function(u){return x($[c][1][u]||u)},a,a.exports,F,$,R,P)}return R[c].exports}for(var w=void 0,C=0;C<P.length;C++)x(P[C]);return x}}()({1:[function(F,$,R){(function(P,x){(function(){"use strict";var w=F("events").EventEmitter,C=F("./store"),c=F("./topic-alias-recv"),s=F("./topic-alias-send"),l=F("mqtt-packet"),d=F("./default-message-id-provider"),a=F("readable-stream").Writable,u=F("inherits"),v=F("reinterval"),m=F("rfdc/default"),g=F("./validations"),b=F("xtend"),y=F("debug")("mqttjs:client"),T=P?P.nextTick:function(L){setTimeout(L,0)},O=x.setImmediate||function(L){T(L)},M={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},V=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],N={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function Q(L,E){var q;E.properties&&(q=E.properties.topicAlias);var J=E.topic.toString();if(J.length===0){if(q===void 0)return new Error("Unregistered Topic Alias");if((J=L.topicAliasSend.getTopicByAlias(q))===void 0)return new Error("Unregistered Topic Alias");E.topic=J}q&&delete E.properties.topicAlias}function tt(L,E,q){y("sendPacket :: packet: %O",E),y("sendPacket :: emitting `packetsend`"),L.emit("packetsend",E),y("sendPacket :: writing to stream");var J=l.writeToStream(E,L.stream,L.options);y("sendPacket :: writeToStream result %s",J),!J&&q&&q!==k?(y("sendPacket :: handle events on `drain` once through callback."),L.stream.once("drain",q)):q&&(y("sendPacket :: invoking cb"),q())}function D(L,E,q,J){y("storeAndSend :: store packet with cmd %s to outgoingStore",E.cmd);var W,z=E;if(z.cmd==="publish"&&(z=m(E),W=Q(L,z)))return q&&q(W);L.outgoingStore.put(z,function(K){if(K)return q&&q(K);J(),tt(L,E,q)})}function k(L){y("nop ::",L)}function A(L,E){var q,J=this;if(!(this instanceof A))return new A(L,E);for(q in this.options=E||{},M)this.options[q]===void 0?this.options[q]=M[q]:this.options[q]=E[q];y("MqttClient :: options.protocol",E.protocol),y("MqttClient :: options.protocolVersion",E.protocolVersion),y("MqttClient :: options.username",E.username),y("MqttClient :: options.keepalive",E.keepalive),y("MqttClient :: options.reconnectPeriod",E.reconnectPeriod),y("MqttClient :: options.rejectUnauthorized",E.rejectUnauthorized),y("MqttClient :: options.topicAliasMaximum",E.topicAliasMaximum),this.options.clientId=typeof E.clientId=="string"?E.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),y("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=E.protocolVersion===5&&E.customHandleAcks?E.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=L,this.messageIdProvider=this.options.messageIdProvider===void 0?new d:this.options.messageIdProvider,this.outgoingStore=E.outgoingStore||new C,this.incomingStore=E.incomingStore||new C,this.queueQoSZero=E.queueQoSZero===void 0||E.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,E.topicAliasMaximum>0&&(E.topicAliasMaximum>65535?y("MqttClient :: options.topicAliasMaximum is out of range"):this.topicAliasRecv=new c(E.topicAliasMaximum)),this.on("connect",function(){var W=this.queue;y("connect :: sending queued packets"),function z(){var K=W.shift();y("deliver :: entry %o",K);var H=null;if(!K)return void J._resubscribe();H=K.packet,y("deliver :: call _sendPacket for %o",H);var _=!0;H.messageId&&H.messageId!==0&&(J.messageIdProvider.register(H.messageId)||(_=!1)),_?J._sendPacket(H,function(G){K.cb&&K.cb(G),z()}):(y("messageId: %d has already used. The message is skipped and removed.",H.messageId),z())}()}),this.on("close",function(){y("close :: connected set to `false`"),this.connected=!1,y("close :: clearing connackTimer"),clearTimeout(this.connackTimer),y("close :: clearing ping timer"),J.pingTimer!==null&&(J.pingTimer.clear(),J.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),y("close :: calling _setupReconnect"),this._setupReconnect()}),w.call(this),y("MqttClient :: setting up stream"),this._setupStream()}u(A,w),A.prototype._setupStream=function(){var L=this,E=this,q=new a,J=l.parser(this.options),W=null,z=[];function K(){if(z.length)T(H);else{var G=W;W=null,G()}}function H(){y("work :: getting next packet in queue");var G=z.shift();if(G)y("work :: packet pulled from queue"),E._handlePacket(G,K);else{y("work :: no packets in queue");var et=W;W=null,y("work :: done flag is %s",!!et),et&&et()}}y("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),y("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),J.on("packet",function(G){y("parser :: on packet push to packets array."),z.push(G)}),q._write=function(G,et,Z){W=Z,y("writable stream :: parsing buffer"),J.parse(G),H()},y("_setupStream :: pipe stream to writable stream"),this.stream.pipe(q),this.stream.on("error",function(G){y("streamErrorHandler :: error",G.message),V.includes(G.code)?(y("streamErrorHandler :: emitting error"),E.emit("error",G)):k(G)}),this.stream.on("close",function(){var G;y("(%s)stream :: on close",E.options.clientId),(G=E.outgoing)&&(y("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(G).forEach(function(et){G[et].volatile&&typeof G[et].cb=="function"&&(G[et].cb(new Error("Connection closed")),delete G[et])})),y("stream: emit close to MqttClient"),E.emit("close")}),y("_setupStream: sending packet `connect`");var _=Object.create(this.options);if(_.cmd="connect",this.topicAliasRecv&&(_.properties||(_.properties={}),this.topicAliasRecv&&(_.properties.topicAliasMaximum=this.topicAliasRecv.max)),tt(this,_),J.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return E.end(function(){return L.emit("error",new Error("Packet has no Authentication Method"))}),this;this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"&&tt(this,b({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){y("!!connectTimeout hit!! Calling _cleanUp with force `true`"),E._cleanUp(!0)},this.options.connectTimeout)},A.prototype._handlePacket=function(L,E){var q=this.options;if(q.protocolVersion===5&&q.properties&&q.properties.maximumPacketSize&&q.properties.maximumPacketSize<L.length)return this.emit("error",new Error("exceeding packets size "+L.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(y("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",L),L.cmd){case"publish":this._handlePublish(L,E);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(L),E();break;case"pubrel":this._handlePubrel(L,E);break;case"connack":this._handleConnack(L),E();break;case"auth":this._handleAuth(L),E();break;case"pingresp":this._handlePingresp(L),E();break;case"disconnect":this._handleDisconnect(L),E()}},A.prototype._checkDisconnecting=function(L){return this.disconnecting&&(L&&L!==k?L(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},A.prototype.publish=function(L,E,q,J){y("publish :: message `%s` to topic `%s`",E,L);var W=this.options;if(typeof q=="function"&&(J=q,q=null),q=b({qos:0,retain:!1,dup:!1},q),this._checkDisconnecting(J))return this;var z=this,K=function(){var _=0;if((q.qos===1||q.qos===2)&&(_=z._nextId())===null)return y("No messageId left"),!1;var G={cmd:"publish",topic:L,payload:E,qos:q.qos,retain:q.retain,messageId:_,dup:q.dup};switch(W.protocolVersion===5&&(G.properties=q.properties),y("publish :: qos",q.qos),q.qos){case 1:case 2:z.outgoing[G.messageId]={volatile:!1,cb:J||k},y("MqttClient:publish: packet cmd: %s",G.cmd),z._sendPacket(G,void 0,q.cbStorePut);break;default:y("MqttClient:publish: packet cmd: %s",G.cmd),z._sendPacket(G,J,q.cbStorePut)}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!K())&&this._storeProcessingQueue.push({invoke:K,cbStorePut:q.cbStorePut,callback:J}),this},A.prototype.subscribe=function(){for(var L=this,E=new Array(arguments.length),q=0;q<arguments.length;q++)E[q]=arguments[q];var J=[],W=E.shift(),z=W.resubscribe,K=E.pop()||k,H=E.pop(),_=this.options.protocolVersion;delete W.resubscribe,typeof W=="string"&&(W=[W]),typeof K!="function"&&(H=K,K=k);var G=g.validateTopics(W);if(G!==null)return O(K,new Error("Invalid topic "+G)),this;if(this._checkDisconnecting(K))return y("subscribe: discconecting true"),this;var et={qos:0};if(_===5&&(et.nl=!1,et.rap=!1,et.rh=0),H=b(et,H),Array.isArray(W)?W.forEach(function(at){if(y("subscribe: array topic %s",at),!Object.prototype.hasOwnProperty.call(L._resubscribeTopics,at)||L._resubscribeTopics[at].qos<H.qos||z){var it={topic:at,qos:H.qos};_===5&&(it.nl=H.nl,it.rap=H.rap,it.rh=H.rh,it.properties=H.properties),y("subscribe: pushing topic `%s` and qos `%s` to subs list",it.topic,it.qos),J.push(it)}}):Object.keys(W).forEach(function(at){if(y("subscribe: object topic %s",at),!Object.prototype.hasOwnProperty.call(L._resubscribeTopics,at)||L._resubscribeTopics[at].qos<W[at].qos||z){var it={topic:at,qos:W[at].qos};_===5&&(it.nl=W[at].nl,it.rap=W[at].rap,it.rh=W[at].rh,it.properties=H.properties),y("subscribe: pushing `%s` to subs list",it),J.push(it)}}),!J.length)return K(null,[]),this;var Z=function(){var it=L._nextId();if(it===null)return y("No messageId left"),!1;var st={cmd:"subscribe",subscriptions:J,qos:1,retain:!1,dup:!1,messageId:it};if(H.properties&&(st.properties=H.properties),L.options.resubscribe){y("subscribe :: resubscribe true");var h=[];J.forEach(function(f){if(L.options.reconnectPeriod>0){var I={qos:f.qos};_===5&&(I.nl=f.nl||!1,I.rap=f.rap||!1,I.rh=f.rh||0,I.properties=f.properties),L._resubscribeTopics[f.topic]=I,h.push(f.topic)}}),L.messageIdToTopic[st.messageId]=h}return L.outgoing[st.messageId]={volatile:!0,cb:function(I,B){if(!I)for(var Y=B.granted,X=0;X<Y.length;X+=1)J[X].qos=Y[X];K(I,J)}},y("subscribe :: call _sendPacket"),L._sendPacket(st),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!Z())&&this._storeProcessingQueue.push({invoke:Z,callback:K}),this},A.prototype.unsubscribe=function(){for(var L=this,E=new Array(arguments.length),q=0;q<arguments.length;q++)E[q]=arguments[q];var J=E.shift(),W=E.pop()||k,z=E.pop();typeof J=="string"&&(J=[J]),typeof W!="function"&&(z=W,W=k);var K=g.validateTopics(J);if(K!==null)return O(W,new Error("Invalid topic "+K)),this;if(L._checkDisconnecting(W))return this;var H=function(){var G=L._nextId();if(G===null)return y("No messageId left"),!1;var et={cmd:"unsubscribe",qos:1,messageId:G};return typeof J=="string"?et.unsubscriptions=[J]:Array.isArray(J)&&(et.unsubscriptions=J),L.options.resubscribe&&et.unsubscriptions.forEach(function(Z){delete L._resubscribeTopics[Z]}),typeof z=="object"&&z.properties&&(et.properties=z.properties),L.outgoing[et.messageId]={volatile:!0,cb:W},y("unsubscribe: call _sendPacket"),L._sendPacket(et),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!H())&&this._storeProcessingQueue.push({invoke:H,callback:W}),this},A.prototype.end=function(L,E,q){var J=this;function W(){y("end :: (%s) :: finish :: calling _cleanUp with force %s",J.options.clientId,L),J._cleanUp(L,function(){y("end :: finish :: calling process.nextTick on closeStores"),T(function(){y("end :: closeStores: closing incoming and outgoing stores"),J.disconnected=!0,J.incomingStore.close(function(z){J.outgoingStore.close(function(K){if(y("end :: closeStores: emitting end"),J.emit("end"),q){var H=z||K;y("end :: closeStores: invoking callback with args"),q(H)}})}),J._deferredReconnect&&J._deferredReconnect()}.bind(J))},E)}return y("end :: (%s)",this.options.clientId),L!=null&&typeof L=="boolean"||(q=E||k,E=L,L=!1,typeof E!="object"&&(q=E,E=null,typeof q!="function"&&(q=k))),typeof E!="object"&&(q=E,E=null),y("end :: cb? %s",!!q),q=q||k,this.disconnecting?(q(),this):(this._clearReconnect(),this.disconnecting=!0,!L&&Object.keys(this.outgoing).length>0?(y("end :: (%s) :: calling finish in 10ms once outgoing is empty",J.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,W,10))):(y("end :: (%s) :: immediately calling finish",J.options.clientId),W()),this)},A.prototype.removeOutgoingMessage=function(L){var E=this.outgoing[L]?this.outgoing[L].cb:null;return delete this.outgoing[L],this.outgoingStore.del({messageId:L},function(){E(new Error("Message removed"))}),this},A.prototype.reconnect=function(L){y("client reconnect");var E=this,q=function(){L?(E.options.incomingStore=L.incomingStore,E.options.outgoingStore=L.outgoingStore):(E.options.incomingStore=null,E.options.outgoingStore=null),E.incomingStore=E.options.incomingStore||new C,E.outgoingStore=E.options.outgoingStore||new C,E.disconnecting=!1,E.disconnected=!1,E._deferredReconnect=null,E._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=q:q(),this},A.prototype._reconnect=function(){var L=this;y("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(function(){L._setupStream()}),y("client already connected. disconnecting first.")):(y("_reconnect: calling _setupStream"),this._setupStream())},A.prototype._setupReconnect=function(){var L=this;!L.disconnecting&&!L.reconnectTimer&&L.options.reconnectPeriod>0?(this.reconnecting||(y("_setupReconnect :: emit `offline` state"),this.emit("offline"),y("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),y("_setupReconnect :: setting reconnectTimer for %d ms",L.options.reconnectPeriod),L.reconnectTimer=setInterval(function(){y("reconnectTimer :: reconnect triggered!"),L._reconnect()},L.options.reconnectPeriod)):y("_setupReconnect :: doing nothing...")},A.prototype._clearReconnect=function(){y("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},A.prototype._cleanUp=function(L,E){var q=arguments[2];if(E&&(y("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",E)),y("_cleanUp :: forced? %s",L),L)this.options.reconnectPeriod===0&&this.options.clean&&(W=this.outgoing)&&(y("flush: queue exists? %b",!!W),Object.keys(W).forEach(function(z){typeof W[z].cb=="function"&&(W[z].cb(new Error("Connection closed")),delete W[z])})),y("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{var J=b({cmd:"disconnect"},q);y("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(J,O.bind(null,this.stream.end.bind(this.stream)))}var W;this.disconnecting||(y("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer!==null&&(y("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),E&&!this.connected&&(y("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",E),E())},A.prototype._sendPacket=function(L,E,q){y("_sendPacket :: (%s) ::  start",this.options.clientId),q=q||k,E=E||k;var J=function(W,z){if(W.options.protocolVersion===5&&z.cmd==="publish"){var K;z.properties&&(K=z.properties.topicAlias);var H=z.topic.toString();if(W.topicAliasSend)if(K){if(H.length!==0&&(y("applyTopicAlias :: register topic: %s - alias: %d",H,K),!W.topicAliasSend.put(H,K)))return y("applyTopicAlias :: error out of range. topic: %s - alias: %d",H,K),new Error("Sending Topic Alias out of range")}else H.length!==0&&(W.options.autoAssignTopicAlias?(K=W.topicAliasSend.getAliasByTopic(H))?(z.topic="",z.properties=Ct(Ct({},z.properties),{},{topicAlias:K}),y("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",H,K)):(K=W.topicAliasSend.getLruAlias(),W.topicAliasSend.put(H,K),z.properties=Ct(Ct({},z.properties),{},{topicAlias:K}),y("applyTopicAlias :: auto assign topic: %s - alias: %d",H,K)):W.options.autoUseTopicAlias&&(K=W.topicAliasSend.getAliasByTopic(H))&&(z.topic="",z.properties=Ct(Ct({},z.properties),{},{topicAlias:K}),y("applyTopicAlias :: auto use topic: %s - alias: %d",H,K)));else if(K)return y("applyTopicAlias :: error out of range. topic: %s - alias: %d",H,K),new Error("Sending Topic Alias out of range")}}(this,L);if(J)E(J);else{if(!this.connected)return L.cmd==="auth"?(this._shiftPingInterval(),void tt(this,L,E)):(y("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(L,E,q));switch(this._shiftPingInterval(),L.cmd){case"publish":break;case"pubrel":return void D(this,L,E,q);default:return void tt(this,L,E)}switch(L.qos){case 2:case 1:D(this,L,E,q);break;case 0:default:tt(this,L,E)}y("_sendPacket :: (%s) ::  end",this.options.clientId)}},A.prototype._storePacket=function(L,E,q){y("_storePacket :: packet: %o",L),y("_storePacket :: cb? %s",!!E),q=q||k;var J=L;if(J.cmd==="publish"){var W=Q(this,J=m(L));if(W)return E&&E(W)}(J.qos||0)===0&&this.queueQoSZero||J.cmd!=="publish"?this.queue.push({packet:J,cb:E}):J.qos>0?(E=this.outgoing[J.messageId]?this.outgoing[J.messageId].cb:null,this.outgoingStore.put(J,function(z){if(z)return E&&E(z);q()})):E&&E(new Error("No connection to broker"))},A.prototype._setupPingTimer=function(){y("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);var L=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=v(function(){L._checkPing()},1e3*this.options.keepalive))},A.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},A.prototype._checkPing=function(){y("_checkPing :: checking ping..."),this.pingResp?(y("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(y("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))},A.prototype._handlePingresp=function(){this.pingResp=!0},A.prototype._handleConnack=function(L){y("_handleConnack");var E=this.options,q=E.protocolVersion===5?L.reasonCode:L.returnCode;if(clearTimeout(this.connackTimer),delete this.topicAliasSend,L.properties){if(L.properties.topicAliasMaximum){if(L.properties.topicAliasMaximum>65535)return void this.emit("error",new Error("topicAliasMaximum from broker is out of range"));L.properties.topicAliasMaximum>0&&(this.topicAliasSend=new s(L.properties.topicAliasMaximum))}L.properties.serverKeepAlive&&E.keepalive&&(E.keepalive=L.properties.serverKeepAlive,this._shiftPingInterval()),L.properties.maximumPacketSize&&(E.properties||(E.properties={}),E.properties.maximumPacketSize=L.properties.maximumPacketSize)}if(q===0)this.reconnecting=!1,this._onConnect(L);else if(q>0){var J=new Error("Connection refused: "+N[q]);J.code=q,this.emit("error",J)}},A.prototype._handleAuth=function(L){var E=this.options.protocolVersion,q=E===5?L.reasonCode:L.returnCode;if(E!==5){var J=new Error("Protocol error: Auth packets are only supported in MQTT 5. Your version:"+E);return J.code=q,void this.emit("error",J)}var W=this;this.handleAuth(L,function(z,K){if(z)W.emit("error",z);else if(q===24)W.reconnecting=!1,W._sendPacket(K);else{var H=new Error("Connection refused: "+N[q]);z.code=q,W.emit("error",H)}})},A.prototype.handleAuth=function(L,E){E()},A.prototype._handlePublish=function(L,E){y("_handlePublish: packet %o",L),E=E!==void 0?E:k;var q=L.topic.toString(),J=L.payload,W=L.qos,z=L.messageId,K=this,H=this.options,_=[0,16,128,131,135,144,145,151,153];if(this.options.protocolVersion===5){var G;if(L.properties&&(G=L.properties.topicAlias),G!==void 0)if(q.length===0){if(!(G>0&&G<=65535))return y("_handlePublish :: topic alias out of range. alias: %d",G),void this.emit("error",new Error("Received Topic Alias is out of range"));{var et=this.topicAliasRecv.getTopicByAlias(G);if(!et)return y("_handlePublish :: unregistered topic alias. alias: %d",G),void this.emit("error",new Error("Received unregistered Topic Alias"));y("_handlePublish :: topic complemented by alias. topic: %s - alias: %d",q=et,G)}}else{if(!this.topicAliasRecv.put(q,G))return y("_handlePublish :: topic alias out of range. alias: %d",G),void this.emit("error",new Error("Received Topic Alias is out of range"));y("_handlePublish :: registered topic: %s - alias: %d",q,G)}}switch(y("_handlePublish: qos %d",W),W){case 2:H.customHandleAcks(q,J,L,function(Z,at){return Z instanceof Error||(at=Z,Z=null),Z?K.emit("error",Z):_.indexOf(at)===-1?K.emit("error",new Error("Wrong reason code for pubrec")):void(at?K._sendPacket({cmd:"pubrec",messageId:z,reasonCode:at},E):K.incomingStore.put(L,function(){K._sendPacket({cmd:"pubrec",messageId:z},E)}))});break;case 1:H.customHandleAcks(q,J,L,function(Z,at){return Z instanceof Error||(at=Z,Z=null),Z?K.emit("error",Z):_.indexOf(at)===-1?K.emit("error",new Error("Wrong reason code for puback")):(at||K.emit("message",q,J,L),void K.handleMessage(L,function(it){if(it)return E&&E(it);K._sendPacket({cmd:"puback",messageId:z,reasonCode:at},E)}))});break;case 0:this.emit("message",q,J,L),this.handleMessage(L,E);break;default:y("_handlePublish: unknown QoS. Doing nothing.")}},A.prototype.handleMessage=function(L,E){E()},A.prototype._handleAck=function(L){var E=L.messageId,q=L.cmd,J=null,W=this.outgoing[E]?this.outgoing[E].cb:null,z=this,K;if(W){switch(y("_handleAck :: packet type",q),q){case"pubcomp":case"puback":{var H=L.reasonCode;H&&H>0&&H!==16&&((K=new Error("Publish error: "+N[H])).code=H,W(K,L)),delete this.outgoing[E],this.outgoingStore.del(L,W),this.messageIdProvider.deallocate(E),this._invokeStoreProcessingQueue();break}case"pubrec":{J={cmd:"pubrel",qos:2,messageId:E};var _=L.reasonCode;_&&_>0&&_!==16?((K=new Error("Publish error: "+N[_])).code=_,W(K,L)):this._sendPacket(J);break}case"suback":delete this.outgoing[E],this.messageIdProvider.deallocate(E);for(var G=0;G<L.granted.length;G++)if((128&L.granted[G])!=0){var et=this.messageIdToTopic[E];et&&et.forEach(function(Z){delete z._resubscribeTopics[Z]})}this._invokeStoreProcessingQueue(),W(null,L);break;case"unsuback":delete this.outgoing[E],this.messageIdProvider.deallocate(E),this._invokeStoreProcessingQueue(),W(null);break;default:z.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&Object.keys(this.outgoing).length===0&&this.emit("outgoingEmpty")}else y("_handleAck :: Server sent an ack in error. Ignoring.")},A.prototype._handlePubrel=function(L,E){y("handling pubrel packet"),E=E!==void 0?E:k;var q=this,J={cmd:"pubcomp",messageId:L.messageId};q.incomingStore.get(L,function(W,z){W?q._sendPacket(J,E):(q.emit("message",z.topic,z.payload,z),q.handleMessage(z,function(K){if(K)return E(K);q.incomingStore.del(z,k),q._sendPacket(J,E)}))})},A.prototype._handleDisconnect=function(L){this.emit("disconnect",L)},A.prototype._nextId=function(){return this.messageIdProvider.allocate()},A.prototype.getLastMessageId=function(){return this.messageIdProvider.getLastAllocated()},A.prototype._resubscribe=function(){y("_resubscribe");var L=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion===5&&!this.connackPacket.sessionPresent)&&L.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){y("_resubscribe: protocolVersion 5");for(var E=0;E<L.length;E++){var q={};q[L[E]]=this._resubscribeTopics[L[E]],q.resubscribe=!0,this.subscribe(q,{properties:q[L[E]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},A.prototype._onConnect=function(L){if(this.disconnected)return void this.emit("connect",L);var E=this;this.connackPacket=L,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0,function q(){var J=E.outgoingStore.createStream();function W(){E._storeProcessing=!1,E._packetIdsDuringStoreProcessing={}}function z(){J.destroy(),J=null,E._flushStoreProcessingQueue(),W()}E.once("close",z),J.on("error",function(K){W(),E._flushStoreProcessingQueue(),E.removeListener("close",z),E.emit("error",K)}),J.on("end",function(){var K=!0;for(var H in E._packetIdsDuringStoreProcessing)if(!E._packetIdsDuringStoreProcessing[H]){K=!1;break}K?(W(),E.removeListener("close",z),E._invokeAllStoreProcessingQueue(),E.emit("connect",L)):q()}),function K(){if(!!J){E._storeProcessing=!0;var H=J.read(1),_;H?E._packetIdsDuringStoreProcessing[H.messageId]?K():E.disconnecting||E.reconnectTimer?J.destroy&&J.destroy():(_=E.outgoing[H.messageId]?E.outgoing[H.messageId].cb:null,E.outgoing[H.messageId]={volatile:!1,cb:function(et,Z){_&&_(et,Z),K()}},E._packetIdsDuringStoreProcessing[H.messageId]=!0,E.messageIdProvider.register(H.messageId)?E._sendPacket(H):y("messageId: %d has already used.",H.messageId)):J.once("readable",K)}}()}()},A.prototype._invokeStoreProcessingQueue=function(){if(this._storeProcessingQueue.length>0){var L=this._storeProcessingQueue[0];if(L&&L.invoke())return this._storeProcessingQueue.shift(),!0}return!1},A.prototype._invokeAllStoreProcessingQueue=function(){for(;this._invokeStoreProcessingQueue(););},A.prototype._flushStoreProcessingQueue=function(){var L=Et(this._storeProcessingQueue),E;try{for(L.s();!(E=L.n()).done;){var q=E.value;q.cbStorePut&&q.cbStorePut(new Error("Connection closed")),q.callback&&q.callback(new Error("Connection closed"))}}catch(J){L.e(J)}finally{L.f()}this._storeProcessingQueue.splice(0)},$.exports=A}).call(this)}).call(this,F("_process"),typeof dt.g!="undefined"?dt.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./default-message-id-provider":7,"./store":8,"./topic-alias-recv":9,"./topic-alias-send":10,"./validations":11,_process:50,debug:18,events:22,inherits:24,"mqtt-packet":40,"readable-stream":69,reinterval:70,"rfdc/default":71,xtend:81}],2:[function(F,$,R){"use strict";var P=F("buffer"),x=P.Buffer,w=F("readable-stream").Transform,C=F("duplexify"),c,s,l,d=!1;$.exports=function(a,u){if(u.hostname=u.hostname||u.host,!u.hostname)throw new Error("Could not determine host. Specify host manually.");var v=u.protocolId==="MQIsdp"&&u.protocolVersion===3?"mqttv3.1":"mqtt";(function(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})})(u);var m=function(g,b){var y=g.protocol==="alis"?"wss":"ws",T=y+"://"+g.hostname+g.path;return g.port&&g.port!==80&&g.port!==443&&(T=y+"://"+g.hostname+":"+g.port+g.path),typeof g.transformWsUrl=="function"&&(T=g.transformWsUrl(T,g,b)),T}(u,a);return(c=u.my).connectSocket({url:m,protocols:v}),s=function(){var g=new w;return g._write=function(b,y,T){c.sendSocketMessage({data:b.buffer,success:function(){T()},fail:function(){T(new Error)}})},g._flush=function(b){c.closeSocket({success:function(){b()}})},g}(),l=C.obj(),d||(d=!0,c.onSocketOpen(function(){l.setReadable(s),l.setWritable(s),l.emit("connect")}),c.onSocketMessage(function(g){if(typeof g.data=="string"){var b=x.from(g.data,"base64");s.push(b)}else{var y=new FileReader;y.addEventListener("load",function(){var T=y.result;T=T instanceof ArrayBuffer?x.from(T):x.from(T,"utf8"),s.push(T)}),y.readAsArrayBuffer(g.data)}}),c.onSocketClose(function(){l.end(),l.destroy()}),c.onSocketError(function(g){l.destroy(g)})),l}},{buffer:17,duplexify:20,"readable-stream":69}],3:[function(F,$,R){"use strict";var P=F("net"),x=F("debug")("mqttjs:tcp");$.exports=function(w,C){C.port=C.port||1883,C.hostname=C.hostname||C.host||"localhost";var c=C.port,s=C.hostname;return x("port %d and host %s",c,s),P.createConnection(c,s)}},{debug:18,net:16}],4:[function(F,$,R){"use strict";var P=F("tls"),x=F("net"),w=F("debug")("mqttjs:tls");$.exports=function(C,c){c.port=c.port||8883,c.host=c.hostname||c.host||"localhost",x.isIP(c.host)===0&&(c.servername=c.host),c.rejectUnauthorized=c.rejectUnauthorized!==!1,delete c.path,w("port %d host %s rejectUnauthorized %b",c.port,c.host,c.rejectUnauthorized);var s=P.connect(c);function l(d){c.rejectUnauthorized&&C.emit("error",d),s.end()}return s.on("secureConnect",function(){c.rejectUnauthorized&&!s.authorized?s.emit("error",new Error("TLS not authorized")):s.removeListener("error",l)}),s.on("error",l),s}},{debug:18,net:16,tls:16}],5:[function(F,$,R){(function(P){(function(){"use strict";var x=F("buffer"),w=x.Buffer,C=F("ws"),c=F("debug")("mqttjs:ws"),s=F("duplexify"),l=F("readable-stream").Transform,d=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],a=P!==void 0&&P.title==="browser"||typeof dt=="function";function u(m,g){var b=m.protocol+"://"+m.hostname+":"+m.port+m.path;return typeof m.transformWsUrl=="function"&&(b=m.transformWsUrl(b,m,g)),b}function v(m){var g=m;return m.hostname||(g.hostname="localhost"),m.port||(m.protocol==="wss"?g.port=443:g.port=80),m.path||(g.path="/"),m.wsOptions||(g.wsOptions={}),a||m.protocol!=="wss"||d.forEach(function(b){Object.prototype.hasOwnProperty.call(m,b)&&!Object.prototype.hasOwnProperty.call(m.wsOptions,b)&&(g.wsOptions[b]=m[b])}),g}$.exports=a?function(m,g){var b;c("browserStreamBuilder");var y=function(L){var E=v(L);if(E.hostname||(E.hostname=E.host),!E.hostname){if(typeof document=="undefined")throw new Error("Could not determine host. Specify host manually.");var q=new URL(document.URL);E.hostname=q.hostname,E.port||(E.port=q.port)}return E.objectMode===void 0&&(E.objectMode=!(E.binary===!0||E.binary===void 0)),E}(g).browserBufferSize||524288,T=g.browserBufferTimeout||1e3,O=!g.objectMode,M=function(L,E){var q=E.protocolId==="MQIsdp"&&E.protocolVersion===3?"mqttv3.1":"mqtt",J=u(E,L),W=new WebSocket(J,[q]);return W.binaryType="arraybuffer",W}(m,g),V=function(L,E,q){var J=new l({objectModeMode:L.objectMode});return J._write=E,J._flush=q,J}(g,function L(E,q,J){M.bufferedAmount>y&&setTimeout(L,T,E,q,J),O&&typeof E=="string"&&(E=w.from(E,"utf8"));try{M.send(E)}catch(W){return J(W)}J()},function(L){M.close(),L()});g.objectMode||(V._writev=A),V.on("close",function(){M.close()});var N=M.addEventListener!==void 0;function Q(){b.setReadable(V),b.setWritable(V),b.emit("connect")}function tt(){b.end(),b.destroy()}function D(L){b.destroy(L)}function k(L){var E=L.data;E=E instanceof ArrayBuffer?w.from(E):w.from(E,"utf8"),V.push(E)}function A(L,E){for(var q=new Array(L.length),J=0;J<L.length;J++)typeof L[J].chunk=="string"?q[J]=w.from(L[J],"utf8"):q[J]=L[J].chunk;this._write(w.concat(q),"binary",E)}return M.readyState===M.OPEN?b=V:(b=b=s(void 0,void 0,g),g.objectMode||(b._writev=A),N?M.addEventListener("open",Q):M.onopen=Q),b.socket=M,N?(M.addEventListener("close",tt),M.addEventListener("error",D),M.addEventListener("message",k)):(M.onclose=tt,M.onerror=D,M.onmessage=k),b}:function(m,g){c("streamBuilder");var b=v(g),y=u(b,m),T=function(M,V,N){c("createWebSocket"),c("protocol: "+N.protocolId+" "+N.protocolVersion);var Q=N.protocolId==="MQIsdp"&&N.protocolVersion===3?"mqttv3.1":"mqtt";return c("creating new Websocket for url: "+V+" and protocol: "+Q),new C(V,[Q],N.wsOptions)}(0,y,b),O=C.createWebSocketStream(T,b.wsOptions);return O.url=y,T.on("close",function(){O.destroy()}),O}}).call(this)}).call(this,F("_process"))},{_process:50,buffer:17,debug:18,duplexify:20,"readable-stream":69,ws:80}],6:[function(F,$,R){"use strict";var P=F("buffer"),x=P.Buffer,w=F("readable-stream").Transform,C=F("duplexify"),c,s,l;$.exports=function(d,a){if(a.hostname=a.hostname||a.host,!a.hostname)throw new Error("Could not determine host. Specify host manually.");var u=a.protocolId==="MQIsdp"&&a.protocolVersion===3?"mqttv3.1":"mqtt";(function(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})})(a);var v=function(g,b){var y=g.protocol==="wxs"?"wss":"ws",T=y+"://"+g.hostname+g.path;return g.port&&g.port!==80&&g.port!==443&&(T=y+"://"+g.hostname+":"+g.port+g.path),typeof g.transformWsUrl=="function"&&(T=g.transformWsUrl(T,g,b)),T}(a,d);c=wx.connectSocket({url:v,protocols:[u]}),s=function(){var g=new w;return g._write=function(b,y,T){c.send({data:b.buffer,success:function(){T()},fail:function(M){T(new Error(M))}})},g._flush=function(b){c.close({success:function(){b()}})},g}(),(l=C.obj())._destroy=function(g,b){c.close({success:function(){b&&b(g)}})};var m=l.destroy;return l.destroy=function(){l.destroy=m;var g=this;setTimeout(function(){c.close({fail:function(){g._destroy(new Error)}})},0)}.bind(l),c.onOpen(function(){l.setReadable(s),l.setWritable(s),l.emit("connect")}),c.onMessage(function(g){var b=g.data;b=b instanceof ArrayBuffer?x.from(b):x.from(b,"utf8"),s.push(b)}),c.onClose(function(){l.end(),l.destroy()}),c.onError(function(g){l.destroy(new Error(g.errMsg))}),l}},{buffer:17,duplexify:20,"readable-stream":69}],7:[function(F,$,R){"use strict";function P(){if(!(this instanceof P))return new P;this.nextId=Math.max(1,Math.floor(65535*Math.random()))}P.prototype.allocate=function(){var x=this.nextId++;return this.nextId===65536&&(this.nextId=1),x},P.prototype.getLastAllocated=function(){return this.nextId===1?65535:this.nextId-1},P.prototype.register=function(x){return!0},P.prototype.deallocate=function(x){},P.prototype.clear=function(){},$.exports=P},{}],8:[function(F,$,R){"use strict";var P=F("xtend"),x=F("readable-stream").Readable,w={objectMode:!0},C={clean:!0};function c(s){if(!(this instanceof c))return new c(s);this.options=s||{},this.options=P(C,s),this._inflights=new Map}c.prototype.put=function(s,l){return this._inflights.set(s.messageId,s),l&&l(),this},c.prototype.createStream=function(){var s=new x(w),l=[],d=!1,a=0;return this._inflights.forEach(function(u,v){l.push(u)}),s._read=function(){!d&&a<l.length?this.push(l[a++]):this.push(null)},s.destroy=function(){if(!d){var u=this;d=!0,setTimeout(function(){u.emit("close")},0)}},s},c.prototype.del=function(s,l){return(s=this._inflights.get(s.messageId))?(this._inflights.delete(s.messageId),l(null,s)):l&&l(new Error("missing packet")),this},c.prototype.get=function(s,l){return(s=this._inflights.get(s.messageId))?l(null,s):l&&l(new Error("missing packet")),this},c.prototype.close=function(s){this.options.clean&&(this._inflights=null),s&&s()},$.exports=c},{"readable-stream":69,xtend:81}],9:[function(F,$,R){"use strict";function P(x){if(!(this instanceof P))return new P(x);this.aliasToTopic={},this.max=x}P.prototype.put=function(x,w){return!(w===0||w>this.max)&&(this.aliasToTopic[w]=x,this.length=Object.keys(this.aliasToTopic).length,!0)},P.prototype.getTopicByAlias=function(x){return this.aliasToTopic[x]},P.prototype.clear=function(){this.aliasToTopic={}},$.exports=P},{}],10:[function(F,$,R){"use strict";var P=F("lru-cache"),x=F("number-allocator").NumberAllocator;function w(C){if(!(this instanceof w))return new w(C);C>0&&(this.aliasToTopic=new P({max:C}),this.topicToAlias={},this.numberAllocator=new x(1,C),this.max=C,this.length=0)}w.prototype.put=function(C,c){if(c===0||c>this.max)return!1;var s=this.aliasToTopic.get(c);return s&&delete this.topicToAlias[s],this.aliasToTopic.set(c,C),this.topicToAlias[C]=c,this.numberAllocator.use(c),this.length=this.aliasToTopic.length,!0},w.prototype.getTopicByAlias=function(C){return this.aliasToTopic.get(C)},w.prototype.getAliasByTopic=function(C){var c=this.topicToAlias[C];return c!==void 0&&this.aliasToTopic.get(c),c},w.prototype.clear=function(){this.aliasToTopic.reset(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0},w.prototype.getLruAlias=function(){var C=this.numberAllocator.firstVacant();return C||this.aliasToTopic.keys()[this.aliasToTopic.length-1]},$.exports=w},{"lru-cache":37,"number-allocator":46}],11:[function(F,$,R){"use strict";function P(x){for(var w=x.split("/"),C=0;C<w.length;C++)if(w[C]!=="+"){if(w[C]==="#")return C===w.length-1;if(w[C].indexOf("+")!==-1||w[C].indexOf("#")!==-1)return!1}return!0}$.exports={validateTopics:function(w){if(w.length===0)return"empty_topic_list";for(var C=0;C<w.length;C++)if(!P(w[C]))return w[C];return null}}},{}],12:[function(F,$,R){(function(P){(function(){"use strict";var x=F("../client"),w=F("../store"),C=F("url"),c=F("xtend"),s=F("debug")("mqttjs"),l={};function d(a,u){if(s("connecting to an MQTT broker..."),typeof a!="object"||u||(u=a,a=null),u=u||{},a){var v=C.parse(a,!0);if(v.port!=null&&(v.port=Number(v.port)),(u=c(v,u)).protocol===null)throw new Error("Missing protocol");u.protocol=u.protocol.replace(/:$/,"")}if(function(b){var y;b.auth&&((y=b.auth.match(/^(.+):(.+)$/))?(b.username=y[1],b.password=y[2]):b.username=b.auth)}(u),u.query&&typeof u.query.clientId=="string"&&(u.clientId=u.query.clientId),u.cert&&u.key){if(!u.protocol)throw new Error("Missing secure protocol key");if(["mqtts","wss","wxs","alis"].indexOf(u.protocol)===-1)switch(u.protocol){case"mqtt":u.protocol="mqtts";break;case"ws":u.protocol="wss";break;case"wx":u.protocol="wxs";break;case"ali":u.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+u.protocol+'"!')}}if(!l[u.protocol]){var m=["mqtts","wss"].indexOf(u.protocol)!==-1;u.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(b,y){return(!m||y%2!=0)&&typeof l[b]=="function"})[0]}if(u.clean===!1&&!u.clientId)throw new Error("Missing clientId for unclean clients");u.protocol&&(u.defaultProtocol=u.protocol);var g=new x(function(b){return u.servers&&(b._reconnectCount&&b._reconnectCount!==u.servers.length||(b._reconnectCount=0),u.host=u.servers[b._reconnectCount].host,u.port=u.servers[b._reconnectCount].port,u.protocol=u.servers[b._reconnectCount].protocol?u.servers[b._reconnectCount].protocol:u.defaultProtocol,u.hostname=u.host,b._reconnectCount++),s("calling streambuilder for",u.protocol),l[u.protocol](b,u)},u);return g.on("error",function(){}),g}P!==void 0&&P.title!=="browser"||typeof dt!="function"?(l.mqtt=F("./tcp"),l.tcp=F("./tcp"),l.ssl=F("./tls"),l.tls=F("./tls"),l.mqtts=F("./tls")):(l.wx=F("./wx"),l.wxs=F("./wx"),l.ali=F("./ali"),l.alis=F("./ali")),l.ws=F("./ws"),l.wss=F("./ws"),$.exports=d,$.exports.connect=d,$.exports.MqttClient=x,$.exports.Store=w}).call(this)}).call(this,F("_process"))},{"../client":1,"../store":8,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:50,debug:18,url:76,xtend:81}],13:[function(F,$,R){"use strict";R.byteLength=function(a){var u=l(a),v=u[0],m=u[1];return 3*(v+m)/4-m},R.toByteArray=function(a){var u,v,m=l(a),g=m[0],b=m[1],y=new w(function(M,V,N){return 3*(V+N)/4-N}(0,g,b)),T=0,O=b>0?g-4:g;for(v=0;v<O;v+=4)u=x[a.charCodeAt(v)]<<18|x[a.charCodeAt(v+1)]<<12|x[a.charCodeAt(v+2)]<<6|x[a.charCodeAt(v+3)],y[T++]=u>>16&255,y[T++]=u>>8&255,y[T++]=255&u;return b===2&&(u=x[a.charCodeAt(v)]<<2|x[a.charCodeAt(v+1)]>>4,y[T++]=255&u),b===1&&(u=x[a.charCodeAt(v)]<<10|x[a.charCodeAt(v+1)]<<4|x[a.charCodeAt(v+2)]>>2,y[T++]=u>>8&255,y[T++]=255&u),y},R.fromByteArray=function(a){for(var u,v=a.length,m=v%3,g=[],b=0,y=v-m;b<y;b+=16383)g.push(d(a,b,b+16383>y?y:b+16383));return m===1?(u=a[v-1],g.push(P[u>>2]+P[u<<4&63]+"==")):m===2&&(u=(a[v-2]<<8)+a[v-1],g.push(P[u>>10]+P[u>>4&63]+P[u<<2&63]+"=")),g.join("")};for(var P=[],x=[],w=typeof Uint8Array!="undefined"?Uint8Array:Array,C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,s=C.length;c<s;++c)P[c]=C[c],x[C.charCodeAt(c)]=c;function l(a){var u=a.length;if(u%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var v=a.indexOf("=");return v===-1&&(v=u),[v,v===u?0:4-v%4]}function d(a,u,v){for(var m,g,b=[],y=u;y<v;y+=3)m=(a[y]<<16&16711680)+(a[y+1]<<8&65280)+(255&a[y+2]),b.push(P[(g=m)>>18&63]+P[g>>12&63]+P[g>>6&63]+P[63&g]);return b.join("")}x["-".charCodeAt(0)]=62,x["_".charCodeAt(0)]=63},{}],14:[function(F,$,R){"use strict";var P=F("buffer"),x=P.Buffer,w=Symbol.for("BufferList");function C(c){if(!(this instanceof C))return new C(c);C._init.call(this,c)}C._init=function(c){Object.defineProperty(this,w,{value:!0}),this._bufs=[],this.length=0,c&&this.append(c)},C.prototype._new=function(c){return new C(c)},C.prototype._offset=function(c){if(c===0)return[0,0];for(var s=0,l=0;l<this._bufs.length;l++){var d=s+this._bufs[l].length;if(c<d||l===this._bufs.length-1)return[l,c-s];s=d}},C.prototype._reverseOffset=function(c){for(var s=c[0],l=c[1],d=0;d<s;d++)l+=this._bufs[d].length;return l},C.prototype.get=function(c){if(!(c>this.length||c<0)){var s=this._offset(c);return this._bufs[s[0]][s[1]]}},C.prototype.slice=function(c,s){return typeof c=="number"&&c<0&&(c+=this.length),typeof s=="number"&&s<0&&(s+=this.length),this.copy(null,0,c,s)},C.prototype.copy=function(c,s,l,d){if((typeof l!="number"||l<0)&&(l=0),(typeof d!="number"||d>this.length)&&(d=this.length),l>=this.length||d<=0)return c||x.alloc(0);var a=!!c,u=this._offset(l),v=d-l,m=v,g=a&&s||0,b=u[1];if(l===0&&d===this.length){if(!a)return this._bufs.length===1?this._bufs[0]:x.concat(this._bufs,this.length);for(var y=0;y<this._bufs.length;y++)this._bufs[y].copy(c,g),g+=this._bufs[y].length;return c}if(m<=this._bufs[u[0]].length-b)return a?this._bufs[u[0]].copy(c,s,b,b+m):this._bufs[u[0]].slice(b,b+m);a||(c=x.allocUnsafe(v));for(var T=u[0];T<this._bufs.length;T++){var O=this._bufs[T].length-b;if(!(m>O)){this._bufs[T].copy(c,g,b,b+m),g+=O;break}this._bufs[T].copy(c,g,b),g+=O,m-=O,b&&(b=0)}return c.length>g?c.slice(0,g):c},C.prototype.shallowSlice=function(c,s){if(c=c||0,s=typeof s!="number"?this.length:s,c<0&&(c+=this.length),s<0&&(s+=this.length),c===s)return this._new();var l=this._offset(c),d=this._offset(s),a=this._bufs.slice(l[0],d[0]+1);return d[1]===0?a.pop():a[a.length-1]=a[a.length-1].slice(0,d[1]),l[1]!==0&&(a[0]=a[0].slice(l[1])),this._new(a)},C.prototype.toString=function(c,s,l){return this.slice(s,l).toString(c)},C.prototype.consume=function(c){if(c=Math.trunc(c),Number.isNaN(c)||c<=0)return this;for(;this._bufs.length;){if(!(c>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(c),this.length-=c;break}c-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},C.prototype.duplicate=function(){for(var c=this._new(),s=0;s<this._bufs.length;s++)c.append(this._bufs[s]);return c},C.prototype.append=function(c){if(c==null)return this;if(c.buffer)this._appendBuffer(x.from(c.buffer,c.byteOffset,c.byteLength));else if(Array.isArray(c))for(var s=0;s<c.length;s++)this.append(c[s]);else if(this._isBufferList(c))for(var l=0;l<c._bufs.length;l++)this.append(c._bufs[l]);else typeof c=="number"&&(c=c.toString()),this._appendBuffer(x.from(c));return this},C.prototype._appendBuffer=function(c){this._bufs.push(c),this.length+=c.length},C.prototype.indexOf=function(c,s,l){if(l===void 0&&typeof s=="string"&&(l=s,s=void 0),typeof c=="function"||Array.isArray(c))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof c=="number"?c=x.from([c]):typeof c=="string"?c=x.from(c,l):this._isBufferList(c)?c=c.slice():Array.isArray(c.buffer)?c=x.from(c.buffer,c.byteOffset,c.byteLength):x.isBuffer(c)||(c=x.from(c)),s=Number(s||0),isNaN(s)&&(s=0),s<0&&(s=this.length+s),s<0&&(s=0),c.length===0)return s>this.length?this.length:s;for(var d=this._offset(s),a=d[0],u=d[1];a<this._bufs.length;a++){for(var v=this._bufs[a];u<v.length;)if(v.length-u>=c.length){var m=v.indexOf(c,u);if(m!==-1)return this._reverseOffset([a,m]);u=v.length-c.length+1}else{var g=this._reverseOffset([a,u]);if(this._match(g,c))return g;u++}u=0}return-1},C.prototype._match=function(c,s){if(this.length-c<s.length)return!1;for(var l=0;l<s.length;l++)if(this.get(c+l)!==s[l])return!1;return!0},function(){var c={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(var s in c)(function(l){C.prototype[l]=c[l]===null?function(d,a){return this.slice(d,d+a)[l](0,a)}:function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.slice(d,d+c[l])[l](0)}})(s)}(),C.prototype._isBufferList=function(c){return c instanceof C||C.isBufferList(c)},C.isBufferList=function(c){return c!=null&&c[w]},$.exports=C},{buffer:17}],15:[function(F,$,R){"use strict";var P=F("readable-stream").Duplex,x=F("inherits"),w=F("./BufferList");function C(c){if(!(this instanceof C))return new C(c);if(typeof c=="function"){this._callback=c;var s=function(l){this._callback&&(this._callback(l),this._callback=null)}.bind(this);this.on("pipe",function(l){l.on("error",s)}),this.on("unpipe",function(l){l.removeListener("error",s)}),c=null}w._init.call(this,c),P.call(this)}x(C,P),Object.assign(C.prototype,w.prototype),C.prototype._new=function(c){return new C(c)},C.prototype._write=function(c,s,l){this._appendBuffer(c),typeof l=="function"&&l()},C.prototype._read=function(c){if(!this.length)return this.push(null);c=Math.min(c,this.length),this.push(this.slice(0,c)),this.consume(c)},C.prototype.end=function(c){P.prototype.end.call(this,c),this._callback&&(this._callback(null,this.slice()),this._callback=null)},C.prototype._destroy=function(c,s){this._bufs.length=0,this.length=0,s(c)},C.prototype._isBufferList=function(c){return c instanceof C||c instanceof w||C.isBufferList(c)},C.isBufferList=w.isBufferList,$.exports=C,$.exports.BufferListStream=C,$.exports.BufferList=w},{"./BufferList":14,inherits:24,"readable-stream":69}],16:[function(F,$,R){},{}],17:[function(F,$,R){(function(P){(function(){"use strict";var x=F("base64-js"),w=F("ieee754");R.Buffer=s,R.SlowBuffer=function(h){return+h!=h&&(h=0),s.alloc(+h)},R.INSPECT_MAX_BYTES=50;var C=2147483647;function c(h){if(h>C)throw new RangeError('The value "'+h+'" is invalid for option "size"');var f=new Uint8Array(h);return f.__proto__=s.prototype,f}function s(h,f,I){if(typeof h=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return a(h)}return l(h,f,I)}function l(h,f,I){if(typeof h=="string")return function(X,ot){if(typeof ot=="string"&&ot!==""||(ot="utf8"),!s.isEncoding(ot))throw new TypeError("Unknown encoding: "+ot);var ut=0|m(X,ot),lt=c(ut),gt=lt.write(X,ot);return gt!==ut&&(lt=lt.slice(0,gt)),lt}(h,f);if(ArrayBuffer.isView(h))return u(h);if(h==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);if(it(h,ArrayBuffer)||h&&it(h.buffer,ArrayBuffer))return function(X,ot,ut){if(ot<0||X.byteLength<ot)throw new RangeError('"offset" is outside of buffer bounds');if(X.byteLength<ot+(ut||0))throw new RangeError('"length" is outside of buffer bounds');var lt;return lt=ot===void 0&&ut===void 0?new Uint8Array(X):ut===void 0?new Uint8Array(X,ot):new Uint8Array(X,ot,ut),lt.__proto__=s.prototype,lt}(h,f,I);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var B=h.valueOf&&h.valueOf();if(B!=null&&B!==h)return s.from(B,f,I);var Y=function(X){if(s.isBuffer(X)){var ot=0|v(X.length),ut=c(ot);return ut.length===0||X.copy(ut,0,0,ot),ut}if(X.length!==void 0)return typeof X.length!="number"||st(X.length)?c(0):u(X);if(X.type==="Buffer"&&Array.isArray(X.data))return u(X.data)}(h);if(Y)return Y;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return s.from(h[Symbol.toPrimitive]("string"),f,I);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h)}function d(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(h<0)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function a(h){return d(h),c(h<0?0:0|v(h))}function u(h){for(var f=h.length<0?0:0|v(h.length),I=c(f),B=0;B<f;B+=1)I[B]=255&h[B];return I}function v(h){if(h>=C)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+C.toString(16)+" bytes");return 0|h}function m(h,f){if(s.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||it(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof h);var I=h.length,B=arguments.length>2&&arguments[2]===!0;if(!B&&I===0)return 0;for(var Y=!1;;)switch(f){case"ascii":case"latin1":case"binary":return I;case"utf8":case"utf-8":return et(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*I;case"hex":return I>>>1;case"base64":return Z(h).length;default:if(Y)return B?-1:et(h).length;f=(""+f).toLowerCase(),Y=!0}}function g(h,f,I){var B=h[f];h[f]=h[I],h[I]=B}function b(h,f,I,B,Y){if(h.length===0)return-1;if(typeof I=="string"?(B=I,I=0):I>2147483647?I=2147483647:I<-2147483648&&(I=-2147483648),st(I=+I)&&(I=Y?0:h.length-1),I<0&&(I=h.length+I),I>=h.length){if(Y)return-1;I=h.length-1}else if(I<0){if(!Y)return-1;I=0}if(typeof f=="string"&&(f=s.from(f,B)),s.isBuffer(f))return f.length===0?-1:y(h,f,I,B,Y);if(typeof f=="number")return f&=255,typeof Uint8Array.prototype.indexOf=="function"?Y?Uint8Array.prototype.indexOf.call(h,f,I):Uint8Array.prototype.lastIndexOf.call(h,f,I):y(h,[f],I,B,Y);throw new TypeError("val must be string, number or Buffer")}function y(h,f,I,B,Y){var X,ot=1,ut=h.length,lt=f.length;if(B!==void 0&&((B=String(B).toLowerCase())==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(h.length<2||f.length<2)return-1;ot=2,ut/=2,lt/=2,I/=2}function gt(Ht,pt){return ot===1?Ht[pt]:Ht.readUInt16BE(pt*ot)}if(Y){var bt=-1;for(X=I;X<ut;X++)if(gt(h,X)===gt(f,bt===-1?0:X-bt)){if(bt===-1&&(bt=X),X-bt+1===lt)return bt*ot}else bt!==-1&&(X-=X-bt),bt=-1}else for(I+lt>ut&&(I=ut-lt),X=I;X>=0;X--){for(var Wt=!0,Dt=0;Dt<lt;Dt++)if(gt(h,X+Dt)!==gt(f,Dt)){Wt=!1;break}if(Wt)return X}return-1}function T(h,f,I,B){I=Number(I)||0;var Y=h.length-I;B?(B=Number(B))>Y&&(B=Y):B=Y;var X=f.length;B>X/2&&(B=X/2);for(var ot=0;ot<B;++ot){var ut=parseInt(f.substr(2*ot,2),16);if(st(ut))return ot;h[I+ot]=ut}return ot}function O(h,f,I,B){return at(et(f,h.length-I),h,I,B)}function M(h,f,I,B){return at(function(Y){for(var X=[],ot=0;ot<Y.length;++ot)X.push(255&Y.charCodeAt(ot));return X}(f),h,I,B)}function V(h,f,I,B){return M(h,f,I,B)}function N(h,f,I,B){return at(Z(f),h,I,B)}function Q(h,f,I,B){return at(function(Y,X){for(var ot,ut,lt,gt=[],bt=0;bt<Y.length&&!((X-=2)<0);++bt)ot=Y.charCodeAt(bt),ut=ot>>8,lt=ot%256,gt.push(lt),gt.push(ut);return gt}(f,h.length-I),h,I,B)}function tt(h,f,I){return f===0&&I===h.length?x.fromByteArray(h):x.fromByteArray(h.slice(f,I))}function D(h,f,I){I=Math.min(h.length,I);for(var B=[],Y=f;Y<I;){var X,ot,ut,lt,gt=h[Y],bt=null,Wt=gt>239?4:gt>223?3:gt>191?2:1;if(Y+Wt<=I)switch(Wt){case 1:gt<128&&(bt=gt);break;case 2:(192&(X=h[Y+1]))==128&&(lt=(31&gt)<<6|63&X)>127&&(bt=lt);break;case 3:X=h[Y+1],ot=h[Y+2],(192&X)==128&&(192&ot)==128&&(lt=(15&gt)<<12|(63&X)<<6|63&ot)>2047&&(lt<55296||lt>57343)&&(bt=lt);break;case 4:X=h[Y+1],ot=h[Y+2],ut=h[Y+3],(192&X)==128&&(192&ot)==128&&(192&ut)==128&&(lt=(15&gt)<<18|(63&X)<<12|(63&ot)<<6|63&ut)>65535&&lt<1114112&&(bt=lt)}bt===null?(bt=65533,Wt=1):bt>65535&&(bt-=65536,B.push(bt>>>10&1023|55296),bt=56320|1023&bt),B.push(bt),Y+=Wt}return function(Dt){var Ht=Dt.length;if(Ht<=k)return String.fromCharCode.apply(String,Dt);for(var pt="",At=0;At<Ht;)pt+=String.fromCharCode.apply(String,Dt.slice(At,At+=k));return pt}(B)}R.kMaxLength=C,s.TYPED_ARRAY_SUPPORT=function(){try{var h=new Uint8Array(1);return h.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},h.foo()===42}catch(f){return!1}}(),s.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),typeof Symbol!="undefined"&&Symbol.species!=null&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(h,f,I){return l(h,f,I)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(h,f,I){return function(B,Y,X){return d(B),B<=0?c(B):Y!==void 0?typeof X=="string"?c(B).fill(Y,X):c(B).fill(Y):c(B)}(h,f,I)},s.allocUnsafe=function(h){return a(h)},s.allocUnsafeSlow=function(h){return a(h)},s.isBuffer=function(h){return h!=null&&h._isBuffer===!0&&h!==s.prototype},s.compare=function(h,f){if(it(h,Uint8Array)&&(h=s.from(h,h.offset,h.byteLength)),it(f,Uint8Array)&&(f=s.from(f,f.offset,f.byteLength)),!s.isBuffer(h)||!s.isBuffer(f))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(h===f)return 0;for(var I=h.length,B=f.length,Y=0,X=Math.min(I,B);Y<X;++Y)if(h[Y]!==f[Y]){I=h[Y],B=f[Y];break}return I<B?-1:B<I?1:0},s.isEncoding=function(h){switch(String(h).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(h,f){if(!Array.isArray(h))throw new TypeError('"list" argument must be an Array of Buffers');if(h.length===0)return s.alloc(0);var I;if(f===void 0)for(f=0,I=0;I<h.length;++I)f+=h[I].length;var B=s.allocUnsafe(f),Y=0;for(I=0;I<h.length;++I){var X=h[I];if(it(X,Uint8Array)&&(X=s.from(X)),!s.isBuffer(X))throw new TypeError('"list" argument must be an Array of Buffers');X.copy(B,Y),Y+=X.length}return B},s.byteLength=m,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var h=this.length;if(h%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var f=0;f<h;f+=2)g(this,f,f+1);return this},s.prototype.swap32=function(){var h=this.length;if(h%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var f=0;f<h;f+=4)g(this,f,f+3),g(this,f+1,f+2);return this},s.prototype.swap64=function(){var h=this.length;if(h%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var f=0;f<h;f+=8)g(this,f,f+7),g(this,f+1,f+6),g(this,f+2,f+5),g(this,f+3,f+4);return this},s.prototype.toString=function(){var h=this.length;return h===0?"":arguments.length===0?D(this,0,h):function(f,I,B){var Y=!1;if((I===void 0||I<0)&&(I=0),I>this.length||((B===void 0||B>this.length)&&(B=this.length),B<=0)||(B>>>=0)<=(I>>>=0))return"";for(f||(f="utf8");;)switch(f){case"hex":return E(this,I,B);case"utf8":case"utf-8":return D(this,I,B);case"ascii":return A(this,I,B);case"latin1":case"binary":return L(this,I,B);case"base64":return tt(this,I,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,I,B);default:if(Y)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase(),Y=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(h){if(!s.isBuffer(h))throw new TypeError("Argument must be a Buffer");return this===h||s.compare(this,h)===0},s.prototype.inspect=function(){var h="",f=R.INSPECT_MAX_BYTES;return h=this.toString("hex",0,f).replace(/(.{2})/g,"$1 ").trim(),this.length>f&&(h+=" ... "),"<Buffer "+h+">"},s.prototype.compare=function(h,f,I,B,Y){if(it(h,Uint8Array)&&(h=s.from(h,h.offset,h.byteLength)),!s.isBuffer(h))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof h);if(f===void 0&&(f=0),I===void 0&&(I=h?h.length:0),B===void 0&&(B=0),Y===void 0&&(Y=this.length),f<0||I>h.length||B<0||Y>this.length)throw new RangeError("out of range index");if(B>=Y&&f>=I)return 0;if(B>=Y)return-1;if(f>=I)return 1;if(f>>>=0,I>>>=0,B>>>=0,Y>>>=0,this===h)return 0;for(var X=Y-B,ot=I-f,ut=Math.min(X,ot),lt=this.slice(B,Y),gt=h.slice(f,I),bt=0;bt<ut;++bt)if(lt[bt]!==gt[bt]){X=lt[bt],ot=gt[bt];break}return X<ot?-1:ot<X?1:0},s.prototype.includes=function(h,f,I){return this.indexOf(h,f,I)!==-1},s.prototype.indexOf=function(h,f,I){return b(this,h,f,I,!0)},s.prototype.lastIndexOf=function(h,f,I){return b(this,h,f,I,!1)},s.prototype.write=function(h,f,I,B){if(f===void 0)B="utf8",I=this.length,f=0;else if(I===void 0&&typeof f=="string")B=f,I=this.length,f=0;else{if(!isFinite(f))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");f>>>=0,isFinite(I)?(I>>>=0,B===void 0&&(B="utf8")):(B=I,I=void 0)}var Y=this.length-f;if((I===void 0||I>Y)&&(I=Y),h.length>0&&(I<0||f<0)||f>this.length)throw new RangeError("Attempt to write outside buffer bounds");B||(B="utf8");for(var X=!1;;)switch(B){case"hex":return T(this,h,f,I);case"utf8":case"utf-8":return O(this,h,f,I);case"ascii":return M(this,h,f,I);case"latin1":case"binary":return V(this,h,f,I);case"base64":return N(this,h,f,I);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,h,f,I);default:if(X)throw new TypeError("Unknown encoding: "+B);B=(""+B).toLowerCase(),X=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function A(h,f,I){var B="";I=Math.min(h.length,I);for(var Y=f;Y<I;++Y)B+=String.fromCharCode(127&h[Y]);return B}function L(h,f,I){var B="";I=Math.min(h.length,I);for(var Y=f;Y<I;++Y)B+=String.fromCharCode(h[Y]);return B}function E(h,f,I){var B=h.length;(!f||f<0)&&(f=0),(!I||I<0||I>B)&&(I=B);for(var Y="",X=f;X<I;++X)Y+=G(h[X]);return Y}function q(h,f,I){for(var B=h.slice(f,I),Y="",X=0;X<B.length;X+=2)Y+=String.fromCharCode(B[X]+256*B[X+1]);return Y}function J(h,f,I){if(h%1!=0||h<0)throw new RangeError("offset is not uint");if(h+f>I)throw new RangeError("Trying to access beyond buffer length")}function W(h,f,I,B,Y,X){if(!s.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>Y||f<X)throw new RangeError('"value" argument is out of bounds');if(I+B>h.length)throw new RangeError("Index out of range")}function z(h,f,I,B,Y,X){if(I+B>h.length)throw new RangeError("Index out of range");if(I<0)throw new RangeError("Index out of range")}function K(h,f,I,B,Y){return f=+f,I>>>=0,Y||z(h,0,I,4),w.write(h,f,I,B,23,4),I+4}function H(h,f,I,B,Y){return f=+f,I>>>=0,Y||z(h,0,I,8),w.write(h,f,I,B,52,8),I+8}s.prototype.slice=function(h,f){var I=this.length;h=~~h,f=f===void 0?I:~~f,h<0?(h+=I)<0&&(h=0):h>I&&(h=I),f<0?(f+=I)<0&&(f=0):f>I&&(f=I),f<h&&(f=h);var B=this.subarray(h,f);return B.__proto__=s.prototype,B},s.prototype.readUIntLE=function(h,f,I){h>>>=0,f>>>=0,I||J(h,f,this.length);for(var B=this[h],Y=1,X=0;++X<f&&(Y*=256);)B+=this[h+X]*Y;return B},s.prototype.readUIntBE=function(h,f,I){h>>>=0,f>>>=0,I||J(h,f,this.length);for(var B=this[h+--f],Y=1;f>0&&(Y*=256);)B+=this[h+--f]*Y;return B},s.prototype.readUInt8=function(h,f){return h>>>=0,f||J(h,1,this.length),this[h]},s.prototype.readUInt16LE=function(h,f){return h>>>=0,f||J(h,2,this.length),this[h]|this[h+1]<<8},s.prototype.readUInt16BE=function(h,f){return h>>>=0,f||J(h,2,this.length),this[h]<<8|this[h+1]},s.prototype.readUInt32LE=function(h,f){return h>>>=0,f||J(h,4,this.length),(this[h]|this[h+1]<<8|this[h+2]<<16)+16777216*this[h+3]},s.prototype.readUInt32BE=function(h,f){return h>>>=0,f||J(h,4,this.length),16777216*this[h]+(this[h+1]<<16|this[h+2]<<8|this[h+3])},s.prototype.readIntLE=function(h,f,I){h>>>=0,f>>>=0,I||J(h,f,this.length);for(var B=this[h],Y=1,X=0;++X<f&&(Y*=256);)B+=this[h+X]*Y;return B>=(Y*=128)&&(B-=Math.pow(2,8*f)),B},s.prototype.readIntBE=function(h,f,I){h>>>=0,f>>>=0,I||J(h,f,this.length);for(var B=f,Y=1,X=this[h+--B];B>0&&(Y*=256);)X+=this[h+--B]*Y;return X>=(Y*=128)&&(X-=Math.pow(2,8*f)),X},s.prototype.readInt8=function(h,f){return h>>>=0,f||J(h,1,this.length),128&this[h]?-1*(255-this[h]+1):this[h]},s.prototype.readInt16LE=function(h,f){h>>>=0,f||J(h,2,this.length);var I=this[h]|this[h+1]<<8;return 32768&I?4294901760|I:I},s.prototype.readInt16BE=function(h,f){h>>>=0,f||J(h,2,this.length);var I=this[h+1]|this[h]<<8;return 32768&I?4294901760|I:I},s.prototype.readInt32LE=function(h,f){return h>>>=0,f||J(h,4,this.length),this[h]|this[h+1]<<8|this[h+2]<<16|this[h+3]<<24},s.prototype.readInt32BE=function(h,f){return h>>>=0,f||J(h,4,this.length),this[h]<<24|this[h+1]<<16|this[h+2]<<8|this[h+3]},s.prototype.readFloatLE=function(h,f){return h>>>=0,f||J(h,4,this.length),w.read(this,h,!0,23,4)},s.prototype.readFloatBE=function(h,f){return h>>>=0,f||J(h,4,this.length),w.read(this,h,!1,23,4)},s.prototype.readDoubleLE=function(h,f){return h>>>=0,f||J(h,8,this.length),w.read(this,h,!0,52,8)},s.prototype.readDoubleBE=function(h,f){return h>>>=0,f||J(h,8,this.length),w.read(this,h,!1,52,8)},s.prototype.writeUIntLE=function(h,f,I,B){h=+h,f>>>=0,I>>>=0,B||W(this,h,f,I,Math.pow(2,8*I)-1,0);var Y=1,X=0;for(this[f]=255&h;++X<I&&(Y*=256);)this[f+X]=h/Y&255;return f+I},s.prototype.writeUIntBE=function(h,f,I,B){h=+h,f>>>=0,I>>>=0,B||W(this,h,f,I,Math.pow(2,8*I)-1,0);var Y=I-1,X=1;for(this[f+Y]=255&h;--Y>=0&&(X*=256);)this[f+Y]=h/X&255;return f+I},s.prototype.writeUInt8=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,1,255,0),this[f]=255&h,f+1},s.prototype.writeUInt16LE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,2,65535,0),this[f]=255&h,this[f+1]=h>>>8,f+2},s.prototype.writeUInt16BE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,2,65535,0),this[f]=h>>>8,this[f+1]=255&h,f+2},s.prototype.writeUInt32LE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,4,4294967295,0),this[f+3]=h>>>24,this[f+2]=h>>>16,this[f+1]=h>>>8,this[f]=255&h,f+4},s.prototype.writeUInt32BE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,4,4294967295,0),this[f]=h>>>24,this[f+1]=h>>>16,this[f+2]=h>>>8,this[f+3]=255&h,f+4},s.prototype.writeIntLE=function(h,f,I,B){if(h=+h,f>>>=0,!B){var Y=Math.pow(2,8*I-1);W(this,h,f,I,Y-1,-Y)}var X=0,ot=1,ut=0;for(this[f]=255&h;++X<I&&(ot*=256);)h<0&&ut===0&&this[f+X-1]!==0&&(ut=1),this[f+X]=(h/ot>>0)-ut&255;return f+I},s.prototype.writeIntBE=function(h,f,I,B){if(h=+h,f>>>=0,!B){var Y=Math.pow(2,8*I-1);W(this,h,f,I,Y-1,-Y)}var X=I-1,ot=1,ut=0;for(this[f+X]=255&h;--X>=0&&(ot*=256);)h<0&&ut===0&&this[f+X+1]!==0&&(ut=1),this[f+X]=(h/ot>>0)-ut&255;return f+I},s.prototype.writeInt8=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,1,127,-128),h<0&&(h=255+h+1),this[f]=255&h,f+1},s.prototype.writeInt16LE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,2,32767,-32768),this[f]=255&h,this[f+1]=h>>>8,f+2},s.prototype.writeInt16BE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,2,32767,-32768),this[f]=h>>>8,this[f+1]=255&h,f+2},s.prototype.writeInt32LE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,4,2147483647,-2147483648),this[f]=255&h,this[f+1]=h>>>8,this[f+2]=h>>>16,this[f+3]=h>>>24,f+4},s.prototype.writeInt32BE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,4,2147483647,-2147483648),h<0&&(h=4294967295+h+1),this[f]=h>>>24,this[f+1]=h>>>16,this[f+2]=h>>>8,this[f+3]=255&h,f+4},s.prototype.writeFloatLE=function(h,f,I){return K(this,h,f,!0,I)},s.prototype.writeFloatBE=function(h,f,I){return K(this,h,f,!1,I)},s.prototype.writeDoubleLE=function(h,f,I){return H(this,h,f,!0,I)},s.prototype.writeDoubleBE=function(h,f,I){return H(this,h,f,!1,I)},s.prototype.copy=function(h,f,I,B){if(!s.isBuffer(h))throw new TypeError("argument should be a Buffer");if(I||(I=0),B||B===0||(B=this.length),f>=h.length&&(f=h.length),f||(f=0),B>0&&B<I&&(B=I),B===I||h.length===0||this.length===0)return 0;if(f<0)throw new RangeError("targetStart out of bounds");if(I<0||I>=this.length)throw new RangeError("Index out of range");if(B<0)throw new RangeError("sourceEnd out of bounds");B>this.length&&(B=this.length),h.length-f<B-I&&(B=h.length-f+I);var Y=B-I;if(this===h&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(f,I,B);else if(this===h&&I<f&&f<B)for(var X=Y-1;X>=0;--X)h[X+f]=this[X+I];else Uint8Array.prototype.set.call(h,this.subarray(I,B),f);return Y},s.prototype.fill=function(h,f,I,B){if(typeof h=="string"){if(typeof f=="string"?(B=f,f=0,I=this.length):typeof I=="string"&&(B=I,I=this.length),B!==void 0&&typeof B!="string")throw new TypeError("encoding must be a string");if(typeof B=="string"&&!s.isEncoding(B))throw new TypeError("Unknown encoding: "+B);if(h.length===1){var Y=h.charCodeAt(0);(B==="utf8"&&Y<128||B==="latin1")&&(h=Y)}}else typeof h=="number"&&(h&=255);if(f<0||this.length<f||this.length<I)throw new RangeError("Out of range index");if(I<=f)return this;var X;if(f>>>=0,I=I===void 0?this.length:I>>>0,h||(h=0),typeof h=="number")for(X=f;X<I;++X)this[X]=h;else{var ot=s.isBuffer(h)?h:s.from(h,B),ut=ot.length;if(ut===0)throw new TypeError('The value "'+h+'" is invalid for argument "value"');for(X=0;X<I-f;++X)this[X+f]=ot[X%ut]}return this};var _=/[^+/0-9A-Za-z-_]/g;function G(h){return h<16?"0"+h.toString(16):h.toString(16)}function et(h,f){var I;f=f||1/0;for(var B=h.length,Y=null,X=[],ot=0;ot<B;++ot){if((I=h.charCodeAt(ot))>55295&&I<57344){if(!Y){if(I>56319){(f-=3)>-1&&X.push(239,191,189);continue}if(ot+1===B){(f-=3)>-1&&X.push(239,191,189);continue}Y=I;continue}if(I<56320){(f-=3)>-1&&X.push(239,191,189),Y=I;continue}I=65536+(Y-55296<<10|I-56320)}else Y&&(f-=3)>-1&&X.push(239,191,189);if(Y=null,I<128){if((f-=1)<0)break;X.push(I)}else if(I<2048){if((f-=2)<0)break;X.push(I>>6|192,63&I|128)}else if(I<65536){if((f-=3)<0)break;X.push(I>>12|224,I>>6&63|128,63&I|128)}else{if(!(I<1114112))throw new Error("Invalid code point");if((f-=4)<0)break;X.push(I>>18|240,I>>12&63|128,I>>6&63|128,63&I|128)}}return X}function Z(h){return x.toByteArray(function(f){if((f=(f=f.split("=")[0]).trim().replace(_,"")).length<2)return"";for(;f.length%4!=0;)f+="=";return f}(h))}function at(h,f,I,B){for(var Y=0;Y<B&&!(Y+I>=f.length||Y>=h.length);++Y)f[Y+I]=h[Y];return Y}function it(h,f){return h instanceof f||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===f.name}function st(h){return h!=h}}).call(this)}).call(this,F("buffer").Buffer)},{"base64-js":13,buffer:17,ieee754:23}],18:[function(F,$,R){(function(P){(function(){R.formatArgs=function(w){if(w[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+w[0]+(this.useColors?"%c ":" ")+"+"+$.exports.humanize(this.diff),!!this.useColors){var C="color: "+this.color;w.splice(1,0,C,"color: inherit");var c=0,s=0;w[0].replace(/%[a-zA-Z%]/g,function(l){l!=="%%"&&l==="%c"&&(s=++c)}),w.splice(s,0,C)}},R.save=function(w){try{w?R.storage.setItem("debug",w):R.storage.removeItem("debug")}catch(C){}},R.load=function(){var w;try{w=R.storage.getItem("debug")}catch(C){}return!w&&P!==void 0&&"env"in P&&(w=P.env.DEBUG),w},R.useColors=function(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},R.storage=function(){try{return localStorage}catch(w){}}(),R.destroy=function(){var w=!1;return function(){w||(w=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),R.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],R.log=console.debug||console.log||function(){},$.exports=F("./common")(R);var x=$.exports.formatters;x.j=function(w){try{return JSON.stringify(w)}catch(C){return"[UnexpectedJSONParseError]: "+C.message}}}).call(this)}).call(this,F("_process"))},{"./common":19,_process:50}],19:[function(F,$,R){$.exports=function(P){function x(c){var s,l,d,a=null;function u(){for(var v=arguments.length,m=new Array(v),g=0;g<v;g++)m[g]=arguments[g];if(!!u.enabled){var b=u,y=Number(new Date),T=y-(s||y);b.diff=T,b.prev=s,b.curr=y,s=y,m[0]=x.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");var O=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,function(M,V){if(M==="%%")return"%";O++;var N=x.formatters[V];if(typeof N=="function"){var Q=m[O];M=N.call(b,Q),m.splice(O,1),O--}return M}),x.formatArgs.call(b,m),(b.log||x.log).apply(b,m)}}return u.namespace=c,u.useColors=x.useColors(),u.color=x.selectColor(c),u.extend=w,u.destroy=x.destroy,Object.defineProperty(u,"enabled",{enumerable:!0,configurable:!1,get:function(){return a!==null?a:(l!==x.namespaces&&(l=x.namespaces,d=x.enabled(c)),d)},set:function(m){a=m}}),typeof x.init=="function"&&x.init(u),u}function w(c,s){var l=x(this.namespace+(s===void 0?":":s)+c);return l.log=this.log,l}function C(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}return x.debug=x,x.default=x,x.coerce=function(c){return c instanceof Error?c.stack||c.message:c},x.disable=function(){var c=[].concat(Pt(x.names.map(C)),Pt(x.skips.map(C).map(function(s){return"-"+s}))).join(",");return x.enable(""),c},x.enable=function(c){var s;x.save(c),x.namespaces=c,x.names=[],x.skips=[];var l=(typeof c=="string"?c:"").split(/[\s,]+/),d=l.length;for(s=0;s<d;s++)l[s]&&((c=l[s].replace(/\*/g,".*?"))[0]==="-"?x.skips.push(new RegExp("^"+c.substr(1)+"$")):x.names.push(new RegExp("^"+c+"$")))},x.enabled=function(c){if(c[c.length-1]==="*")return!0;var s,l;for(s=0,l=x.skips.length;s<l;s++)if(x.skips[s].test(c))return!1;for(s=0,l=x.names.length;s<l;s++)if(x.names[s].test(c))return!0;return!1},x.humanize=F("ms"),x.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(P).forEach(function(c){x[c]=P[c]}),x.names=[],x.skips=[],x.formatters={},x.selectColor=function(c){for(var s=0,l=0;l<c.length;l++)s=(s<<5)-s+c.charCodeAt(l),s|=0;return x.colors[Math.abs(s)%x.colors.length]},x.enable(x.load()),x}},{ms:45}],20:[function(F,$,R){(function(P,x){(function(){var w=F("readable-stream"),C=F("end-of-stream"),c=F("inherits"),s=F("stream-shift"),l=x.from&&x.from!==Uint8Array.from?x.from([0]):new x([0]),d=function(g,b){g._corked?g.once("uncork",b):b()},a=function(g,b){return function(y){y?function(T,O){T._autoDestroy&&T.destroy(O)}(g,y.message==="premature close"?null:y):b&&!g._ended&&g.end()}},u=function(){},v=function m(g,b,y){if(!(this instanceof m))return new m(g,b,y);w.Duplex.call(this,y),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!y||y.autoDestroy!==!1,this._forwardDestroy=!y||y.destroy!==!1,this._forwardEnd=!y||y.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,g&&this.setWritable(g),b&&this.setReadable(b)};c(v,w.Duplex),v.obj=function(m,g,b){return b||(b={}),b.objectMode=!0,b.highWaterMark=16,new v(m,g,b)},v.prototype.cork=function(){++this._corked==1&&this.emit("cork")},v.prototype.uncork=function(){this._corked&&--this._corked==0&&this.emit("uncork")},v.prototype.setWritable=function(m){if(this._unwrite&&this._unwrite(),this.destroyed)m&&m.destroy&&m.destroy();else if(m!==null&&m!==!1){var g=this,b=C(m,{writable:!0,readable:!1},a(this,this._forwardEnd)),y=function(){var O=g._ondrain;g._ondrain=null,O&&O()};this._unwrite&&P.nextTick(y),this._writable=m,this._writable.on("drain",y),this._unwrite=function(){g._writable.removeListener("drain",y),b()},this.uncork()}else this.end()},v.prototype.setReadable=function(m){if(this._unread&&this._unread(),this.destroyed)m&&m.destroy&&m.destroy();else{if(m===null||m===!1)return this.push(null),void this.resume();var g,b=this,y=C(m,{writable:!1,readable:!0},a(this)),T=function(){b._forward()},O=function(){b.push(null)};this._drained=!0,this._readable=m,this._readable2=m._readableState?m:(g=m,new w.Readable({objectMode:!0,highWaterMark:16}).wrap(g)),this._readable2.on("readable",T),this._readable2.on("end",O),this._unread=function(){b._readable2.removeListener("readable",T),b._readable2.removeListener("end",O),y()},this._forward()}},v.prototype._read=function(){this._drained=!0,this._forward()},v.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var m;for(this._forwarding=!0;this._drained&&(m=s(this._readable2))!==null;)this.destroyed||(this._drained=this.push(m));this._forwarding=!1}},v.prototype.destroy=function(m,g){if(g||(g=u),this.destroyed)return g(null);this.destroyed=!0;var b=this;P.nextTick(function(){b._destroy(m),g(null)})},v.prototype._destroy=function(m){if(m){var g=this._ondrain;this._ondrain=null,g?g(m):this.emit("error",m)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},v.prototype._write=function(m,g,b){if(!this.destroyed)return this._corked?d(this,this._write.bind(this,m,g,b)):m===l?this._finish(b):this._writable?void(this._writable.write(m)===!1?this._ondrain=b:this.destroyed||b()):b()},v.prototype._finish=function(m){var g=this;this.emit("preend"),d(this,function(){var b,y;b=g._forwardEnd&&g._writable,y=function(){g._writableState.prefinished===!1&&(g._writableState.prefinished=!0),g.emit("prefinish"),d(g,m)},b?b._writableState&&b._writableState.finished?y():b._writableState?b.end(y):(b.end(),y()):y()})},v.prototype.end=function(m,g,b){return typeof m=="function"?this.end(null,null,m):typeof g=="function"?this.end(m,null,g):(this._ended=!0,m&&this.write(m),this._writableState.ending||this._writableState.destroyed||this.write(l),w.Writable.prototype.end.call(this,b))},$.exports=v}).call(this)}).call(this,F("_process"),F("buffer").Buffer)},{_process:50,buffer:17,"end-of-stream":21,inherits:24,"readable-stream":69,"stream-shift":74}],21:[function(F,$,R){(function(P){(function(){var x=F("once"),w=function(){},C=function c(s,l,d){if(typeof l=="function")return c(s,null,l);l||(l={}),d=x(d||w);var a=s._writableState,u=s._readableState,v=l.readable||l.readable!==!1&&s.readable,m=l.writable||l.writable!==!1&&s.writable,g=!1,b=function(){s.writable||y()},y=function(){m=!1,v||d.call(s)},T=function(){v=!1,m||d.call(s)},O=function(D){d.call(s,D?new Error("exited with error code: "+D):null)},M=function(D){d.call(s,D)},V=function(){P.nextTick(N)},N=function(){if(!g)return(!v||u&&u.ended&&!u.destroyed)&&(!m||a&&a.ended&&!a.destroyed)?void 0:d.call(s,new Error("premature close"))},Q=function(){s.req.on("finish",y)};return function(tt){return tt.setHeader&&typeof tt.abort=="function"}(s)?(s.on("complete",y),s.on("abort",V),s.req?Q():s.on("request",Q)):m&&!a&&(s.on("end",b),s.on("close",b)),function(tt){return tt.stdio&&Array.isArray(tt.stdio)&&tt.stdio.length===3}(s)&&s.on("exit",O),s.on("end",T),s.on("finish",y),l.error!==!1&&s.on("error",M),s.on("close",V),function(){g=!0,s.removeListener("complete",y),s.removeListener("abort",V),s.removeListener("request",Q),s.req&&s.req.removeListener("finish",y),s.removeListener("end",b),s.removeListener("close",b),s.removeListener("finish",y),s.removeListener("exit",O),s.removeListener("end",T),s.removeListener("error",M),s.removeListener("close",V)}};$.exports=C}).call(this)}).call(this,F("_process"))},{_process:50,once:48}],22:[function(F,$,R){var P=Object.create||function(y){var T=function(){};return T.prototype=y,new T},x=Object.keys||function(y){var T=[];for(var O in y)Object.prototype.hasOwnProperty.call(y,O)&&T.push(O);return O},w=Function.prototype.bind||function(y){var T=this;return function(){return T.apply(y,arguments)}};function C(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=P(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}$.exports=C,C.EventEmitter=C,C.prototype._events=void 0,C.prototype._maxListeners=void 0;var c,s=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),c=l.x===0}catch(y){c=!1}function d(y){return y._maxListeners===void 0?C.defaultMaxListeners:y._maxListeners}function a(y,T,O,M){var V,N,Q;if(typeof O!="function")throw new TypeError('"listener" argument must be a function');if((N=y._events)?(N.newListener&&(y.emit("newListener",T,O.listener?O.listener:O),N=y._events),Q=N[T]):(N=y._events=P(null),y._eventsCount=0),Q){if(typeof Q=="function"?Q=N[T]=M?[O,Q]:[Q,O]:M?Q.unshift(O):Q.push(O),!Q.warned&&(V=d(y))&&V>0&&Q.length>V){Q.warned=!0;var tt=new Error("Possible EventEmitter memory leak detected. "+Q.length+' "'+String(T)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');tt.name="MaxListenersExceededWarning",tt.emitter=y,tt.type=T,tt.count=Q.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",tt.name,tt.message)}}else Q=N[T]=O,++y._eventsCount;return y}function u(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var y=new Array(arguments.length),T=0;T<y.length;++T)y[T]=arguments[T];this.listener.apply(this.target,y)}}function v(y,T,O){var M={fired:!1,wrapFn:void 0,target:y,type:T,listener:O},V=w.call(u,M);return V.listener=O,M.wrapFn=V,V}function m(y,T,O){var M=y._events;if(!M)return[];var V=M[T];return V?typeof V=="function"?O?[V.listener||V]:[V]:O?function(N){for(var Q=new Array(N.length),tt=0;tt<Q.length;++tt)Q[tt]=N[tt].listener||N[tt];return Q}(V):b(V,V.length):[]}function g(y){var T=this._events;if(T){var O=T[y];if(typeof O=="function")return 1;if(O)return O.length}return 0}function b(y,T){for(var O=new Array(T),M=0;M<T;++M)O[M]=y[M];return O}c?Object.defineProperty(C,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(T){if(typeof T!="number"||T<0||T!=T)throw new TypeError('"defaultMaxListeners" must be a positive number');s=T}}):C.defaultMaxListeners=s,C.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||isNaN(y))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=y,this},C.prototype.getMaxListeners=function(){return d(this)},C.prototype.emit=function(y){var T,O,M,V,N,Q,tt=y==="error";if(Q=this._events)tt=tt&&Q.error==null;else if(!tt)return!1;if(tt){if(arguments.length>1&&(T=arguments[1]),T instanceof Error)throw T;var D=new Error('Unhandled "error" event. ('+T+")");throw D.context=T,D}if(!(O=Q[y]))return!1;var k=typeof O=="function";switch(M=arguments.length){case 1:(function(A,L,E){if(L)A.call(E);else for(var q=A.length,J=b(A,q),W=0;W<q;++W)J[W].call(E)})(O,k,this);break;case 2:(function(A,L,E,q){if(L)A.call(E,q);else for(var J=A.length,W=b(A,J),z=0;z<J;++z)W[z].call(E,q)})(O,k,this,arguments[1]);break;case 3:(function(A,L,E,q,J){if(L)A.call(E,q,J);else for(var W=A.length,z=b(A,W),K=0;K<W;++K)z[K].call(E,q,J)})(O,k,this,arguments[1],arguments[2]);break;case 4:(function(A,L,E,q,J,W){if(L)A.call(E,q,J,W);else for(var z=A.length,K=b(A,z),H=0;H<z;++H)K[H].call(E,q,J,W)})(O,k,this,arguments[1],arguments[2],arguments[3]);break;default:for(V=new Array(M-1),N=1;N<M;N++)V[N-1]=arguments[N];(function(A,L,E,q){if(L)A.apply(E,q);else for(var J=A.length,W=b(A,J),z=0;z<J;++z)W[z].apply(E,q)})(O,k,this,V)}return!0},C.prototype.addListener=function(y,T){return a(this,y,T,!1)},C.prototype.on=C.prototype.addListener,C.prototype.prependListener=function(y,T){return a(this,y,T,!0)},C.prototype.once=function(y,T){if(typeof T!="function")throw new TypeError('"listener" argument must be a function');return this.on(y,v(this,y,T)),this},C.prototype.prependOnceListener=function(y,T){if(typeof T!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(y,v(this,y,T)),this},C.prototype.removeListener=function(y,T){var O,M,V,N,Q;if(typeof T!="function")throw new TypeError('"listener" argument must be a function');if(!(M=this._events))return this;if(!(O=M[y]))return this;if(O===T||O.listener===T)--this._eventsCount==0?this._events=P(null):(delete M[y],M.removeListener&&this.emit("removeListener",y,O.listener||T));else if(typeof O!="function"){for(V=-1,N=O.length-1;N>=0;N--)if(O[N]===T||O[N].listener===T){Q=O[N].listener,V=N;break}if(V<0)return this;V===0?O.shift():function(tt,D){for(var k=D,A=k+1,L=tt.length;A<L;k+=1,A+=1)tt[k]=tt[A];tt.pop()}(O,V),O.length===1&&(M[y]=O[0]),M.removeListener&&this.emit("removeListener",y,Q||T)}return this},C.prototype.removeAllListeners=function(y){var T,O,M;if(!(O=this._events))return this;if(!O.removeListener)return arguments.length===0?(this._events=P(null),this._eventsCount=0):O[y]&&(--this._eventsCount==0?this._events=P(null):delete O[y]),this;if(arguments.length===0){var V,N=x(O);for(M=0;M<N.length;++M)(V=N[M])!=="removeListener"&&this.removeAllListeners(V);return this.removeAllListeners("removeListener"),this._events=P(null),this._eventsCount=0,this}if(typeof(T=O[y])=="function")this.removeListener(y,T);else if(T)for(M=T.length-1;M>=0;M--)this.removeListener(y,T[M]);return this},C.prototype.listeners=function(y){return m(this,y,!0)},C.prototype.rawListeners=function(y){return m(this,y,!1)},C.listenerCount=function(y,T){return typeof y.listenerCount=="function"?y.listenerCount(T):g.call(y,T)},C.prototype.listenerCount=g,C.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],23:[function(F,$,R){R.read=function(P,x,w,C,c){var s,l,d=8*c-C-1,a=(1<<d)-1,u=a>>1,v=-7,m=w?c-1:0,g=w?-1:1,b=P[x+m];for(m+=g,s=b&(1<<-v)-1,b>>=-v,v+=d;v>0;s=256*s+P[x+m],m+=g,v-=8);for(l=s&(1<<-v)-1,s>>=-v,v+=C;v>0;l=256*l+P[x+m],m+=g,v-=8);if(s===0)s=1-u;else{if(s===a)return l?NaN:1/0*(b?-1:1);l+=Math.pow(2,C),s-=u}return(b?-1:1)*l*Math.pow(2,s-C)},R.write=function(P,x,w,C,c,s){var l,d,a,u=8*s-c-1,v=(1<<u)-1,m=v>>1,g=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=C?0:s-1,y=C?1:-1,T=x<0||x===0&&1/x<0?1:0;for(x=Math.abs(x),isNaN(x)||x===1/0?(d=isNaN(x)?1:0,l=v):(l=Math.floor(Math.log(x)/Math.LN2),x*(a=Math.pow(2,-l))<1&&(l--,a*=2),(x+=l+m>=1?g/a:g*Math.pow(2,1-m))*a>=2&&(l++,a/=2),l+m>=v?(d=0,l=v):l+m>=1?(d=(x*a-1)*Math.pow(2,c),l+=m):(d=x*Math.pow(2,m-1)*Math.pow(2,c),l=0));c>=8;P[w+b]=255&d,b+=y,d/=256,c-=8);for(l=l<<c|d,u+=c;u>0;P[w+b]=255&l,b+=y,l/=256,u-=8);P[w+b-y]|=128*T}},{}],24:[function(F,$,R){typeof Object.create=="function"?$.exports=function(P,x){x&&(P.super_=x,P.prototype=Object.create(x.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}))}:$.exports=function(P,x){if(x){P.super_=x;var w=function(){};w.prototype=x.prototype,P.prototype=new w,P.prototype.constructor=P}}},{}],25:[function(F,$,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var P=function(){function x(w,C){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=w,this.value=C}return x.prototype.rotateLeft=function(){var w=this.parent,C=this.brother,c=this.leftChild,s=this.rightChild;if(!s)throw new Error("unknown error");var l=s.leftChild,d=s.rightChild;return w&&(w.leftChild===this?w.leftChild=s:w.rightChild===this&&(w.rightChild=s)),s.parent=w,s.brother=C,s.leftChild=this,s.rightChild=d,C&&(C.brother=s),this.parent=s,this.brother=d,this.leftChild=c,this.rightChild=l,d&&(d.parent=s,d.brother=this),c&&(c.parent=this,c.brother=l),l&&(l.parent=this,l.brother=c),s},x.prototype.rotateRight=function(){var w=this.parent,C=this.brother,c=this.leftChild;if(!c)throw new Error("unknown error");var s=this.rightChild,l=c.leftChild,d=c.rightChild;return w&&(w.leftChild===this?w.leftChild=c:w.rightChild===this&&(w.rightChild=c)),c.parent=w,c.brother=C,c.leftChild=l,c.rightChild=this,C&&(C.brother=c),l&&(l.parent=c,l.brother=this),this.parent=c,this.brother=l,this.leftChild=d,this.rightChild=s,d&&(d.parent=this,d.brother=s),s&&(s.parent=this,s.brother=d),c},x.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},x.TreeNodeColorType={red:!0,black:!1},x}();Object.freeze(P),R.default=P},{}],26:[function(F,$,R){"use strict";var P=this&&this.__generator||function(w,C){var c,s,l,d,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return d={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function u(v){return function(m){return function(g){if(c)throw new TypeError("Generator is already executing.");for(;a;)try{if(c=1,s&&(l=2&g[0]?s.return:g[0]?s.throw||((l=s.return)&&l.call(s),0):s.next)&&!(l=l.call(s,g[1])).done)return l;switch(s=0,l&&(g=[2&g[0],l.value]),g[0]){case 0:case 1:l=g;break;case 4:return a.label++,{value:g[1],done:!1};case 5:a.label++,s=g[1],g=[0];continue;case 7:g=a.ops.pop(),a.trys.pop();continue;default:if(!(l=(l=a.trys).length>0&&l[l.length-1])&&(g[0]===6||g[0]===2)){a=0;continue}if(g[0]===3&&(!l||g[1]>l[0]&&g[1]<l[3])){a.label=g[1];break}if(g[0]===6&&a.label<l[1]){a.label=l[1],l=g;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(g);break}l[2]&&a.ops.pop(),a.trys.pop();continue}g=C.call(w,a)}catch(b){g=[6,b],s=0}finally{c=l=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([v,m])}}};function x(w){var C=this;w===void 0&&(w=[]);var c=[],s=0,l=0,d=0,a=0,u=0,v=0;this.size=function(){return v},this.empty=function(){return v===0},this.clear=function(){s=d=l=a=u=v=0,g.call(this,x.bucketSize),v=0},this.front=function(){return c[s][l]},this.back=function(){return c[d][a]},this.forEach=function(b){if(!this.empty()){var y=0;if(s!==d){for(O=l;O<x.bucketSize;++O)b(c[s][O],y++);for(O=s+1;O<d;++O)for(var T=0;T<x.bucketSize;++T)b(c[O][T],y++);for(O=0;O<=a;++O)b(c[d][O],y++)}else for(var O=l;O<=a;++O)b(c[s][O],y++)}};var m=function(y){var T=s*x.bucketSize+l,O=T+y,M=d*x.bucketSize+a;if(O<T||O>M)throw new Error("pos should more than 0 and less than queue's size");return{curNodeBucketIndex:Math.floor(O/x.bucketSize),curNodePointerIndex:O%x.bucketSize}};this.getElementByPos=function(b){var y=m(b),T=y.curNodeBucketIndex,O=y.curNodePointerIndex;return c[T][O]},this.eraseElementByPos=function(b){var y=this;if(b<0||b>v)throw new Error("pos should more than 0 and less than queue's size");if(b===0)this.popFront();else if(b===this.size())this.popBack();else{for(var T=[],O=b+1;O<v;++O)T.push(this.getElementByPos(O));this.cut(b),this.popBack(),T.forEach(function(M){return y.pushBack(M)})}},this.eraseElementByValue=function(b){if(!this.empty()){var y=[];this.forEach(function(M){M!==b&&y.push(M)});for(var T=y.length,O=0;O<T;++O)this.setElementByPos(O,y[O]);this.cut(T-1)}};var g=function(y){for(var T=[],O=y*x.sigma,M=Math.max(Math.ceil(O/x.bucketSize),2),V=0;V<M;++V)T.push(new Array(x.bucketSize));var N=Math.ceil(y/x.bucketSize),Q=Math.floor(M/2)-Math.floor(N/2),tt=Q,D=0;if(this.size())for(V=0;V<N;++V){for(var k=0;k<x.bucketSize;++k)if(T[Q+V][k]=this.front(),this.popFront(),this.empty()){tt=Q+V,D=k;break}if(this.empty())break}c=T,s=Q,l=0,d=tt,a=D,u=M,v=y};this.pushBack=function(b){this.empty()||(d===u-1&&a===x.bucketSize-1&&g.call(this,this.size()),a<x.bucketSize-1?++a:d<u-1&&(++d,a=0)),++v,c[d][a]=b},this.popBack=function(){this.empty()||(this.size()!==1&&(a>0?--a:s<d&&(--d,a=x.bucketSize-1)),v>0&&--v)},this.setElementByPos=function(b,y){var T=m(b),O=T.curNodeBucketIndex,M=T.curNodePointerIndex;c[O][M]=y},this.insert=function(b,y,T){var O=this;if(T===void 0&&(T=1),b===0)for(;T--;)this.pushFront(y);else if(b===this.size())for(;T--;)this.pushBack(y);else{for(var M=[],V=b;V<v;++V)M.push(this.getElementByPos(V));for(this.cut(b-1),V=0;V<T;++V)this.pushBack(y);M.forEach(function(N){return O.pushBack(N)})}},this.find=function(b){if(s===d){for(var y=l;y<=a;++y)if(c[s][y]===b)return!0;return!1}for(y=l;y<x.bucketSize;++y)if(c[s][y]===b)return!0;for(y=s+1;y<d;++y)for(var T=0;T<x.bucketSize;++T)if(c[y][T]===b)return!0;for(y=0;y<=a;++y)if(c[d][y]===b)return!0;return!1},this.reverse=function(){for(var b=0,y=v-1;b<y;){var T=this.getElementByPos(b);this.setElementByPos(b,this.getElementByPos(y)),this.setElementByPos(y,T),++b,--y}},this.unique=function(){if(!this.empty()){var b=[],y=this.front();this.forEach(function(O,M){M!==0&&O===y||(b.push(O),y=O)});for(var T=0;T<v;++T)this.setElementByPos(T,b[T]);this.cut(b.length-1)}},this.sort=function(b){var y=[];this.forEach(function(O){y.push(O)}),y.sort(b);for(var T=0;T<v;++T)this.setElementByPos(T,y[T])},this.pushFront=function(b){this.empty()||(s===0&&l===0&&g.call(this,this.size()),l>0?--l:s>0&&(--s,l=x.bucketSize-1)),++v,c[s][l]=b},this.popFront=function(){this.empty()||(this.size()!==1&&(l<x.bucketSize-1?++l:s<d&&(++s,l=0)),v>0&&--v)},this.shrinkToFit=function(){var b=this,y=[];this.forEach(function(V){y.push(V)});var T=y.length;c=[];for(var O=Math.ceil(T/x.bucketSize),M=0;M<O;++M)c.push(new Array(x.bucketSize));this.clear(),y.forEach(function(V){return b.pushBack(V)})},this.cut=function(b){if(b<0)this.clear();else{var y=m(b),T=y.curNodeBucketIndex,O=y.curNodePointerIndex;d=T,a=O,v=b+1}},this[Symbol.iterator]=function(){return function(){var b,y;return P(this,function(T){switch(T.label){case 0:if(v===0)return[2];if(s!==d)return[3,5];y=l,T.label=1;case 1:return y<=a?[4,c[s][y]]:[3,4];case 2:T.sent(),T.label=3;case 3:return++y,[3,1];case 4:return[2];case 5:y=l,T.label=6;case 6:return y<x.bucketSize?[4,c[s][y]]:[3,9];case 7:T.sent(),T.label=8;case 8:return++y,[3,6];case 9:y=s+1,T.label=10;case 10:if(!(y<d))return[3,15];b=0,T.label=11;case 11:return b<x.bucketSize?[4,c[y][b]]:[3,14];case 12:T.sent(),T.label=13;case 13:return++b,[3,11];case 14:return++y,[3,10];case 15:y=0,T.label=16;case 16:return y<=a?[4,c[d][y]]:[3,19];case 17:T.sent(),T.label=18;case 18:return++y,[3,16];case 19:return[2]}})}()},function(){var b=x.bucketSize;w.size?b=w.size():w.length&&(b=w.length);var y=b*x.sigma;u=Math.ceil(y/x.bucketSize),u=Math.max(u,3);for(var T=0;T<u;++T)c.push(new Array(x.bucketSize));var O=Math.ceil(b/x.bucketSize);s=Math.floor(u/2)-Math.floor(O/2),d=s,w.forEach(function(M){return C.pushBack(M)})}(),Object.freeze(this)}Object.defineProperty(R,"__esModule",{value:!0}),x.sigma=3,x.bucketSize=5e3,Object.freeze(x),R.default=x},{}],27:[function(F,$,R){"use strict";var P=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(b){return function(y){return function(T){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&T[0]?a.return:T[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,T[1])).done)return u;switch(a=0,u&&(T=[2&T[0],u.value]),T[0]){case 0:case 1:u=T;break;case 4:return m.label++,{value:T[1],done:!1};case 5:m.label++,a=T[1],T=[0];continue;case 7:T=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(T[0]===6||T[0]===2)){m=0;continue}if(T[0]===3&&(!u||T[1]>u[0]&&T[1]<u[3])){m.label=T[1];break}if(T[0]===6&&m.label<u[1]){m.label=u[1],u=T;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(T);break}u[2]&&m.ops.pop(),m.trys.pop();continue}T=l.call(s,m)}catch(O){T=[6,O],a=0}finally{d=u=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([b,y])}}},x=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(R,"__esModule",{value:!0});var w=F("../LinkList/LinkList"),C=F("../Map/Map");function c(s,l,d){var a=this;if(s===void 0&&(s=[]),l===void 0&&(l=c.initSize),d=d||function(g){var b,y,T=0,O="";if(typeof g=="number")T=((T=Math.floor(g))<<5)-T,T&=T;else{O=typeof g!="string"?JSON.stringify(g):g;try{for(var M=x(O),V=M.next();!V.done;V=M.next())T=(T<<5)-T+V.value.charCodeAt(0),T&=T}catch(N){b={error:N}}finally{try{V&&!V.done&&(y=M.return)&&y.call(M)}finally{if(b)throw b.error}}}return T^=T>>>16},(l&l-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var u=0,v=[],m=Math.max(c.initSize,Math.min(c.maxSize,l));this.size=function(){return u},this.empty=function(){return u===0},this.clear=function(){u=0,m=l,v=[]},this.forEach=function(g){var b=0;v.forEach(function(y){y.forEach(function(T){g(T,b++)})})},this.setElement=function(g,b){var y,T;if(g==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(b!=null){var O=d(g)&m-1;if(v[O]){var M=v[O].size();if(v[O]instanceof w.default){try{for(var V=x(v[O]),N=V.next();!N.done;N=V.next()){var Q=N.value;if(Q.key===g)return void(Q.value=b)}}catch(D){y={error:D}}finally{try{N&&!N.done&&(T=V.return)&&T.call(V)}finally{if(y)throw y.error}}v[O].pushBack({key:g,value:b}),v[O].size()>=c.treeifyThreshold&&(v[O]=new C.default(v[O]))}else v[O].setElement(g,b);var tt=v[O].size();u+=tt-M}else++u,v[O]=new w.default([{key:g,value:b}]);u>m*c.sigma&&function(D){if(!(D>=c.maxSize)){m=2*D;var k=[];v.forEach(function(A,L){if(!A.empty()){if(A instanceof w.default&&A.size()===1){var E=A.front(),q=E.key,J=E.value;k[d(q)&m-1]=new w.default([{key:q,value:J}])}else if(A instanceof C.default){var W=new w.default,z=new w.default;A.forEach(function(_){(d(_.key)&D)==0?W.pushBack(_):z.pushBack(_)}),W.size()>c.untreeifyThreshold?k[L]=new C.default(W):W.size()&&(k[L]=W),z.size()>c.untreeifyThreshold?k[L+D]=new C.default(z):z.size()&&(k[L+D]=z)}else{var K=new w.default,H=new w.default;A.forEach(function(_){(d(_.key)&D)==0?K.pushBack(_):H.pushBack(_)}),K.size()&&(k[L]=K),H.size()&&(k[L+D]=H)}v[L].clear()}}),v=k}}.call(this,m)}else this.eraseElementByKey(g)},this.getElementByKey=function(g){var b,y,T=d(g)&m-1;if(v[T]){if(v[T]instanceof C.default)return v[T].getElementByKey(g);try{for(var O=x(v[T]),M=O.next();!M.done;M=O.next()){var V=M.value;if(V.key===g)return V.value}}catch(N){b={error:N}}finally{try{M&&!M.done&&(y=O.return)&&y.call(O)}finally{if(b)throw b.error}}}},this.eraseElementByKey=function(g){var b,y,T=d(g)&m-1;if(v[T]){var O=v[T].size();if(v[T]instanceof C.default)v[T].eraseElementByKey(g),v[T].size()<=c.untreeifyThreshold&&(v[T]=new w.default(v[T]));else{var M=-1;try{for(var V=x(v[T]),N=V.next();!N.done;N=V.next())if(++M,N.value.key===g){v[T].eraseElementByPos(M);break}}catch(tt){b={error:tt}}finally{try{N&&!N.done&&(y=V.return)&&y.call(V)}finally{if(b)throw b.error}}}var Q=v[T].size();u+=Q-O}},this.find=function(g){var b,y,T=d(g)&m-1;if(!v[T])return!1;if(v[T]instanceof C.default)return v[T].find(g);try{for(var O=x(v[T]),M=O.next();!M.done;M=O.next())if(M.value.key===g)return!0}catch(V){b={error:V}}finally{try{M&&!M.done&&(y=O.return)&&y.call(O)}finally{if(b)throw b.error}}return!1},this[Symbol.iterator]=function(){return function(){var g,b,y,T,O,M;return P(this,function(V){switch(V.label){case 0:g=0,V.label=1;case 1:if(!(g<m))return[3,10];for(;g<m&&!v[g];)++g;if(g>=m)return[3,10];V.label=2;case 2:V.trys.push([2,7,8,9]),O=void 0,b=x(v[g]),y=b.next(),V.label=3;case 3:return y.done?[3,6]:[4,y.value];case 4:V.sent(),V.label=5;case 5:return y=b.next(),[3,3];case 6:return[3,9];case 7:return T=V.sent(),O={error:T},[3,9];case 8:try{y&&!y.done&&(M=b.return)&&M.call(b)}finally{if(O)throw O.error}return[7];case 9:return++g,[3,1];case 10:return[2]}})}()},s.forEach(function(g){var b=g.key,y=g.value;return a.setElement(b,y)}),Object.freeze(this)}c.initSize=16,c.maxSize=1<<30,c.sigma=.75,c.treeifyThreshold=8,c.untreeifyThreshold=6,c.minTreeifySize=64,Object.freeze(c),R.default=c},{"../LinkList/LinkList":29,"../Map/Map":30}],28:[function(F,$,R){"use strict";var P=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(b){return function(y){return function(T){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&T[0]?a.return:T[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,T[1])).done)return u;switch(a=0,u&&(T=[2&T[0],u.value]),T[0]){case 0:case 1:u=T;break;case 4:return m.label++,{value:T[1],done:!1};case 5:m.label++,a=T[1],T=[0];continue;case 7:T=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(T[0]===6||T[0]===2)){m=0;continue}if(T[0]===3&&(!u||T[1]>u[0]&&T[1]<u[3])){m.label=T[1];break}if(T[0]===6&&m.label<u[1]){m.label=u[1],u=T;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(T);break}u[2]&&m.ops.pop(),m.trys.pop();continue}T=l.call(s,m)}catch(O){T=[6,O],a=0}finally{d=u=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([b,y])}}},x=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(R,"__esModule",{value:!0});var w=F("../Set/Set"),C=F("../LinkList/LinkList");function c(s,l,d){var a=this;if(s===void 0&&(s=[]),l===void 0&&(l=c.initSize),d=d||function(g){var b=0,y="";if(typeof g=="number")b=((b=Math.floor(g))<<5)-b,b&=b;else{y=typeof g!="string"?JSON.stringify(g):g;for(var T=0;T<y.length;T++)b=(b<<5)-b+y.charCodeAt(T),b&=b}return b^=b>>>16},(l&l-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var u=0,v=[],m=Math.max(c.initSize,Math.min(c.maxSize,l));this.size=function(){return u},this.empty=function(){return u===0},this.clear=function(){u=0,m=l,v=[]},this.forEach=function(g){var b=0;v.forEach(function(y){y.forEach(function(T){g(T,b++)})})},this.insert=function(g){if(g==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");var b=d(g)&m-1;if(v[b]){var y=v[b].size();if(v[b]instanceof C.default){if(v[b].find(g))return;v[b].pushBack(g),v[b].size()>=c.treeifyThreshold&&(v[b]=new w.default(v[b]))}else v[b].insert(g);var T=v[b].size();u+=T-y}else v[b]=new C.default([g]),++u;u>m*c.sigma&&function(O){if(!(O>=c.maxSize)){m=2*O;var M=[];v.forEach(function(V,N){if(!V.empty()){if(V instanceof C.default&&V.size()===1){var Q=V.front();if(Q===void 0)throw new Error("unknown error");M[d(Q)&m-1]=new C.default([Q])}else if(V instanceof w.default){var tt=new C.default,D=new C.default;V.forEach(function(L){(d(L)&O)==0?tt.pushBack(L):D.pushBack(L)}),tt.size()>c.untreeifyThreshold?M[N]=new w.default(tt):tt.size()&&(M[N]=tt),D.size()>c.untreeifyThreshold?M[N+O]=new w.default(D):D.size()&&(M[N+O]=D)}else{var k=new C.default,A=new C.default;V.forEach(function(L){(d(L)&O)==0?k.pushBack(L):A.pushBack(L)}),k.size()&&(M[N]=k),A.size()&&(M[N+O]=A)}v[N].clear()}}),v=M}}.call(this,m)},this.eraseElementByValue=function(g){var b=d(g)&m-1;if(v[b]){var y=v[b].size();v[b].eraseElementByValue(g),v[b]instanceof w.default&&v[b].size()<=c.untreeifyThreshold&&(v[b]=new C.default(v[b]));var T=v[b].size();u+=T-y}},this.find=function(g){var b=d(g)&m-1;return!!v[b]&&v[b].find(g)},this[Symbol.iterator]=function(){return function(){var g,b,y,T,O,M;return P(this,function(V){switch(V.label){case 0:g=0,V.label=1;case 1:if(!(g<m))return[3,10];for(;g<m&&!v[g];)++g;if(g>=m)return[3,10];V.label=2;case 2:V.trys.push([2,7,8,9]),O=void 0,b=x(v[g]),y=b.next(),V.label=3;case 3:return y.done?[3,6]:[4,y.value];case 4:V.sent(),V.label=5;case 5:return y=b.next(),[3,3];case 6:return[3,9];case 7:return T=V.sent(),O={error:T},[3,9];case 8:try{y&&!y.done&&(M=b.return)&&M.call(b)}finally{if(O)throw O.error}return[7];case 9:return++g,[3,1];case 10:return[2]}})}()},s.forEach(function(g){return a.insert(g)}),Object.freeze(this)}c.initSize=16,c.maxSize=1<<30,c.sigma=.75,c.treeifyThreshold=8,c.untreeifyThreshold=6,c.minTreeifySize=64,Object.freeze(c),R.default=c},{"../LinkList/LinkList":29,"../Set/Set":33}],29:[function(F,$,R){"use strict";var P=this&&this.__generator||function(C,c){var s,l,d,a,u={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return a={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function v(m){return function(g){return function(b){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,l&&(d=2&b[0]?l.return:b[0]?l.throw||((d=l.return)&&d.call(l),0):l.next)&&!(d=d.call(l,b[1])).done)return d;switch(l=0,d&&(b=[2&b[0],d.value]),b[0]){case 0:case 1:d=b;break;case 4:return u.label++,{value:b[1],done:!1};case 5:u.label++,l=b[1],b=[0];continue;case 7:b=u.ops.pop(),u.trys.pop();continue;default:if(!(d=(d=u.trys).length>0&&d[d.length-1])&&(b[0]===6||b[0]===2)){u=0;continue}if(b[0]===3&&(!d||b[1]>d[0]&&b[1]<d[3])){u.label=b[1];break}if(b[0]===6&&u.label<d[1]){u.label=d[1],d=b;break}if(d&&u.label<d[2]){u.label=d[2],u.ops.push(b);break}d[2]&&u.ops.pop(),u.trys.pop();continue}b=c.call(C,u)}catch(y){b=[6,y],l=0}finally{s=d=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([m,g])}}};Object.defineProperty(R,"__esModule",{value:!0});var x=function(){return function(C){this.value=void 0,this.pre=void 0,this.next=void 0,this.value=C}}();function w(C){var c=this;C===void 0&&(C=[]);var s=0,l=void 0,d=void 0;this.size=function(){return s},this.empty=function(){return s===0},this.clear=function(){l=d=void 0,s=0},this.front=function(){return l==null?void 0:l.value},this.back=function(){return d==null?void 0:d.value},this.forEach=function(a){for(var u=l,v=0;u;){if(u.value===void 0)throw new Error("unknown error");a(u.value,v++),u=u.next}},this.getElementByPos=function(a){if(a<0||a>=s)throw new Error("pos must more then 0 and less then the list length");for(var u=l;a--&&u;)u=u.next;if(!u||u.value===void 0)throw new Error("unknown error");return u.value},this.eraseElementByPos=function(a){if(a<0||a>=s)throw new Error("erase pos must more then 0 and less then the list length");if(a===0)this.popFront();else if(a===s-1)this.popBack();else{for(var u=l;a--;){if(!(u==null?void 0:u.next))throw new Error("unknown error");u=u.next}if(!u||!u.pre||!u.next)throw new Error("unknown error");var v=u.pre,m=u.next;m.pre=v,v.next=m,s>0&&--s}},this.eraseElementByValue=function(a){for(;l&&l.value===a;)this.popFront();for(;d&&d.value===a;)this.popBack();if(l)for(var u=l;u;){if(u.value===a){var v=u.pre,m=u.next;m&&(m.pre=v),v&&(v.next=m),s>0&&--s}u=u.next}},this.pushBack=function(a){if(a==null)throw new Error("you can't push null or undefined here");++s;var u=new x(a);d?(d.next=u,u.pre=d,d=u):l=d=u},this.popBack=function(){d&&(s>0&&--s,d&&(l===d?l=d=void 0:(d=d.pre)&&(d.next=void 0)))},this.setElementByPos=function(a,u){if(u==null)throw new Error("you can't set null or undefined here");if(a<0||a>=s)throw new Error("pos must more then 0 and less then the list length");for(var v=l;a--;){if(!v)throw new Error("unknown error");v=v.next}v&&(v.value=u)},this.insert=function(a,u,v){if(v===void 0&&(v=1),u==null)throw new Error("you can't insert null or undefined here");if(a<0||a>s)throw new Error("insert pos must more then 0 and less then or equal to the list length");if(v<0)throw new Error("insert size must more than 0");if(a===0)for(;v--;)this.pushFront(u);else if(a===s)for(;v--;)this.pushBack(u);else{for(var m=l,g=1;g<a;++g){if(!(m==null?void 0:m.next))throw new Error("unknown error");m=m==null?void 0:m.next}if(!m)throw new Error("unknown error");var b=m.next;for(s+=v;v--;)m.next=new x(u),m.next.pre=m,m=m.next;m.next=b,b&&(b.pre=m)}},this.find=function(a){for(var u=l;u;){if(u.value===a)return!0;u=u.next}return!1},this.reverse=function(){for(var a=l,u=d,v=0;a&&u&&2*v<s;){var m=a.value;a.value=u.value,u.value=m,a=a.next,u=u.pre,++v}},this.unique=function(){for(var a=l;a;){for(var u=a;u&&u.next&&u.value===u.next.value;)u=u.next,s>0&&--s;a.next=u.next,a.next&&(a.next.pre=a),a=a.next}},this.sort=function(a){var u=[];this.forEach(function(m){u.push(m)}),u.sort(a);var v=l;u.forEach(function(m){v&&(v.value=m,v=v.next)})},this.pushFront=function(a){if(a==null)throw new Error("you can't push null or undefined here");++s;var u=new x(a);l?(u.next=l,l.pre=u,l=u):l=d=u},this.popFront=function(){l&&(s>0&&--s,l&&(l===d?l=d=void 0:(l=l.next)&&(l.pre=void 0)))},this.merge=function(a){var u=this,v=l;a.forEach(function(m){for(;v&&v.value!==void 0&&v.value<=m;)v=v.next;if(v===void 0)u.pushBack(m),v=d;else if(v===l)u.pushFront(m),v=l;else{++s;var g=v.pre;g&&(g.next=new x(m),g.next.pre=g,g.next.next=v,v&&(v.pre=g.next))}})},this[Symbol.iterator]=function(){return function(){var a;return P(this,function(u){switch(u.label){case 0:a=l,u.label=1;case 1:if(a===void 0)return[3,3];if(!a.value)throw new Error("unknown error");return[4,a.value];case 2:return u.sent(),a=a.next,[3,1];case 3:return[2]}})}()},C.forEach(function(a){return c.pushBack(a)}),Object.freeze(this)}Object.freeze(w),R.default=w},{}],30:[function(F,$,R){"use strict";var P=this&&this.__generator||function(c,s){var l,d,a,u,v={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(g){return function(b){return function(y){if(l)throw new TypeError("Generator is already executing.");for(;v;)try{if(l=1,d&&(a=2&y[0]?d.return:y[0]?d.throw||((a=d.return)&&a.call(d),0):d.next)&&!(a=a.call(d,y[1])).done)return a;switch(d=0,a&&(y=[2&y[0],a.value]),y[0]){case 0:case 1:a=y;break;case 4:return v.label++,{value:y[1],done:!1};case 5:v.label++,d=y[1],y=[0];continue;case 7:y=v.ops.pop(),v.trys.pop();continue;default:if(!(a=(a=v.trys).length>0&&a[a.length-1])&&(y[0]===6||y[0]===2)){v=0;continue}if(y[0]===3&&(!a||y[1]>a[0]&&y[1]<a[3])){v.label=y[1];break}if(y[0]===6&&v.label<a[1]){v.label=a[1],a=y;break}if(a&&v.label<a[2]){v.label=a[2],v.ops.push(y);break}a[2]&&v.ops.pop(),v.trys.pop();continue}y=s.call(c,v)}catch(T){y=[6,T],d=0}finally{l=a=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([g,b])}}},x=this&&this.__values||function(c){var s=typeof Symbol=="function"&&Symbol.iterator,l=s&&c[s],d=0;if(l)return l.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(R,"__esModule",{value:!0});var w=F("../Base/TreeNode");function C(c,s){var l=this;c===void 0&&(c=[]),s=s||function(D,k){return D<k?-1:D>k?1:0};var d=0,a=new w.default;a.color=w.default.TreeNodeColorType.black,this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.key=a.value=void 0,a.leftChild=a.rightChild=a.brother=void 0};var u=function D(k){if(!k||k.key===void 0)throw new Error("unknown error");return k.leftChild?D(k.leftChild):k},v=function D(k){if(!k||k.key===void 0)throw new Error("unknown error");return k.rightChild?D(k.rightChild):k};this.front=function(){if(!this.empty()){var D=u(a);if(D.key===void 0||D.value===void 0)throw new Error("unknown error");return{key:D.key,value:D.value}}},this.back=function(){if(!this.empty()){var D=v(a);if(D.key===void 0||D.value===void 0)throw new Error("unknown error");return{key:D.key,value:D.value}}},this.forEach=function(D){var k,A,L=0;try{for(var E=x(this),q=E.next();!q.done;q=E.next())D(q.value,L++)}catch(J){k={error:J}}finally{try{q&&!q.done&&(A=E.return)&&A.call(E)}finally{if(k)throw k.error}}},this.getElementByPos=function(D){var k,A;if(D<0||D>=this.size())throw new Error("pos must more than 0 and less than set's size");var L=0;try{for(var E=x(this),q=E.next();!q.done;q=E.next()){var J=q.value;if(L===D)return J;++L}}catch(W){k={error:W}}finally{try{q&&!q.done&&(A=E.return)&&A.call(E)}finally{if(k)throw k.error}}throw new Error("unknown Error")};var m=function D(k,A){if(k&&k.key!==void 0&&k.value!==void 0){var L=s(k.key,A);return L===0?{key:k.key,value:k.value}:L<0?D(k.rightChild,A):D(k.leftChild,A)||{key:k.key,value:k.value}}};this.lowerBound=function(D){return m(a,D)};var g=function D(k,A){if(k&&k.key!==void 0&&k.value!==void 0)return s(k.key,A)<=0?D(k.rightChild,A):D(k.leftChild,A)||{key:k.key,value:k.value}};this.upperBound=function(D){return g(a,D)};var b=function D(k,A){if(k&&k.key!==void 0&&k.value!==void 0){var L=s(k.key,A);return L===0?{key:k.key,value:k.value}:L>0?D(k.leftChild,A):D(k.rightChild,A)||{key:k.key,value:k.value}}};this.reverseLowerBound=function(D){return b(a,D)};var y=function D(k,A){if(k&&k.key!==void 0&&k.value!==void 0)return s(k.key,A)>=0?D(k.leftChild,A):D(k.rightChild,A)||{key:k.key,value:k.value}};this.reverseUpperBound=function(D){return y(a,D)};var T=function D(k){var A=k.parent;if(!A){if(k===a)return;throw new Error("unknown error")}if(k.color!==w.default.TreeNodeColorType.red){var L=k.brother;if(!L)throw new Error("unknown error");if(k===A.leftChild)if(L.color===w.default.TreeNodeColorType.red){L.color=w.default.TreeNodeColorType.black,A.color=w.default.TreeNodeColorType.red;var E=A.rotateLeft();a===A&&(a=E),D(k)}else L.color===w.default.TreeNodeColorType.black&&(L.rightChild&&L.rightChild.color===w.default.TreeNodeColorType.red?(L.color=A.color,A.color=w.default.TreeNodeColorType.black,L.rightChild&&(L.rightChild.color=w.default.TreeNodeColorType.black),E=A.rotateLeft(),a===A&&(a=E),k.color=w.default.TreeNodeColorType.black):L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||!L.leftChild||L.leftChild.color!==w.default.TreeNodeColorType.red?L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||(L.color=w.default.TreeNodeColorType.red,D(A)):(L.color=w.default.TreeNodeColorType.red,L.leftChild&&(L.leftChild.color=w.default.TreeNodeColorType.black),E=L.rotateRight(),a===L&&(a=E),D(k)));else k===A.rightChild&&(L.color===w.default.TreeNodeColorType.red?(L.color=w.default.TreeNodeColorType.black,A.color=w.default.TreeNodeColorType.red,E=A.rotateRight(),a===A&&(a=E),D(k)):L.color===w.default.TreeNodeColorType.black&&(L.leftChild&&L.leftChild.color===w.default.TreeNodeColorType.red?(L.color=A.color,A.color=w.default.TreeNodeColorType.black,L.leftChild&&(L.leftChild.color=w.default.TreeNodeColorType.black),E=A.rotateRight(),a===A&&(a=E),k.color=w.default.TreeNodeColorType.black):L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||!L.rightChild||L.rightChild.color!==w.default.TreeNodeColorType.red?L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||(L.color=w.default.TreeNodeColorType.red,D(A)):(L.color=w.default.TreeNodeColorType.red,L.rightChild&&(L.rightChild.color=w.default.TreeNodeColorType.black),E=L.rotateLeft(),a===L&&(a=E),D(k))))}else k.color=w.default.TreeNodeColorType.black},O=function(k){for(var A=k;A.leftChild||A.rightChild;){if(A.rightChild){A=u(A.rightChild);var L=k.key;k.key=A.key,A.key=L;var E=k.value;k.value=A.value,A.value=E,k=A}A.leftChild&&(A=v(A.leftChild),L=k.key,k.key=A.key,A.key=L,E=k.value,k.value=A.value,A.value=E,k=A)}T(A),A&&A.remove(),--d,a.color=w.default.TreeNodeColorType.black},M=function D(k,A){return!(!k||k.key===void 0)&&(!!D(k.leftChild,A)||!!A(k)||D(k.rightChild,A))};this.eraseElementByPos=function(D){if(D<0||D>=d)throw new Error("pos must more than 0 and less than set's size");var k=0;M(a,function(A){return D===k?(O(A),!0):(++k,!1)})},this.eraseElementByKey=function(D){if(!this.empty()){var k=Q(a,D);k!==void 0&&k.key!==void 0&&s(k.key,D)===0&&O(k)}};var V=function D(k,A){if(!k||k.key===void 0)throw new Error("unknown error");var L=s(A,k.key);return L<0?k.leftChild?D(k.leftChild,A):(k.leftChild=new w.default,k.leftChild.parent=k,k.leftChild.brother=k.rightChild,k.rightChild&&(k.rightChild.brother=k.leftChild),k.leftChild):L>0?k.rightChild?D(k.rightChild,A):(k.rightChild=new w.default,k.rightChild.parent=k,k.rightChild.brother=k.leftChild,k.leftChild&&(k.leftChild.brother=k.rightChild),k.rightChild):k},N=function D(k){var A=k.parent;if(!A){if(k===a)return;throw new Error("unknown error")}if(A.color!==w.default.TreeNodeColorType.black&&A.color===w.default.TreeNodeColorType.red){var L=A.brother,E=A.parent;if(!E)throw new Error("unknown error");if(L&&L.color===w.default.TreeNodeColorType.red)L.color=A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red,D(E);else if(!L||L.color===w.default.TreeNodeColorType.black)if(A===E.leftChild)if(k===A.leftChild){A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red;var q=E.rotateRight();E===a&&(a=q)}else k===A.rightChild&&(q=A.rotateLeft(),E===a&&(a=q),D(A));else A===E.rightChild&&(k===A.leftChild?(q=A.rotateRight(),E===a&&(a=q),D(A)):k===A.rightChild&&(A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red,q=E.rotateLeft(),E===a&&(a=q)))}};this.setElement=function(D,k){if(D==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(k!=null){if(this.empty())return++d,a.key=D,a.value=k,void(a.color=w.default.TreeNodeColorType.black);var A=V(a,D);A.key===void 0||s(A.key,D)!==0?(++d,A.key=D,A.value=k,N(A),a.color=w.default.TreeNodeColorType.black):A.value=k}else this.eraseElementByKey(D)};var Q=function D(k,A){if(k&&k.key!==void 0){var L=s(A,k.key);return L<0?D(k.leftChild,A):L>0?D(k.rightChild,A):k}};this.find=function(D){return!!Q(a,D)},this.getElementByKey=function(D){var k=Q(a,D);if((k==null?void 0:k.key)===void 0||(k==null?void 0:k.value)===void 0)throw new Error("unknown error");return k.value},this.union=function(D){var k=this;D.forEach(function(A){var L=A.key,E=A.value;return k.setElement(L,E)})},this.getHeight=function(){if(this.empty())return 0;var D=function k(A){return A?Math.max(k(A.leftChild),k(A.rightChild))+1:1};return D(a)};var tt=function D(k){return P(this,function(A){switch(A.label){case 0:return k&&k.key!==void 0&&k.value!==void 0?[5,x(D(k.leftChild))]:[2];case 1:return A.sent(),[4,{key:k.key,value:k.value}];case 2:return A.sent(),[5,x(D(k.rightChild))];case 3:return A.sent(),[2]}})};this[Symbol.iterator]=function(){return tt(a)},c.forEach(function(D){var k=D.key,A=D.value;return l.setElement(k,A)}),Object.freeze(this)}Object.freeze(C),R.default=C},{"../Base/TreeNode":25}],31:[function(F,$,R){"use strict";function P(x,w){x===void 0&&(x=[]),w=w||function(d,a){return d>a?-1:d<a?1:0};var C=[];x.forEach(function(d){return C.push(d)});var c=C.length,s=function(a,u){if(a<0||a>=c)throw new Error("unknown error");if(u<0||u>=c)throw new Error("unknown error");var v=C[a];C[a]=C[u],C[u]=v},l=function(a){if(a<0||a>=c)throw new Error("unknown error");var u=2*a+1,v=2*a+2;u<c&&w(C[a],C[u])>0&&s(a,u),v<c&&w(C[a],C[v])>0&&s(a,v)};(function(){for(var d=Math.floor((c-1)/2);d>=0;--d)for(var a=d,u=2*a+1;u<c;){var v=u+1,m=u;if(v<c&&w(C[u],C[v])>0&&(m=v),w(C[a],C[m])<=0)break;s(a,m),u=2*(a=m)+1}})(),this.size=function(){return c},this.empty=function(){return c===0},this.clear=function(){c=0,C.length=0},this.push=function(d){if(C.push(d),++c!=1)for(var a=c-1;a>0;){var u=Math.floor((a-1)/2);if(w(C[u],d)<=0)break;l(u),a=u}},this.pop=function(){if(!this.empty())if(this.size()!==1){var d=C[c-1];--c;for(var a=0;a<this.size();){var u=2*a+1,v=2*a+2;if(u>=this.size())break;var m=u;if(v<this.size()&&w(C[u],C[v])>0&&(m=v),w(C[m],d)>=0)break;C[a]=C[m],a=m}C[a]=d}else--c},this.top=function(){return C[0]},Object.freeze(this)}Object.defineProperty(R,"__esModule",{value:!0}),Object.freeze(P),R.default=P},{}],32:[function(F,$,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var P=F("../LinkList/LinkList");function x(w){w===void 0&&(w=[]);var C=new P.default(w);this.size=function(){return C.size()},this.empty=function(){return C.empty()},this.clear=function(){C.clear()},this.push=function(c){C.pushBack(c)},this.pop=function(){C.popFront()},this.front=function(){return C.front()},Object.freeze(this)}Object.freeze(x),R.default=x},{"../LinkList/LinkList":29}],33:[function(F,$,R){"use strict";var P=this&&this.__generator||function(c,s){var l,d,a,u,v={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(g){return function(b){return function(y){if(l)throw new TypeError("Generator is already executing.");for(;v;)try{if(l=1,d&&(a=2&y[0]?d.return:y[0]?d.throw||((a=d.return)&&a.call(d),0):d.next)&&!(a=a.call(d,y[1])).done)return a;switch(d=0,a&&(y=[2&y[0],a.value]),y[0]){case 0:case 1:a=y;break;case 4:return v.label++,{value:y[1],done:!1};case 5:v.label++,d=y[1],y=[0];continue;case 7:y=v.ops.pop(),v.trys.pop();continue;default:if(!(a=(a=v.trys).length>0&&a[a.length-1])&&(y[0]===6||y[0]===2)){v=0;continue}if(y[0]===3&&(!a||y[1]>a[0]&&y[1]<a[3])){v.label=y[1];break}if(y[0]===6&&v.label<a[1]){v.label=a[1],a=y;break}if(a&&v.label<a[2]){v.label=a[2],v.ops.push(y);break}a[2]&&v.ops.pop(),v.trys.pop();continue}y=s.call(c,v)}catch(T){y=[6,T],d=0}finally{l=a=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([g,b])}}},x=this&&this.__values||function(c){var s=typeof Symbol=="function"&&Symbol.iterator,l=s&&c[s],d=0;if(l)return l.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(R,"__esModule",{value:!0});var w=F("../Base/TreeNode");function C(c,s){var l=this;c===void 0&&(c=[]),s=s||function(D,k){return D<k?-1:D>k?1:0};var d=0,a=new w.default;a.color=w.default.TreeNodeColorType.black,this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.key=void 0,a.leftChild=a.rightChild=a.brother=a.parent=void 0,a.color=w.default.TreeNodeColorType.black};var u=function D(k){if(!k||k.key===void 0)throw new Error("unknown error");return k.leftChild?D(k.leftChild):k},v=function D(k){if(!k||k.key===void 0)throw new Error("unknown error");return k.rightChild?D(k.rightChild):k};this.front=function(){if(!this.empty())return u(a).key},this.back=function(){if(!this.empty())return v(a).key},this.forEach=function(D){var k,A,L=0;try{for(var E=x(this),q=E.next();!q.done;q=E.next())D(q.value,L++)}catch(J){k={error:J}}finally{try{q&&!q.done&&(A=E.return)&&A.call(E)}finally{if(k)throw k.error}}},this.getElementByPos=function(D){var k,A;if(D<0||D>=this.size())throw new Error("pos must more than 0 and less than set's size");var L=0;try{for(var E=x(this),q=E.next();!q.done;q=E.next()){var J=q.value;if(L===D)return J;++L}}catch(W){k={error:W}}finally{try{q&&!q.done&&(A=E.return)&&A.call(E)}finally{if(k)throw k.error}}throw new Error("unknown error")};var m=function D(k){var A=k.parent;if(!A){if(k===a)return;throw new Error("unknown error")}if(k.color!==w.default.TreeNodeColorType.red){var L=k.brother;if(!L)throw new Error("unknown error");if(k===A.leftChild)if(L.color===w.default.TreeNodeColorType.red){L.color=w.default.TreeNodeColorType.black,A.color=w.default.TreeNodeColorType.red;var E=A.rotateLeft();a===A&&(a=E),D(k)}else L.color===w.default.TreeNodeColorType.black&&(L.rightChild&&L.rightChild.color===w.default.TreeNodeColorType.red?(L.color=A.color,A.color=w.default.TreeNodeColorType.black,L.rightChild&&(L.rightChild.color=w.default.TreeNodeColorType.black),E=A.rotateLeft(),a===A&&(a=E),k.color=w.default.TreeNodeColorType.black):L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||!L.leftChild||L.leftChild.color!==w.default.TreeNodeColorType.red?L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||(L.color=w.default.TreeNodeColorType.red,D(A)):(L.color=w.default.TreeNodeColorType.red,L.leftChild&&(L.leftChild.color=w.default.TreeNodeColorType.black),E=L.rotateRight(),a===L&&(a=E),D(k)));else k===A.rightChild&&(L.color===w.default.TreeNodeColorType.red?(L.color=w.default.TreeNodeColorType.black,A.color=w.default.TreeNodeColorType.red,E=A.rotateRight(),a===A&&(a=E),D(k)):L.color===w.default.TreeNodeColorType.black&&(L.leftChild&&L.leftChild.color===w.default.TreeNodeColorType.red?(L.color=A.color,A.color=w.default.TreeNodeColorType.black,L.leftChild&&(L.leftChild.color=w.default.TreeNodeColorType.black),E=A.rotateRight(),a===A&&(a=E),k.color=w.default.TreeNodeColorType.black):L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||!L.rightChild||L.rightChild.color!==w.default.TreeNodeColorType.red?L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||(L.color=w.default.TreeNodeColorType.red,D(A)):(L.color=w.default.TreeNodeColorType.red,L.rightChild&&(L.rightChild.color=w.default.TreeNodeColorType.black),E=L.rotateLeft(),a===L&&(a=E),D(k))))}else k.color=w.default.TreeNodeColorType.black},g=function(k){for(var A=k;A.leftChild||A.rightChild;){if(A.rightChild){A=u(A.rightChild);var L=k.key;k.key=A.key,A.key=L,k=A}A.leftChild&&(A=v(A.leftChild),L=k.key,k.key=A.key,A.key=L,k=A)}m(A),A&&A.remove(),--d,a.color=w.default.TreeNodeColorType.black},b=function D(k,A){return!(!k||k.key===void 0)&&(!!D(k.leftChild,A)||!!A(k)||D(k.rightChild,A))};this.eraseElementByPos=function(D){if(D<0||D>=d)throw new Error("pos must more than 0 and less than set's size");var k=0;b(a,function(A){return D===k?(g(A),!0):(++k,!1)})},this.eraseElementByValue=function(D){if(!this.empty()){var k=O(a,D);k!==void 0&&k.key!==void 0&&s(k.key,D)===0&&g(k)}};var y=function D(k,A){if(!k||k.key===void 0)throw new Error("unknown error");var L=s(A,k.key);return L<0?k.leftChild?D(k.leftChild,A):(k.leftChild=new w.default,k.leftChild.parent=k,k.leftChild.brother=k.rightChild,k.rightChild&&(k.rightChild.brother=k.leftChild),k.leftChild):L>0?k.rightChild?D(k.rightChild,A):(k.rightChild=new w.default,k.rightChild.parent=k,k.rightChild.brother=k.leftChild,k.leftChild&&(k.leftChild.brother=k.rightChild),k.rightChild):k},T=function D(k){var A=k.parent;if(!A){if(k===a)return;throw new Error("unknown error")}if(A.color!==w.default.TreeNodeColorType.black&&A.color===w.default.TreeNodeColorType.red){var L=A.brother,E=A.parent;if(!E)throw new Error("unknown error");if(L&&L.color===w.default.TreeNodeColorType.red)L.color=A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red,D(E);else if(!L||L.color===w.default.TreeNodeColorType.black)if(A===E.leftChild)if(k===A.leftChild){A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red;var q=E.rotateRight();E===a&&(a=q)}else k===A.rightChild&&(q=A.rotateLeft(),E===a&&(a=q),D(A));else A===E.rightChild&&(k===A.leftChild?(q=A.rotateRight(),E===a&&(a=q),D(A)):k===A.rightChild&&(A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red,q=E.rotateLeft(),E===a&&(a=q)))}};this.insert=function(D){if(D==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty())return++d,a.key=D,void(a.color=w.default.TreeNodeColorType.black);var k=y(a,D);k.key!==void 0&&s(k.key,D)===0||(++d,k.key=D,T(k),a.color=w.default.TreeNodeColorType.black)};var O=function D(k,A){if(k&&k.key!==void 0){var L=s(A,k.key);return L<0?D(k.leftChild,A):L>0?D(k.rightChild,A):k}};this.find=function(D){var k=O(a,D);return k!==void 0&&k.key!==void 0&&s(k.key,D)===0};var M=function D(k,A){if(k&&k.key!==void 0){var L=s(k.key,A);if(L===0)return k.key;if(L<0)return D(k.rightChild,A);var E=D(k.leftChild,A);return E!==void 0?E:k.key}};this.lowerBound=function(D){return M(a,D)};var V=function D(k,A){if(k&&k.key!==void 0){if(s(k.key,A)<=0)return D(k.rightChild,A);var L=D(k.leftChild,A);return L!==void 0?L:k.key}};this.upperBound=function(D){return V(a,D)};var N=function D(k,A){if(k&&k.key!==void 0){var L=s(k.key,A);if(L===0)return k.key;if(L>0)return D(k.leftChild,A);var E=D(k.rightChild,A);return E!==void 0?E:k.key}};this.reverseLowerBound=function(D){return N(a,D)};var Q=function D(k,A){if(k&&k.key!==void 0){if(s(k.key,A)>=0)return D(k.leftChild,A);var L=D(k.rightChild,A);return L!==void 0?L:k.key}};this.reverseUpperBound=function(D){return Q(a,D)},this.union=function(D){var k=this;D.forEach(function(A){return k.insert(A)})},this.getHeight=function(){if(this.empty())return 0;var D=function k(A){return A?Math.max(k(A.leftChild),k(A.rightChild))+1:1};return D(a)};var tt=function D(k){return P(this,function(A){switch(A.label){case 0:return k&&k.key!==void 0?[5,x(D(k.leftChild))]:[2];case 1:return A.sent(),[4,k.key];case 2:return A.sent(),[5,x(D(k.rightChild))];case 3:return A.sent(),[2]}})};this[Symbol.iterator]=function(){return tt(a)},c.forEach(function(D){return l.insert(D)}),Object.freeze(this)}Object.freeze(C),R.default=C},{"../Base/TreeNode":25}],34:[function(F,$,R){"use strict";function P(x){var w=this;x===void 0&&(x=[]);var C=0,c=[];this.size=function(){return C},this.empty=function(){return C===0},this.clear=function(){C=0,c.length=0},this.push=function(s){c.push(s),++C},this.pop=function(){c.pop(),C>0&&--C},this.top=function(){return c[C-1]},x.forEach(function(s){return w.push(s)}),Object.freeze(this)}Object.defineProperty(R,"__esModule",{value:!0}),Object.freeze(P),R.default=P},{}],35:[function(F,$,R){"use strict";var P=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(b){return function(y){return function(T){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&T[0]?a.return:T[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,T[1])).done)return u;switch(a=0,u&&(T=[2&T[0],u.value]),T[0]){case 0:case 1:u=T;break;case 4:return m.label++,{value:T[1],done:!1};case 5:m.label++,a=T[1],T=[0];continue;case 7:T=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(T[0]===6||T[0]===2)){m=0;continue}if(T[0]===3&&(!u||T[1]>u[0]&&T[1]<u[3])){m.label=T[1];break}if(T[0]===6&&m.label<u[1]){m.label=u[1],u=T;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(T);break}u[2]&&m.ops.pop(),m.trys.pop();continue}T=l.call(s,m)}catch(O){T=[6,O],a=0}finally{d=u=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([b,y])}}},x=this&&this.__read||function(s,l){var d=typeof Symbol=="function"&&s[Symbol.iterator];if(!d)return s;var a,u,v=d.call(s),m=[];try{for(;(l===void 0||l-- >0)&&!(a=v.next()).done;)m.push(a.value)}catch(g){u={error:g}}finally{try{a&&!a.done&&(d=v.return)&&d.call(v)}finally{if(u)throw u.error}}return m},w=this&&this.__spreadArray||function(s,l,d){if(d||arguments.length===2)for(var a,u=0,v=l.length;u<v;u++)!a&&u in l||(a||(a=Array.prototype.slice.call(l,0,u)),a[u]=l[u]);return s.concat(a||Array.prototype.slice.call(l))},C=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};function c(s){var l=this;s===void 0&&(s=[]);var d=0,a=[];this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.length=0},this.front=function(){if(!this.empty())return a[0]},this.back=function(){if(!this.empty())return a[d-1]},this.forEach=function(u){a.forEach(u)},this.getElementByPos=function(u){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");return a[u]},this.eraseElementByPos=function(u){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");for(var v=u;v<d-1;++v)a[v]=a[v+1];this.popBack()},this.eraseElementByValue=function(u){var v=[];this.forEach(function(g){g!==u&&v.push(g)}),v.forEach(function(g,b){a[b]=g});for(var m=v.length;d>m;)this.popBack()},this.pushBack=function(u){a.push(u),++d},this.popBack=function(){a.pop(),d>0&&--d},this.setElementByPos=function(u,v){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");a[u]=v},this.insert=function(u,v,m){if(m===void 0&&(m=1),u<0||u>d)throw new Error("pos must more than 0 and less than or equal to vector's size");a.splice.apply(a,w([u,0],x(new Array(m).fill(v)),!1)),d+=m},this.find=function(u){return a.includes(u)},this.reverse=function(){a.reverse()},this.unique=function(){var u,v=[];this.forEach(function(g,b){b!==0&&g===u||(v.push(g),u=g)}),v.forEach(function(g,b){a[b]=g});for(var m=v.length;d>m;)this.popBack()},this.sort=function(u){a.sort(u)},this[Symbol.iterator]=function(){return function(){return P(this,function(u){switch(u.label){case 0:return[5,C(a)];case 1:return[2,u.sent()]}})}()},s.forEach(function(u){return l.pushBack(u)}),Object.freeze(this)}Object.defineProperty(R,"__esModule",{value:!0}),Object.freeze(c),R.default=c},{}],36:[function(F,$,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.HashMap=R.HashSet=R.Map=R.Set=R.PriorityQueue=R.Deque=R.LinkList=R.Queue=R.Stack=R.Vector=void 0;var P=F("./Vector/Vector");R.Vector=P.default;var x=F("./Stack/Stack");R.Stack=x.default;var w=F("./Queue/Queue");R.Queue=w.default;var C=F("./LinkList/LinkList");R.LinkList=C.default;var c=F("./Deque/Deque");R.Deque=c.default;var s=F("./PriorityQueue/PriorityQueue");R.PriorityQueue=s.default;var l=F("./Set/Set");R.Set=l.default;var d=F("./Map/Map");R.Map=d.default;var a=F("./HashSet/HashSet");R.HashSet=a.default;var u=F("./HashMap/HashMap");R.HashMap=u.default},{"./Deque/Deque":26,"./HashMap/HashMap":27,"./HashSet/HashSet":28,"./LinkList/LinkList":29,"./Map/Map":30,"./PriorityQueue/PriorityQueue":31,"./Queue/Queue":32,"./Set/Set":33,"./Stack/Stack":34,"./Vector/Vector":35}],37:[function(F,$,R){"use strict";var P=F("yallist"),x=Symbol("max"),w=Symbol("length"),C=Symbol("lengthCalculator"),c=Symbol("allowStale"),s=Symbol("maxAge"),l=Symbol("dispose"),d=Symbol("noDisposeOnSet"),a=Symbol("lruList"),u=Symbol("cache"),v=Symbol("updateAgeOnGet"),m=function(){return 1},g=function(N,Q,tt){var D=N[u].get(Q);if(D){var k=D.value;if(b(N,k)){if(T(N,D),!N[c])return}else tt&&(N[v]&&(D.value.now=Date.now()),N[a].unshiftNode(D));return k.value}},b=function(N,Q){if(!Q||!Q.maxAge&&!N[s])return!1;var tt=Date.now()-Q.now;return Q.maxAge?tt>Q.maxAge:N[s]&&tt>N[s]},y=function(N){if(N[w]>N[x])for(var Q=N[a].tail;N[w]>N[x]&&Q!==null;){var tt=Q.prev;T(N,Q),Q=tt}},T=function(N,Q){if(Q){var tt=Q.value;N[l]&&N[l](tt.key,tt.value),N[w]-=tt.length,N[u].delete(tt.key),N[a].removeNode(Q)}},O=function V(N,Q,tt,D,k){Tt(this,V),this.key=N,this.value=Q,this.length=tt,this.now=D,this.maxAge=k||0},M=function(N,Q,tt,D){var k=tt.value;b(N,k)&&(T(N,tt),N[c]||(k=void 0)),k&&Q.call(D,k.value,k.key,N)};$.exports=function(){function V(N){if(Tt(this,V),typeof N=="number"&&(N={max:N}),N||(N={}),N.max&&(typeof N.max!="number"||N.max<0))throw new TypeError("max must be a non-negative number");this[x]=N.max||1/0;var Q=N.length||m;if(this[C]=typeof Q!="function"?m:Q,this[c]=N.stale||!1,N.maxAge&&typeof N.maxAge!="number")throw new TypeError("maxAge must be a number");this[s]=N.maxAge||0,this[l]=N.dispose,this[d]=N.noDisposeOnSet||!1,this[v]=N.updateAgeOnGet||!1,this.reset()}return wt(V,[{key:"max",get:function(){return this[x]},set:function(Q){if(typeof Q!="number"||Q<0)throw new TypeError("max must be a non-negative number");this[x]=Q||1/0,y(this)}},{key:"allowStale",get:function(){return this[c]},set:function(Q){this[c]=!!Q}},{key:"maxAge",get:function(){return this[s]},set:function(Q){if(typeof Q!="number")throw new TypeError("maxAge must be a non-negative number");this[s]=Q,y(this)}},{key:"lengthCalculator",get:function(){return this[C]},set:function(Q){var tt=this;typeof Q!="function"&&(Q=m),Q!==this[C]&&(this[C]=Q,this[w]=0,this[a].forEach(function(D){D.length=tt[C](D.value,D.key),tt[w]+=D.length})),y(this)}},{key:"length",get:function(){return this[w]}},{key:"itemCount",get:function(){return this[a].length}},{key:"rforEach",value:function(Q,tt){tt=tt||this;for(var D=this[a].tail;D!==null;){var k=D.prev;M(this,Q,D,tt),D=k}}},{key:"forEach",value:function(Q,tt){tt=tt||this;for(var D=this[a].head;D!==null;){var k=D.next;M(this,Q,D,tt),D=k}}},{key:"keys",value:function(){return this[a].toArray().map(function(Q){return Q.key})}},{key:"values",value:function(){return this[a].toArray().map(function(Q){return Q.value})}},{key:"reset",value:function(){var Q=this;this[l]&&this[a]&&this[a].length&&this[a].forEach(function(tt){return Q[l](tt.key,tt.value)}),this[u]=new Map,this[a]=new P,this[w]=0}},{key:"dump",value:function(){var Q=this;return this[a].map(function(tt){return!b(Q,tt)&&{k:tt.key,v:tt.value,e:tt.now+(tt.maxAge||0)}}).toArray().filter(function(tt){return tt})}},{key:"dumpLru",value:function(){return this[a]}},{key:"set",value:function(Q,tt,D){if((D=D||this[s])&&typeof D!="number")throw new TypeError("maxAge must be a number");var k=D?Date.now():0,A=this[C](tt,Q);if(this[u].has(Q)){if(A>this[x])return T(this,this[u].get(Q)),!1;var L=this[u].get(Q).value;return this[l]&&(this[d]||this[l](Q,L.value)),L.now=k,L.maxAge=D,L.value=tt,this[w]+=A-L.length,L.length=A,this.get(Q),y(this),!0}var E=new O(Q,tt,A,k,D);return E.length>this[x]?(this[l]&&this[l](Q,tt),!1):(this[w]+=E.length,this[a].unshift(E),this[u].set(Q,this[a].head),y(this),!0)}},{key:"has",value:function(Q){if(!this[u].has(Q))return!1;var tt=this[u].get(Q).value;return!b(this,tt)}},{key:"get",value:function(Q){return g(this,Q,!0)}},{key:"peek",value:function(Q){return g(this,Q,!1)}},{key:"pop",value:function(){var Q=this[a].tail;return Q?(T(this,Q),Q.value):null}},{key:"del",value:function(Q){T(this,this[u].get(Q))}},{key:"load",value:function(Q){this.reset();for(var tt=Date.now(),D=Q.length-1;D>=0;D--){var k=Q[D],A=k.e||0;if(A===0)this.set(k.k,k.v);else{var L=A-tt;L>0&&this.set(k.k,k.v,L)}}}},{key:"prune",value:function(){var Q=this;this[u].forEach(function(tt,D){return g(Q,D,!1)})}}]),V}()},{yallist:83}],38:[function(F,$,R){(function(P){(function(){var x=$.exports;x.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},x.codes={};for(var w in x.types){var C=x.types[w];x.codes[C]=w}x.CMD_SHIFT=4,x.CMD_MASK=240,x.DUP_MASK=8,x.QOS_MASK=3,x.QOS_SHIFT=1,x.RETAIN_MASK=1,x.VARBYTEINT_MASK=127,x.VARBYTEINT_FIN_MASK=128,x.VARBYTEINT_MAX=268435455,x.SESSIONPRESENT_MASK=1,x.SESSIONPRESENT_HEADER=P.from([x.SESSIONPRESENT_MASK]),x.CONNACK_HEADER=P.from([x.codes.connack<<x.CMD_SHIFT]),x.USERNAME_MASK=128,x.PASSWORD_MASK=64,x.WILL_RETAIN_MASK=32,x.WILL_QOS_MASK=24,x.WILL_QOS_SHIFT=3,x.WILL_FLAG_MASK=4,x.CLEAN_SESSION_MASK=2,x.CONNECT_HEADER=P.from([x.codes.connect<<x.CMD_SHIFT]),x.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},x.propertiesCodes={};for(var c in x.properties){var s=x.properties[c];x.propertiesCodes[s]=c}function l(d){return[0,1,2].map(function(a){return[0,1].map(function(u){return[0,1].map(function(v){var m=P.alloc(1);return m.writeUInt8(x.codes[d]<<x.CMD_SHIFT|(u?x.DUP_MASK:0)|a<<x.QOS_SHIFT|v,0,!0),m})})})}x.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},x.PUBLISH_HEADER=l("publish"),x.SUBSCRIBE_HEADER=l("subscribe"),x.SUBSCRIBE_OPTIONS_QOS_MASK=3,x.SUBSCRIBE_OPTIONS_NL_MASK=1,x.SUBSCRIBE_OPTIONS_NL_SHIFT=2,x.SUBSCRIBE_OPTIONS_RAP_MASK=1,x.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,x.SUBSCRIBE_OPTIONS_RH_MASK=3,x.SUBSCRIBE_OPTIONS_RH_SHIFT=4,x.SUBSCRIBE_OPTIONS_RH=[0,16,32],x.SUBSCRIBE_OPTIONS_NL=4,x.SUBSCRIBE_OPTIONS_RAP=8,x.SUBSCRIBE_OPTIONS_QOS=[0,1,2],x.UNSUBSCRIBE_HEADER=l("unsubscribe"),x.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},x.SUBACK_HEADER=P.from([x.codes.suback<<x.CMD_SHIFT]),x.VERSION3=P.from([3]),x.VERSION4=P.from([4]),x.VERSION5=P.from([5]),x.VERSION131=P.from([131]),x.VERSION132=P.from([132]),x.QOS=[0,1,2].map(function(d){return P.from([d])}),x.EMPTY={pingreq:P.from([x.codes.pingreq<<4,0]),pingresp:P.from([x.codes.pingresp<<4,0]),disconnect:P.from([x.codes.disconnect<<4,0])}}).call(this)}).call(this,F("buffer").Buffer)},{buffer:17}],39:[function(F,$,R){(function(P){(function(){var x=F("./writeToStream"),w=F("events"),C=function(c){"use strict";St(l,c);var s=vt(l);function l(){var d;return Tt(this,l),d=s.call(this),d._array=new Array(20),d._i=0,d}return wt(l,[{key:"write",value:function(a){return this._array[this._i++]=a,!0}},{key:"concat",value:function(){var a=0,u=new Array(this._array.length),v=this._array,m,g=0;for(m=0;m<v.length&&v[m]!==void 0;m++)typeof v[m]!="string"?u[m]=v[m].length:u[m]=P.byteLength(v[m]),a+=u[m];var b=P.allocUnsafe(a);for(m=0;m<v.length&&v[m]!==void 0;m++)typeof v[m]!="string"?(v[m].copy(b,g),g+=u[m]):(b.write(v[m],g),g+=u[m]);return b}}]),l}(w);$.exports=function(c,s){var l=new C;return x(c,l,s),l.concat()}}).call(this)}).call(this,F("buffer").Buffer)},{"./writeToStream":44,buffer:17,events:22}],40:[function(F,$,R){R.parser=F("./parser").parser,R.generate=F("./generate"),R.writeToStream=F("./writeToStream")},{"./generate":39,"./parser":43,"./writeToStream":44}],41:[function(F,$,R){(function(P){(function(){var x=65536,w={},C=P.isBuffer(P.from([1,2]).subarray(0,1));function c(s){var l=P.allocUnsafe(2);return l.writeUInt8(s>>8,0),l.writeUInt8(255&s,1),l}$.exports={cache:w,generateCache:function(){for(var l=0;l<x;l++)w[l]=c(l)},generateNumber:c,genBufVariableByteInt:function(l){var d=0,a=0,u=P.allocUnsafe(4);do d=l%128|0,(l=l/128|0)>0&&(d|=128),u.writeUInt8(d,a++);while(l>0&&a<4);return l>0&&(a=0),C?u.subarray(0,a):u.slice(0,a)},generate4ByteBuffer:function(l){var d=P.allocUnsafe(4);return d.writeUInt32BE(l,0),d}}}).call(this)}).call(this,F("buffer").Buffer)},{buffer:17}],42:[function(F,$,R){$.exports=function(){"use strict";function P(){Tt(this,P),this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}return P}()},{}],43:[function(F,$,R){var P=F("bl"),x=F("events"),w=F("./packet"),C=F("./constants"),c=F("debug")("mqtt-packet:parser"),s=function(l){"use strict";St(a,l);var d=vt(a);function a(){var u;return Tt(this,a),u=d.call(this),u.parser=u.constructor.parser,u}return wt(a,[{key:"_resetState",value:function(){c("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new w,this.error=null,this._list=P(),this._stateCounter=0}},{key:"parse",value:function(v){for(this.error&&this._resetState(),this._list.append(v),c("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,c("parse: state complete. _stateCounter is now: %d",this._stateCounter),c("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return c("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}},{key:"_parseHeader",value:function(){var v=this._list.readUInt8(0);return this.packet.cmd=C.types[v>>C.CMD_SHIFT],this.packet.retain=(v&C.RETAIN_MASK)!=0,this.packet.qos=v>>C.QOS_SHIFT&C.QOS_MASK,this.packet.dup=(v&C.DUP_MASK)!=0,c("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}},{key:"_parseLength",value:function(){var v=this._parseVarByteNum(!0);return v&&(this.packet.length=v.value,this._list.consume(v.bytes)),c("_parseLength %d",v.value),!!v}},{key:"_parsePayload",value:function(){c("_parsePayload: payload %O",this._list);var v=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}v=!0}return c("_parsePayload complete result: %s",v),v}},{key:"_parseConnect",value:function(){var v,m,g,b;c("_parseConnect");var y={},T=this.packet,O=this._parseString();if(O===null)return this._emitError(new Error("Cannot parse protocolId"));if(O!=="MQTT"&&O!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(T.protocolId=O,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(T.protocolVersion=this._list.readUInt8(this._pos),T.protocolVersion>=128&&(T.bridgeMode=!0,T.protocolVersion=T.protocolVersion-128),T.protocolVersion!==3&&T.protocolVersion!==4&&T.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(y.username=this._list.readUInt8(this._pos)&C.USERNAME_MASK,y.password=this._list.readUInt8(this._pos)&C.PASSWORD_MASK,y.will=this._list.readUInt8(this._pos)&C.WILL_FLAG_MASK,y.will&&(T.will={},T.will.retain=(this._list.readUInt8(this._pos)&C.WILL_RETAIN_MASK)!=0,T.will.qos=(this._list.readUInt8(this._pos)&C.WILL_QOS_MASK)>>C.WILL_QOS_SHIFT),T.clean=(this._list.readUInt8(this._pos)&C.CLEAN_SESSION_MASK)!=0,this._pos++,T.keepalive=this._parseNum(),T.keepalive===-1)return this._emitError(new Error("Packet too short"));if(T.protocolVersion===5){var M=this._parseProperties();Object.getOwnPropertyNames(M).length&&(T.properties=M)}var V=this._parseString();if(V===null)return this._emitError(new Error("Packet too short"));if(T.clientId=V,c("_parseConnect: packet.clientId: %s",T.clientId),y.will){if(T.protocolVersion===5){var N=this._parseProperties();Object.getOwnPropertyNames(N).length&&(T.will.properties=N)}if((v=this._parseString())===null)return this._emitError(new Error("Cannot parse will topic"));if(T.will.topic=v,c("_parseConnect: packet.will.topic: %s",T.will.topic),(m=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse will payload"));T.will.payload=m,c("_parseConnect: packet.will.paylaod: %s",T.will.payload)}if(y.username){if((b=this._parseString())===null)return this._emitError(new Error("Cannot parse username"));T.username=b,c("_parseConnect: packet.username: %s",T.username)}if(y.password){if((g=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse password"));T.password=g}return this.settings=T,c("_parseConnect: complete"),T}},{key:"_parseConnack",value:function(){c("_parseConnack");var v=this.packet;if(this._list.length<1)return null;if(v.sessionPresent=!!(this._list.readUInt8(this._pos++)&C.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?v.reasonCode=this._list.readUInt8(this._pos++):v.reasonCode=0;else{if(this._list.length<2)return null;v.returnCode=this._list.readUInt8(this._pos++)}if(v.returnCode===-1||v.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}c("_parseConnack: complete")}},{key:"_parsePublish",value:function(){c("_parsePublish");var v=this.packet;if(v.topic=this._parseString(),v.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(v.qos>0)||this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}v.payload=this._list.slice(this._pos,v.length),c("_parsePublish: payload from buffer list: %o",v.payload)}}},{key:"_parseSubscribe",value:function(){c("_parseSubscribe");var v=this.packet,m,g,b,y,T,O,M;if(v.qos!==1)return this._emitError(new Error("Wrong subscribe header"));if(v.subscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var V=this._parseProperties();Object.getOwnPropertyNames(V).length&&(v.properties=V)}for(;this._pos<v.length;){if((m=this._parseString())===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=v.length)return this._emitError(new Error("Malformed Subscribe Payload"));b=(g=this._parseByte())&C.SUBSCRIBE_OPTIONS_QOS_MASK,O=(g>>C.SUBSCRIBE_OPTIONS_NL_SHIFT&C.SUBSCRIBE_OPTIONS_NL_MASK)!=0,T=(g>>C.SUBSCRIBE_OPTIONS_RAP_SHIFT&C.SUBSCRIBE_OPTIONS_RAP_MASK)!=0,y=g>>C.SUBSCRIBE_OPTIONS_RH_SHIFT&C.SUBSCRIBE_OPTIONS_RH_MASK,M={topic:m,qos:b},this.settings.protocolVersion===5?(M.nl=O,M.rap=T,M.rh=y):this.settings.bridgeMode&&(M.rh=0,M.rap=!0,M.nl=!0),c("_parseSubscribe: push subscription `%s` to subscription",M),v.subscriptions.push(M)}}}},{key:"_parseSuback",value:function(){c("_parseSuback");var v=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}},{key:"_parseUnsubscribe",value:function(){c("_parseUnsubscribe");var v=this.packet;if(v.unsubscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}for(;this._pos<v.length;){var g=this._parseString();if(g===null)return this._emitError(new Error("Cannot parse topic"));c("_parseUnsubscribe: push topic `%s` to unsubscriptions",g),v.unsubscriptions.push(g)}}}},{key:"_parseUnsuback",value:function(){c("_parseUnsuback");var v=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(this.settings.protocolVersion===5){var m=this._parseProperties();for(Object.getOwnPropertyNames(m).length&&(v.properties=m),v.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}},{key:"_parseConfirmation",value:function(){c("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);var v=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5&&(v.length>2?(v.reasonCode=this._parseByte(),c("_parseConfirmation: packet.reasonCode `%d`",v.reasonCode)):v.reasonCode=0,v.length>3)){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}return!0}},{key:"_parseDisconnect",value:function(){var v=this.packet;if(c("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?v.reasonCode=this._parseByte():v.reasonCode=0;var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}return c("_parseDisconnect result: true"),!0}},{key:"_parseAuth",value:function(){c("_parseAuth");var v=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));v.reasonCode=this._parseByte();var m=this._parseProperties();return Object.getOwnPropertyNames(m).length&&(v.properties=m),c("_parseAuth: result: true"),!0}},{key:"_parseMessageId",value:function(){var v=this.packet;return v.messageId=this._parseNum(),v.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(c("_parseMessageId: packet.messageId %d",v.messageId),!0)}},{key:"_parseString",value:function(v){var m=this._parseNum(),g=m+this._pos;if(m===-1||g>this._list.length||g>this.packet.length)return null;var b=this._list.toString("utf8",this._pos,g);return this._pos+=m,c("_parseString: result: %s",b),b}},{key:"_parseStringPair",value:function(){return c("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}},{key:"_parseBuffer",value:function(){var v=this._parseNum(),m=v+this._pos;if(v===-1||m>this._list.length||m>this.packet.length)return null;var g=this._list.slice(this._pos,m);return this._pos+=v,c("_parseBuffer: result: %o",g),g}},{key:"_parseNum",value:function(){if(this._list.length-this._pos<2)return-1;var v=this._list.readUInt16BE(this._pos);return this._pos+=2,c("_parseNum: result: %s",v),v}},{key:"_parse4ByteNum",value:function(){if(this._list.length-this._pos<4)return-1;var v=this._list.readUInt32BE(this._pos);return this._pos+=4,c("_parse4ByteNum: result: %s",v),v}},{key:"_parseVarByteNum",value:function(v){c("_parseVarByteNum");for(var m,g=0,b=1,y=0,T=!1,O=this._pos?this._pos:0;g<4&&O+g<this._list.length;){if(y+=b*((m=this._list.readUInt8(O+g++))&C.VARBYTEINT_MASK),b*=128,(m&C.VARBYTEINT_FIN_MASK)==0){T=!0;break}if(this._list.length<=g)break}return!T&&g===4&&this._list.length>=g&&this._emitError(new Error("Invalid variable byte integer")),O&&(this._pos+=g),c("_parseVarByteNum: result: %o",T=!!T&&(v?{bytes:g,value:y}:y)),T}},{key:"_parseByte",value:function(){var v;return this._pos<this._list.length&&(v=this._list.readUInt8(this._pos),this._pos++),c("_parseByte: result: %o",v),v}},{key:"_parseByType",value:function(v){switch(c("_parseByType: type: %s",v),v){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}},{key:"_parseProperties",value:function(){c("_parseProperties");for(var v=this._parseVarByteNum(),m=this._pos+v,g={};this._pos<m;){var b=this._parseByte();if(!b)return this._emitError(new Error("Cannot parse property code type")),!1;var y=C.propertiesCodes[b];if(!y)return this._emitError(new Error("Unknown property")),!1;if(y!=="userProperties")g[y]?Array.isArray(g[y])?g[y].push(this._parseByType(C.propertiesTypes[y])):(g[y]=[g[y]],g[y].push(this._parseByType(C.propertiesTypes[y]))):g[y]=this._parseByType(C.propertiesTypes[y]);else{g[y]||(g[y]=Object.create(null));var T=this._parseByType(C.propertiesTypes[y]);if(g[y][T.name])if(Array.isArray(g[y][T.name]))g[y][T.name].push(T.value);else{var O=g[y][T.name];g[y][T.name]=[O],g[y][T.name].push(T.value)}else g[y][T.name]=T.value}}return g}},{key:"_newPacket",value:function(){return c("_newPacket"),this.packet&&(this._list.consume(this.packet.length),c("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),c("_newPacket: new packet"),this.packet=new w,this._pos=0,!0}},{key:"_emitError",value:function(v){c("_emitError"),this.error=v,this.emit("error",v)}}],[{key:"parser",value:function(v){return this instanceof a?(this.settings=v||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new a().parser(v)}}]),a}(x);$.exports=s},{"./constants":38,"./packet":42,bl:15,debug:18,events:22}],44:[function(F,$,R){(function(P){(function(){var x=F("./constants"),w=P.allocUnsafe(0),C=P.from([0]),c=F("./numbers"),s=F("process-nextick-args").nextTick,l=F("debug")("mqtt-packet:writeToStream"),d=c.cache,a=c.generateNumber,u=c.generateCache,v=c.genBufVariableByteInt,m=c.generate4ByteBuffer,g=Q,b=!0;function y(W,z,K){switch(l("generate called"),z.cork&&(z.cork(),s(T,z)),b&&(b=!1,u()),l("generate: packet.cmd: %s",W.cmd),W.cmd){case"connect":return function(H,_,G){var et=H||{},Z=et.protocolId||"MQTT",at=et.protocolVersion||4,it=et.will,st=et.clean,h=et.keepalive||0,f=et.clientId||"",I=et.username,B=et.password,Y=et.properties;st===void 0&&(st=!0);var X=0;if(!Z||typeof Z!="string"&&!P.isBuffer(Z))return _.emit("error",new Error("Invalid protocolId")),!1;if(X+=Z.length+2,at!==3&&at!==4&&at!==5)return _.emit("error",new Error("Invalid protocol version")),!1;if(X+=1,(typeof f=="string"||P.isBuffer(f))&&(f||at>=4)&&(f||st))X+=P.byteLength(f)+2;else{if(at<4)return _.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*st==0)return _.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof h!="number"||h<0||h>65535||h%1!=0)return _.emit("error",new Error("Invalid keepalive")),!1;if(X+=2,X+=1,at===5){var ot=k(_,Y);if(!ot)return!1;X+=ot.length}if(it){if(typeof it!="object")return _.emit("error",new Error("Invalid will")),!1;if(!it.topic||typeof it.topic!="string")return _.emit("error",new Error("Invalid will topic")),!1;if(X+=P.byteLength(it.topic)+2,X+=2,it.payload){if(!(it.payload.length>=0))return _.emit("error",new Error("Invalid will payload")),!1;typeof it.payload=="string"?X+=P.byteLength(it.payload):X+=it.payload.length}var ut={};if(at===5){if(!(ut=k(_,it.properties)))return!1;X+=ut.length}}var lt=!1;if(I!=null){if(!J(I))return _.emit("error",new Error("Invalid username")),!1;lt=!0,X+=P.byteLength(I)+2}if(B!=null){if(!lt)return _.emit("error",new Error("Username is required to use password")),!1;if(!J(B))return _.emit("error",new Error("Invalid password")),!1;X+=q(B)+2}_.write(x.CONNECT_HEADER),M(_,X),D(_,Z),et.bridgeMode&&(at+=128),_.write(at===131?x.VERSION131:at===132?x.VERSION132:at===4?x.VERSION4:at===5?x.VERSION5:x.VERSION3);var gt=0;return gt|=I!=null?x.USERNAME_MASK:0,gt|=B!=null?x.PASSWORD_MASK:0,gt|=it&&it.retain?x.WILL_RETAIN_MASK:0,gt|=it&&it.qos?it.qos<<x.WILL_QOS_SHIFT:0,gt|=it?x.WILL_FLAG_MASK:0,gt|=st?x.CLEAN_SESSION_MASK:0,_.write(P.from([gt])),g(_,h),at===5&&ot.write(),D(_,f),it&&(at===5&&ut.write(),V(_,it.topic),D(_,it.payload)),I!=null&&D(_,I),B!=null&&D(_,B),!0}(W,z);case"connack":return function(H,_,G){var et=G?G.protocolVersion:4,Z=H||{},at=et===5?Z.reasonCode:Z.returnCode,it=Z.properties,st=2;if(typeof at!="number")return _.emit("error",new Error("Invalid return code")),!1;var h=null;if(et===5){if(!(h=k(_,it)))return!1;st+=h.length}return _.write(x.CONNACK_HEADER),M(_,st),_.write(Z.sessionPresent?x.SESSIONPRESENT_HEADER:C),_.write(P.from([at])),h!=null&&h.write(),!0}(W,z,K);case"publish":return function(H,_,G){l("publish: packet: %o",H);var et=G?G.protocolVersion:4,Z=H||{},at=Z.qos||0,it=Z.retain?x.RETAIN_MASK:0,st=Z.topic,h=Z.payload||w,f=Z.messageId,I=Z.properties,B=0;if(typeof st=="string")B+=P.byteLength(st)+2;else{if(!P.isBuffer(st))return _.emit("error",new Error("Invalid topic")),!1;B+=st.length+2}if(P.isBuffer(h)?B+=h.length:B+=P.byteLength(h),at&&typeof f!="number")return _.emit("error",new Error("Invalid messageId")),!1;at&&(B+=2);var Y=null;if(et===5){if(!(Y=k(_,I)))return!1;B+=Y.length}return _.write(x.PUBLISH_HEADER[at][Z.dup?1:0][it?1:0]),M(_,B),g(_,q(st)),_.write(st),at>0&&g(_,f),Y!=null&&Y.write(),l("publish: payload: %o",h),_.write(h)}(W,z,K);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(H,_,G){var et=G?G.protocolVersion:4,Z=H||{},at=Z.cmd||"puback",it=Z.messageId,st=Z.dup&&at==="pubrel"?x.DUP_MASK:0,h=0,f=Z.reasonCode,I=Z.properties,B=et===5?3:2;if(at==="pubrel"&&(h=1),typeof it!="number")return _.emit("error",new Error("Invalid messageId")),!1;var Y=null;if(et===5&&typeof I=="object"){if(!(Y=A(_,I,G,B)))return!1;B+=Y.length}return _.write(x.ACKS[at][h][st][0]),M(_,B),g(_,it),et===5&&_.write(P.from([f])),Y!==null&&Y.write(),!0}(W,z,K);case"subscribe":return function(H,_,G){l("subscribe: packet: ");var et=G?G.protocolVersion:4,Z=H||{},at=Z.dup?x.DUP_MASK:0,it=Z.messageId,st=Z.subscriptions,h=Z.properties,f=0;if(typeof it!="number")return _.emit("error",new Error("Invalid messageId")),!1;f+=2;var I=null;if(et===5){if(!(I=k(_,h)))return!1;f+=I.length}if(typeof st!="object"||!st.length)return _.emit("error",new Error("Invalid subscriptions")),!1;for(var B=0;B<st.length;B+=1){var Y=st[B].topic,X=st[B].qos;if(typeof Y!="string")return _.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if(typeof X!="number")return _.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(et===5){var ot=st[B].nl||!1;if(typeof ot!="boolean")return _.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;var ut=st[B].rap||!1;if(typeof ut!="boolean")return _.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var lt=st[B].rh||0;if(typeof lt!="number"||lt>2)return _.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}f+=P.byteLength(Y)+2+1}l("subscribe: writing to stream: %o",x.SUBSCRIBE_HEADER),_.write(x.SUBSCRIBE_HEADER[1][at?1:0][0]),M(_,f),g(_,it),I!==null&&I.write();var gt=!0,bt=Et(st),Wt;try{for(bt.s();!(Wt=bt.n()).done;){var Dt=Wt.value,Ht=Dt.topic,pt=Dt.qos,At=+Dt.nl,Qt=+Dt.rap,oe=Dt.rh,Gt=void 0;V(_,Ht),Gt=x.SUBSCRIBE_OPTIONS_QOS[pt],et===5&&(Gt|=At?x.SUBSCRIBE_OPTIONS_NL:0,Gt|=Qt?x.SUBSCRIBE_OPTIONS_RAP:0,Gt|=oe?x.SUBSCRIBE_OPTIONS_RH[oe]:0),gt=_.write(P.from([Gt]))}}catch(fe){bt.e(fe)}finally{bt.f()}return gt}(W,z,K);case"suback":return function(H,_,G){var et=G?G.protocolVersion:4,Z=H||{},at=Z.messageId,it=Z.granted,st=Z.properties,h=0;if(typeof at!="number")return _.emit("error",new Error("Invalid messageId")),!1;if(h+=2,typeof it!="object"||!it.length)return _.emit("error",new Error("Invalid qos vector")),!1;for(var f=0;f<it.length;f+=1){if(typeof it[f]!="number")return _.emit("error",new Error("Invalid qos vector")),!1;h+=1}var I=null;if(et===5){if(!(I=A(_,st,G,h)))return!1;h+=I.length}return _.write(x.SUBACK_HEADER),M(_,h),g(_,at),I!==null&&I.write(),_.write(P.from(it))}(W,z,K);case"unsubscribe":return function(H,_,G){var et=G?G.protocolVersion:4,Z=H||{},at=Z.messageId,it=Z.dup?x.DUP_MASK:0,st=Z.unsubscriptions,h=Z.properties,f=0;if(typeof at!="number")return _.emit("error",new Error("Invalid messageId")),!1;if(f+=2,typeof st!="object"||!st.length)return _.emit("error",new Error("Invalid unsubscriptions")),!1;for(var I=0;I<st.length;I+=1){if(typeof st[I]!="string")return _.emit("error",new Error("Invalid unsubscriptions")),!1;f+=P.byteLength(st[I])+2}var B=null;if(et===5){if(!(B=k(_,h)))return!1;f+=B.length}_.write(x.UNSUBSCRIBE_HEADER[1][it?1:0][0]),M(_,f),g(_,at),B!==null&&B.write();for(var Y=!0,X=0;X<st.length;X++)Y=V(_,st[X]);return Y}(W,z,K);case"unsuback":return function(H,_,G){var et=G?G.protocolVersion:4,Z=H||{},at=Z.messageId,it=Z.dup?x.DUP_MASK:0,st=Z.granted,h=Z.properties,f=Z.cmd,I=2;if(typeof at!="number")return _.emit("error",new Error("Invalid messageId")),!1;if(et===5){if(typeof st!="object"||!st.length)return _.emit("error",new Error("Invalid qos vector")),!1;for(var B=0;B<st.length;B+=1){if(typeof st[B]!="number")return _.emit("error",new Error("Invalid qos vector")),!1;I+=1}}var Y=null;if(et===5){if(!(Y=A(_,h,G,I)))return!1;I+=Y.length}return _.write(x.ACKS[f][0][it][0]),M(_,I),g(_,at),Y!==null&&Y.write(),et===5&&_.write(P.from(st)),!0}(W,z,K);case"pingreq":case"pingresp":return function(H,_,G){return _.write(x.EMPTY[H.cmd])}(W,z);case"disconnect":return function(H,_,G){var et=G?G.protocolVersion:4,Z=H||{},at=Z.reasonCode,it=Z.properties,st=et===5?1:0,h=null;if(et===5){if(!(h=A(_,it,G,st)))return!1;st+=h.length}return _.write(P.from([x.codes.disconnect<<4])),M(_,st),et===5&&_.write(P.from([at])),h!==null&&h.write(),!0}(W,z,K);case"auth":return function(H,_,G){var et=G?G.protocolVersion:4,Z=H||{},at=Z.reasonCode,it=Z.properties,st=et===5?1:0;et!==5&&_.emit("error",new Error("Invalid mqtt version for auth packet"));var h=A(_,it,G,st);return h?(st+=h.length,_.write(P.from([x.codes.auth<<4])),M(_,st),_.write(P.from([at])),h!==null&&h.write(),!0):!1}(W,z,K);default:return z.emit("error",new Error("Unknown command")),!1}}function T(W){W.uncork()}Object.defineProperty(y,"cacheNumbers",{get:function(){return g===Q},set:function(z){z?(d&&Object.keys(d).length!==0||(b=!0),g=Q):(b=!1,g=tt)}});var O={};function M(W,z){if(z>x.VARBYTEINT_MAX)return W.emit("error",new Error("Invalid variable byte integer: ".concat(z))),!1;var K=O[z];return K||(K=v(z),z<16384&&(O[z]=K)),l("writeVarByteInt: writing to stream: %o",K),W.write(K)}function V(W,z){var K=P.byteLength(z);return g(W,K),l("writeString: %s",z),W.write(z,"utf8")}function N(W,z,K){V(W,z),V(W,K)}function Q(W,z){return l("writeNumberCached: number: %d",z),l("writeNumberCached: %o",d[z]),W.write(d[z])}function tt(W,z){var K=a(z);return l("writeNumberGenerated: %o",K),W.write(K)}function D(W,z){typeof z=="string"?V(W,z):z?(g(W,z.length),W.write(z)):g(W,0)}function k(W,z){if(typeof z!="object"||z.length!=null)return{length:1,write:function(){E(W,{},0)}};var K=0;function H(it,st){var h=0;switch(x.propertiesTypes[it]){case"byte":if(typeof st!="boolean")return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=2;break;case"int8":if(typeof st!="number"||st<0||st>255)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=2;break;case"binary":if(st&&st===null)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=1+P.byteLength(st)+2;break;case"int16":if(typeof st!="number"||st<0||st>65535)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=3;break;case"int32":if(typeof st!="number"||st<0||st>4294967295)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=5;break;case"var":if(typeof st!="number"||st<0||st>268435455)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=1+P.byteLength(v(st));break;case"string":if(typeof st!="string")return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=3+P.byteLength(st.toString());break;case"pair":if(typeof st!="object")return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=Object.getOwnPropertyNames(st).reduce(function(f,I){var B=st[I];return Array.isArray(B)?f+=B.reduce(function(Y,X){return Y+=3+P.byteLength(I.toString())+2+P.byteLength(X.toString())},0):f+=3+P.byteLength(I.toString())+2+P.byteLength(st[I].toString()),f},0);break;default:return W.emit("error",new Error("Invalid property ".concat(it,": ").concat(st))),!1}return h}if(z)for(var _ in z){var G=0,et=0,Z=z[_];if(Array.isArray(Z))for(var at=0;at<Z.length;at++){if(!(et=H(_,Z[at])))return!1;G+=et}else{if(!(et=H(_,Z)))return!1;G=et}if(!G)return!1;K+=G}return{length:P.byteLength(v(K))+K,write:function(){E(W,z,K)}}}function A(W,z,K,H){var _=["reasonString","userProperties"],G=K&&K.properties&&K.properties.maximumPacketSize?K.properties.maximumPacketSize:0,et=k(W,z);if(G)for(;H+et.length>G;){var Z=_.shift();if(!Z||!z[Z])return!1;delete z[Z],et=k(W,z)}return et}function L(W,z,K){switch(x.propertiesTypes[z]){case"byte":W.write(P.from([x.properties[z]])),W.write(P.from([+K]));break;case"int8":W.write(P.from([x.properties[z]])),W.write(P.from([K]));break;case"binary":W.write(P.from([x.properties[z]])),D(W,K);break;case"int16":W.write(P.from([x.properties[z]])),g(W,K);break;case"int32":W.write(P.from([x.properties[z]])),function(H,_){var G=m(_);l("write4ByteNumber: %o",G),H.write(G)}(W,K);break;case"var":W.write(P.from([x.properties[z]])),M(W,K);break;case"string":W.write(P.from([x.properties[z]])),V(W,K);break;case"pair":Object.getOwnPropertyNames(K).forEach(function(H){var _=K[H];Array.isArray(_)?_.forEach(function(G){W.write(P.from([x.properties[z]])),N(W,H.toString(),G.toString())}):(W.write(P.from([x.properties[z]])),N(W,H.toString(),_.toString()))});break;default:return W.emit("error",new Error("Invalid property ".concat(z," value: ").concat(K))),!1}}function E(W,z,K){M(W,K);for(var H in z)if(Object.prototype.hasOwnProperty.call(z,H)&&z[H]!==null){var _=z[H];if(Array.isArray(_))for(var G=0;G<_.length;G++)L(W,H,_[G]);else L(W,H,_)}}function q(W){return W?W instanceof P?W.length:P.byteLength(W):0}function J(W){return typeof W=="string"||W instanceof P}$.exports=y}).call(this)}).call(this,F("buffer").Buffer)},{"./constants":38,"./numbers":41,buffer:17,debug:18,"process-nextick-args":49}],45:[function(F,$,R){var P=1e3,x=60*P,w=60*x,C=24*w,c=7*C,s=365.25*C;function l(d,a,u,v){var m=a>=1.5*u;return Math.round(d/u)+" "+v+(m?"s":"")}$.exports=function(d,a){a=a||{};var u=typeof d;if(u==="string"&&d.length>0)return function(v){if(!((v=String(v)).length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(v);if(!!m){var g=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return g*s;case"weeks":case"week":case"w":return g*c;case"days":case"day":case"d":return g*C;case"hours":case"hour":case"hrs":case"hr":case"h":return g*w;case"minutes":case"minute":case"mins":case"min":case"m":return g*x;case"seconds":case"second":case"secs":case"sec":case"s":return g*P;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}(d);if(u==="number"&&isFinite(d))return a.long?function(v){var m=Math.abs(v);return m>=C?l(v,m,C,"day"):m>=w?l(v,m,w,"hour"):m>=x?l(v,m,x,"minute"):m>=P?l(v,m,P,"second"):v+" ms"}(d):function(v){var m=Math.abs(v);return m>=C?Math.round(v/C)+"d":m>=w?Math.round(v/w)+"h":m>=x?Math.round(v/x)+"m":m>=P?Math.round(v/P)+"s":v+"ms"}(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],46:[function(F,$,R){var P=F("./lib/number-allocator.js");$.exports.NumberAllocator=P},{"./lib/number-allocator.js":47}],47:[function(F,$,R){"use strict";var P=F("js-sdsl").Set,x=F("debug")("number-allocator:trace"),w=F("debug")("number-allocator:error");function C(s,l){this.low=s,this.high=l}function c(s,l){if(!(this instanceof c))return new c(s,l);this.min=s,this.max=l,this.ss=new P([],function(d,a){return d.compare(a)}),x("Create"),this.clear()}C.prototype.equals=function(s){return this.low===s.low&&this.high===s.high},C.prototype.compare=function(s){return this.low<s.low&&this.high<s.low?-1:s.low<this.low&&s.high<this.low?1:0},c.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},c.prototype.alloc=function(){if(this.ss.size()===0)return x("alloc():empty"),null;var s=this.ss.front(),l=s.low;return l+1<=s.high?++s.low:this.ss.eraseElementByPos(0),x("alloc():"+l),l},c.prototype.use=function(s){var l=new C(s,s),d=this.ss.lowerBound(l);if(d){if(d.equals(l))return this.ss.eraseElementByValue(d),x("use():"+s),!0;if(d.low>s)return!1;if(d.low===s)return++d.low,x("use():"+s),!0;if(d.high===s)return--d.high,x("use():"+s),!0;var a=d.low;return d.low=s+1,this.ss.insert(new C(a,s-1)),x("use():"+s),!0}return x("use():failed"),!1},c.prototype.free=function(s){if(s<this.min||s>this.max)return void w("free():"+s+" is out of range");var l=new C(s,s),d=this.ss.lowerBound(l);if(d){if(d.low<=s&&s<=d.high)return void w("free():"+s+" has already been vacant");if(d===this.ss.front())s+1===d.low?--d.low:this.ss.insert(l);else{var a=this.ss.reverseLowerBound(l);a.high+1===s?s+1===d.low?(this.ss.eraseElementByValue(a),d.low=a.low):a.high=s:s+1===d.low?d.low=s:this.ss.insert(l)}}else{if(d===this.ss.front())return void this.ss.insert(l);var u=this.ss.reverseLowerBound(l);u.high+1===s?u.high=s:this.ss.insert(l)}x("free():"+s)},c.prototype.clear=function(){x("clear()"),this.ss.clear(),this.ss.insert(new C(this.min,this.max))},c.prototype.intervalCount=function(){return this.ss.size()},c.prototype.dump=function(){console.log("length:"+this.ss.size());var s=Et(this.ss),l;try{for(s.s();!(l=s.n()).done;){var d=l.value;console.log(d)}}catch(a){s.e(a)}finally{s.f()}},$.exports=c},{debug:18,"js-sdsl":36}],48:[function(F,$,R){var P=F("wrappy");function x(C){var c=function s(){return s.called?s.value:(s.called=!0,s.value=C.apply(this,arguments))};return c.called=!1,c}function w(C){var c=function l(){if(l.called)throw new Error(l.onceError);return l.called=!0,l.value=C.apply(this,arguments)},s=C.name||"Function wrapped with `once`";return c.onceError=s+" shouldn't be called more than once",c.called=!1,c}$.exports=P(x),$.exports.strict=P(w),x.proto=x(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return x(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return w(this)},configurable:!0})})},{wrappy:79}],49:[function(F,$,R){(function(P){(function(){"use strict";P===void 0||!P.version||P.version.indexOf("v0.")===0||P.version.indexOf("v1.")===0&&P.version.indexOf("v1.8.")!==0?$.exports={nextTick:function(w,C,c,s){if(typeof w!="function")throw new TypeError('"callback" argument must be a function');var l,d,a=arguments.length;switch(a){case 0:case 1:return P.nextTick(w);case 2:return P.nextTick(function(){w.call(null,C)});case 3:return P.nextTick(function(){w.call(null,C,c)});case 4:return P.nextTick(function(){w.call(null,C,c,s)});default:for(l=new Array(a-1),d=0;d<l.length;)l[d++]=arguments[d];return P.nextTick(function(){w.apply(null,l)})}}}:$.exports=P}).call(this)}).call(this,F("_process"))},{_process:50}],50:[function(F,$,R){var P,x,w=$.exports={};function C(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function s(y){if(P===setTimeout)return setTimeout(y,0);if((P===C||!P)&&setTimeout)return P=setTimeout,setTimeout(y,0);try{return P(y,0)}catch(T){try{return P.call(null,y,0)}catch(O){return P.call(this,y,0)}}}(function(){try{P=typeof setTimeout=="function"?setTimeout:C}catch(y){P=C}try{x=typeof clearTimeout=="function"?clearTimeout:c}catch(y){x=c}})();var l,d=[],a=!1,u=-1;function v(){a&&l&&(a=!1,l.length?d=l.concat(d):u=-1,d.length&&m())}function m(){if(!a){var y=s(v);a=!0;for(var T=d.length;T;){for(l=d,d=[];++u<T;)l&&l[u].run();u=-1,T=d.length}l=null,a=!1,function(O){if(x===clearTimeout)return clearTimeout(O);if((x===c||!x)&&clearTimeout)return x=clearTimeout,clearTimeout(O);try{x(O)}catch(M){try{return x.call(null,O)}catch(V){return x.call(this,O)}}}(y)}}function g(y,T){this.fun=y,this.array=T}function b(){}w.nextTick=function(y){var T=new Array(arguments.length-1);if(arguments.length>1)for(var O=1;O<arguments.length;O++)T[O-1]=arguments[O];d.push(new g(y,T)),d.length!==1||a||s(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=b,w.addListener=b,w.once=b,w.off=b,w.removeListener=b,w.removeAllListeners=b,w.emit=b,w.prependListener=b,w.prependOnceListener=b,w.listeners=function(y){return[]},w.binding=function(y){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(y){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],51:[function(F,$,R){(function(P){(function(){(function(x){var w=typeof R=="object"&&R&&!R.nodeType&&R,C=typeof $=="object"&&$&&!$.nodeType&&$,c=typeof P=="object"&&P;c.global!==c&&c.window!==c&&c.self!==c||(x=c);var s,l,d=2147483647,a=36,u=1,v=26,m=38,g=700,b=72,y=128,T="-",O=/^xn--/,M=/[^\x20-\x7E]/,V=/[\x2E\u3002\uFF0E\uFF61]/g,N={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Q=a-u,tt=Math.floor,D=String.fromCharCode;function k(H){throw new RangeError(N[H])}function A(H,_){for(var G=H.length,et=[];G--;)et[G]=_(H[G]);return et}function L(H,_){var G=H.split("@"),et="";return G.length>1&&(et=G[0]+"@",H=G[1]),et+A((H=H.replace(V,".")).split("."),_).join(".")}function E(H){for(var _,G,et=[],Z=0,at=H.length;Z<at;)(_=H.charCodeAt(Z++))>=55296&&_<=56319&&Z<at?(64512&(G=H.charCodeAt(Z++)))==56320?et.push(((1023&_)<<10)+(1023&G)+65536):(et.push(_),Z--):et.push(_);return et}function q(H){return A(H,function(_){var G="";return _>65535&&(G+=D((_-=65536)>>>10&1023|55296),_=56320|1023&_),G+=D(_)}).join("")}function J(H,_){return H+22+75*(H<26)-((_!=0)<<5)}function W(H,_,G){var et=0;for(H=G?tt(H/g):H>>1,H+=tt(H/_);H>Q*v>>1;et+=a)H=tt(H/Q);return tt(et+(Q+1)*H/(H+m))}function z(H){var _,G,et,Z,at,it,st,h,f,I,B,Y=[],X=H.length,ot=0,ut=y,lt=b;for((G=H.lastIndexOf(T))<0&&(G=0),et=0;et<G;++et)H.charCodeAt(et)>=128&&k("not-basic"),Y.push(H.charCodeAt(et));for(Z=G>0?G+1:0;Z<X;){for(at=ot,it=1,st=a;Z>=X&&k("invalid-input"),((h=(B=H.charCodeAt(Z++))-48<10?B-22:B-65<26?B-65:B-97<26?B-97:a)>=a||h>tt((d-ot)/it))&&k("overflow"),ot+=h*it,!(h<(f=st<=lt?u:st>=lt+v?v:st-lt));st+=a)it>tt(d/(I=a-f))&&k("overflow"),it*=I;lt=W(ot-at,_=Y.length+1,at==0),tt(ot/_)>d-ut&&k("overflow"),ut+=tt(ot/_),ot%=_,Y.splice(ot++,0,ut)}return q(Y)}function K(H){var _,G,et,Z,at,it,st,h,f,I,B,Y,X,ot,ut,lt=[];for(Y=(H=E(H)).length,_=y,G=0,at=b,it=0;it<Y;++it)(B=H[it])<128&&lt.push(D(B));for(et=Z=lt.length,Z&&lt.push(T);et<Y;){for(st=d,it=0;it<Y;++it)(B=H[it])>=_&&B<st&&(st=B);for(st-_>tt((d-G)/(X=et+1))&&k("overflow"),G+=(st-_)*X,_=st,it=0;it<Y;++it)if((B=H[it])<_&&++G>d&&k("overflow"),B==_){for(h=G,f=a;!(h<(I=f<=at?u:f>=at+v?v:f-at));f+=a)ut=h-I,ot=a-I,lt.push(D(J(I+ut%ot,0))),h=tt(ut/ot);lt.push(D(J(h,0))),at=W(G,X,et==Z),G=0,++et}++G,++_}return lt.join("")}if(s={version:"1.4.1",ucs2:{decode:E,encode:q},decode:z,encode:K,toASCII:function(_){return L(_,function(G){return M.test(G)?"xn--"+K(G):G})},toUnicode:function(_){return L(_,function(G){return O.test(G)?z(G.slice(4).toLowerCase()):G})}},w&&C)if($.exports==w)C.exports=s;else for(l in s)s.hasOwnProperty(l)&&(w[l]=s[l]);else x.punycode=s})(this)}).call(this)}).call(this,typeof dt.g!="undefined"?dt.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],52:[function(F,$,R){"use strict";function P(w,C){return Object.prototype.hasOwnProperty.call(w,C)}$.exports=function(w,C,c,s){C=C||"&",c=c||"=";var l={};if(typeof w!="string"||w.length===0)return l;var d=/\+/g;w=w.split(C);var a=1e3;s&&typeof s.maxKeys=="number"&&(a=s.maxKeys);var u=w.length;a>0&&u>a&&(u=a);for(var v=0;v<u;++v){var m,g,b,y,T=w[v].replace(d,"%20"),O=T.indexOf(c);O>=0?(m=T.substr(0,O),g=T.substr(O+1)):(m=T,g=""),b=decodeURIComponent(m),y=decodeURIComponent(g),P(l,b)?x(l[b])?l[b].push(y):l[b]=[l[b],y]:l[b]=y}return l};var x=Array.isArray||function(w){return Object.prototype.toString.call(w)==="[object Array]"}},{}],53:[function(F,$,R){"use strict";var P=function(s){switch(typeof s){case"string":return s;case"boolean":return s?"true":"false";case"number":return isFinite(s)?s:"";default:return""}};$.exports=function(c,s,l,d){return s=s||"&",l=l||"=",c===null&&(c=void 0),typeof c=="object"?w(C(c),function(a){var u=encodeURIComponent(P(a))+l;return x(c[a])?w(c[a],function(v){return u+encodeURIComponent(P(v))}).join(s):u+encodeURIComponent(P(c[a]))}).join(s):d?encodeURIComponent(P(d))+l+encodeURIComponent(P(c)):""};var x=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};function w(c,s){if(c.map)return c.map(s);for(var l=[],d=0;d<c.length;d++)l.push(s(c[d],d));return l}var C=Object.keys||function(c){var s=[];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&s.push(l);return s}},{}],54:[function(F,$,R){"use strict";R.decode=R.parse=F("./decode"),R.encode=R.stringify=F("./encode")},{"./decode":52,"./encode":53}],55:[function(F,$,R){"use strict";var P={};function x(C,c,s){s||(s=Error);var l=function(d){var a,u;function v(m,g,b){return d.call(this,function(y,T,O){return typeof c=="string"?c:c(y,T,O)}(m,g,b))||this}return u=d,(a=v).prototype=Object.create(u.prototype),a.prototype.constructor=a,a.__proto__=u,v}(s);l.prototype.name=s.name,l.prototype.code=C,P[C]=l}function w(C,c){if(Array.isArray(C)){var s=C.length;return C=C.map(function(l){return String(l)}),s>2?"one of ".concat(c," ").concat(C.slice(0,s-1).join(", "),", or ")+C[s-1]:s===2?"one of ".concat(c," ").concat(C[0]," or ").concat(C[1]):"of ".concat(c," ").concat(C[0])}return"of ".concat(c," ").concat(String(C))}x("ERR_INVALID_OPT_VALUE",function(C,c){return'The value "'+c+'" is invalid for option "'+C+'"'},TypeError),x("ERR_INVALID_ARG_TYPE",function(C,c,s){var l,d,a,u;if(typeof c=="string"&&(d="not ",c.substr(!a||a<0?0:+a,d.length)===d)?(l="must not be",c=c.replace(/^not /,"")):l="must be",function(m,g,b){return(b===void 0||b>m.length)&&(b=m.length),m.substring(b-g.length,b)===g}(C," argument"))u="The ".concat(C," ").concat(l," ").concat(w(c,"type"));else{var v=function(m,g,b){return typeof b!="number"&&(b=0),!(b+g.length>m.length)&&m.indexOf(g,b)!==-1}(C,".")?"property":"argument";u='The "'.concat(C,'" ').concat(v," ").concat(l," ").concat(w(c,"type"))}return u+=". Received type ".concat(typeof s)},TypeError),x("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),x("ERR_METHOD_NOT_IMPLEMENTED",function(C){return"The "+C+" method is not implemented"}),x("ERR_STREAM_PREMATURE_CLOSE","Premature close"),x("ERR_STREAM_DESTROYED",function(C){return"Cannot call "+C+" after a stream was destroyed"}),x("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),x("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),x("ERR_STREAM_WRITE_AFTER_END","write after end"),x("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),x("ERR_UNKNOWN_ENCODING",function(C){return"Unknown encoding: "+C},TypeError),x("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),$.exports.codes=P},{}],56:[function(F,$,R){(function(P){(function(){"use strict";var x=Object.keys||function(v){var m=[];for(var g in v)m.push(g);return m};$.exports=d;var w=F("./_stream_readable"),C=F("./_stream_writable");F("inherits")(d,w);for(var c=x(C.prototype),s=0;s<c.length;s++){var l=c[s];d.prototype[l]||(d.prototype[l]=C.prototype[l])}function d(v){if(!(this instanceof d))return new d(v);w.call(this,v),C.call(this,v),this.allowHalfOpen=!0,v&&(v.readable===!1&&(this.readable=!1),v.writable===!1&&(this.writable=!1),v.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}function a(){this._writableState.ended||P.nextTick(u,this)}function u(v){v.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(d.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(m){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=m,this._writableState.destroyed=m)}})}).call(this)}).call(this,F("_process"))},{"./_stream_readable":58,"./_stream_writable":60,_process:50,inherits:24}],57:[function(F,$,R){"use strict";$.exports=x;var P=F("./_stream_transform");function x(w){if(!(this instanceof x))return new x(w);P.call(this,w)}F("inherits")(x,P),x.prototype._transform=function(w,C,c){c(null,w)}},{"./_stream_transform":59,inherits:24}],58:[function(F,$,R){(function(P,x){(function(){"use strict";var w;$.exports=k,k.ReadableState=D,F("events").EventEmitter;var C=function(f,I){return f.listeners(I).length},c=F("./internal/streams/stream"),s=F("buffer").Buffer,l=x.Uint8Array||function(){},d,a=F("util");d=a&&a.debuglog?a.debuglog("stream"):function(){};var u,v,m,g=F("./internal/streams/buffer_list"),b=F("./internal/streams/destroy"),y=F("./internal/streams/state").getHighWaterMark,T=F("../errors").codes,O=T.ERR_INVALID_ARG_TYPE,M=T.ERR_STREAM_PUSH_AFTER_EOF,V=T.ERR_METHOD_NOT_IMPLEMENTED,N=T.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;F("inherits")(k,c);var Q=b.errorOrDestroy,tt=["error","close","destroy","pause","resume"];function D(h,f,I){w=w||F("./_stream_duplex"),h=h||{},typeof I!="boolean"&&(I=f instanceof w),this.objectMode=!!h.objectMode,I&&(this.objectMode=this.objectMode||!!h.readableObjectMode),this.highWaterMark=y(this,h,"readableHighWaterMark",I),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=h.emitClose!==!1,this.autoDestroy=!!h.autoDestroy,this.destroyed=!1,this.defaultEncoding=h.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,h.encoding&&(u||(u=F("string_decoder/").StringDecoder),this.decoder=new u(h.encoding),this.encoding=h.encoding)}function k(h){if(w=w||F("./_stream_duplex"),!(this instanceof k))return new k(h);var f=this instanceof w;this._readableState=new D(h,this,f),this.readable=!0,h&&(typeof h.read=="function"&&(this._read=h.read),typeof h.destroy=="function"&&(this._destroy=h.destroy)),c.call(this)}function A(h,f,I,B,Y){d("readableAddChunk",f);var X,ot=h._readableState;if(f===null)ot.reading=!1,function(ut,lt){if(d("onEofChunk"),!lt.ended){if(lt.decoder){var gt=lt.decoder.end();gt&&gt.length&&(lt.buffer.push(gt),lt.length+=lt.objectMode?1:gt.length)}lt.ended=!0,lt.sync?J(ut):(lt.needReadable=!1,lt.emittedReadable||(lt.emittedReadable=!0,W(ut)))}}(h,ot);else if(Y||(X=function(ut,lt){var gt;bt=lt,s.isBuffer(bt)||bt instanceof l||typeof lt=="string"||lt===void 0||ut.objectMode||(gt=new O("chunk",["string","Buffer","Uint8Array"],lt));var bt;return gt}(ot,f)),X)Q(h,X);else if(ot.objectMode||f&&f.length>0)if(typeof f=="string"||ot.objectMode||Object.getPrototypeOf(f)===s.prototype||(f=function(ut){return s.from(ut)}(f)),B)ot.endEmitted?Q(h,new N):L(h,ot,f,!0);else if(ot.ended)Q(h,new M);else{if(ot.destroyed)return!1;ot.reading=!1,ot.decoder&&!I?(f=ot.decoder.write(f),ot.objectMode||f.length!==0?L(h,ot,f,!1):z(h,ot)):L(h,ot,f,!1)}else B||(ot.reading=!1,z(h,ot));return!ot.ended&&(ot.length<ot.highWaterMark||ot.length===0)}function L(h,f,I,B){f.flowing&&f.length===0&&!f.sync?(f.awaitDrain=0,h.emit("data",I)):(f.length+=f.objectMode?1:I.length,B?f.buffer.unshift(I):f.buffer.push(I),f.needReadable&&J(h)),z(h,f)}Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(f){this._readableState&&(this._readableState.destroyed=f)}}),k.prototype.destroy=b.destroy,k.prototype._undestroy=b.undestroy,k.prototype._destroy=function(h,f){f(h)},k.prototype.push=function(h,f){var I,B=this._readableState;return B.objectMode?I=!0:typeof h=="string"&&((f=f||B.defaultEncoding)!==B.encoding&&(h=s.from(h,f),f=""),I=!0),A(this,h,f,!1,I)},k.prototype.unshift=function(h){return A(this,h,null,!0,!1)},k.prototype.isPaused=function(){return this._readableState.flowing===!1},k.prototype.setEncoding=function(h){u||(u=F("string_decoder/").StringDecoder);var f=new u(h);this._readableState.decoder=f,this._readableState.encoding=this._readableState.decoder.encoding;for(var I=this._readableState.buffer.head,B="";I!==null;)B+=f.write(I.data),I=I.next;return this._readableState.buffer.clear(),B!==""&&this._readableState.buffer.push(B),this._readableState.length=B.length,this};var E=1073741824;function q(h,f){return h<=0||f.length===0&&f.ended?0:f.objectMode?1:h!=h?f.flowing&&f.length?f.buffer.head.data.length:f.length:(h>f.highWaterMark&&(f.highWaterMark=function(I){return I>=E?I=E:(I--,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,I|=I>>>16,I++),I}(h)),h<=f.length?h:f.ended?f.length:(f.needReadable=!0,0))}function J(h){var f=h._readableState;d("emitReadable",f.needReadable,f.emittedReadable),f.needReadable=!1,f.emittedReadable||(d("emitReadable",f.flowing),f.emittedReadable=!0,P.nextTick(W,h))}function W(h){var f=h._readableState;d("emitReadable_",f.destroyed,f.length,f.ended),f.destroyed||!f.length&&!f.ended||(h.emit("readable"),f.emittedReadable=!1),f.needReadable=!f.flowing&&!f.ended&&f.length<=f.highWaterMark,et(h)}function z(h,f){f.readingMore||(f.readingMore=!0,P.nextTick(K,h,f))}function K(h,f){for(;!f.reading&&!f.ended&&(f.length<f.highWaterMark||f.flowing&&f.length===0);){var I=f.length;if(d("maybeReadMore read 0"),h.read(0),I===f.length)break}f.readingMore=!1}function H(h){var f=h._readableState;f.readableListening=h.listenerCount("readable")>0,f.resumeScheduled&&!f.paused?f.flowing=!0:h.listenerCount("data")>0&&h.resume()}function _(h){d("readable nexttick read 0"),h.read(0)}function G(h,f){d("resume",f.reading),f.reading||h.read(0),f.resumeScheduled=!1,h.emit("resume"),et(h),f.flowing&&!f.reading&&h.read(0)}function et(h){var f=h._readableState;for(d("flow",f.flowing);f.flowing&&h.read()!==null;);}function Z(h,f){return f.length===0?null:(f.objectMode?I=f.buffer.shift():!h||h>=f.length?(I=f.decoder?f.buffer.join(""):f.buffer.length===1?f.buffer.first():f.buffer.concat(f.length),f.buffer.clear()):I=f.buffer.consume(h,f.decoder),I);var I}function at(h){var f=h._readableState;d("endReadable",f.endEmitted),f.endEmitted||(f.ended=!0,P.nextTick(it,f,h))}function it(h,f){if(d("endReadableNT",h.endEmitted,h.length),!h.endEmitted&&h.length===0&&(h.endEmitted=!0,f.readable=!1,f.emit("end"),h.autoDestroy)){var I=f._writableState;(!I||I.autoDestroy&&I.finished)&&f.destroy()}}function st(h,f){for(var I=0,B=h.length;I<B;I++)if(h[I]===f)return I;return-1}k.prototype.read=function(h){d("read",h),h=parseInt(h,10);var f=this._readableState,I=h;if(h!==0&&(f.emittedReadable=!1),h===0&&f.needReadable&&((f.highWaterMark!==0?f.length>=f.highWaterMark:f.length>0)||f.ended))return d("read: emitReadable",f.length,f.ended),f.length===0&&f.ended?at(this):J(this),null;if((h=q(h,f))===0&&f.ended)return f.length===0&&at(this),null;var B,Y=f.needReadable;return d("need readable",Y),(f.length===0||f.length-h<f.highWaterMark)&&d("length less than watermark",Y=!0),f.ended||f.reading?d("reading or ended",Y=!1):Y&&(d("do read"),f.reading=!0,f.sync=!0,f.length===0&&(f.needReadable=!0),this._read(f.highWaterMark),f.sync=!1,f.reading||(h=q(I,f))),(B=h>0?Z(h,f):null)===null?(f.needReadable=f.length<=f.highWaterMark,h=0):(f.length-=h,f.awaitDrain=0),f.length===0&&(f.ended||(f.needReadable=!0),I!==h&&f.ended&&at(this)),B!==null&&this.emit("data",B),B},k.prototype._read=function(h){Q(this,new V("_read()"))},k.prototype.pipe=function(h,f){var I=this,B=this._readableState;switch(B.pipesCount){case 0:B.pipes=h;break;case 1:B.pipes=[B.pipes,h];break;default:B.pipes.push(h)}B.pipesCount+=1,d("pipe count=%d opts=%j",B.pipesCount,f);var Y=(!f||f.end!==!1)&&h!==P.stdout&&h!==P.stderr?ot:Ht;function X(pt,At){d("onunpipe"),pt===I&&At&&At.hasUnpiped===!1&&(At.hasUnpiped=!0,d("cleanup"),h.removeListener("close",Wt),h.removeListener("finish",Dt),h.removeListener("drain",ut),h.removeListener("error",bt),h.removeListener("unpipe",X),I.removeListener("end",ot),I.removeListener("end",Ht),I.removeListener("data",gt),lt=!0,!B.awaitDrain||h._writableState&&!h._writableState.needDrain||ut())}function ot(){d("onend"),h.end()}B.endEmitted?P.nextTick(Y):I.once("end",Y),h.on("unpipe",X);var ut=function(pt){return function(){var At=pt._readableState;d("pipeOnDrain",At.awaitDrain),At.awaitDrain&&At.awaitDrain--,At.awaitDrain===0&&C(pt,"data")&&(At.flowing=!0,et(pt))}}(I);h.on("drain",ut);var lt=!1;function gt(pt){d("ondata");var At=h.write(pt);d("dest.write",At),At===!1&&((B.pipesCount===1&&B.pipes===h||B.pipesCount>1&&st(B.pipes,h)!==-1)&&!lt&&(d("false write response, pause",B.awaitDrain),B.awaitDrain++),I.pause())}function bt(pt){d("onerror",pt),Ht(),h.removeListener("error",bt),C(h,"error")===0&&Q(h,pt)}function Wt(){h.removeListener("finish",Dt),Ht()}function Dt(){d("onfinish"),h.removeListener("close",Wt),Ht()}function Ht(){d("unpipe"),I.unpipe(h)}return I.on("data",gt),function(pt,At,Qt){if(typeof pt.prependListener=="function")return pt.prependListener(At,Qt);pt._events&&pt._events[At]?Array.isArray(pt._events[At])?pt._events[At].unshift(Qt):pt._events[At]=[Qt,pt._events[At]]:pt.on(At,Qt)}(h,"error",bt),h.once("close",Wt),h.once("finish",Dt),h.emit("pipe",I),B.flowing||(d("pipe resume"),I.resume()),h},k.prototype.unpipe=function(h){var f=this._readableState,I={hasUnpiped:!1};if(f.pipesCount===0)return this;if(f.pipesCount===1)return h&&h!==f.pipes?this:(h||(h=f.pipes),f.pipes=null,f.pipesCount=0,f.flowing=!1,h&&h.emit("unpipe",this,I),this);if(!h){var B=f.pipes,Y=f.pipesCount;f.pipes=null,f.pipesCount=0,f.flowing=!1;for(var X=0;X<Y;X++)B[X].emit("unpipe",this,{hasUnpiped:!1});return this}var ot=st(f.pipes,h);return ot===-1?this:(f.pipes.splice(ot,1),f.pipesCount-=1,f.pipesCount===1&&(f.pipes=f.pipes[0]),h.emit("unpipe",this,I),this)},k.prototype.on=function(h,f){var I=c.prototype.on.call(this,h,f),B=this._readableState;return h==="data"?(B.readableListening=this.listenerCount("readable")>0,B.flowing!==!1&&this.resume()):h==="readable"&&(B.endEmitted||B.readableListening||(B.readableListening=B.needReadable=!0,B.flowing=!1,B.emittedReadable=!1,d("on readable",B.length,B.reading),B.length?J(this):B.reading||P.nextTick(_,this))),I},k.prototype.addListener=k.prototype.on,k.prototype.removeListener=function(h,f){var I=c.prototype.removeListener.call(this,h,f);return h==="readable"&&P.nextTick(H,this),I},k.prototype.removeAllListeners=function(h){var f=c.prototype.removeAllListeners.apply(this,arguments);return h!=="readable"&&h!==void 0||P.nextTick(H,this),f},k.prototype.resume=function(){var h=this._readableState;return h.flowing||(d("resume"),h.flowing=!h.readableListening,function(f,I){I.resumeScheduled||(I.resumeScheduled=!0,P.nextTick(G,f,I))}(this,h)),h.paused=!1,this},k.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},k.prototype.wrap=function(h){var f=this,I=this._readableState,B=!1;for(var Y in h.on("end",function(){if(d("wrapped end"),I.decoder&&!I.ended){var ot=I.decoder.end();ot&&ot.length&&f.push(ot)}f.push(null)}),h.on("data",function(ot){d("wrapped data"),I.decoder&&(ot=I.decoder.write(ot)),(!I.objectMode||ot!=null)&&(I.objectMode||ot&&ot.length)&&(f.push(ot)||(B=!0,h.pause()))}),h)this[Y]===void 0&&typeof h[Y]=="function"&&(this[Y]=function(ot){return function(){return h[ot].apply(h,arguments)}}(Y));for(var X=0;X<tt.length;X++)h.on(tt[X],this.emit.bind(this,tt[X]));return this._read=function(ot){d("wrapped _read",ot),B&&(B=!1,h.resume())},this},typeof Symbol=="function"&&(k.prototype[Symbol.asyncIterator]=function(){return v===void 0&&(v=F("./internal/streams/async_iterator")),v(this)}),Object.defineProperty(k.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(k.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(k.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(f){this._readableState&&(this._readableState.flowing=f)}}),k._fromList=Z,Object.defineProperty(k.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(k.from=function(h,f){return m===void 0&&(m=F("./internal/streams/from")),m(k,h,f)})}).call(this)}).call(this,F("_process"),typeof dt.g!="undefined"?dt.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/async_iterator":61,"./internal/streams/buffer_list":62,"./internal/streams/destroy":63,"./internal/streams/from":65,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,events:22,inherits:24,"string_decoder/":75,util:16}],59:[function(F,$,R){"use strict";$.exports=l;var P=F("../errors").codes,x=P.ERR_METHOD_NOT_IMPLEMENTED,w=P.ERR_MULTIPLE_CALLBACK,C=P.ERR_TRANSFORM_ALREADY_TRANSFORMING,c=P.ERR_TRANSFORM_WITH_LENGTH_0,s=F("./_stream_duplex");function l(u){if(!(this instanceof l))return new l(u);s.call(this,u),this._transformState={afterTransform:function(v,m){var g=this._transformState;g.transforming=!1;var b=g.writecb;if(b===null)return this.emit("error",new w);g.writechunk=null,g.writecb=null,m!=null&&this.push(m),b(v);var y=this._readableState;y.reading=!1,(y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,u&&(typeof u.transform=="function"&&(this._transform=u.transform),typeof u.flush=="function"&&(this._flush=u.flush)),this.on("prefinish",d)}function d(){var u=this;typeof this._flush!="function"||this._readableState.destroyed?a(this,null,null):this._flush(function(v,m){a(u,v,m)})}function a(u,v,m){if(v)return u.emit("error",v);if(m!=null&&u.push(m),u._writableState.length)throw new c;if(u._transformState.transforming)throw new C;return u.push(null)}F("inherits")(l,s),l.prototype.push=function(u,v){return this._transformState.needTransform=!1,s.prototype.push.call(this,u,v)},l.prototype._transform=function(u,v,m){m(new x("_transform()"))},l.prototype._write=function(u,v,m){var g=this._transformState;if(g.writecb=m,g.writechunk=u,g.writeencoding=v,!g.transforming){var b=this._readableState;(g.needTransform||b.needReadable||b.length<b.highWaterMark)&&this._read(b.highWaterMark)}},l.prototype._read=function(u){var v=this._transformState;v.writechunk===null||v.transforming?v.needTransform=!0:(v.transforming=!0,this._transform(v.writechunk,v.writeencoding,v.afterTransform))},l.prototype._destroy=function(u,v){s.prototype._destroy.call(this,u,function(m){v(m)})}},{"../errors":55,"./_stream_duplex":56,inherits:24}],60:[function(F,$,R){(function(P,x){(function(){"use strict";function w(z){var K=this;this.next=null,this.entry=null,this.finish=function(){(function(H,_,G){var et=H.entry;for(H.entry=null;et;){var Z=et.callback;_.pendingcb--,Z(G),et=et.next}_.corkedRequestsFree.next=H})(K,z)}}var C;$.exports=k,k.WritableState=D;var c={deprecate:F("util-deprecate")},s=F("./internal/streams/stream"),l=F("buffer").Buffer,d=x.Uint8Array||function(){},a,u=F("./internal/streams/destroy"),v=F("./internal/streams/state").getHighWaterMark,m=F("../errors").codes,g=m.ERR_INVALID_ARG_TYPE,b=m.ERR_METHOD_NOT_IMPLEMENTED,y=m.ERR_MULTIPLE_CALLBACK,T=m.ERR_STREAM_CANNOT_PIPE,O=m.ERR_STREAM_DESTROYED,M=m.ERR_STREAM_NULL_VALUES,V=m.ERR_STREAM_WRITE_AFTER_END,N=m.ERR_UNKNOWN_ENCODING,Q=u.errorOrDestroy;function tt(){}function D(z,K,H){C=C||F("./_stream_duplex"),z=z||{},typeof H!="boolean"&&(H=K instanceof C),this.objectMode=!!z.objectMode,H&&(this.objectMode=this.objectMode||!!z.writableObjectMode),this.highWaterMark=v(this,z,"writableHighWaterMark",H),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var _=z.decodeStrings===!1;this.decodeStrings=!_,this.defaultEncoding=z.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(G){(function(et,Z){var at=et._writableState,it=at.sync,st=at.writecb;if(typeof st!="function")throw new y;if(function(f){f.writing=!1,f.writecb=null,f.length-=f.writelen,f.writelen=0}(at),Z)(function(f,I,B,Y,X){--I.pendingcb,B?(P.nextTick(X,Y),P.nextTick(W,f,I),f._writableState.errorEmitted=!0,Q(f,Y)):(X(Y),f._writableState.errorEmitted=!0,Q(f,Y),W(f,I))})(et,at,it,Z,st);else{var h=q(at)||et.destroyed;h||at.corked||at.bufferProcessing||!at.bufferedRequest||E(et,at),it?P.nextTick(L,et,at,h,st):L(et,at,h,st)}})(K,G)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=z.emitClose!==!1,this.autoDestroy=!!z.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}function k(z){var K=this instanceof(C=C||F("./_stream_duplex"));if(!K&&!a.call(k,this))return new k(z);this._writableState=new D(z,this,K),this.writable=!0,z&&(typeof z.write=="function"&&(this._write=z.write),typeof z.writev=="function"&&(this._writev=z.writev),typeof z.destroy=="function"&&(this._destroy=z.destroy),typeof z.final=="function"&&(this._final=z.final)),s.call(this)}function A(z,K,H,_,G,et,Z){K.writelen=_,K.writecb=Z,K.writing=!0,K.sync=!0,K.destroyed?K.onwrite(new O("write")):H?z._writev(G,K.onwrite):z._write(G,et,K.onwrite),K.sync=!1}function L(z,K,H,_){H||function(G,et){et.length===0&&et.needDrain&&(et.needDrain=!1,G.emit("drain"))}(z,K),K.pendingcb--,_(),W(z,K)}function E(z,K){K.bufferProcessing=!0;var H=K.bufferedRequest;if(z._writev&&H&&H.next){var _=K.bufferedRequestCount,G=new Array(_),et=K.corkedRequestsFree;et.entry=H;for(var Z=0,at=!0;H;)G[Z]=H,H.isBuf||(at=!1),H=H.next,Z+=1;G.allBuffers=at,A(z,K,!0,K.length,G,"",et.finish),K.pendingcb++,K.lastBufferedRequest=null,et.next?(K.corkedRequestsFree=et.next,et.next=null):K.corkedRequestsFree=new w(K),K.bufferedRequestCount=0}else{for(;H;){var it=H.chunk,st=H.encoding,h=H.callback;if(A(z,K,!1,K.objectMode?1:it.length,it,st,h),H=H.next,K.bufferedRequestCount--,K.writing)break}H===null&&(K.lastBufferedRequest=null)}K.bufferedRequest=H,K.bufferProcessing=!1}function q(z){return z.ending&&z.length===0&&z.bufferedRequest===null&&!z.finished&&!z.writing}function J(z,K){z._final(function(H){K.pendingcb--,H&&Q(z,H),K.prefinished=!0,z.emit("prefinish"),W(z,K)})}function W(z,K){var H=q(K);if(H&&(function(G,et){et.prefinished||et.finalCalled||(typeof G._final!="function"||et.destroyed?(et.prefinished=!0,G.emit("prefinish")):(et.pendingcb++,et.finalCalled=!0,P.nextTick(J,G,et)))}(z,K),K.pendingcb===0&&(K.finished=!0,z.emit("finish"),K.autoDestroy))){var _=z._readableState;(!_||_.autoDestroy&&_.endEmitted)&&z.destroy()}return H}F("inherits")(k,s),D.prototype.getBuffer=function(){for(var z=this.bufferedRequest,K=[];z;)K.push(z),z=z.next;return K},function(){try{Object.defineProperty(D.prototype,"buffer",{get:c.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(z){}}(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(K){return!!a.call(this,K)||this===k&&K&&K._writableState instanceof D}})):a=function(K){return K instanceof this},k.prototype.pipe=function(){Q(this,new T)},k.prototype.write=function(z,K,H){var _,G=this._writableState,et=!1,Z=!G.objectMode&&(_=z,l.isBuffer(_)||_ instanceof d);return Z&&!l.isBuffer(z)&&(z=function(at){return l.from(at)}(z)),typeof K=="function"&&(H=K,K=null),Z?K="buffer":K||(K=G.defaultEncoding),typeof H!="function"&&(H=tt),G.ending?function(at,it){var st=new V;Q(at,st),P.nextTick(it,st)}(this,H):(Z||function(at,it,st,h){var f;return st===null?f=new M:typeof st=="string"||it.objectMode||(f=new g("chunk",["string","Buffer"],st)),!f||(Q(at,f),P.nextTick(h,f),!1)}(this,G,z,H))&&(G.pendingcb++,et=function(at,it,st,h,f,I){if(!st){var B=function(ut,lt,gt){return ut.objectMode||ut.decodeStrings===!1||typeof lt!="string"||(lt=l.from(lt,gt)),lt}(it,h,f);h!==B&&(st=!0,f="buffer",h=B)}var Y=it.objectMode?1:h.length;it.length+=Y;var X=it.length<it.highWaterMark;if(X||(it.needDrain=!0),it.writing||it.corked){var ot=it.lastBufferedRequest;it.lastBufferedRequest={chunk:h,encoding:f,isBuf:st,callback:I,next:null},ot?ot.next=it.lastBufferedRequest:it.bufferedRequest=it.lastBufferedRequest,it.bufferedRequestCount+=1}else A(at,it,!1,Y,h,f,I);return X}(this,G,Z,z,K,H)),et},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var z=this._writableState;z.corked&&(z.corked--,z.writing||z.corked||z.bufferProcessing||!z.bufferedRequest||E(this,z))},k.prototype.setDefaultEncoding=function(z){if(typeof z=="string"&&(z=z.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((z+"").toLowerCase())>-1))throw new N(z);return this._writableState.defaultEncoding=z,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),k.prototype._write=function(z,K,H){H(new b("_write()"))},k.prototype._writev=null,k.prototype.end=function(z,K,H){var _=this._writableState;return typeof z=="function"?(H=z,z=null,K=null):typeof K=="function"&&(H=K,K=null),z!=null&&this.write(z,K),_.corked&&(_.corked=1,this.uncork()),_.ending||function(G,et,Z){et.ending=!0,W(G,et),Z&&(et.finished?P.nextTick(Z):G.once("finish",Z)),et.ended=!0,G.writable=!1}(this,_,H),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(K){this._writableState&&(this._writableState.destroyed=K)}}),k.prototype.destroy=u.destroy,k.prototype._undestroy=u.undestroy,k.prototype._destroy=function(z,K){K(z)}}).call(this)}).call(this,F("_process"),typeof dt.g!="undefined"?dt.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/destroy":63,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,inherits:24,"util-deprecate":78}],61:[function(F,$,R){(function(P){(function(){"use strict";var x;function w(T,O,M){return O in T?Object.defineProperty(T,O,{value:M,enumerable:!0,configurable:!0,writable:!0}):T[O]=M,T}var C=F("./end-of-stream"),c=Symbol("lastResolve"),s=Symbol("lastReject"),l=Symbol("error"),d=Symbol("ended"),a=Symbol("lastPromise"),u=Symbol("handlePromise"),v=Symbol("stream");function m(T,O){return{value:T,done:O}}function g(T){var O=T[c];if(O!==null){var M=T[v].read();M!==null&&(T[a]=null,T[c]=null,T[s]=null,O(m(M,!1)))}}var b=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((w(x={get stream(){return this[v]},next:function(){var O=this,M=this[l];if(M!==null)return Promise.reject(M);if(this[d])return Promise.resolve(m(void 0,!0));if(this[v].destroyed)return new Promise(function(tt,D){P.nextTick(function(){O[l]?D(O[l]):tt(m(void 0,!0))})});var V,N=this[a];if(N)V=new Promise(function(tt,D){return function(k,A){tt.then(function(){D[d]?k(m(void 0,!0)):D[u](k,A)},A)}}(N,this));else{var Q=this[v].read();if(Q!==null)return Promise.resolve(m(Q,!1));V=new Promise(this[u])}return this[a]=V,V}},Symbol.asyncIterator,function(){return this}),w(x,"return",function(){var T=this;return new Promise(function(O,M){T[v].destroy(null,function(V){V?M(V):O(m(void 0,!0))})})}),x),b);$.exports=function(T){var O,M=Object.create(y,(w(O={},v,{value:T,writable:!0}),w(O,c,{value:null,writable:!0}),w(O,s,{value:null,writable:!0}),w(O,l,{value:null,writable:!0}),w(O,d,{value:T._readableState.endEmitted,writable:!0}),w(O,u,{value:function(N,Q){var tt=M[v].read();tt?(M[a]=null,M[c]=null,M[s]=null,N(m(tt,!1))):(M[c]=N,M[s]=Q)},writable:!0}),O));return M[a]=null,C(T,function(V){if(V&&V.code!=="ERR_STREAM_PREMATURE_CLOSE"){var N=M[s];return N!==null&&(M[a]=null,M[c]=null,M[s]=null,N(V)),void(M[l]=V)}var Q=M[c];Q!==null&&(M[a]=null,M[c]=null,M[s]=null,Q(m(void 0,!0))),M[d]=!0}),T.on("readable",function(V){P.nextTick(g,V)}.bind(null,M)),M}}).call(this)}).call(this,F("_process"))},{"./end-of-stream":64,_process:50}],62:[function(F,$,R){"use strict";function P(l,d){var a=Object.keys(l);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(l);d&&(u=u.filter(function(v){return Object.getOwnPropertyDescriptor(l,v).enumerable})),a.push.apply(a,u)}return a}function x(l,d,a){return d in l?Object.defineProperty(l,d,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[d]=a,l}function w(l,d){for(var a=0;a<d.length;a++){var u=d[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(l,u.key,u)}}var C=F("buffer").Buffer,c=F("util").inspect,s=c&&c.custom||"inspect";$.exports=function(){function l(){(function(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,l),this.head=null,this.tail=null,this.length=0}var d,a,u;return d=l,(a=[{key:"push",value:function(m){var g={data:m,next:null};this.length>0?this.tail.next=g:this.head=g,this.tail=g,++this.length}},{key:"unshift",value:function(m){var g={data:m,next:this.head};this.length===0&&(this.tail=g),this.head=g,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var g=this.head,b=""+g.data;g=g.next;)b+=m+g.data;return b}},{key:"concat",value:function(m){if(this.length===0)return C.alloc(0);for(var g,b,y,T=C.allocUnsafe(m>>>0),O=this.head,M=0;O;)g=O.data,b=T,y=M,C.prototype.copy.call(g,b,y),M+=O.data.length,O=O.next;return T}},{key:"consume",value:function(m,g){var b;return m<this.head.data.length?(b=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):b=m===this.head.data.length?this.shift():g?this._getString(m):this._getBuffer(m),b}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var g=this.head,b=1,y=g.data;for(m-=y.length;g=g.next;){var T=g.data,O=m>T.length?T.length:m;if(O===T.length?y+=T:y+=T.slice(0,m),(m-=O)===0){O===T.length?(++b,g.next?this.head=g.next:this.head=this.tail=null):(this.head=g,g.data=T.slice(O));break}++b}return this.length-=b,y}},{key:"_getBuffer",value:function(m){var g=C.allocUnsafe(m),b=this.head,y=1;for(b.data.copy(g),m-=b.data.length;b=b.next;){var T=b.data,O=m>T.length?T.length:m;if(T.copy(g,g.length-m,0,O),(m-=O)===0){O===T.length?(++y,b.next?this.head=b.next:this.head=this.tail=null):(this.head=b,b.data=T.slice(O));break}++y}return this.length-=y,g}},{key:s,value:function(m,g){return c(this,function(b){for(var y=1;y<arguments.length;y++){var T=arguments[y]!=null?arguments[y]:{};y%2?P(Object(T),!0).forEach(function(O){x(b,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(T)):P(Object(T)).forEach(function(O){Object.defineProperty(b,O,Object.getOwnPropertyDescriptor(T,O))})}return b}({},g,{depth:0,customInspect:!1}))}}])&&w(d.prototype,a),u&&w(d,u),l}()},{buffer:17,util:16}],63:[function(F,$,R){(function(P){(function(){"use strict";function x(c,s){C(c,s),w(c)}function w(c){c._writableState&&!c._writableState.emitClose||c._readableState&&!c._readableState.emitClose||c.emit("close")}function C(c,s){c.emit("error",s)}$.exports={destroy:function(s,l){var d=this,a=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return a||u?(l?l(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,P.nextTick(C,this,s)):P.nextTick(C,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(v){!l&&v?d._writableState?d._writableState.errorEmitted?P.nextTick(w,d):(d._writableState.errorEmitted=!0,P.nextTick(x,d,v)):P.nextTick(x,d,v):l?(P.nextTick(w,d),l(v)):P.nextTick(w,d)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(s,l){var d=s._readableState,a=s._writableState;d&&d.autoDestroy||a&&a.autoDestroy?s.destroy(l):s.emit("error",l)}}}).call(this)}).call(this,F("_process"))},{_process:50}],64:[function(F,$,R){"use strict";var P=F("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function x(){}$.exports=function w(C,c,s){if(typeof c=="function")return w(C,null,c);c||(c={}),s=function(O){var M=!1;return function(){if(!M){M=!0;for(var V=arguments.length,N=new Array(V),Q=0;Q<V;Q++)N[Q]=arguments[Q];O.apply(this,N)}}}(s||x);var l=c.readable||c.readable!==!1&&C.readable,d=c.writable||c.writable!==!1&&C.writable,a=function(){C.writable||v()},u=C._writableState&&C._writableState.finished,v=function(){d=!1,u=!0,l||s.call(C)},m=C._readableState&&C._readableState.endEmitted,g=function(){l=!1,m=!0,d||s.call(C)},b=function(M){s.call(C,M)},y=function(){var M;return l&&!m?(C._readableState&&C._readableState.ended||(M=new P),s.call(C,M)):d&&!u?(C._writableState&&C._writableState.ended||(M=new P),s.call(C,M)):void 0},T=function(){C.req.on("finish",v)};return function(O){return O.setHeader&&typeof O.abort=="function"}(C)?(C.on("complete",v),C.on("abort",y),C.req?T():C.on("request",T)):d&&!C._writableState&&(C.on("end",a),C.on("close",a)),C.on("end",g),C.on("finish",v),c.error!==!1&&C.on("error",b),C.on("close",y),function(){C.removeListener("complete",v),C.removeListener("abort",y),C.removeListener("request",T),C.req&&C.req.removeListener("finish",v),C.removeListener("end",a),C.removeListener("close",a),C.removeListener("finish",v),C.removeListener("end",g),C.removeListener("error",b),C.removeListener("close",y)}}},{"../../../errors":55}],65:[function(F,$,R){$.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],66:[function(F,$,R){"use strict";var P,x=F("../../../errors").codes,w=x.ERR_MISSING_ARGS,C=x.ERR_STREAM_DESTROYED;function c(d){if(d)throw d}function s(d){d()}function l(d,a){return d.pipe(a)}$.exports=function(){for(var d=arguments.length,a=new Array(d),u=0;u<d;u++)a[u]=arguments[u];var v,m=function(b){return b.length?typeof b[b.length-1]!="function"?c:b.pop():c}(a);if(Array.isArray(a[0])&&(a=a[0]),a.length<2)throw new w("streams");var g=a.map(function(b,y){var T=y<a.length-1;return function(O,M,V,N){N=function(D){var k=!1;return function(){k||(k=!0,D.apply(void 0,arguments))}}(N);var Q=!1;O.on("close",function(){Q=!0}),P===void 0&&(P=F("./end-of-stream")),P(O,{readable:M,writable:V},function(D){if(D)return N(D);Q=!0,N()});var tt=!1;return function(D){if(!Q&&!tt)return tt=!0,function(k){return k.setHeader&&typeof k.abort=="function"}(O)?O.abort():typeof O.destroy=="function"?O.destroy():void N(D||new C("pipe"))}}(b,T,y>0,function(O){v||(v=O),O&&g.forEach(s),T||(g.forEach(s),m(v))})});return a.reduce(l)}},{"../../../errors":55,"./end-of-stream":64}],67:[function(F,$,R){"use strict";var P=F("../../../errors").codes.ERR_INVALID_OPT_VALUE;$.exports={getHighWaterMark:function(w,C,c,s){var l=function(d,a,u){return d.highWaterMark!=null?d.highWaterMark:a?d[u]:null}(C,s,c);if(l!=null){if(!isFinite(l)||Math.floor(l)!==l||l<0)throw new P(s?c:"highWaterMark",l);return Math.floor(l)}return w.objectMode?16:16384}}},{"../../../errors":55}],68:[function(F,$,R){$.exports=F("events").EventEmitter},{events:22}],69:[function(F,$,R){(R=$.exports=F("./lib/_stream_readable.js")).Stream=R,R.Readable=R,R.Writable=F("./lib/_stream_writable.js"),R.Duplex=F("./lib/_stream_duplex.js"),R.Transform=F("./lib/_stream_transform.js"),R.PassThrough=F("./lib/_stream_passthrough.js"),R.finished=F("./lib/internal/streams/end-of-stream.js"),R.pipeline=F("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":56,"./lib/_stream_passthrough.js":57,"./lib/_stream_readable.js":58,"./lib/_stream_transform.js":59,"./lib/_stream_writable.js":60,"./lib/internal/streams/end-of-stream.js":64,"./lib/internal/streams/pipeline.js":66}],70:[function(F,$,R){"use strict";$.exports=function(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("interval needed");var P;if(arguments.length>0){P=new Array(arguments.length-2);for(var x=0;x<P.length;x++)P[x]=arguments[x+2]}return new function(w,C,c){var s=this;this._callback=w,this._args=c,this._interval=setInterval(w,C,this._args),this.reschedule=function(l){l||(l=s._interval),s._interval&&clearInterval(s._interval),s._interval=setInterval(s._callback,l,s._args)},this.clear=function(){s._interval&&(clearInterval(s._interval),s._interval=void 0)},this.destroy=function(){s._interval&&clearInterval(s._interval),s._callback=void 0,s._interval=void 0,s._args=void 0}}(arguments[0],arguments[1],P)}},{}],71:[function(F,$,R){"use strict";$.exports=F("./index.js")()},{"./index.js":72}],72:[function(F,$,R){(function(P){(function(){"use strict";function x(w){return w instanceof P?P.from(w):new w.constructor(w.buffer.slice(),w.byteOffset,w.length)}$.exports=function(w){return(w=w||{}).circles?function(c){var s=[],l=[];return c.proto?function a(u){if(typeof u!="object"||u===null)return u;if(u instanceof Date)return new Date(u);if(Array.isArray(u))return d(u,a);if(u instanceof Map)return new Map(d(Array.from(u),a));if(u instanceof Set)return new Set(d(Array.from(u),a));var v={};for(var m in s.push(u),l.push(v),u){var g=u[m];if(typeof g!="object"||g===null)v[m]=g;else if(g instanceof Date)v[m]=new Date(g);else if(g instanceof Map)v[m]=new Map(d(Array.from(g),a));else if(g instanceof Set)v[m]=new Set(d(Array.from(g),a));else if(ArrayBuffer.isView(g))v[m]=x(g);else{var b=s.indexOf(g);v[m]=b!==-1?l[b]:a(g)}}return s.pop(),l.pop(),v}:function a(u){if(typeof u!="object"||u===null)return u;if(u instanceof Date)return new Date(u);if(Array.isArray(u))return d(u,a);if(u instanceof Map)return new Map(d(Array.from(u),a));if(u instanceof Set)return new Set(d(Array.from(u),a));var v={};for(var m in s.push(u),l.push(v),u)if(Object.hasOwnProperty.call(u,m)!==!1){var g=u[m];if(typeof g!="object"||g===null)v[m]=g;else if(g instanceof Date)v[m]=new Date(g);else if(g instanceof Map)v[m]=new Map(d(Array.from(g),a));else if(g instanceof Set)v[m]=new Set(d(Array.from(g),a));else if(ArrayBuffer.isView(g))v[m]=x(g);else{var b=s.indexOf(g);v[m]=b!==-1?l[b]:a(g)}}return s.pop(),l.pop(),v};function d(a,u){for(var v=Object.keys(a),m=new Array(v.length),g=0;g<v.length;g++){var b=v[g],y=a[b];if(typeof y!="object"||y===null)m[b]=y;else if(y instanceof Date)m[b]=new Date(y);else if(ArrayBuffer.isView(y))m[b]=x(y);else{var T=s.indexOf(y);m[b]=T!==-1?l[T]:u(y)}}return m}}(w):w.proto?function c(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return C(s,c);if(s instanceof Map)return new Map(C(Array.from(s),c));if(s instanceof Set)return new Set(C(Array.from(s),c));var l={};for(var d in s){var a=s[d];typeof a!="object"||a===null?l[d]=a:a instanceof Date?l[d]=new Date(a):a instanceof Map?l[d]=new Map(C(Array.from(a),c)):a instanceof Set?l[d]=new Set(C(Array.from(a),c)):ArrayBuffer.isView(a)?l[d]=x(a):l[d]=c(a)}return l}:function c(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return C(s,c);if(s instanceof Map)return new Map(C(Array.from(s),c));if(s instanceof Set)return new Set(C(Array.from(s),c));var l={};for(var d in s)if(Object.hasOwnProperty.call(s,d)!==!1){var a=s[d];typeof a!="object"||a===null?l[d]=a:a instanceof Date?l[d]=new Date(a):a instanceof Map?l[d]=new Map(C(Array.from(a),c)):a instanceof Set?l[d]=new Set(C(Array.from(a),c)):ArrayBuffer.isView(a)?l[d]=x(a):l[d]=c(a)}return l};function C(c,s){for(var l=Object.keys(c),d=new Array(l.length),a=0;a<l.length;a++){var u=l[a],v=c[u];typeof v!="object"||v===null?d[u]=v:v instanceof Date?d[u]=new Date(v):ArrayBuffer.isView(v)?d[u]=x(v):d[u]=s(v)}return d}}}).call(this)}).call(this,F("buffer").Buffer)},{buffer:17}],73:[function(F,$,R){var P=F("buffer"),x=P.Buffer;function w(c,s){for(var l in c)s[l]=c[l]}function C(c,s,l){return x(c,s,l)}x.from&&x.alloc&&x.allocUnsafe&&x.allocUnsafeSlow?$.exports=P:(w(P,R),R.Buffer=C),C.prototype=Object.create(x.prototype),w(x,C),C.from=function(c,s,l){if(typeof c=="number")throw new TypeError("Argument must not be a number");return x(c,s,l)},C.alloc=function(c,s,l){if(typeof c!="number")throw new TypeError("Argument must be a number");var d=x(c);return s!==void 0?typeof l=="string"?d.fill(s,l):d.fill(s):d.fill(0),d},C.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return x(c)},C.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return P.SlowBuffer(c)}},{buffer:17}],74:[function(F,$,R){$.exports=function(P){var x=P._readableState;return x?x.objectMode||typeof P._duplexState=="number"?P.read():P.read((w=x,w.buffer.length?w.buffer.head?w.buffer.head.data.length:w.buffer[0].length:w.length)):null;var w}},{}],75:[function(F,$,R){"use strict";var P=F("safe-buffer").Buffer,x=P.isEncoding||function(m){switch((m=""+m)&&m.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function w(m){var g;switch(this.encoding=function(b){var y=function(T){if(!T)return"utf8";for(var O;;)switch(T){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return T;default:if(O)return;T=(""+T).toLowerCase(),O=!0}}(b);if(typeof y!="string"&&(P.isEncoding===x||!x(b)))throw new Error("Unknown encoding: "+b);return y||b}(m),this.encoding){case"utf16le":this.text=s,this.end=l,g=4;break;case"utf8":this.fillLast=c,g=4;break;case"base64":this.text=d,this.end=a,g=3;break;default:return this.write=u,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=P.allocUnsafe(g)}function C(m){return m<=127?0:m>>5==6?2:m>>4==14?3:m>>3==30?4:m>>6==2?-1:-2}function c(m){var g=this.lastTotal-this.lastNeed,b=function(y,T,O){if((192&T[0])!=128)return y.lastNeed=0,"\uFFFD";if(y.lastNeed>1&&T.length>1){if((192&T[1])!=128)return y.lastNeed=1,"\uFFFD";if(y.lastNeed>2&&T.length>2&&(192&T[2])!=128)return y.lastNeed=2,"\uFFFD"}}(this,m);return b!==void 0?b:this.lastNeed<=m.length?(m.copy(this.lastChar,g,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(m.copy(this.lastChar,g,0,m.length),void(this.lastNeed-=m.length))}function s(m,g){if((m.length-g)%2==0){var b=m.toString("utf16le",g);if(b){var y=b.charCodeAt(b.length-1);if(y>=55296&&y<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1],b.slice(0,-1)}return b}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=m[m.length-1],m.toString("utf16le",g,m.length-1)}function l(m){var g=m&&m.length?this.write(m):"";if(this.lastNeed){var b=this.lastTotal-this.lastNeed;return g+this.lastChar.toString("utf16le",0,b)}return g}function d(m,g){var b=(m.length-g)%3;return b===0?m.toString("base64",g):(this.lastNeed=3-b,this.lastTotal=3,b===1?this.lastChar[0]=m[m.length-1]:(this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1]),m.toString("base64",g,m.length-b))}function a(m){var g=m&&m.length?this.write(m):"";return this.lastNeed?g+this.lastChar.toString("base64",0,3-this.lastNeed):g}function u(m){return m.toString(this.encoding)}function v(m){return m&&m.length?this.write(m):""}R.StringDecoder=w,w.prototype.write=function(m){if(m.length===0)return"";var g,b;if(this.lastNeed){if((g=this.fillLast(m))===void 0)return"";b=this.lastNeed,this.lastNeed=0}else b=0;return b<m.length?g?g+this.text(m,b):this.text(m,b):g||""},w.prototype.end=function(m){var g=m&&m.length?this.write(m):"";return this.lastNeed?g+"\uFFFD":g},w.prototype.text=function(m,g){var b=function(T,O,M){var V=O.length-1;if(V<M)return 0;var N=C(O[V]);return N>=0?(N>0&&(T.lastNeed=N-1),N):--V<M||N===-2?0:(N=C(O[V]))>=0?(N>0&&(T.lastNeed=N-2),N):--V<M||N===-2?0:(N=C(O[V]))>=0?(N>0&&(N===2?N=0:T.lastNeed=N-3),N):0}(this,m,g);if(!this.lastNeed)return m.toString("utf8",g);this.lastTotal=b;var y=m.length-(b-this.lastNeed);return m.copy(this.lastChar,0,y),m.toString("utf8",g,y)},w.prototype.fillLast=function(m){if(this.lastNeed<=m.length)return m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,m.length),this.lastNeed-=m.length}},{"safe-buffer":73}],76:[function(F,$,R){"use strict";var P=F("punycode"),x=F("./util");function w(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}R.parse=O,R.resolve=function(M,V){return O(M,!1,!0).resolve(V)},R.resolveObject=function(M,V){return M?O(M,!1,!0).resolveObject(V):V},R.format=function(M){return x.isString(M)&&(M=O(M)),M instanceof w?M.format():w.prototype.format.call(M)},R.Url=w;var C=/^([a-z0-9.+-]+:)/i,c=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),d=["'"].concat(l),a=["%","/","?",";","#"].concat(d),u=["/","?","#"],v=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},b={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},T=F("querystring");function O(M,V,N){if(M&&x.isObject(M)&&M instanceof w)return M;var Q=new w;return Q.parse(M,V,N),Q}w.prototype.parse=function(M,V,N){if(!x.isString(M))throw new TypeError("Parameter 'url' must be a string, not "+typeof M);var Q=M.indexOf("?"),tt=Q!==-1&&Q<M.indexOf("#")?"?":"#",D=M.split(tt);D[0]=D[0].replace(/\\/g,"/");var k=M=D.join(tt);if(k=k.trim(),!N&&M.split("#").length===1){var A=s.exec(k);if(A)return this.path=k,this.href=k,this.pathname=A[1],A[2]?(this.search=A[2],this.query=V?T.parse(this.search.substr(1)):this.search.substr(1)):V&&(this.search="",this.query={}),this}var L=C.exec(k);if(L){var E=(L=L[0]).toLowerCase();this.protocol=E,k=k.substr(L.length)}if(N||L||k.match(/^\/\/[^@\/]+@[^@\/]+/)){var q=k.substr(0,2)==="//";!q||L&&b[L]||(k=k.substr(2),this.slashes=!0)}if(!b[L]&&(q||L&&!y[L])){for(var J,W,z=-1,K=0;K<u.length;K++)(H=k.indexOf(u[K]))!==-1&&(z===-1||H<z)&&(z=H);for((W=z===-1?k.lastIndexOf("@"):k.lastIndexOf("@",z))!==-1&&(J=k.slice(0,W),k=k.slice(W+1),this.auth=decodeURIComponent(J)),z=-1,K=0;K<a.length;K++){var H;(H=k.indexOf(a[K]))!==-1&&(z===-1||H<z)&&(z=H)}z===-1&&(z=k.length),this.host=k.slice(0,z),k=k.slice(z),this.parseHost(),this.hostname=this.hostname||"";var _=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!_)for(var G=this.hostname.split(/\./),et=(K=0,G.length);K<et;K++){var Z=G[K];if(Z&&!Z.match(v)){for(var at="",it=0,st=Z.length;it<st;it++)Z.charCodeAt(it)>127?at+="x":at+=Z[it];if(!at.match(v)){var h=G.slice(0,K),f=G.slice(K+1),I=Z.match(m);I&&(h.push(I[1]),f.unshift(I[2])),f.length&&(k="/"+f.join(".")+k),this.hostname=h.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=P.toASCII(this.hostname));var B=this.port?":"+this.port:"",Y=this.hostname||"";this.host=Y+B,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),k[0]!=="/"&&(k="/"+k))}if(!g[E])for(K=0,et=d.length;K<et;K++){var X=d[K];if(k.indexOf(X)!==-1){var ot=encodeURIComponent(X);ot===X&&(ot=escape(X)),k=k.split(X).join(ot)}}var ut=k.indexOf("#");ut!==-1&&(this.hash=k.substr(ut),k=k.slice(0,ut));var lt=k.indexOf("?");if(lt!==-1?(this.search=k.substr(lt),this.query=k.substr(lt+1),V&&(this.query=T.parse(this.query)),k=k.slice(0,lt)):V&&(this.search="",this.query={}),k&&(this.pathname=k),y[E]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var gt=this.search||"";this.path=B+gt}return this.href=this.format(),this},w.prototype.format=function(){var M=this.auth||"";M&&(M=(M=encodeURIComponent(M)).replace(/%3A/i,":"),M+="@");var V=this.protocol||"",N=this.pathname||"",Q=this.hash||"",tt=!1,D="";this.host?tt=M+this.host:this.hostname&&(tt=M+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(tt+=":"+this.port)),this.query&&x.isObject(this.query)&&Object.keys(this.query).length&&(D=T.stringify(this.query));var k=this.search||D&&"?"+D||"";return V&&V.substr(-1)!==":"&&(V+=":"),this.slashes||(!V||y[V])&&tt!==!1?(tt="//"+(tt||""),N&&N.charAt(0)!=="/"&&(N="/"+N)):tt||(tt=""),Q&&Q.charAt(0)!=="#"&&(Q="#"+Q),k&&k.charAt(0)!=="?"&&(k="?"+k),V+tt+(N=N.replace(/[?#]/g,function(A){return encodeURIComponent(A)}))+(k=k.replace("#","%23"))+Q},w.prototype.resolve=function(M){return this.resolveObject(O(M,!1,!0)).format()},w.prototype.resolveObject=function(M){if(x.isString(M)){var V=new w;V.parse(M,!1,!0),M=V}for(var N=new w,Q=Object.keys(this),tt=0;tt<Q.length;tt++){var D=Q[tt];N[D]=this[D]}if(N.hash=M.hash,M.href==="")return N.href=N.format(),N;if(M.slashes&&!M.protocol){for(var k=Object.keys(M),A=0;A<k.length;A++){var L=k[A];L!=="protocol"&&(N[L]=M[L])}return y[N.protocol]&&N.hostname&&!N.pathname&&(N.path=N.pathname="/"),N.href=N.format(),N}if(M.protocol&&M.protocol!==N.protocol){if(!y[M.protocol]){for(var E=Object.keys(M),q=0;q<E.length;q++){var J=E[q];N[J]=M[J]}return N.href=N.format(),N}if(N.protocol=M.protocol,M.host||b[M.protocol])N.pathname=M.pathname;else{for(var W=(M.pathname||"").split("/");W.length&&!(M.host=W.shift()););M.host||(M.host=""),M.hostname||(M.hostname=""),W[0]!==""&&W.unshift(""),W.length<2&&W.unshift(""),N.pathname=W.join("/")}if(N.search=M.search,N.query=M.query,N.host=M.host||"",N.auth=M.auth,N.hostname=M.hostname||M.host,N.port=M.port,N.pathname||N.search){var z=N.pathname||"",K=N.search||"";N.path=z+K}return N.slashes=N.slashes||M.slashes,N.href=N.format(),N}var H=N.pathname&&N.pathname.charAt(0)==="/",_=M.host||M.pathname&&M.pathname.charAt(0)==="/",G=_||H||N.host&&M.pathname,et=G,Z=N.pathname&&N.pathname.split("/")||[],at=(W=M.pathname&&M.pathname.split("/")||[],N.protocol&&!y[N.protocol]);if(at&&(N.hostname="",N.port=null,N.host&&(Z[0]===""?Z[0]=N.host:Z.unshift(N.host)),N.host="",M.protocol&&(M.hostname=null,M.port=null,M.host&&(W[0]===""?W[0]=M.host:W.unshift(M.host)),M.host=null),G=G&&(W[0]===""||Z[0]==="")),_)N.host=M.host||M.host===""?M.host:N.host,N.hostname=M.hostname||M.hostname===""?M.hostname:N.hostname,N.search=M.search,N.query=M.query,Z=W;else if(W.length)Z||(Z=[]),Z.pop(),Z=Z.concat(W),N.search=M.search,N.query=M.query;else if(!x.isNullOrUndefined(M.search))return at&&(N.hostname=N.host=Z.shift(),(I=!!(N.host&&N.host.indexOf("@")>0)&&N.host.split("@"))&&(N.auth=I.shift(),N.host=N.hostname=I.shift())),N.search=M.search,N.query=M.query,x.isNull(N.pathname)&&x.isNull(N.search)||(N.path=(N.pathname?N.pathname:"")+(N.search?N.search:"")),N.href=N.format(),N;if(!Z.length)return N.pathname=null,N.search?N.path="/"+N.search:N.path=null,N.href=N.format(),N;for(var it=Z.slice(-1)[0],st=(N.host||M.host||Z.length>1)&&(it==="."||it==="..")||it==="",h=0,f=Z.length;f>=0;f--)(it=Z[f])==="."?Z.splice(f,1):it===".."?(Z.splice(f,1),h++):h&&(Z.splice(f,1),h--);if(!G&&!et)for(;h--;h)Z.unshift("..");!G||Z[0]===""||Z[0]&&Z[0].charAt(0)==="/"||Z.unshift(""),st&&Z.join("/").substr(-1)!=="/"&&Z.push("");var I,B=Z[0]===""||Z[0]&&Z[0].charAt(0)==="/";return at&&(N.hostname=N.host=B?"":Z.length?Z.shift():"",(I=!!(N.host&&N.host.indexOf("@")>0)&&N.host.split("@"))&&(N.auth=I.shift(),N.host=N.hostname=I.shift())),(G=G||N.host&&Z.length)&&!B&&Z.unshift(""),Z.length?N.pathname=Z.join("/"):(N.pathname=null,N.path=null),x.isNull(N.pathname)&&x.isNull(N.search)||(N.path=(N.pathname?N.pathname:"")+(N.search?N.search:"")),N.auth=M.auth||N.auth,N.slashes=N.slashes||M.slashes,N.href=N.format(),N},w.prototype.parseHost=function(){var M=this.host,V=c.exec(M);V&&((V=V[0])!==":"&&(this.port=V.substr(1)),M=M.substr(0,M.length-V.length)),M&&(this.hostname=M)}},{"./util":77,punycode:51,querystring:54}],77:[function(F,$,R){"use strict";$.exports={isString:function(x){return typeof x=="string"},isObject:function(x){return typeof x=="object"&&x!==null},isNull:function(x){return x===null},isNullOrUndefined:function(x){return x==null}}},{}],78:[function(F,$,R){(function(P){(function(){function x(w){try{if(!P.localStorage)return!1}catch(c){return!1}var C=P.localStorage[w];return C!=null&&String(C).toLowerCase()==="true"}$.exports=function(w,C){if(x("noDeprecation"))return w;var c=!1;return function(){if(!c){if(x("throwDeprecation"))throw new Error(C);x("traceDeprecation")?console.trace(C):console.warn(C),c=!0}return w.apply(this,arguments)}}}).call(this)}).call(this,typeof dt.g!="undefined"?dt.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],79:[function(F,$,R){$.exports=function P(x,w){if(x&&w)return P(x)(w);if(typeof x!="function")throw new TypeError("need wrapper function");return Object.keys(x).forEach(function(c){C[c]=x[c]}),C;function C(){for(var c=new Array(arguments.length),s=0;s<c.length;s++)c[s]=arguments[s];var l=x.apply(this,c),d=c[c.length-1];return typeof l=="function"&&l!==d&&Object.keys(d).forEach(function(a){l[a]=d[a]}),l}}},{}],80:[function(F,$,R){"use strict";$.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],81:[function(F,$,R){$.exports=function(){for(var x={},w=0;w<arguments.length;w++){var C=arguments[w];for(var c in C)P.call(C,c)&&(x[c]=C[c])}return x};var P=Object.prototype.hasOwnProperty},{}],82:[function(F,$,R){"use strict";$.exports=function(P){P.prototype[Symbol.iterator]=nt.mark(function x(){var w;return nt.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:w=this.head;case 1:if(!w){c.next=7;break}return c.next=4,w.value;case 4:w=w.next,c.next=1;break;case 7:case"end":return c.stop()}},x,this)})}},{}],83:[function(F,$,R){"use strict";function P(s){var l=this;if(l instanceof P||(l=new P),l.tail=null,l.head=null,l.length=0,s&&typeof s.forEach=="function")s.forEach(function(u){l.push(u)});else if(arguments.length>0)for(var d=0,a=arguments.length;d<a;d++)l.push(arguments[d]);return l}function x(s,l,d){var a=l===s.head?new c(d,null,l,s):new c(d,l,l.next,s);return a.next===null&&(s.tail=a),a.prev===null&&(s.head=a),s.length++,a}function w(s,l){s.tail=new c(l,s.tail,null,s),s.head||(s.head=s.tail),s.length++}function C(s,l){s.head=new c(l,null,s.head,s),s.tail||(s.tail=s.head),s.length++}function c(s,l,d,a){if(!(this instanceof c))return new c(s,l,d,a);this.list=a,this.value=s,l?(l.next=this,this.prev=l):this.prev=null,d?(d.prev=this,this.next=d):this.next=null}$.exports=P,P.Node=c,P.create=P,P.prototype.removeNode=function(s){if(s.list!==this)throw new Error("removing node which does not belong to this list");var l=s.next,d=s.prev;return l&&(l.prev=d),d&&(d.next=l),s===this.head&&(this.head=l),s===this.tail&&(this.tail=d),s.list.length--,s.next=null,s.prev=null,s.list=null,l},P.prototype.unshiftNode=function(s){if(s!==this.head){s.list&&s.list.removeNode(s);var l=this.head;s.list=this,s.next=l,l&&(l.prev=s),this.head=s,this.tail||(this.tail=s),this.length++}},P.prototype.pushNode=function(s){if(s!==this.tail){s.list&&s.list.removeNode(s);var l=this.tail;s.list=this,s.prev=l,l&&(l.next=s),this.tail=s,this.head||(this.head=s),this.length++}},P.prototype.push=function(){for(var s=0,l=arguments.length;s<l;s++)w(this,arguments[s]);return this.length},P.prototype.unshift=function(){for(var s=0,l=arguments.length;s<l;s++)C(this,arguments[s]);return this.length},P.prototype.pop=function(){if(this.tail){var s=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,s}},P.prototype.shift=function(){if(this.head){var s=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,s}},P.prototype.forEach=function(s,l){l=l||this;for(var d=this.head,a=0;d!==null;a++)s.call(l,d.value,a,this),d=d.next},P.prototype.forEachReverse=function(s,l){l=l||this;for(var d=this.tail,a=this.length-1;d!==null;a--)s.call(l,d.value,a,this),d=d.prev},P.prototype.get=function(s){for(var l=0,d=this.head;d!==null&&l<s;l++)d=d.next;if(l===s&&d!==null)return d.value},P.prototype.getReverse=function(s){for(var l=0,d=this.tail;d!==null&&l<s;l++)d=d.prev;if(l===s&&d!==null)return d.value},P.prototype.map=function(s,l){l=l||this;for(var d=new P,a=this.head;a!==null;)d.push(s.call(l,a.value,this)),a=a.next;return d},P.prototype.mapReverse=function(s,l){l=l||this;for(var d=new P,a=this.tail;a!==null;)d.push(s.call(l,a.value,this)),a=a.prev;return d},P.prototype.reduce=function(s,l){var d,a=this.head;if(arguments.length>1)d=l;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");a=this.head.next,d=this.head.value}for(var u=0;a!==null;u++)d=s(d,a.value,u),a=a.next;return d},P.prototype.reduceReverse=function(s,l){var d,a=this.tail;if(arguments.length>1)d=l;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");a=this.tail.prev,d=this.tail.value}for(var u=this.length-1;a!==null;u--)d=s(d,a.value,u),a=a.prev;return d},P.prototype.toArray=function(){for(var s=new Array(this.length),l=0,d=this.head;d!==null;l++)s[l]=d.value,d=d.next;return s},P.prototype.toArrayReverse=function(){for(var s=new Array(this.length),l=0,d=this.tail;d!==null;l++)s[l]=d.value,d=d.prev;return s},P.prototype.slice=function(s,l){(l=l||this.length)<0&&(l+=this.length),(s=s||0)<0&&(s+=this.length);var d=new P;if(l<s||l<0)return d;s<0&&(s=0),l>this.length&&(l=this.length);for(var a=0,u=this.head;u!==null&&a<s;a++)u=u.next;for(;u!==null&&a<l;a++,u=u.next)d.push(u.value);return d},P.prototype.sliceReverse=function(s,l){(l=l||this.length)<0&&(l+=this.length),(s=s||0)<0&&(s+=this.length);var d=new P;if(l<s||l<0)return d;s<0&&(s=0),l>this.length&&(l=this.length);for(var a=this.length,u=this.tail;u!==null&&a>l;a--)u=u.prev;for(;u!==null&&a>s;a--,u=u.prev)d.push(u.value);return d},P.prototype.splice=function(s,l){s>this.length&&(s=this.length-1),s<0&&(s=this.length+s);for(var d=0,a=this.head;a!==null&&d<s;d++)a=a.next;var u=[];for(d=0;a&&d<l;d++)u.push(a.value),a=this.removeNode(a);for(a===null&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev),d=0;d<(arguments.length<=2?0:arguments.length-2);d++)a=x(this,a,d+2<2||arguments.length<=d+2?void 0:arguments[d+2]);return u},P.prototype.reverse=function(){for(var s=this.head,l=this.tail,d=s;d!==null;d=d.prev){var a=d.prev;d.prev=d.next,d.next=a}return this.head=l,this.tail=s,this};try{F("./iterator.js")(P)}catch(s){}},{"./iterator.js":82}]},{},[12])(12)})}}]);
