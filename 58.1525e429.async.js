(self.webpackChunkrh_template_umi=self.webpackChunkrh_template_umi||[]).push([[58],{263:function(It){function mt(ft){if(ft===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ft}It.exports=mt},46507:function(It){function mt(ft,nt){if(!(ft instanceof nt))throw new TypeError("Cannot call a class as a function")}It.exports=mt},21364:function(It){function mt(nt,kt){for(var vt=0;vt<kt.length;vt++){var wt=kt[vt];wt.enumerable=wt.enumerable||!1,wt.configurable=!0,"value"in wt&&(wt.writable=!0),Object.defineProperty(nt,wt.key,wt)}}function ft(nt,kt,vt){return kt&&mt(nt.prototype,kt),vt&&mt(nt,vt),nt}It.exports=ft},25102:function(It,mt,ft){var nt=ft(74752),kt=ft(63213),vt=ft(26416);function wt(Tt){var Lt=kt();return function(){var xt=nt(Tt),D;if(Lt){var Z=nt(this).constructor;D=Reflect.construct(xt,arguments,Z)}else D=xt.apply(this,arguments);return vt(this,D)}}It.exports=wt},74752:function(It){function mt(ft){return It.exports=mt=Object.setPrototypeOf?Object.getPrototypeOf:function(kt){return kt.__proto__||Object.getPrototypeOf(kt)},mt(ft)}It.exports=mt},79764:function(It,mt,ft){var nt=ft(31748);function kt(vt,wt){if(typeof wt!="function"&&wt!==null)throw new TypeError("Super expression must either be null or a function");vt.prototype=Object.create(wt&&wt.prototype,{constructor:{value:vt,writable:!0,configurable:!0}}),wt&&nt(vt,wt)}It.exports=kt},63213:function(It){function mt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(ft){return!1}}It.exports=mt},26416:function(It,mt,ft){var nt=ft(74770),kt=ft(263);function vt(wt,Tt){return Tt&&(nt(Tt)==="object"||typeof Tt=="function")?Tt:kt(wt)}It.exports=vt},31748:function(It){function mt(ft,nt){return It.exports=mt=Object.setPrototypeOf||function(vt,wt){return vt.__proto__=wt,vt},mt(ft,nt)}It.exports=mt},74770:function(It){function mt(ft){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?It.exports=mt=function(kt){return typeof kt}:It.exports=mt=function(kt){return kt&&typeof Symbol=="function"&&kt.constructor===Symbol&&kt!==Symbol.prototype?"symbol":typeof kt},mt(ft)}It.exports=mt},9058:function(It,mt,ft){"use strict";ft.d(mt,{$E:function(){return nt},zR:function(){return vt},bs:function(){return wt}});function nt(w,T){w.beginPath(),w.ellipse(T.rect.x+T.rect.width/2,T.rect.y+T.rect.height/2,T.rect.width/2,T.rect.height/2,0,0,Math.PI*2),w.stroke(),w.beginPath(),w.fillStyle=w.strokeStyle,w.ellipse(T.rect.x+T.rect.width/2,T.rect.y+T.rect.height/2,T.rect.width/4,T.rect.height/4,0,0,Math.PI*2),w.fill()}var kt=ft(5646);function vt(w){w.iconRect=new kt.UL(0,0,0,0)}function wt(w){var T=w.rect.width*5/7,c=w.rect.height*5/7;w.textRect=new kt.UL(w.rect.x+(w.rect.width-T)/2,w.rect.y+(w.rect.height-c)/2,T,c),w.fullTextRect=w.textRect}function Tt(w){w.iconRect=new Rect(0,0,0,0)}function Lt(w){w.textRect=new Rect(w.rect.x,w.rect.y,w.rect.width,w.rect.height),w.fullTextRect=w.textRect}function At(w){w.anchors.push(new Point(w.rect.x,w.rect.y+w.rect.height/2,Direction.Left)),w.anchors.push(new Point(w.rect.ex,w.rect.y+w.rect.height/2,Direction.Right));for(var T=5,c=T;w.rect.x+c<w.rect.ex;c=c+T){var s=new Point(w.rect.x+c,w.rect.y,Direction.Up),l=new Point(w.rect.x+c,w.rect.ey,Direction.Bottom);s.hidden=!0,l.hidden=!0,w.anchors.push(s),w.anchors.push(l)}}function xt(w){w.anchors.push(new Point(w.rect.x+w.rect.width/2,w.rect.y,Direction.Up)),w.anchors.push(new Point(w.rect.x+w.rect.width/2,w.rect.ey,Direction.Bottom));for(var T=5,c=T;w.rect.y+c<w.rect.ey;c=c+T){var s=new Point(w.rect.x,w.rect.y+c,Direction.Left),l=new Point(w.rect.ex,w.rect.y+c,Direction.Right);s.hidden=!0,l.hidden=!0,w.anchors.push(s),w.anchors.push(l)}}function D(w){w.iconRect=new Rect(0,0,0,0)}function Z(w){w.textRect=new Rect(w.rect.x+10,w.rect.y,20,w.rect.height),w.fullTextRect=w.textRect}function R(w){w.iconRect=new Rect(0,0,0,0)}function P(w){w.textRect=new Rect(w.rect.x,w.rect.y,w.rect.width,40),w.fullTextRect=w.textRect}function x(){registerNode("activityFinal",activityFinal,null,activityFinalIconRect,activityFinalTextRect),registerNode("swimlaneV",swimlaneV,null,swimlaneVIconRect,swimlaneVTextRect),registerNode("swimlaneH",swimlaneH,null,swimlaneHIconRect,swimlaneHTextRect),registerNode("forkH",fork,forkHAnchors,forkIconRect,forkTextRect),registerNode("forkV",fork,forkVAnchors,forkIconRect,forkTextRect)}},5646:function(It,mt,ft){"use strict";ft.d(mt,{x1:function(){return Ot},gb:function(){return Fe},NB:function(){return Nt},aH:function(){return g},E9:function(){return R},UL:function(){return a},d3:function(){return Si},wC:function(){return Qr},Dz:function(){return $t},fs:function(){return Gr},C9:function(){return N},iZ:function(){return Ne},s8:function(){return xt}});var nt=ft(32362);function kt(r){return{all:r=r||new Map,on:function(e,i){var n=r.get(e);n&&n.push(i)||r.set(e,[i])},off:function(e,i){var n=r.get(e);n&&n.splice(n.indexOf(i)>>>0,1)},emit:function(e,i){(r.get(e)||[]).slice().map(function(n){n(i)}),(r.get("*")||[]).slice().map(function(n){n(e,i)})}}}var vt;(function(r){r[r.Any=-1]="Any",r[r.CtrlOrAlt=0]="CtrlOrAlt",r[r.Ctrl=1]="Ctrl",r[r.Shift=2]="Shift",r[r.Alt=3]="Alt",r[r.Right=4]="Right"})(vt||(vt={}));var wt;(function(r){r[r.None=-1]="None",r[r.Document=0]="Document",r[r.Canvas=1]="Canvas"})(wt||(wt={}));var Tt=["fontColor","fontFamily","fontSize","lineHeight","textAlign","textBaseline"],Lt={cacheLen:30,refresh:30,fontColor:"#222222",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"center",textBaseline:"middle",color:"#222222",activeColor:"#1890ff",hoverColor:"#fa541c",anchorRadius:4,anchorFillStyle:"#fff",dockStrokeStyle:"#fa541c",dockFillStyle:"#fa541c",dragColor:"#1890ff",rotateCursor:"/assets/img/rotate.cur",hoverCursor:"pointer",minScale:.3,maxScale:5,anchorSize:5,keydown:wt.Document,viewPadding:0,gridSize:10,gridColor:"#f3f3f3",ruleColor:"#888888",scaleCache:!0};function At(){return((1+Math.random())*65536|0).toString(16).substring(1)}function xt(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function D(){return At()+xt()}function Z(){return xt()+xt()}var R=function(){function r(t,e,i,n,o,p,b){this.x=t,this.y=e,this.direction=i,this.anchorIndex=n,this.id=o,this.hidden=p,this.autoAnchor=b}return r.prototype.floor=function(){this.x|=0,this.y|=0},r.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},r.prototype.clone=function(){var t=new r(this.x,this.y,this.direction,this.anchorIndex,this.id,this.hidden,this.autoAnchor);return this.data&&(t.data=this.data),this.mode&&(t.mode=this.mode),t},r.prototype.hit=function(t,e){return e===void 0&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},r.prototype.rotate=function(t,e){if(!t||t===360)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,n=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=n,this},r.prototype.isSameAs=function(t){return this.anchorIndex===t.anchorIndex&&this.direction===t.direction&&this.id===t.id},r}();window.topologyPoint=R,window.Le5leTopologyPoint=R;function P(r){for(var t={nodes:[],lines:[]},e=0,i=r;e<i.length;e++){var n=i[e];if(n.type){t.lines.push(n);continue}t.nodes.push(n),n.children&&(t.nodes.push.apply(t.nodes,P(n.children).nodes),t.lines.push.apply(t.lines,P(n.children).lines))}return t}function x(r,t){var e=[];return t.forEach(function(i){(i.id===r||i.tags.indexOf(r)>-1)&&e.push(i),i.children&&e.push.apply(e,x(r,i.children))}),e}function w(r,t){for(var e=[],i=0;i<t.length;i++)t[i].id===r||t[i].tags.indexOf(r)>-1?(e.push(t[i]),t.splice(i,1),--i):t[i].children&&e.push.apply(e,w(r,t[i].children));return e}function T(r,t){for(var e,i=0,n=r;i<n.length;i++){var o=n[i];if(!o.type&&!!o.children)for(var p=0,b=o.children;p<b.length;p++){var z=b[p];if(z.id===t.id)return o;if(!z.type&&z.children&&(e=T(z.children,t),e))return e}}return e}function c(r,t){if(t.length<3)return!1;for(var e=!1,i=t[t.length-1],n=0,o=t;n<o.length;n++){var p=o[n];i.y>r.y!=p.y>r.y&&p.x+(r.y-p.y)*(i.x-p.x)/(i.y-p.y)>r.x&&(e=!e),i=p}return e}function s(r,t,e,i){i===void 0&&(i=1);var n=Math.atan2(t.y-e.y,e.x-t.x);i=i>5?i:5;var o=Math.sin(n)*i,p=Math.cos(n)*i,b=[new R(t.x-o,t.y-p),new R(e.x-o,e.y-p),new R(e.x+o,e.y+p),new R(t.x+o,t.y+p)];return c(r,b)}function l(r,t){var e=Math.sqrt(Math.pow(Math.abs(r.x-t.x),2)+Math.pow(Math.abs(r.y-t.y),2));return e|0}function d(r,t,e,i){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M"+r.x+" "+r.y+" C"+t.x+" "+t.y+" "+e.x+" "+e.y+" "+i.x+" "+i.y),n.getTotalLength()|0}var a=function(){function r(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.center=new R(0,0),i<0&&(i=0),n<0&&(n=0),this.init()}return r.prototype.init=function(){this.ex=this.x+this.width,this.ey=this.y+this.height,this.calcCenter()},r.prototype.floor=function(){this.x|=0,this.y|=0,this.width|=0,this.height|=0,this.init()},r.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height),this.init()},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.hit=function(t,e){return e===void 0&&(e=0),t&&t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},r.prototype.hitByRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},r.prototype.hitRotate=function(t,e,i){for(var n=this.toPoints(),o=0,p=n;o<p.length;o++){var b=p[o];b.rotate(e,i)}return c(t,n)},r.prototype.calcCenter=function(){this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2},r.prototype.toPoints=function(){return[new R(this.x,this.y),new R(this.ex,this.y),new R(this.ex,this.ey),new R(this.x,this.ey)]},r.prototype.translate=function(t,e){this.x+=t,this.y+=e,this.ex+=t,this.ey+=e,this.calcCenter()},r.prototype.scale=function(t,e,i){e||(e=this.center),i===void 0&&(i=t),this.x=e.x-(e.x-this.x)*t,this.y=e.y-(e.y-this.y)*i,this.width*=t,this.height*=i,this.init()},r}();window.topologyRect=a;var u;(function(r){r[r.Click=0]="Click",r[r.DblClick=1]="DblClick",r[r.WebSocket=2]="WebSocket",r[r.Mqtt=3]="Mqtt",r[r.MoveIn=4]="MoveIn",r[r.MoveOut=5]="MoveOut",r[r.MouseUp=6]="MouseUp"})(u||(u={}));var v;(function(r){r[r.Link=0]="Link",r[r.StartAnimate=1]="StartAnimate",r[r.Function=2]="Function",r[r.WindowFn=3]="WindowFn",r[r.SetProps=4]="SetProps",r[r.PauseAnimate=5]="PauseAnimate",r[r.StopAnimate=6]="StopAnimate",r[r.Emit=7]="Emit"})(v||(v={}));function m(r){if(Array.isArray(r)){var t=[];return r.forEach(function(n){t.push(m(n))}),t}else if(typeof r=="object"){if(r===null)return null;if(r.constructor===RegExp)return r;var e={};for(var i in r)e[i]=m(r[i]);return e}return r}var g;(function(r){r[r.Node=0]="Node",r[r.Line=1]="Line"})(g||(g={}));var k=["link","doStartAnimate","doFn","doWindowFn","","doPauseAnimate","doStopAnimate","doEmit"],y={name:"",tags:[],visible:!0,rect:new a(0,0,0,0),fontStyle:"normal",fontWeight:"normal",textBackground:"",textDecoration:"",textDecorationDash:0,textDecorationColor:"",animateCycleIndex:0,events:[],dash:0,lineDashOffset:0,lineWidth:1,strokeStyle:"",fillStyle:"",globalAlpha:1,rotate:0,offsetRotate:0,textMaxLine:0,textOffsetX:0,textOffsetY:0,animatePos:0},C={},M=function(){function r(){}return r.prototype.fromData=function(t,e){e?typeof e=="string"&&(e=JSON.parse(e)):e={},y.id=xt(),t=Object.assign({},y,t);for(var i in t)this[i]=t[i];for(var i in e)this[i]=e[i];Array.isArray(this.tags)&&(this.tags=Object.assign([],this.tags)),this.rect&&(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height)),this.lineWidth=this.lineWidth||1,!this.fontColor&&e.font&&(this.fontColor=e.font.color||this.fontColor,this.fontFamily=e.font.fontFamily||this.fontFamily,this.fontSize=e.font.fontSize||this.fontSize,this.lineHeight=e.font.lineHeight||this.lineHeight,this.fontStyle=e.font.fontStyle||this.fontStyle,this.fontWeight=e.font.fontWeight||this.fontWeight,this.textAlign=e.font.textAlign||this.textAlign,this.textBaseline=e.font.textBaseline||this.textBaseline,this.textBackground=e.font.background||this.textBackground,delete this.font),this.events&&(this.events=m(this.events)),this.wheres&&(this.wheres=m(this.wheres)),typeof this.data=="object"&&(this.data=JSON.parse(JSON.stringify(this.data))),delete this.img,delete this.animateStart,delete this.animateReady},r.prototype.render=function(t){if(!!this.visible){if(this.from&&!this.to){if(this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.render(t)}return}if(t.save(),t.setAttrs&&t.setAttrs(this),(this.rotate||this.offsetRotate)&&(t.translate(this.rect.center.x,this.rect.center.y),t.rotate((this.rotate+this.offsetRotate)*Math.PI/180),t.translate(-this.rect.center.x,-this.rect.center.y)),this.lineWidth>1&&(t.lineWidth=this.lineWidth),this.strokeImage?this.strokeImage===this.lastStrokeImage&&this.strokeImg?t.strokeStyle=t.createPattern(this.strokeImg,"repeat"):this.loadStrokeImg():t.strokeStyle=this.strokeStyle||nt.Store.get(this.generateStoreKey("LT:color")),this.fillImage?this.fillImage===this.lastFillImage&&this.fillImg?t.fillStyle=t.createPattern(this.fillImg,"repeat"):this.loadFillImg():this.fillStyle&&(t.fillStyle=this.fillStyle),this.lineCap?t.lineCap=this.lineCap:this.type===g.Line&&(t.lineCap="round"),this.globalAlpha<1&&(t.globalAlpha=this.globalAlpha),this.lineDash)t.setLineDash(this.lineDash);else switch(this.dash){case 1:t.setLineDash([5,5]);break;case 2:t.setLineDash([10,10]);break;case 3:t.setLineDash([10,10,2,10]);break;case 4:t.setLineDash([1,16]);break}if(this.lineDashOffset&&(t.lineDashOffset=this.lineDashOffset),this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur),this.draw(t),t.restore(),this.children)for(var o=0,p=this.children;o<p.length;o++){var n=p[o];n.render(t)}}},r.prototype.loadFillImg=function(){var t=this;if(!!this.fillImage){var e=new Image;e.crossOrigin="anonymous",e.src=this.fillImage,e.onload=function(){t.lastFillImage=t.fillImage,t.fillImg=e,C[t.fillImage]={img:e},nt.Store.set(t.generateStoreKey("LT:imageLoaded"),!0)}}},r.prototype.loadStrokeImg=function(){var t=this;if(!!this.strokeImage){var e=new Image;e.crossOrigin="anonymous",e.src=this.strokeImage,e.onload=function(){t.lastStrokeImage=t.strokeImage,t.strokeImg=e,C[t.strokeImage]={img:e},nt.Store.set(t.generateStoreKey("LT:imageLoaded"),!0)}}},r.prototype.click=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.Click&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.mouseUp=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MouseUp&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.dblclick=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.DblClick&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.moveIn=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MoveIn&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.moveOut=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MoveOut&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.doWheres=function(){var t=this;!this.wheres||this.wheres.forEach(function(e){if(e.fn instanceof Function)e.fn(t)&&e.actions&&e.actions.forEach(function(n){t.doAction(n)});else if(e.fn&&e.fn.trim()){var i=new Function("pen",e.fn);i(t)&&e.actions&&e.actions.forEach(function(n){t.doAction(n)})}else{var i=new Function("attr","return attr "+e.comparison+" "+e.value);i(t[e.key])&&e.actions&&e.actions.forEach(function(o){t.doAction(o)})}})},r.prototype.doAction=function(t){switch(t.do||t.action){case 0:case"Link":this.link(t.url||t.value,t._blank||t.params);break;case 1:case"StartAnimate":this.doStartAnimate(t.tag||t.value);break;case 5:case"PauseAnimate":this.doPauseAnimate(t.tag||t.value);break;case 6:case"StopAnimate":this.doStopAnimate(t.tag||t.value);break;case 2:case"Function":this.doFn(t.fn||t.value,t.params);break;case 3:case"WindowFn":this.doWindowFn(t.fn||t.value,t.params);break;case 7:case"Emit":this.doEmit(t.fn||t.value,t.params);break}},r.prototype.show=function(){return this.visible=!0,this},r.prototype.hide=function(){return this.visible=!1,this},r.prototype.isVisible=function(){return this.visible},r.prototype.getTID=function(){return this.TID},r.prototype.setTID=function(t){if(this.TID=t,this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.setTID(t)}return this},r.prototype.startAnimate=function(){this.animateStart=Date.now(),this.type===g.Node&&!this.animateReady&&this.initAnimate(),nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this}),this.playType===2&&this.play()},r.prototype.play=function(t){nt.Store.set(this.generateStoreKey("LT:play"),{pen:this,pause:t})},r.prototype.link=function(t,e){window.open(t,e===void 0?"_blank":e)},r.prototype.doStartAnimate=function(t,e){t?nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t}):this.startAnimate()},r.prototype.doPauseAnimate=function(t,e){t?nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t,stop:!0}):this.pauseAnimate()},r.prototype.doStopAnimate=function(t,e){t?nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t,stop:!0}):this.stopAnimate()},r.prototype.doFn=function(t,e){if(t instanceof Function)return t(this,e);var i=new Function("pen","params",t);i(this,e)},r.prototype.doWindowFn=function(t,e){window[t](this,e)},r.prototype.doEmit=function(t,e){nt.Store.set(this.generateStoreKey("LT:emit"),{event:t,params:e,pen:this})},r.prototype.generateStoreKey=function(t){return this.TID+"-"+t},r}();function N(r,t){var e=t.borderRadius,i=t.borderRadius;t.borderRadius<1&&(e=t.rect.width*t.borderRadius,i=t.rect.height*t.borderRadius);var n=e<i?e:i;t.rect.width<2*n&&(n=t.rect.width/2),t.rect.height<2*n&&(n=t.rect.height/2),r.beginPath(),r.moveTo(t.rect.x+n,t.rect.y),r.arcTo(t.rect.x+t.rect.width,t.rect.y,t.rect.x+t.rect.width,t.rect.y+t.rect.height,n),r.arcTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height,t.rect.x,t.rect.y+t.rect.height,n),r.arcTo(t.rect.x,t.rect.y+t.rect.height,t.rect.x,t.rect.y,n),r.arcTo(t.rect.x,t.rect.y,t.rect.x+t.rect.width,t.rect.y,n),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function Y(r,t){r.beginPath(),r.ellipse(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height/2,t.rect.width/2,t.rect.height/2,0,0,Math.PI*2),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function _(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function G(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height/2),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function et(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function B(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x,t.rect.y+t.rect.height*2/3),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function S(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function A(r){var t=[],e="";r||(r="");for(var i=0;i<r.length;++i){var n=r.charCodeAt(i);if(n<33||n>126){e&&(t.push(e),e=""),t.push(r[i]);continue}else e+=r[i]}return e&&t.push(e),t}function L(r,t,e,i){for(var n=[],o=t[0]||"",p=1;p<t.length;++p){var b=t[p]||"",z=o+b,U=z.match(/[^\x00-\xff]/g)||"",rt=U.length;(z.length-rt)*i*.5+rt*i<e?o+=b:(n.push(o),o=b)}return n.push(o),n}function E(r,t){t.text&&!t.text.split&&(t.text+="");var e=[];switch(t.whiteSpace){case"nowrap":e.push(t.text);break;case"pre-line":e=t.text.split(/[\n]/g);break;default:for(var i=t.getTextRect(),n=t.text.split(/[\n]/g),o=0;o<n.length;++o){var p=L(r,A(n[o]),i.width,t.fontSize);e.push.apply(e,p)}break}return(t.displayFormat||t.displayFormat===0)&&e.forEach(function(b,z){var U=Number(b);isNaN(U)||(e[z]=U.toFixed(t.displayFormat))}),e}function V(r,t){for(var e=E(r,t),i=0,n=0,o=e;n<o.length;n++){var p=o[n];r.font=(t.fontStyle||"normal")+" normal "+(t.fontWeight||"normal")+" "+t.fontSize+"px/"+t.lineHeight+" "+t.fontFamily;var b=r.measureText(p),z=b.width;z>i&&(i=z)}return{width:i,height:e.length*t.fontSize*t.lineHeight}}function $(r,t,e,i,n,o){if(!(!t||!o)){var p=r.measureText(t).width;r.save(),r.fillStyle=o;var b=e-p/2,z=i-n/2;switch(r.textAlign){case"left":b=e;break;case"right":b=e-p;break}switch(r.textBaseline){case"top":z=i;break;case"bottom":z=i-n;break}r.fillRect(b,z,p,n),r.restore()}}function W(r,t,e,i,n,o,p,b,z,U,rt,ht){!b||b>t.length?b=t.length:b=Math.ceil(b);for(var ct=0;ct<b-1;++ct)z&&$(r,t[ct],e,i+ct*p,p,z),r.fillText(t[ct],e,i+ct*p),U==="underline"&&F(r,t[ct],e,i+ct*p,rt,ht);if(b<t.length){var yt=(t[b-1]||"")+"...";t[b-1]&&r.measureText(yt).width>n&&(yt=t[b-1].substr(0,t[b-1].length-2)+"..."),z&&$(r,yt,e,i+(b-1)*p,p,z),r.fillText(yt,e,i+(b-1)*p),U==="underline"&&F(r,yt,e,i+(b-1)*p,rt,ht)}else z&&$(r,t[b-1],e,i+(b-1)*p,p,z),r.fillText(t[b-1],e,i+(b-1)*p),U==="underline"&&F(r,t[b-1],e,i+(b-1)*p,rt,ht)}function F(r,t,e,i,n,o){var p=j(r,t),b=Math.floor(p.actualHeight*1.4);switch(r.textAlign){case"center":e-=p.width/2;break;case"right":e-=p.width;break}switch(r.textBaseline){case"top":i+=b;break;case"middle":i+=b/2;break}switch(r.save(),r.beginPath(),r.strokeStyle=o||r.fillStyle,r.lineWidth=1,r.moveTo(e,i),n){case 1:r.setLineDash([5,5]);break;case 2:r.setLineDash([10,10]);break;case 3:r.setLineDash([10,10,2,10]);break;case 4:r.setLineDash([1,16]);break}r.lineTo(e+p.width,i),r.stroke(),r.restore()}function j(r,t){var e=r.measureText(t);return{width:Math.floor(e.width),height:Math.floor(e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),actualHeight:Math.floor(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent)}}function q(r,t){if(!!t.text){t.text.split||(t.text+=""),r.save(),r.beginPath(),delete r.shadowColor,delete r.shadowBlur,r.font=(t.fontStyle||"normal")+" normal "+(t.fontWeight||"normal")+" "+t.fontSize+"px/"+t.lineHeight+" "+t.fontFamily,t.fontColor?r.fillStyle=t.fontColor:r.fillStyle=nt.Store.get(t.generateStoreKey("LT:fontColor")),t.textAlign&&(r.textAlign=t.textAlign),t.textBaseline&&(r.textBaseline=t.textBaseline);var e=t.getTextRect();if(!e){r.restore();return}var i=E(r,t),n=t.fontSize*t.lineHeight,o=t.textMaxLine>0&&t.textMaxLine<i.length?t.textMaxLine:i.length,p=e.x+e.width/2,b=e.y+(e.height-n*o)/2+n*4/7;switch(r.textAlign){case"left":p=e.x;break;case"right":p=e.x+e.width;break}switch(r.textBaseline){case"top":b=e.y+(n-t.fontSize)/2;break;case"bottom":b=e.ey-n*o+n;break}W(r,i,p+t.textOffsetX,b+t.textOffsetY,e.width,e.height,n,o,t.textBackground,t.textDecoration,t.textDecorationDash,t.textDecorationColor),r.restore()}}function H(r,t){r.save(),r.textAlign="center",r.textBaseline="middle";var e=t.getIconRect(),i=e.x+e.width/2,n=e.y+e.height/2;switch(t.imageAlign){case"top":n=e.y,r.textBaseline="top";break;case"bottom":n=e.ey,r.textBaseline="bottom";break;case"left":i=e.x,r.textAlign="left";break;case"right":i=e.ex,r.textAlign="right";break;case"left-top":i=e.x,n=e.y,r.textAlign="left",r.textBaseline="top";break;case"right-top":i=e.ex,n=e.y,r.textAlign="right",r.textBaseline="top";break;case"left-bottom":i=e.x,n=e.ey,r.textAlign="left",r.textBaseline="bottom";break;case"right-bottom":i=e.ex,n=e.ey,r.textAlign="right",r.textBaseline="bottom";break}t.iconSize>0?r.font=t.iconSize+"px "+t.iconFamily:e.width>e.height?r.font=e.height+"px "+t.iconFamily:r.font=e.width+"px "+t.iconFamily,r.fillStyle=t.iconColor||nt.Store.get(t.generateStoreKey("LT:iconColor"))||t.fontColor,t.iconRotate&&(r.translate(e.center.x,e.center.y),r.rotate(t.iconRotate*Math.PI/180),r.translate(-e.center.x,-e.center.y)),r.beginPath(),r.fillText(t.icon,i,n),r.restore()}function J(r,t){r.beginPath();var e=t.rect.y+t.rect.height/2;r.moveTo(t.rect.x,e),r.lineTo(t.rect.x+t.rect.width,e),r.stroke()}var K;(function(r){r[r.None=0]="None",r[r.Up=1]="Up",r[r.Right=2]="Right",r[r.Bottom=3]="Bottom",r[r.Left=4]="Left"})(K||(K={}));function tt(r){r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,K.Up)),r.anchors.push(new R(r.rect.x+r.rect.width*3/4,r.rect.y+r.rect.height/2,K.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,K.Bottom)),r.anchors.push(new R(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height/2,K.Left))}function at(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height/2,K.Left)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,K.Right))}function it(r){var t=r.rect.y+r.rect.height/2;r.anchors.push(new R(r.rect.x,t,K.Left)),r.anchors.push(new R(r.rect.x+r.rect.width,t,K.Right));for(var e=topology.data.scale||1,i=r.rect.x+5*e;i<r.rect.ex;i+=5*e){var n=new R(i,t,K.Bottom);n.hidden=!0,r.anchors.push(n)}}function st(r){var t=r.rect.width/2,e=r.rect.height/2;t>e?t=e:e=t;var i=r.rect.height/10;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function h(r){var t=r.rect.height/20;t<5&&(t=0),r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height*2/3-t,r.rect.width/2,r.rect.height/3-5);var e=r.rect.width*5/7,i=r.rect.height*5/7;r.fullTextRect=new a(r.rect.x+(r.rect.width-e)/2,r.rect.y+(r.rect.height-i)/2,e,i)}function f(r){var t=r.rect.width*2/7,e=r.rect.height*2/7;t>e?t=e:e=t;var i=t;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function I(r){r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height*2/3,r.rect.width/2,r.rect.height/3-5);var t=r.rect.width/2,e=r.rect.height*3/7;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height/2-5,t,e)}function O(r){var t=r.rect.width/3,e=r.rect.height/3;t>e?t=e:e=t;var i=r.rect.width/5;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function X(r){var t=r.rect.height/10;t<5&&(t=0),r.textRect=new a(r.rect.x+r.rect.width/3,r.rect.y+r.rect.height*2/3-t,r.rect.width/3,r.rect.height/3-5);var e=r.rect.width/2,i=r.rect.height*1/2;r.fullTextRect=new a(r.rect.x+(r.rect.width-e)/2,r.rect.y+r.rect.height/4,e,i)}function Q(r){r.iconRect=new a(0,0,0,0)}function ot(r){r.textRect=new a(r.rect.x+r.rect.height/2,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height/2,r.rect.height/3),r.fullTextRect=r.textRect}function ut(r){r.iconRect=new a(0,0,0,0)}function lt(r){r.textRect=new a(r.rect.x,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height/2,r.rect.height/3),r.fullTextRect=r.textRect}function gt(r){r.iconRect=new a(0,0,0,0)}function bt(r){r.textRect=new a(r.rect.x+r.rect.height/2,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height,r.rect.height/3),r.fullTextRect=r.textRect}function Wt(r){r.iconRect=new a(0,0,0,0)}function Ft(r){r.fullTextRect=new a(r.rect.x+10,r.rect.y+r.rect.height/2-20,r.rect.width-20,20),r.textRect=r.fullTextRect}function qt(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y),r.lineTo(t.to.x,t.to.y),r.stroke()}function Rt(r,t){}function _t(r){r.controlPoints=[]}var Ct=50;function ae(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y);for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.lineTo(n.x,n.y)}r.lineTo(t.to.x,t.to.y),r.stroke()}function Zt(r,t){r.save(),r.fillStyle="#fff",r.lineWidth=2;for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.beginPath(),r.arc(n.x,n.y,4,0,Math.PI*2),r.stroke(),r.fill()}r.restore()}function ye(r){r.controlPoints=[];var t=Se(r.from,r.to);r.from.direction&&r.controlPoints.push(t);var e=Se(r.to,r.from),i;switch(t.direction){case K.Up:i=Ke(t,e);break;case K.Right:i=He(t,e);break;case K.Bottom:i=je(t,e);break;case K.Left:i=We(t,e);break}r.controlPoints.push.apply(r.controlPoints,i),r.to.direction&&r.controlPoints.push(e)}function ke(r,t){if(!t.controlPoints||!t.controlPoints.length)return s(r,t.from,t.to,t.lineWidth/2);if(s(r,t.from,t.controlPoints[0])||s(r,t.to,t.controlPoints[t.controlPoints.length-1]))return!0;for(var e=0;e<t.controlPoints.length-1;++e)if(s(r,t.controlPoints[e],t.controlPoints[e+1]))return!0;return!1}function Ue(r,t){var e=[t.from];e.push.apply(e,t.controlPoints),e.push(t.to);for(var i=0,n=e;i<n.length;i++){var o=n[i];Math.abs(r.x-o.x)<7&&(r.x=o.x),Math.abs(r.y-o.y)<7&&(r.y=o.y)}}function Se(r,t){var e=r.clone();switch(r.direction){case K.Up:t.y<r.y?e.y-=(r.y-t.y)/2:e.y-=Ct;break;case K.Right:t.x>r.x?e.x+=(t.x-r.x)/2:e.x+=Ct;break;case K.Bottom:t.y>r.y?e.y+=(t.y-r.y)/2:e.y+=Ct;break;case K.Left:t.x<r.x?e.x-=(r.x-t.x)/2:e.x-=Ct;break}return e}function Ke(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.y>t.y)return t.direction===K.Up&&r.y-t.y>3*Ct?r.x<t.x?t.x-r.x<Ct?[new R(r.x-2*Ct,r.y),new R(r.x-2*Ct,t.y)]:[new R(r.x,t.y)]:r.x-t.x<Ct?[new R(r.x+2*Ct,r.y),new R(r.x+2*Ct,t.y)]:[new R(r.x,t.y)]:t.direction===K.Left&&r.x>t.x||t.direction===K.Right&&r.x<t.x?[new R(t.x,r.y)]:[new R(r.x,t.y)];if(t.direction===K.Bottom){if(r.x<t.x)return he(r,t);var e=he(t,r);return[e[1],e[0]]}else return[new R(t.x,r.y)]}function je(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.y<t.y)return t.direction===K.Bottom&&t.y-r.y>3*Ct?r.x<t.x?t.x-r.x<Ct?[new R(r.x-2*Ct,r.y),new R(r.x-2*Ct,t.y)]:[new R(r.x,t.y)]:r.x-t.x<Ct?[new R(r.x+2*Ct,r.y),new R(r.x+2*Ct,t.y)]:[new R(r.x,t.y)]:t.direction===K.Left&&r.x>t.x||t.direction===K.Right&&r.x<t.x?[new R(t.x,r.y)]:[new R(r.x,t.y)];if(t.direction===K.Up){if(r.x<t.x)return he(r,t);var e=he(t,r);return[e[1],e[0]]}else return[new R(t.x,r.y)]}function We(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.x>t.x)return t.direction===K.Left&&r.x-t.x>3*Ct?r.y<t.y?t.y-r.y<Ct?[new R(r.x,r.y+2*Ct),new R(t.x,r.y+2*Ct)]:[new R(t.x,r.y)]:r.y-t.y<Ct?[new R(r.x,r.y-2*Ct),new R(t.x,r.y-2*Ct)]:[new R(t.x,r.y)]:t.direction===K.Left||t.direction===K.Up&&r.y<t.y||t.direction===K.Bottom&&r.y>t.y?[new R(t.x,r.y)]:[new R(r.x,t.y)];if(t.direction===K.Right){if(r.y<t.y)return ce(r,t);var e=ce(t,r);return[e[1],e[0]]}else return[new R(r.x,t.y)]}function He(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.x<t.x)return t.direction===K.Right&&t.x-r.x>3*Ct?r.y<t.y?t.y-r.y<Ct?[new R(r.x,r.y-2*Ct),new R(t.x,r.y-2*Ct)]:[new R(t.x,r.y)]:r.y-t.y<Ct?[new R(r.x,r.y+2*Ct),new R(t.x,r.y+2*Ct)]:[new R(t.x,r.y)]:t.direction===K.Right||t.direction===K.Up&&r.y<t.y||t.direction===K.Bottom&&r.y>t.y?[new R(t.x,r.y)]:[new R(r.x,t.y)];if(t.direction===K.Left){if(r.y<t.y)return ce(r,t);var e=ce(t,r);return[e[1],e[0]]}else return[new R(r.x,t.y)]}function he(r,t){var e=r.x+(t.x-r.x)/2;return[new R(e,r.y),new R(e,t.y)]}function ce(r,t){var e=r.y+(t.y-r.y)/2;return[new R(r.x,e),new R(t.x,e)]}function ve(r){var t=parseInt,e=Math.round,i=r.length,n={};if(i>9){var o=r=r.split(","),p=o[0],b=o[1],z=o[2],U=o[3];if(i=r.length,i<3||i>4)return null;n.r=t(p[3]=="a"?p.slice(5):p.slice(4)),n.g=t(b),n.b=t(z),n.a=U?parseFloat(U):-1}else{if(i==8||i==6||i<4)return null;i<6&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]+(i>4?r[4]+r[4]:"")),r=t(r.slice(1),16),i==9||i==5?(n.r=r>>24&255,n.g=r>>16&255,n.b=r>>8&255,n.a=e((r&255)/.255)/1e3):(n.r=r>>16,n.g=r>>8&255,n.b=r&255,n.a=-1)}return n}function xe(r,t,e,i){var n,o,p,b,z,U,rt,ht=Math.round,ct=typeof e=="string";return typeof r!="number"||r<-1||r>1||typeof t!="string"||t[0]!="r"&&t[0]!="#"||e&&!ct||(rt=t.length>9,rt=ct?e.length>9?!0:e=="c"?!rt:!1:rt,z=ve(t),b=r<0,U=e&&e!="c"?ve(e):b?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},r=b?r*-1:r,b=1-r,!z||!U)?null:(i?(n=ht(b*z.r+r*U.r),o=ht(b*z.g+r*U.g),p=ht(b*z.b+r*U.b)):(n=ht(Math.pow(b*Math.pow(z.r,2)+r*Math.pow(U.r,2),.5)),o=ht(Math.pow(b*Math.pow(z.g,2)+r*Math.pow(U.g,2),.5)),p=ht(Math.pow(b*Math.pow(z.b,2)+r*Math.pow(U.b,2),.5))),ct=z.a,U=U.a,z=ct>=0||U>=0,ct=z?ct<0?U:U<0?ct:ct*b+U*r:0,rt?"rgb"+(z?"a(":"(")+n+","+o+","+p+(z?","+ht(ct*1e3)/1e3:"")+")":"#"+(4294967296+n*16777216+o*65536+p*256+(z?ht(ct*255):0)).toString(16).slice(1,z?void 0:-2))}function ee(r,t){var e=ve(t)||{r:0,g:0,b:0};return e.a<0?"rgba("+e.r+","+e.g+","+e.b+","+r+")":"rgba("+e.r+","+e.g+","+e.b+","+(r+e.a)+")"}function jt(r,t){return+t?+t:!t||t[t.length-1]!=="%"?0:(t=t.substr(0,t.length-1),r*+t/100)}function qe(r,t){var e=r.x-t.x,i=r.y-t.y;return Math.sqrt(e*e+i*i)}var Ve=80;function Ce(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y),r.bezierCurveTo(t.controlPoints[0].x,t.controlPoints[0].y,t.controlPoints[1].x,t.controlPoints[1].y,t.to.x,t.to.y),r.stroke()}function Te(r,t){r.save(),r.fillStyle=ee(.5,r.strokeStyle+""),r.lineWidth=1,r.beginPath(),r.moveTo(t.from.x,t.from.y),r.lineTo(t.controlPoints[0].x,t.controlPoints[0].y),r.stroke(),r.beginPath(),r.moveTo(t.to.x,t.to.y),r.lineTo(t.controlPoints[1].x,t.controlPoints[1].y),r.stroke(),r.fillStyle="#fff",r.lineWidth=2;for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.beginPath(),r.arc(n.x,n.y,4,0,Math.PI*2),r.stroke(),r.fill()}r.restore()}function Ye(r){r.from.direction||(r.from.direction=K.Bottom),r.to.direction||(r.to.direction=(r.from.direction+2)%4,r.to.direction||(r.to.direction=K.Left)),r.controlPoints=[Le(r.from,r.to),Le(r.to,r.from)],nt.Store.set(le(r,"pts-")+r.id,void 0)}function Ie(r,t){var e=nt.Store.get(le(t,"pts-")+t.id);if(!e){if(e=[t.from],t.controlPoints)for(var i=.01;i<1;i+=.01)e.push(Xt(i,t.from,t.controlPoints[0],t.controlPoints[1],t.to));e.push(t.to),nt.Store.set(le(t,"pts-")+t.id,e)}for(var n=e.length-1,i=0;i<n;++i)if(s(r,e[i],e[i+1]))return!0;return!1}function Xt(r,t,e,i,n){var o=t.x,p=t.y,b=n.x,z=n.y,U=e.x,rt=e.y,ht=i.x,ct=i.y,yt=o*(1-r)*(1-r)*(1-r)+3*U*r*(1-r)*(1-r)+3*ht*r*r*(1-r)+b*r*r*r,St=p*(1-r)*(1-r)*(1-r)+3*rt*r*(1-r)*(1-r)+3*ct*r*r*(1-r)+z*r*r*r;return new R(yt,St)}function Le(r,t){var e=new R(r.x,r.y,r.direction,r.anchorIndex,r.id),i=window.topologyControlPtDistance||Ve;if((r.direction===K.Up||r.direction===K.Bottom)&&Math.abs(r.x-t.x)<3)return t.y>r.y?(i=Math.round((t.y-r.y)/3),e.y+=i):(i=Math.round((r.y-t.y)/3),e.y-=i),e;if((r.direction===K.Left||r.direction===K.Right)&&Math.abs(r.y-t.y)<3)return t.x>r.x?(i=Math.round((t.x-r.x)/3),e.x+=i):(i=Math.round((r.x-t.x)/3),e.x-=i),e;switch(r.direction){case K.Up:e.y-=i;break;case K.Right:e.x+=i;break;case K.Bottom:e.y+=i;break;case K.Left:e.x-=i;break}return e}function le(r,t){return r.getTID()+"-"+t}var ue=20;function Xe(r){switch(r.from.direction||(r.from.direction=K.Bottom),r.to.direction||(r.to.direction=(r.from.direction+2)%4,r.to.direction||(r.to.direction=K.Left)),r.from.direction){case K.Up:r.controlPoints=[new R(r.from.x,r.from.y-ue),new R(r.from.x,r.to.y)];break;case K.Right:r.controlPoints=[new R(r.from.x+ue,r.from.y),new R(r.from.x,r.to.y)];break;case K.Bottom:r.controlPoints=[new R(r.from.x,r.from.y+ue),new R(r.from.x,r.to.y)];break;case K.Left:r.controlPoints=[new R(r.from.x-ue,r.from.y),new R(r.from.x,r.to.y)];break}nt.Store.set(le(r,"pts-")+r.id,void 0)}function Pe(r,t,e,i,n){i+=r.lineWidth*3;var o=r.lineWidth/10;r.lineWidth<2&&(r.lineWidth=2,o=0),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth+o*5,-e.y),r.moveTo(e.x,e.y+o),r.lineTo(e.x,e.y-o),r.lineTo(e.x-i,e.y-i/3),r.lineTo(e.x-i,e.y+i/3),r.closePath(),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function Qe(r,t,e,i){Pe(r,t,e,i,nt.Store.get("LT:bkColor")||"#fff")}function Re(r,t,e,i,n){i+=r.lineWidth*3;var o=i/2,p=r.lineWidth/10;r.lineWidth<2&&(r.lineWidth=2,p=0),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth+p*5,-e.y),r.moveTo(e.x,e.y+p),r.lineTo(e.x,e.y-p),r.lineTo(e.x-o,e.y-o/2),r.lineTo(e.x-i,e.y-p),r.lineTo(e.x-i,e.y+p),r.lineTo(e.x-o,e.y+o/2),r.closePath(),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function Ge(r,t,e,i){Re(r,t,e,i,nt.Store.get("LT:bkColor")||"#fff")}function Ee(r,t,e,i,n){i+=r.lineWidth*3;var o=i/2;r.lineWidth<2&&(r.lineWidth=2),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x,-e.y-r.lineWidth/10),r.arc(e.x-o-r.lineWidth/2,e.y,o,0,2*Math.PI),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function Je(r,t,e,i){Ee(r,t,e,i,nt.Store.get("LT:bkColor")||"#fff")}function $e(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height/2,K.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,K.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,K.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,K.Bottom));for(var t=5;t<360;t+=5)if(t%90!=0){var e=Math.round(t/90),i=new R(r.rect.center.x+Math.sin(t/180*Math.PI)*r.rect.width/2,r.rect.center.y+Math.cos(t/180*Math.PI)*r.rect.height/2,e);i.hidden=!0,r.anchors.push(i)}}function Ze(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3),r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3),r.stroke()}function tr(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),e.x>t.x?(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3)):(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3)),r.stroke()}function er(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),e.x<t.x?(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3)):(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3)),r.stroke()}function rr(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*2/5),r.lineTo(t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height),r.lineTo(t.rect.x+t.rect.width/5,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height*2/5),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ir(r){var t=r.rect.width/2,e=r.rect.height/2;t>e?t=e:e=t;var i=r.rect.height/7;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function nr(r){r.textRect=new a(r.rect.x+r.rect.width/5,r.rect.y+r.rect.height*5/7,r.rect.width*3/5,r.rect.height/4);var t=r.rect.width*3/5,e=r.rect.height*3/5;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height/4,t,e)}function or(r){r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,K.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height*2/5,K.Right)),r.anchors.push(new R(r.rect.x+r.rect.width*4/5,r.rect.y+r.rect.height,K.Bottom)),r.anchors.push(new R(r.rect.x+r.rect.width/5,r.rect.y+r.rect.height,K.Bottom)),r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height*2/5,K.Left))}function sr(r,t){r.beginPath();var e=t.rect.width/5;r.moveTo(t.rect.x+e,t.rect.y),r.lineTo(t.rect.x+t.rect.width-e,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.width-e,t.rect.y+t.rect.height),r.lineTo(t.rect.x+e,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height/2),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ar(r){r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,K.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,K.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,K.Bottom)),r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height/2,K.Left));var t=new R(r.rect.x+r.rect.width/10,r.rect.y+r.rect.height/4,K.Left);t.hidden=!0,r.anchors.push(t);var e=new R(r.rect.x+r.rect.width/10,r.rect.y+r.rect.height*3/4,K.Left);e.hidden=!0,r.anchors.push(e);var i=new R(r.rect.x+r.rect.width*9/10,r.rect.y+r.rect.height/4,K.Right);i.hidden=!0,r.anchors.push(i);var n=new R(r.rect.x+r.rect.width*9/10,r.rect.y+r.rect.height*3/4,K.Right);n.hidden=!0,r.anchors.push(n)}function hr(r){var t=r.rect.width*3/5,e=r.rect.height*3/4;r.iconRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,e-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function cr(r){var t=r.rect.width*3/5,e=r.rect.height/4;r.textRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.rect.height-e+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,e),r.fullTextRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function lr(r,t){r.beginPath();for(var e=0;e<5;++e)r.lineTo(Math.cos((18+72*e)/180*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin((18+72*e)/180*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2),r.lineTo(Math.cos((54+72*e)/180*Math.PI)*t.rect.width/4+t.rect.x+t.rect.width/2,-Math.sin((54+72*e)/180*Math.PI)*t.rect.width/4+t.rect.y+t.rect.height/2);r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ur(r){r.anchors.push(new R(Math.cos(18/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin(18/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,K.Right)),r.anchors.push(new R(Math.cos((18+72)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,K.Up)),r.anchors.push(new R(Math.cos((18+72*2)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*2)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,K.Left)),r.anchors.push(new R(Math.cos((18+72*3)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*3)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,K.Bottom)),r.anchors.push(new R(Math.cos((18+72*4)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*4)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,K.Bottom))}function fr(r){r.iconRect=new a(0,0,0,0)}function dr(r){var t=r.rect.width*2/5,e=r.rect.height*2/5;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+(r.rect.height-e)/2,t,e),r.textRect=r.fullTextRect}function pr(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/5,t.rect.y+t.rect.height*13/16),r.bezierCurveTo(t.rect.x-t.rect.width/15,t.rect.y+t.rect.height*13/16,t.rect.x-t.rect.width/15,t.rect.y+t.rect.height*7/16,t.rect.x+t.rect.width/5,t.rect.y+t.rect.height*7/16),r.bezierCurveTo(t.rect.x+t.rect.width/5,t.rect.y,t.rect.x+t.rect.width*4/5,t.rect.y,t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height*7/16),r.bezierCurveTo(t.rect.x+t.rect.width*16/15,t.rect.y+t.rect.height*7/16,t.rect.x+t.rect.width*16/15,t.rect.y+t.rect.height*13/16,t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height*13/16),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function yr(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height*3/5,K.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height/9,K.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height*3/5,K.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height*4/5,K.Bottom))}function vr(r){r.iconRect=new a(0,0,0,0)}function gr(r){r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height/4,r.rect.width/2,r.rect.height*6/11),r.fullTextRect=r.textRect}function mr(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x+t.rect.width*8/16,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x+t.rect.width/4,t.rect.ey),r.lineTo(t.rect.x+t.rect.width*5/16,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x,t.rect.y+t.rect.height*3/4),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function wr(r){r.iconRect=new a(0,0,0,0),r.fullIconRect=r.iconRect}function br(r){r.textRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height*3/4-r.paddingTopNum-r.paddingBottomNum),r.fullTextRect=r.textRect}function kr(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height*3/8,K.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,K.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height*3/8,K.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/4,r.rect.ey,K.Bottom))}function Sr(r,t){r.beginPath();var e=t.rect.width/6;r.moveTo(t.rect.x,t.rect.y),r.lineTo(t.rect.ex-e,t.rect.y),r.lineTo(t.rect.ex,t.rect.y+e),r.lineTo(t.rect.ex,t.rect.ey),r.lineTo(t.rect.x,t.rect.ey),r.closePath(),r.moveTo(t.rect.ex-e,t.rect.y),r.lineTo(t.rect.ex-e,t.rect.y+e),r.lineTo(t.rect.ex,t.rect.y+e),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function xr(r){var t=0,e=0;r.text&&(r.paddingRightNum?t=r.paddingRightNum:e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1)),r.iconRect=new a(r.rect.x,r.rect.y,r.rect.width-t,r.rect.height-e),r.fullIconRect=r.rect}function Cr(r){if(r.paddingRightNum){var t=r.paddingRightNum-5;r.textRect=new a(r.rect.x+r.rect.width-t,r.rect.y,t,r.rect.height-r.textOffsetY*2)}else{var e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1);r.textRect=new a(r.rect.x,r.rect.y+r.rect.height-e,r.rect.width-r.textOffsetX*2,e)}r.fullTextRect=r.rect}function Tr(r){var t=0,e=0;r.text&&(r.paddingRightNum?t=r.paddingRightNum:e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1)),r.anchors.push(new R(r.rect.x,r.rect.y+(r.rect.height-e)/2,K.Left)),r.anchors.push(new R(r.rect.x+(r.rect.width-t)/2,r.rect.y,K.Up)),r.anchors.push(new R(r.rect.x+r.rect.width-t,r.rect.y+(r.rect.height-e)/2,K.Right)),r.anchors.push(new R(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height-e,K.Bottom))}var ge=function(){function r(t,e,i,n,o,p){o===void 0&&(o=""),p===void 0&&(p=""),this.points=[],this.fillStyle="",this.strokeStyle="",this.points.push(t),this.points.push(e),this.points.push(i),this.points.push(n),this.fillStyle=o,this.strokeStyle=p||o}return r.prototype.render=function(t){t.save(),t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.beginPath();for(var e=0;e<this.points.length;++e)e?t.lineTo(this.points[e].x,this.points[e].y):t.moveTo(this.points[e].x,this.points[e].y);t.closePath(),this.fillStyle&&t.fill(),t.stroke(),t.restore()},r}(),Ir=function(){function r(t,e,i,n,o){n===void 0&&(n="#ddd"),o===void 0&&(o="#ccc"),this.surfaces=[];var p=e*Math.sin(45*Math.PI/180),b=new R(t.x,t.y+p),z=new R(t.ex-p,t.y+p),U=new R(t.ex-p,t.ey),rt=new R(t.x,t.ey);this.surfaces.push(new ge(b,z,U,rt,n,o)),this.surfaces.push(new ge(b,new R(t.x+p,t.y),new R(t.ex,t.y),z,xe(.5,n),o)),this.surfaces.push(new ge(z,new R(t.ex,t.y),new R(t.ex,t.ey-p),U,xe(.6,n),o))}return r.prototype.render=function(t){for(var e=0,i=this.surfaces;e<i.length;e++){var n=i[e];n.render(t)}},r}();function Lr(r,t){new Ir(t.rect,t.z,t.zRotate,t.fillStyle,t.strokeStyle).render(r)}function Pr(r){var t=r.z*Math.sin(45*Math.PI/180);r.anchors.push(new R(r.rect.x,r.rect.ey-(r.rect.height-t)/2,K.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+t/2,K.Up)),r.anchors.push(new R(r.rect.ex-t/2,r.rect.y+r.rect.height/2,K.Right)),r.anchors.push(new R(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height,K.Bottom))}function Rr(r){r.fullIconRect=r.fullTextRect,r.iconRect=new a(r.fullIconRect.x,r.fullIconRect.y,r.fullIconRect.width,r.fullIconRect.height*2/3)}function Er(r){var t=r.z*Math.sin(45*Math.PI/180);r.fullTextRect=new a(r.rect.x,r.rect.y+t,r.rect.width-t,r.rect.height-t),r.textRect=new a(r.fullTextRect.x+10,r.fullTextRect.y+r.fullTextRect.height*2/3,r.fullTextRect.width-20,r.fullTextRect.height/3-5)}function Ar(r,t){r.beginPath();var e=t.rect.width/4,i=t.rect.x+t.rect.width/2;r.arc(i,t.rect.y+e,e,0,Math.PI*2),r.moveTo(t.rect.x,t.rect.y+e*3),r.lineTo(t.rect.ex,t.rect.y+e*3),r.moveTo(i,t.rect.y+e*2),r.lineTo(i,t.rect.y+e*4),r.moveTo(i,t.rect.y+e*4),r.lineTo(t.rect.x,t.rect.ey),r.moveTo(i,t.rect.y+e*4),r.lineTo(t.rect.ex,t.rect.ey),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function _r(r){r.iconRect=new a(0,0,0,0)}function Nr(r){r.textRect=void 0,r.fullTextRect=r.textRect}function Ae(r){r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function _e(r){var t=r.rect.height-r.paddingTopNum-r.paddingBottomNum;r.textRect=new a(r.rect.x+r.paddingLeftNum+t,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum-t,t),r.fullTextRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t)}function Mr(r,t){!t.points||!t.points[0]||(r.beginPath(),r.moveTo(t.points[0].x,t.points[0].y),t.points.forEach(function(e){r.lineTo(e.x,e.y)}),t.closePath&&!t.doing&&r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke())}function Or(r){if(!(!r.points||!r.points.length)){var t=r.points[0],e=r.points[r.points.length-1];t.x<e.x?(r.anchors.push(new R(t.x,t.y,K.Left)),r.anchors.push(new R(e.x,e.y,K.Right))):(r.anchors.push(new R(t.x,t.y,K.Right)),r.anchors.push(new R(e.x,e.y,K.Left)))}}function Br(r){for(var t=Dr(r),e=5,i=0;i<e;i++)if(i!==2){var n=r.rect.x+r.rect.width*(i+1)/(e+1),o=r.rect.y;n<r.rect.x+t?o=de(r.rect.x+t,o+t,n,t,-1):n>r.rect.x+r.rect.width-t&&(o=de(r.rect.x+r.rect.width-t,o+t,n,t,-1)),r.anchors.push(new R(n,o,K.Up))}for(var p=3,i=0;i<p;i++){var o=r.rect.y+r.rect.height*(i+1)/(p+1),n=r.rect.x+r.rect.width;o<r.rect.y+t?n=fe(n-t,r.rect.y+t,o,t):o>r.rect.y+r.rect.height-t&&(n=fe(n-t,r.rect.y+r.rect.height-t,o,t)),r.anchors.push(new R(n,o,K.Right))}for(var b=5,i=0;i<b;i++)if(i!==2){var n=r.rect.x+r.rect.width*(i+1)/(b+1),o=r.rect.y+r.rect.height;n<r.rect.x+t?o=de(r.rect.x+t,o-t,n,t):n>r.rect.x+r.rect.width-t&&(o=de(r.rect.x+r.rect.width-t,o-t,n,t)),r.anchors.push(new R(n,o,K.Bottom))}for(var z=3,i=0;i<z;i++){var o=r.rect.y+r.rect.height*(i+1)/(z+1),n=r.rect.x;o<r.rect.y+t?n=fe(n+t,r.rect.y+t,o,t,-1):o>r.rect.y+r.rect.height-t&&(n=fe(n+t,r.rect.y+r.rect.height-t,o,t,-1)),r.anchors.push(new R(n,o,K.Left))}}function Dr(r){var t=r.borderRadius,e=r.borderRadius;r.borderRadius<1&&(t=r.rect.width*r.borderRadius,e=r.rect.height*r.borderRadius);var i=t<e?t:e;return r.rect.width<2*i&&(i=r.rect.width/2),r.rect.height<2*i&&(i=r.rect.height/2),i}function fe(r,t,e,i,n){return n===void 0&&(n=1),n*Math.sqrt(Math.pow(i,2)-Math.pow(e-t,2))+r}function de(r,t,e,i,n){return n===void 0&&(n=1),n*Math.sqrt(Math.pow(i,2)-Math.pow(e-r,2))+t}function Fr(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height),r.closePath(),r.stroke()}function zr(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height,4)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height,2))}function Ur(r,t){if(!(!t.points||!t.points[1])){r.beginPath(),r.moveTo(t.points[0].x,t.points[0].y);for(var e=1;e<t.points.length;)if(t.points[e].data)if(t.points[e+2])r.bezierCurveTo(t.points[e].x,t.points[e].y,t.points[e+1].x,t.points[e+1].y,t.points[e+2].x,t.points[e+2].y),e+=2;else break;else r.lineTo(t.points[e].x,t.points[e].y),++e;t.closePath&&!t.doing&&r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}}var Et={},Dt={},zt={},Ut={},Mt={},Vt={};function Kr(){Et.combine=N,Et.div=N,Et.graffiti=Mr,Ut.graffiti=Or,Et.lines=Ur,Et.square=N,Et.rectangle=N,Dt.rectangle=Ae,zt.rectangle=_e,Et.circle=Y,Dt.circle=st,zt.circle=h,Ut.circle=$e,Et.triangle=_,Ut.triangle=tt,Dt.triangle=f,zt.triangle=I,Et.diamond=G,Dt.diamond=O,zt.diamond=X,Et.hexagon=sr,Dt.hexagon=hr,zt.hexagon=cr,Ut.hexagon=ar,Et.pentagon=rr,Dt.pentagon=ir,zt.pentagon=nr,Ut.pentagon=or,Et.pentagram=lr,Dt.pentagram=fr,zt.pentagram=dr,Ut.pentagram=ur,Et.leftArrow=et,Ut.leftArrow=at,Dt.leftArrow=Q,zt.leftArrow=ot,Et.rightArrow=B,Ut.rightArrow=at,Dt.rightArrow=ut,zt.rightArrow=lt,Et.twowayArrow=S,Ut.twowayArrow=at,Dt.twowayArrow=gt,zt.twowayArrow=bt,Et.cloud=pr,Ut.cloud=yr,Dt.cloud=vr,zt.cloud=gr,Et.message=mr,Ut.message=kr,Dt.message=wr,zt.message=br,Et.file=Sr,Et.text=q,Dt.text=Wt,Et.line=J,Ut.line=it,Dt.line=Wt,zt.line=Ft,Et.image=function(r,t){},Dt.image=xr,zt.image=Cr,Ut.image=Tr,Et.cube=Lr,Ut.cube=Pr,Dt.cube=Rr,zt.cube=Er,Et.people=Ar,Dt.people=_r,zt.people=Nr,Et.mindNode=N,Ut.mindNode=Br,Dt.mindNode=Ae,zt.mindNode=_e,Et.mindLine=Fr,Ut.mindLine=zr,Mt.line={drawFn:qt,drawControlPointsFn:Rt,controlPointsFn:_t,pointIn:ke},Mt.polyline={drawFn:ae,drawControlPointsFn:Zt,controlPointsFn:ye,dockControlPointFn:Ue,pointIn:ke},Mt.curve={drawFn:Ce,drawControlPointsFn:Te,controlPointsFn:Ye,pointIn:Ie},Mt.mind={drawFn:Ce,drawControlPointsFn:Te,controlPointsFn:Xe,pointIn:Ie},Vt.triangleSolid=Pe,Vt.triangle=Qe,Vt.diamondSolid=Re,Vt.diamond=Ge,Vt.circleSolid=Ee,Vt.circle=Je,Vt.line=Ze,Vt.lineUp=tr,Vt.lineDown=er}Kr();function Ne(r,t,e,i,n,o){return Et[r]&&o?!1:(Et[r]=t,Ut[r]=e,Dt[r]=i,zt[r]=n,!0)}function jr(r,t,e,i,n,o,p,b,z,U){return U===void 0&&(U=!0),Mt[r]&&!U?!1:(Mt[r]={drawFn:t,drawControlPointsFn:e,controlPointsFn:i,dockControlPointFn:n,pointIn:o,getLength:p,getCenter:b,getPointByPos:z},!0)}function Ci(r,t,e){return Vt[r]&&e?!1:(Vt[r]=t,!0)}window.registerTopologyNode=Ne,window.registerTopologyLine=jr;var Wr=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Ot=function(r){Wr(t,r);function t(e){var i=r.call(this)||this,n={name:"curve",fromArrow:"",toArrow:"",controlPoints:[],fromArrowSize:5,toArrowSize:5,borderWidth:0,borderColor:"#000000",animateColor:"",animateSpan:1,animateFromSize:0,animateToSize:0,animateDotSize:3,textBackground:"#ffffff"};if(i.fromData(n,e),i.type=g.Line,e.from&&(i.from=new R(e.from.x,e.from.y,e.from.direction,e.from.anchorIndex,e.from.id,e.from.hidden,e.from.autoAnchor)),e.to&&(i.to=new R(e.to.x,e.to.y,e.to.direction,e.to.anchorIndex,e.to.id,e.to.hidden,e.to.autoAnchor)),e.name==="mind"&&(!e.controlPoints||e.controlPoints.length>2))e.controlPoints=void 0,i.calcControlPoints(!0);else if(e.controlPoints){i.controlPoints=[];for(var o=0,p=e.controlPoints;o<p.length;o++){var b=p[o];i.controlPoints.push(new R(b.x,b.y,b.direction,b.anchorIndex,b.id))}}return e.children&&(i.children=[],e.children.forEach(function(z){i.children.push(new t(z))})),i}return t.prototype.setFrom=function(e,i){i===void 0&&(i=""),this.from=e,this.fromArrow=i,this.textRect=void 0},t.prototype.setTo=function(e,i){i===void 0&&(i="triangleSolid"),this.to=e,this.toArrow=i,this.textRect=void 0},t.prototype.calcControlPoints=function(e){this.name!=="line"&&this.manualCps&&!e||(this.textRect=void 0,this.from&&this.to&&Mt[this.name]&&Mt[this.name].controlPointsFn(this))},t.prototype.draw=function(e){if(this.animateDot){if(e.fillStyle=e.strokeStyle,this.animateType==="dot"){e.beginPath(),e.arc(this.animateDot.x,this.animateDot.y,this.animateDotSize,0,2*Math.PI,!1),e.fill();return}else if(this.animateType==="comet"){var i=this.getBubbles();e.save();for(var n=0,o=i;n<o.length;n++){var p=o[n];e.globalAlpha=p.a,e.beginPath(),e.arc(p.pos.x,p.pos.y,p.r,0,2*Math.PI,!1),e.fill()}e.restore()}}switch(!this.isAnimate&&this.borderWidth>0&&this.borderColor&&(e.save(),this.lineJoin&&(e.lineJoin=this.lineJoin),e.lineWidth=this.lineWidth+this.borderWidth,e.strokeStyle=this.borderColor,Mt[this.name]&&Mt[this.name].drawFn(e,this),e.restore()),this.strokeType){case 1:this.strokeLinearGradient(e);break}(!this.isAnimate||this.animateType!=="comet")&&Mt[this.name]&&(this.lineJoin&&(e.lineJoin=this.lineJoin),Mt[this.name].drawFn(e,this));var b=nt.Store.get(this.generateStoreKey("LT:scale"))||1;if(this.fromArrow&&Vt[this.fromArrow]){e.save(),e.beginPath(),e.lineDashOffset=0,e.setLineDash([]),e.fillStyle=this.fromArrowColor||e.strokeStyle,e.strokeStyle=e.fillStyle;var z=this.to;this.name==="curve"?z=Xt(.95-this.lineWidth/100,this.to,this.controlPoints[1],this.controlPoints[0],this.from):this.name!=="line"&&this.controlPoints.length&&(z=this.controlPoints[0]),Vt[this.fromArrow](e,z,this.from,this.fromArrowSize*b),e.restore()}if(this.toArrow&&Vt[this.toArrow]){e.save(),e.beginPath(),e.lineDashOffset=0,e.setLineDash([]),e.fillStyle=this.toArrowColor||e.strokeStyle,e.strokeStyle=e.fillStyle;var z=this.from;this.name==="curve"?z=Xt(.95-this.lineWidth/100,this.from,this.controlPoints[0],this.controlPoints[1],this.to):this.name==="mind"?z=Xt(.96-this.lineWidth/100,this.from,this.controlPoints[0],this.controlPoints[1],this.to):this.name!=="line"&&this.controlPoints.length&&(z=this.controlPoints[this.controlPoints.length-1]),Vt[this.toArrow](e,z,this.to,this.toArrowSize*b),e.restore()}this.text&&!this.isAnimate&&!this.hiddenText&&(this.textRect||this.calcTextRect(),q(e,this))},t.prototype.pointIn=function(e){return Mt[this.name].pointIn(e,this)},t.prototype.getLen=function(){switch(this.name){case"line":return l(this.from,this.to);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return l(this.from,this.to);for(var e=0,i=this.from,n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];e+=l(i,p),i=p}return e+=l(i,this.to),e|0;case"curve":case"mind":return d(this.from,this.controlPoints[0],this.controlPoints[1],this.to);default:if(Mt[this.name].getLength)return Mt[this.name].getLength(this)}return 0},t.prototype.strokeLinearGradient=function(e){if(!(!this.lineGradientFromColor||!this.lineGradientToColor)){var i=this.from,n=this.to,o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.lineGradientFromColor),o.addColorStop(1,this.lineGradientToColor),e.strokeStyle=o}},t.prototype.calcTextRect=function(){if(!this.from||!this.to){this.textRect=void 0;return}var e=this.getCenter(),i=Math.abs(this.from.x-this.to.x);i<100&&(i=100),this.text&&!this.text.split&&(this.text+="");var n=this.lineHeight*this.fontSize*(this.textMaxLine||this.text&&this.text.split(`
`).length||1);this.textRect=new a(e.x-i/2,e.y-n/2,i,n)},t.prototype.getTextRect=function(){return this.calcTextRect(),this.textRect},t.prototype.getCenter=function(){var e=new R(this.from.x,this.from.y);switch(this.name){case"line":e=this.getLineCenter(this.from,this.to);break;case"polyline":var i=Math.round(this.controlPoints.length/2);e=this.getLineCenter(this.controlPoints[i-1]||this.from,this.controlPoints[i]||this.to);break;case"curve":e=Xt(.5,this.to,this.controlPoints[1],this.controlPoints[0],this.from);break;default:Mt[this.name].getCenter&&(e=Mt[this.name].getCenter(this))}return e},t.prototype.getLineCenter=function(e,i){return new R((e.x+i.x)/2,(e.y+i.y)/2)},t.prototype.getPointByPos=function(e){if(e<=0)return this.from;switch(this.name){case"line":return this.getLinePtByPos(this.from,this.to,e);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return this.getLinePtByPos(this.from,this.to,e);for(var i=[].concat(this.controlPoints,this.to),n=this.from,o=0,p=i;o<p.length;o++){var b=p[o],z=l(n,b);if(e>z)e-=z,n=b;else return this.getLinePtByPos(n,b,e)}return this.to;case"curve":return Xt(e/this.getLen(),this.from,this.controlPoints[0],this.controlPoints[1],this.to);default:if(Mt[this.name].getPointByPos)return Mt[this.name].getPointByPos(e,this)}return null},t.prototype.getPointByReversePos=function(e){if(e<=0)return this.to;switch(this.name){case"line":return this.getLinePtByPos(this.to,this.from,e);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return this.getLinePtByPos(this.to,this.from,e);var i=[];this.controlPoints.forEach(function(U){i.unshift(U)}),i.unshift(this.to);for(var n=this.to,o=0,p=i;o<p.length;o++){var b=p[o],z=l(n,b);if(e>z)e-=z,n=b;else return this.getLinePtByPos(n,b,e)}return this.from;case"curve":return Xt(e/this.getLen(),this.to,this.controlPoints[1],this.controlPoints[0],this.from);default:if(Mt[this.name].getPointByReversePos)return Mt[this.name].getPointByReversePos(e,this)}return null},t.prototype.getLinePtByPos=function(e,i,n){var o=l(e,i);if(n<=0)return e;if(n>=o)return i;var p,b;return p=e.x+(i.x-e.x)*(n/o),b=e.y+(i.y-e.y)*(n/o),new R(p,b)},t.prototype.calcRectInParent=function(e){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum;this.name==="lines"?Array.isArray(this.children)&&this.children.length>0&&(this.rectInParent={x:(this.children[0].from.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.children[0].from.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:0,height:0,rotate:0}):this.rectInParent={x:(this.from.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.from.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:0,height:0,rotate:0}},t.prototype.calcRectByParent=function(e){if(!!this.rectInParent){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum,o=e.rect.x+e.paddingLeftNum+jt(i,this.rectInParent.x)+jt(i,this.rectInParent.marginLeft),p=e.rect.y+e.paddingTopNum+jt(n,this.rectInParent.y)+jt(i,this.rectInParent.marginTop);if(this.rectInParent.marginLeft===void 0&&this.rectInParent.marginRight&&(o-=jt(i,this.rectInParent.marginRight)),this.rectInParent.marginTop===void 0&&this.rectInParent.marginBottom&&(p-=jt(i,this.rectInParent.marginBottom)),this.name==="lines"){if(Array.isArray(this.children)&&this.children.length>0){var b=this.children[0].from.x,z=this.children[0].from.y;this.translate(o-b,p-z)}}else this.translate(o-this.from.x,p-this.from.y)}},t.prototype.initAnimate=function(){this.animateStart=0,this.animateDot=void 0,this.animatePos=0},t.prototype.pauseAnimate=function(){nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0})},t.prototype.stopAnimate=function(){var e=this;this.pauseAnimate(),this.initAnimate(),setTimeout(function(){nt.Store.set(e.generateStoreKey("LT:render"),{pen:e,stop:!0})},50)},t.prototype.animate=function(e){switch(this.animatePos+=this.animateSpan,this.animateType){case"beads":this.animateReverse?this.lineDashOffset=this.animatePos:this.lineDashOffset=-this.animatePos;var i=this.lineWidth;i<5&&(i=5),this.animateLineDash?this.lineDash=this.animateLineDash:this.lineDash=[i,i*2];break;case"dot":case"comet":this.lineDash=void 0;var n=void 0;this.animateReverse?n=this.getPointByReversePos(this.animatePos+this.animateToSize):n=this.getPointByPos(this.animatePos+this.animateFromSize),this.animateDot=n;break;default:this.animateReverse?this.lineDash=[0,this.length-this.animatePos+1,this.animatePos]:this.lineDash=[this.animatePos,this.length-this.animatePos+1];break}if(this.animatePos>this.length+this.animateSpan-this.animateFromSize-this.animateToSize){if(++this.animateCycleIndex>=this.animateCycle&&this.animateCycle>0){this.animateStart=0,this.initAnimate(),nt.Store.set(this.generateStoreKey("animateEnd"),this);return}this.animatePos=this.animateSpan}},t.prototype.getBubbles=function(){for(var e=[],i=0;i<30&&this.animatePos-i>0;++i)this.animateReverse?e.push({pos:this.getPointByReversePos(this.animatePos-i*2+this.animateToSize),a:1-i*.03,r:this.lineWidth-i*.01}):e.push({pos:this.getPointByPos(this.animatePos-i*2+this.animateFromSize),a:1-i*.03,r:this.lineWidth-i*.01});return e},t.prototype.round=function(){this.from.round(),this.to.round()},t.prototype.translate=function(e,i){if(this.from){this.from.x+=e,this.from.y+=i,this.to.x+=e,this.to.y+=i,this.text&&(this.textRect=void 0);for(var n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];p.x+=e,p.y+=i}}if(this.children)for(var b=0,z=this.children;b<z.length;b++){var U=z[b];U.translate(e,i)}nt.Store.set(this.generateStoreKey("pts-")+this.id,void 0)},t.prototype.scale=function(e,i){if(this.from){this.from.x=i.x-(i.x-this.from.x)*e,this.from.y=i.y-(i.y-this.from.y)*e,this.to.x=i.x-(i.x-this.to.x)*e,this.to.y=i.y-(i.y-this.to.y)*e,this.lineWidth*=e,this.borderWidth*=e,this.fontSize*=e,this.text&&(this.textRect=void 0),this.textOffsetX*=e,this.textOffsetY*=e;for(var n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];p.x=i.x-(i.x-p.x)*e,p.y=i.y-(i.y-p.y)*e}}if(this.children)for(var b=0,z=this.children;b<z.length;b++){var U=z[b];U.scale(e,i)}nt.Store.set(this.generateStoreKey("pts-")+this.id,void 0)},t.prototype.hit=function(e,i){if(i===void 0&&(i=0),this.from.hit(e,i)||this.to.hit(e,i))return this},t.prototype.clone=function(){return new t(this)},t}(M);function Hr(r){r.anchors.push(new R(r.rect.x,r.rect.y+r.rect.height/2,K.Left)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y,K.Up)),r.anchors.push(new R(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,K.Right)),r.anchors.push(new R(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,K.Bottom))}function qr(r){r.image&&r.imageWidth?r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.imageWidth,r.imageHeight):r.icon&&r.iconSize?r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.iconSize,r.iconSize):r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height*3/4-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function Vr(r){var t=r.rect.height-r.paddingTopNum-r.paddingBottomNum;r.textRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum+t*3/4,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t/4),r.fullTextRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t)}var Yr=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Xr=function(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var i=Array(r),n=0,t=0;t<e;t++)for(var o=arguments[t],p=0,b=o.length;p<b;p++,n++)i[n]=o[p];return i},Me=["TID","events","wheres","text","fontFamily","fontSize","lineHeight","fontStyle","fontWeight","textAlign","textBaseline","textBackground","iconFamily","icon","iconSize"],Nt=function(r){Yr(t,r);function t(e,i){var n=r.call(this)||this;n.imageRatio=!0,n.points=[],n.anchors=[],n.manualAnchors=[],n.rotatedAnchors=[],n.animateDuration=0,n.animateFrames=[],n.animateFrame=0;var o={zRotate:0,borderRadius:0,imageAlign:"center",gradientAngle:0,gradientRadius:.01,paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,animateFrame:0,children:[]};if(n.fromData(o,e),n.type=g.Node,i||(delete n.elementLoaded,delete n.elementRendered),delete n.animateReady,e.children&&e.children[0]&&e.children[0].parentRect&&(n.paddingLeft=e.children[0].parentRect.offsetX,n.paddingRight=0,n.paddingTop=e.children[0].parentRect.offsetY,n.paddingBottom=0),e.parentRect&&(n.rectInParent={x:e.parentRect.x*100+"%",y:e.parentRect.y*100+"%",width:e.parentRect.width*100+"%",height:e.parentRect.height*100+"%",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,rotate:e.parentRect.rotate},n.paddingTop=e.parentRect.marginY,n.paddingBottom=e.parentRect.marginY,n.paddingLeft=e.parentRect.marginX,n.paddingRight=e.parentRect.marginX),e.points&&(n.points=[],e.points.forEach(function(U){n.points.push(new R(U.x,U.y))})),e.manualAnchors&&(n.manualAnchors=[],e.manualAnchors.forEach(function(U){var rt=new R(U.x,U.y);rt.id=e.id,n.manualAnchors.push(rt)})),i&&(n.animateFrames=void 0),!i&&e.animateFrames&&e.animateFrames.length){for(var p=0,b=e.animateFrames;p<b.length;p++){var z=b[p];z.children=void 0,z.initState&&(z.initState=t.cloneState(z.initState)),z.state=t.cloneState(z.state)}n.animateFrames=e.animateFrames}return n.animateType=e.animateType?e.animateType:e.animateDuration?"custom":"",n.init(i),e.init&&e.img&&!e.image&&(n.img=e.img),e.children&&(n.children=[],e.children.forEach(function(U){var rt;switch(U.TID=n.TID,U.type){case g.Line:rt=new Ot(U),rt.calcRectByParent(n);break;default:t.prototype.calcRectByParent.apply(U,[n]),rt=new t(U),rt.parentId=n.id,rt.init(i);break}n.children.push(rt)})),n}return Object.defineProperty(t.prototype,"dockWatchers",{get:function(){return Xr([this.rect.center],this.rect.toPoints())},set:function(i){},enumerable:!0,configurable:!0}),t.cloneState=function(e){var i=new t(e,!0);return Me.forEach(function(n){delete i[n]}),i},t.prototype.restore=function(e){if(!e&&this.animateReady&&(e=t.cloneState(this.animateReady)),!!e){for(var i in this)if(e[i]!==void 0&&i.indexOf("animate")<0&&i.indexOf("Animate")<0){if(Me.includes(i))continue;this[i]=e[i],i==="rect"&&(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height))}this.init(!0)}},t.prototype.checkData=function(){this.rect.width=this.rect.width<0?0:this.rect.width,this.rect.height=this.rect.height<0?0:this.rect.height,this.rect.calcCenter||(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height))},t.prototype.init=function(e){this.checkData(),this.calcAbsPadding(),zt[this.name]?zt[this.name](this):Vr(this),Dt[this.name]?Dt[this.name](this):qr(this),this.calcAnchors(),this.elementRendered=!1,e||this.addToDiv()},t.prototype.addToDiv=function(){(this.audio||this.video||this.iframe||this.elementId||this.gif||this.imageLoading)&&nt.Store.set(this.generateStoreKey("LT:addDiv"),this)},t.prototype.removeFromDiv=function(){nt.Store.set(this.generateStoreKey("LT:removeDiv"),this)},t.prototype.hasGif=function(){if(this.gif)return!0;if(this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];if(n.type===g.Node&&n.hasGif&&n.hasGif())return!0}return!1},t.prototype.calcAbsPadding=function(){this.paddingLeftNum=jt(this.rect.width,this.paddingLeft),this.paddingRightNum=jt(this.rect.width,this.paddingRight),this.paddingTopNum=jt(this.rect.height,this.paddingTop),this.paddingBottomNum=jt(this.rect.height,this.paddingBottom)},t.prototype.draw=function(e){if(!!Et[this.name]){switch(this.bkType){case 1:this.drawBkLinearGradient(e);break;case 2:this.drawBkRadialGradient(e);break}switch(this.strokeType){case 1:this.strokeLinearGradient(e);break}Et[this.name](e,this),this.image||this.img&&this.elementId===""?this.drawImg(e):this.icon&&(e.save(),e.shadowColor="",e.shadowBlur=0,H(e,this),e.restore()),this.name!=="text"&&this.text&&!this.hiddenText&&q(e,this)}},t.prototype.strokeLinearGradient=function(e){if(!(!this.lineGradientFromColor||!this.lineGradientToColor)){var i=new R(this.rect.x,this.rect.center.y),n=new R(this.rect.ex,this.rect.center.y);this.lineGradientAngle%90==0&&this.lineGradientAngle%180?this.lineGradientAngle%270?(i.x=this.rect.center.x,i.y=this.rect.y,n.x=this.rect.center.x,n.y=this.rect.ey):(i.x=this.rect.center.x,i.y=this.rect.ey,n.x=this.rect.center.x,n.y=this.rect.y):this.lineGradientAngle&&(i.rotate(this.lineGradientAngle,this.rect.center),n.rotate(this.lineGradientAngle,this.rect.center));var o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.lineGradientFromColor),o.addColorStop(1,this.lineGradientToColor),e.strokeStyle=o}},t.prototype.drawBkLinearGradient=function(e){if(!(!this.gradientFromColor||!this.gradientToColor)){var i=new R(this.rect.x,this.rect.center.y),n=new R(this.rect.ex,this.rect.center.y);this.gradientAngle%90==0&&this.gradientAngle%180?this.gradientAngle%270?(i.x=this.rect.center.x,i.y=this.rect.y,n.x=this.rect.center.x,n.y=this.rect.ey):(i.x=this.rect.center.x,i.y=this.rect.ey,n.x=this.rect.center.x,n.y=this.rect.y):this.gradientAngle&&(i.rotate(this.gradientAngle,this.rect.center),n.rotate(this.gradientAngle,this.rect.center));var o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.gradientFromColor),o.addColorStop(1,this.gradientToColor),e.fillStyle=o}},t.prototype.drawBkRadialGradient=function(e){if(!(!this.gradientFromColor||!this.gradientToColor)){var i=this.rect.width;i<this.rect.height&&(i=this.rect.height),i*=.5;var n=e.createRadialGradient(this.rect.center.x,this.rect.center.y,i*this.gradientRadius,this.rect.center.x,this.rect.center.y,i);n.addColorStop(0,this.gradientFromColor),n.addColorStop(1,this.gradientToColor),e.fillStyle=n}},t.prototype.drawImg=function(e){var i=this;this.lastImage!==this.image&&(this.img=void 0,this.lastImage&&this.lastImage.indexOf(".gif")>0&&nt.Store.set(this.generateStoreKey("LT:addDiv"),this));var n=this.image&&this.image.indexOf(".gif")>0;if(n){if(this.img){this.TID&&!this.elementLoaded&&(this.elementLoaded=!0,nt.Store.set(this.generateStoreKey("LT:addDiv"),this));return}}else if(this.img){e.save(),e.shadowColor="",e.shadowBlur=0;var o=this.getIconRect(),p=o.x,b=o.y,z=o.width,U=o.height;switch(this.imageWidth&&(z=this.imageWidth),this.imageHeight&&(U=this.imageHeight),this.imgNaturalWidth&&this.imgNaturalHeight&&this.imageRatio&&(this.imageWidth?U=this.imgNaturalHeight/this.imgNaturalWidth*z:z=this.imgNaturalWidth/this.imgNaturalHeight*U),p+=(o.width-z)/2,b+=(o.height-U)/2,this.imageAlign){case"top":b=o.y;break;case"bottom":b=o.ey-U;break;case"left":p=o.x;break;case"right":p=o.ex-z;break;case"left-top":p=o.x,b=o.y;break;case"right-top":p=o.ex-z,b=o.y;break;case"left-bottom":p=o.x,b=o.ey-U;break;case"right-bottom":p=o.ex-z,b=o.ey-U;break}this.iconRotate&&(e.translate(o.center.x,o.center.y),e.rotate(this.iconRotate*Math.PI/180),e.translate(-o.center.x,-o.center.y)),this.imageHide||e.drawImage(this.img,p,b,z,U),e.restore(),this.imageLoading=!1,nt.Store.set(this.generateStoreKey("LT:addDiv"),this);return}else if(C[this.image]){this.img=C[this.image].img,this.lastImage=this.image,this.imgNaturalWidth=this.img.naturalWidth,this.imgNaturalHeight=this.img.naturalHeight,this.drawImg(e);return}if(!!this.image){var rt=new Image;this.imageLoading=!0,nt.Store.set(this.generateStoreKey("LT:addDiv"),this),rt.crossOrigin="anonymous",rt.src=this.image,rt.onload=function(){i.lastImage=i.image,i.imgNaturalWidth=rt.naturalWidth,i.imgNaturalHeight=rt.naturalHeight,i.img=rt,C[i.image]={img:rt},nt.Store.set(i.generateStoreKey("LT:imageLoaded"),!0),i.imageLoading=!1,nt.Store.set(i.generateStoreKey("LT:addDiv"),i),!i.gif&&n&&(i.gif=!0,i.TID&&(i.elementLoaded=!0,nt.Store.set(i.generateStoreKey("LT:addDiv"),i)))},rt.onerror=function(){var ht=new Image;ht.crossOrigin="anonymous";var ct=i.errorImage||"/img/error.png";ht.src=ct,ht.onload=function(){i.image=ct,i.lastImage=ct,i.imgNaturalWidth=ht.naturalWidth,i.imgNaturalHeight=ht.naturalHeight,i.img=ht,C[ct]={img:ht},nt.Store.set(i.generateStoreKey("LT:imageLoaded"),!0),i.imageLoading=!1,nt.Store.set(i.generateStoreKey("LT:addDiv"),i)},ht.onerror=function(){i.imageLoading=!1,nt.Store.set(i.generateStoreKey("LT:addDiv"),i)}}}},t.prototype.calcAnchors=function(){var e=this;this.anchors=[],Ut[this.name]?Ut[this.name](this):Hr(this),this.manualAnchors&&this.manualAnchors.forEach(function(i){var n=Math.abs(i.x-e.rect.center.x),o=Math.abs(i.y-e.rect.center.y);n>o?i.x<e.rect.center.x?i.direction=K.Left:i.direction=K.Right:i.y<e.rect.center.y?i.direction=K.Up:i.direction=K.Bottom,e.anchors.push(i)}),this.calcRotateAnchors()},t.prototype.calcRotateAnchors=function(e){e===void 0&&(e=this.rotate),this.rotatedAnchors=[];for(var i=0,n=this.anchors;i<n.length;i++){var o=n[i];this.rotatedAnchors.push(o.clone().rotate(e,this.rect.center))}},t.prototype.getTextRect=function(){var e=this.textRect;return!this.icon&&!this.image&&(e=this.fullTextRect),e},t.prototype.getIconRect=function(){var e=this.iconRect;return this.text||(e=this.fullIconRect||this.fullTextRect||this.rect),e},t.prototype.calcRectByParent=function(e){if(!!this.rectInParent){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum,o=e.rect.x+e.paddingLeftNum+jt(i,this.rectInParent.x)+jt(i,this.rectInParent.marginLeft),p=e.rect.y+e.paddingTopNum+jt(n,this.rectInParent.y)+jt(i,this.rectInParent.marginTop),b=jt(i,this.rectInParent.width),z=jt(n,this.rectInParent.height);this.rectInParent.marginLeft===void 0&&this.rectInParent.marginRight&&(o-=jt(i,this.rectInParent.marginRight)),this.rectInParent.marginTop===void 0&&this.rectInParent.marginBottom&&(p-=jt(i,this.rectInParent.marginBottom)),this.rect=new a(o,p,b,z),this.rectInParent.rotate||(this.rectInParent.rotate=0);var U=e.rotate+e.offsetRotate;this.rotate=this.rectInParent.rotate+U,this.rectInParent.rect||(this.rectInParent.rect=this.rect.clone())}},t.prototype.calcChildrenRect=function(){if(!!this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.calcRectByParent(this),n.type===g.Node&&(n.init(),n.calcChildrenRect())}},t.prototype.calcRectInParent=function(e){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum;this.rectInParent={x:(this.rect.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.rect.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:this.rect.width*100/i+"%",height:this.rect.height*100/n+"%",rotate:this.rectInParent?this.rectInParent.rotate||0:this.rotate||0,rect:this.rect.clone()}},t.prototype.initAnimate=function(){if(!!this.animateFrames){for(var e=0,i=0;i<this.animateFrames.length;++i)this.animateFrames[i].start=e,e+=this.animateFrames[i].duration,this.animateFrames[i].end=e,this.animateFrames[i].initState=t.cloneState(i?this.animateFrames[i-1].state:this),this.animateFrames[i].offsetRect=new a(this.animateFrames[i].state.rect.x-this.animateFrames[i].initState.rect.x,this.animateFrames[i].state.rect.y-this.animateFrames[i].initState.rect.y,this.animateFrames[i].state.rect.width-this.animateFrames[i].initState.rect.width,this.animateFrames[i].state.rect.height-this.animateFrames[i].initState.rect.height);this.animateDuration=e,this.animateReady=t.cloneState(this),this.animatePos=0,this.animateFrame=0}},t.prototype.pauseAnimate=function(){this.animateFrame=this._animateFrame,this.animatePos=this._animatePos,nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0})},t.prototype.stopAnimate=function(){this.animateStart=0,nt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0}),this.restore(),this.initAnimate(),nt.Store.set(this.generateStoreKey("LT:render"),{pen:this,stop:!0})},t.prototype.animate=function(e){var i=this;if(!(this.animateStart<1)){var n=e-this.animateStart;if(this.animateFrame>0&&(this.animateFrames.forEach(function(rt,ht){i.animateFrame<ht+1&&(n+=rt.duration)}),n+=this.animatePos),n>this.animateDuration){if(this.animatePos=0,this.animateFrame=0,this.restore(),this.animateCycle>0&&++this.animateCycleIndex>=this.animateCycle){this.animateStart=0,this.animateCycleIndex=0,nt.Store.set(this.generateStoreKey("animateEnd"),this),this.animateAlone||nt.Store.set(this.generateStoreKey("LT:rectChanged"),this);return}this.animateStart=e,n=0}for(var o=!1,p=0;p<this.animateFrames.length;++p){var b=this.animateFrames[p];if(n>=b.start&&n<b.end){b.state.dash&&(this.dash=b.state.dash),b.state.strokeStyle&&(this.strokeStyle=b.state.strokeStyle),b.state.fillStyle&&(this.fillStyle=b.state.fillStyle),b.state.text&&(this.text=b.state.text),b.state.fontColor&&(this.fontColor=b.state.fontColor),b.state.fontFamily&&(this.fontFamily=b.state.fontFamily),b.state.fontSize&&(this.fontSize=b.state.fontSize),b.state.lineHeight&&(this.lineHeight=b.state.lineHeight),b.state.fontStyle&&(this.fontStyle=b.state.fontStyle),b.state.fontWeight&&(this.fontWeight=b.state.fontWeight),b.state.textAlign&&(this.textAlign=b.state.textAlign),b.state.textBaseline&&(this.textBaseline=b.state.textBaseline),b.state.textBackground&&(this.textBackground=b.state.textBackground),b.state.iconFamily&&(this.iconFamily=b.state.iconFamily),b.state.icon&&(this.icon=b.state.icon),b.state.iconSize&&(this.iconSize=b.state.iconSize),b.state.iconColor&&(this.iconColor=b.state.iconColor),this.visible=b.state.visible,this._animateFrame=p+1,this._animateFrame>this.animateFrame&&(this.animateFrame=0,this.animatePos=0),this._animatePos=n-b.start;var z=this._animatePos/b.duration;if(b.linear){if(b.state.rect.x!==b.initState.rect.x&&(this.rect.x=b.initState.rect.x+b.offsetRect.x*z,o=!0),b.state.rect.y!==b.initState.rect.y&&(this.rect.y=b.initState.rect.y+b.offsetRect.y*z,o=!0),b.state.rect.width!==b.initState.rect.width&&(this.rect.width=b.initState.rect.width+b.offsetRect.width*z,o=!0),b.state.rect.height!==b.initState.rect.height&&(this.rect.height=b.initState.rect.height+b.offsetRect.height*z,o=!0),this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calcCenter(),b.initState.z!==void 0&&b.state.z!==b.initState.z&&(this.z=b.initState.z+(b.state.z-b.initState.z)*z,o=!0),b.state.borderRadius!==b.initState.borderRadius&&(this.borderRadius=b.initState.borderRadius+(b.state.borderRadius-b.initState.borderRadius)*z),b.state.lineWidth!==b.initState.lineWidth&&(this.lineWidth=b.initState.lineWidth+(b.state.lineWidth-b.initState.lineWidth)*z),b.state.rotate!==b.initState.rotate&&(this.rotate=b.initState.rotate+(b.state.rotate-b.initState.rotate)*z,o=!0),b.state.globalAlpha!==b.initState.globalAlpha&&(this.globalAlpha=b.initState.globalAlpha+(b.state.globalAlpha-b.initState.globalAlpha)*z),b.state.lineDashOffset&&(this.lineDashOffset?this.lineDashOffset+=b.state.lineDashOffset:this.lineDashOffset=b.state.lineDashOffset),b.state.value!==b.initState.value&&(this.value=(b.initState.value||0)+((b.state.value||0)-(b.initState.value||0))*z),b.state.num!==b.initState.num&&(this.num=(b.initState.num||0)+((b.state.num||0)-(b.initState.num||0))*z),b.state.num1!==b.initState.num1&&(this.num1=(b.initState.num1||0)+((b.state.num1||0)-(b.initState.num1||0))*z),b.state.num2!==b.initState.num2&&(this.num2=(b.initState.num2||0)+((b.state.num2||0)-(b.initState.num2||0))*z),b.state.num3!==b.initState.num3&&(this.num3=(b.initState.num3||0)+((b.state.num3||0)-(b.initState.num3||0))*z),b.state.data)for(var U in b.state.data)typeof b.state.data[U]=="number"?this.data[U]=(b.initState.data[U]||0)+((b.state.data[U]||0)-(b.initState.data[U]||0))*z:b.state.data[U]!==void 0&&b.state.data[U]!==void 0&&(this.data[U]=b.state.data[U])}else this.rect=b.state.rect,this.lineWidth=b.state.lineWidth,this.rotate=b.state.rotate,this.globalAlpha=b.state.globalAlpha,this.lineDashOffset=b.state.lineDashOffset}}o&&(this.init(!0),this.animateAlone||nt.Store.set(this.generateStoreKey("LT:rectChanged"),this))}},t.prototype.scale=function(e,i){if(i||(i=this.rect.center),this.oldRect=this.rect.clone(),this.rect.x=i.x-(i.x-this.rect.x)*e,this.rect.y=i.y-(i.y-this.rect.y)*e,this.textOffsetX*=e,this.textOffsetY*=e,this.z*=e,this.rect.width*=e,this.rect.height*=e,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.lineWidth*=e,this.imageWidth&&(this.imageWidth*=e),this.imageHeight&&(this.imageHeight*=e),this.lastImage=void 0,this.fontSize*=e,this.iconSize*=e,typeof this.paddingLeft=="number"&&(this.paddingLeft*=e),typeof this.paddingTop=="number"&&(this.paddingTop*=e),typeof this.paddingRight=="number"&&(this.paddingRight*=e),typeof this.paddingBottom=="number"&&(this.paddingBottom*=e),this.rectInParent&&(typeof this.rectInParent.x=="number"&&(this.rectInParent.x*=e),typeof this.rectInParent.y=="number"&&(this.rectInParent.y*=e),typeof this.rectInParent.width=="number"&&(this.rectInParent.width*=e),typeof this.rectInParent.height=="number"&&(this.rectInParent.height*=e),typeof this.rectInParent.marginLeft=="number"&&(this.rectInParent.marginLeft*=e),typeof this.rectInParent.marginTop=="number"&&(this.rectInParent.marginTop*=e),typeof this.rectInParent.marginRight=="number"&&(this.rectInParent.marginRight*=e),typeof this.rectInParent.marginBottom=="number"&&(this.rectInParent.marginBottom*=e)),this.rect.calcCenter(),this.animateFrames&&this.animateFrames.length)for(var n=0,o=this.animateFrames;n<o.length;n++){var p=o[n];p.initState&&(p.initState.scale||(p.initState=new t(p.initState)),p.initState.scale(e,i)),p.state&&(p.state.scale||(p.state=new t(p.state)),p.state.scale(e,i)),p.initState&&p.state&&(p.state.fontSize=p.initState.fontSize)}if(this.scalePoints(e,e),this.elementRendered=!1,this.init(),this.children)for(var b=0,z=this.children;b<z.length;b++){var p=z[b];p.scale(e,i)}this.animateReady&&this.animateReady.scale&&this.animateReady.scale(e,i)},t.prototype.scalePoints=function(e,i){var n=this;(this.points||this.manualAnchors)&&this.oldRect&&(e||(e=this.rect.width/this.oldRect.width),i||(i=this.rect.height/this.oldRect.height),this.points&&this.points.forEach(function(o){o.x=n.rect.x+(o.x-n.oldRect.x)*e,o.y=n.rect.y+(o.y-n.oldRect.y)*i}),this.manualAnchors&&this.manualAnchors.forEach(function(o){o.x=n.rect.x+(o.x-n.oldRect.x)*e,o.y=n.rect.y+(o.y-n.oldRect.y)*i}))},t.prototype.translate=function(e,i){if(this.rect.x+=e,this.rect.y+=i,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calcCenter(),this.animateReady&&this.animateReady.translate(e,i),this.animateFrames&&this.animateFrames.length)for(var n=0,o=this.animateFrames;n<o.length;n++){var p=o[n],b=p.initState,z=p.state;b&&b.translate&&b.translate(e,i),z&&z.translate&&z.translate(e,i)}if(this.points&&this.points.forEach(function(ct){ct.x+=e,ct.y+=i}),this.manualAnchors&&this.manualAnchors.forEach(function(ct){ct.x+=e,ct.y+=i}),this.init(),this.children)for(var U=0,rt=this.children;U<rt.length;U++){var ht=rt[U];ht.translate(e,i)}},t.prototype.initRect=function(){if(this.rect.init(),this.children){this.calcChildrenRect();for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n instanceof t&&n.initRect()}}},t.prototype.pushPoint=function(e){var i=this;this.points.push(e),this.rect||(this.rect=new a(0,0,0,0)),this.points.forEach(function(n){(!i.rect.x||i.rect.x>n.x)&&(i.rect.x=n.x),(!i.rect.y||i.rect.y>n.y)&&(i.rect.y=n.y),i.rect.ex<n.x&&(i.rect.ex=n.x),i.rect.ey<n.y&&(i.rect.ey=n.y)}),this.rect.width=this.rect.ex-this.rect.x,this.rect.height=this.rect.ey-this.rect.y},t.prototype.nearestAnchor=function(e){for(var i=99999,n=0,o=0;o<this.rotatedAnchors.length;++o){var p=qe(e,this.rotatedAnchors[o]);i>p&&(i=p,n=o)}return{index:n,direction:this.rotatedAnchors[n].direction}},t.prototype.hitInSelf=function(e,i){if(i===void 0&&(i=0),this.rotate%360==0)return this.rect.hit(e,i);for(var n=this.rect.toPoints(),o=0,p=n;o<p.length;o++){var b=p[o];b.rotate(this.rotate,this.rect.center)}return c(e,n)},t.prototype.hit=function(e,i){i===void 0&&(i=0);var n;if(this.hitInSelf(e,i)&&(n=this),this.children)for(var o=this.children.length,p=o-1;p>-1;--p){var b=this.children[p],z=b.hit(e,i);if(z){n=z;break}}return n},t.prototype.round=function(){if(this.rect.round(),this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.rect.round()}},t.prototype.clone=function(){var e=new t(this);return e.setTID(this.TID),e.elementRendered=!1,e.elementLoaded=!1,this.name!=="div"&&(e.elementId=void 0),e},t}(M),Ht;(function(r){r[r.None=0]="None",r[r.Readonly=1]="Readonly",r[r.NoMove=2]="NoMove",r[r.NoEvent=10]="NoEvent"})(Ht||(Ht={}));var te;(function(r){r[r.Default=0]="Default",r[r.In=1]="In",r[r.Out=2]="Out"})(te||(te={}));function Qr(r){var t=document.createElement("div");return t.style.position="absolute",t.style.outline="none",t.style.left="-9999px",t.style.bottom="-9999px",t.style.width=r.rect.width+"px",t.style.height=r.rect.height+"px",r.elementId&&(t.id=r.elementId),t}function Ti(r){var t=document.createElement("input");return t.style.position="absolute",t.style.outline="none",t.style.left="-9999px",t.style.bottom="-9999px",t.style.width=r.rect.width+"px",t.style.height=r.rect.height+"px",t.style.border="1px solid #cdcdcd",t.classList.add("set-text-input"),r.elementId&&(t.id=r.elementId),t}function Gr(r,t,e){var i=document.createElement("script");i.type="text/javascript",i.src=r,i.addEventListener("load",function(){t&&t(),e&&nt.Store.set("LT:render",!0)}),document.body.appendChild(i)}function $t(r){for(var t=[],e=0,i=r;e<i.length;e++){var n=i[e];if(n instanceof Nt){var o=n.rect.toPoints();if(n.rotate)for(var p=0,b=o;p<b.length;p++){var z=b[p];z.rotate(n.rotate,n.rect.center)}t.push.apply(t,o)}else if(n instanceof Ot){if(n.children)n.children.forEach(function(Pt){if(t.push(Pt.from),t.push(Pt.to),Array.isArray(Pt.controlPoints)&&t.push.apply(t,Pt.controlPoints),Pt.name==="curve")for(var Bt=.01;Bt<1;Bt+=.02)t.push(Xt(Bt,Pt.from,Pt.controlPoints[0],Pt.controlPoints[1],Pt.to))});else if(n.from&&(t.push(n.from),t.push(n.to),Array.isArray(n.controlPoints)&&t.push.apply(t,n.controlPoints),n.name==="curve"))for(var U=.01;U<1;U+=.02)t.push(Xt(U,n.from,n.controlPoints[0],n.controlPoints[1],n.to))}}var rt=me(t),ht=rt.x1,ct=rt.y1,yt=rt.x2,St=rt.y2;return new a(ht,ct,yt-ht,St-ct)}function me(r){for(var t=Infinity,e=Infinity,i=-Infinity,n=-Infinity,o=0,p=r;o<p.length;o++){var b=p[o],z=b.x,U=b.y;isNaN(z)||isNaN(U)||(t=Math.min(t,z),e=Math.min(e,U),i=Math.max(i,z),n=Math.max(n,U))}return{x1:t,y1:e,x2:i,y2:n}}function Jr(r,t){return!(r.x>t.ex||r.ex<t.x||r.ey<t.y||r.y>t.ey)}function $r(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=new a(r[0].x,r[0].y,r[0].width,r[0].height),i=1;i<r.length;i++){var n=r[i];n&&(e.x>n.x&&(e.x=n.x),e.y>n.y&&(e.y=n.y),e.ex<n.ex&&(e.ex=n.ex),e.ey<n.ey&&(e.ey=n.ey))}return new a(e.x,e.y,e.ex-e.x,e.ey-e.y)}function Zr(){return/Android|webOS|iPad|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}function ti(){var r=indexedDB.open("topology-caches");r.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains("caches")&&e.deleteObjectStore("caches"),e.createObjectStore("caches",{keyPath:"dbIndex"})},r.onsuccess=function(t){var e=r.result;if(!!e.objectStoreNames.contains("caches")){var i=e.transaction(["caches"],"readwrite").objectStore("caches");i.clear()}},r.onerror=function(t){console.warn("\u6570\u636E\u5E93\u6253\u5F00\u5931\u8D25"+t)}}function Oe(r){var t=indexedDB.open("topology-caches");t.onsuccess=function(e){var i=t.result;if(!!i.objectStoreNames.contains("caches")){var n=i.transaction(["caches"],"readwrite").objectStore("caches");n.delete(IDBKeyRange.lowerBound(r))}},t.onupgradeneeded=function(e){var i=e.target.result;i.objectStoreNames.contains("caches")&&i.deleteObjectStore("caches"),i.createObjectStore("caches",{keyPath:"dbIndex"})}}function ei(r,t,e){var i=indexedDB.open("topology-caches");i.onsuccess=function(n){var o=i.result;if(!!o.objectStoreNames.contains("caches")){var p=o.transaction(["caches"],"readwrite").objectStore("caches");r.dbIndex=t,p.add(r);var b=p.count();b.onsuccess=function(){b.result>e&&p.delete(t-e)}}},i.onupgradeneeded=function(n){var o=n.target.result;o.objectStoreNames.contains("caches")&&o.deleteObjectStore("caches"),o.createObjectStore("caches",{keyPath:"dbIndex"})}}function Be(r){return new Promise(function(t,e){var i=indexedDB.open("topology-caches");i.onsuccess=function(n){var o=i.result;if(!o.objectStoreNames.contains("caches")){t(null);return}var p=o.transaction(["caches"]).objectStore("caches"),b=p.get(r);b.onsuccess=function(){t(b.result)}},i.onupgradeneeded=function(n){var o=n.target.result;o.objectStoreNames.contains("caches")&&o.deleteObjectStore("caches"),o.createObjectStore("caches",{keyPath:"dbIndex"})}})}function re(r,t){var e={pens:[],lineName:"curve",fromArrow:"",toArrow:"triangleSolid",scale:1,locked:Ht.None,x:0,y:0};if(typeof r=="string"&&(r=JSON.parse(r)),e=Object.assign(e,r),e.pens=[],r){if(r.nodes){for(var i=0,n=r.nodes;i<n.length;i++){var o=n[i];o.TID=t,e.pens.push(new Nt(o))}for(var p=0,b=r.lines;p<b.length;p++){var o=b[p];o.TID=t,e.pens.push(new Ot(o))}}r.pens&&r.pens.forEach(function(U){t&&(U.TID=t),U.type?e.pens.push(new Ot(U)):e.pens.push(new Nt(U))}),r.bkImageRect&&(e.bkImageRect=new a(r.bkImageRect.x,r.bkImageRect.y,r.bkImageRect.width,r.bkImageRect.height))}if(e.mqttOptions){var z="";typeof e.mqttOptions=="object"?z=JSON.stringify(e.mqttOptions):z=e.mqttOptions+"",e.mqttOptions=JSON.parse(z)}else e.mqttOptions={clientId:xt()};return t&&nt.Store.set(t+"-topology-data",e),e}var ne=function(){function r(t){var e=this;this.TID=t,this.subcribe=nt.Store.subscribe(this.generateStoreKey("topology-data"),function(i){e.data=i})}return r.prototype.generateStoreKey=function(t){return this.TID+"-"+t},r.prototype.destroy=function(){this.subcribe.unsubscribe()},r}(),ri=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),De=function(r){ri(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,n)||this;return o.parentElem=e,o.options=i,o.canvas=document.createElement("canvas"),o.width=0,o.height=0,o.subcribe=nt.Store.subscribe(o.generateStoreKey("topology-data"),function(p){o.data=p}),o.canvas.style.position="absolute",o.canvas.style.left="0",o.canvas.style.top="0",o.canvas.style.outline="none",t.dpiRatio||(!i.extDpiRatio&&i.extDpiRatio!==0&&(window&&window.devicePixelRatio>1?i.extDpiRatio=.25:i.extDpiRatio=0),t.dpiRatio=(window?window.devicePixelRatio:0)+i.extDpiRatio,t.dpiRatio<1&&(t.dpiRatio=1)),o}return t.prototype.resize=function(e){e?(this.width=e.width|0,this.height=e.height|0):(this.options.width&&this.options.width!=="auto"?this.width=+this.options.width:this.width=this.parentElem.clientWidth,this.options.height&&this.options.height!=="auto"?this.height=+this.options.height:this.height=this.parentElem.clientHeight),this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width*t.dpiRatio|0,this.canvas.height=this.height*t.dpiRatio|0,this.canvas.getContext("2d").scale(t.dpiRatio,t.dpiRatio),nt.Store.set(this.generateStoreKey("LT:size"),{width:this.canvas.width,height:this.canvas.height})},t.prototype.render=function(){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.getDpiRatio=function(){return t.dpiRatio},t.prototype.destroy=function(){this.subcribe.unsubscribe()},t.dpiRatio=0,t}(ne),Fe=function(){function r(t){this.side=20,this.dom=document.createElement("div"),this.dom.innerHTML=`    <svg
    focusable="false"
    class="topology-loading"
    width="`+this.side+`px"
    height="`+this.side+`px"
    fill="#1890ff"
    aria-hidden="true"
    viewBox="0 0 1024 1024"
  >
    <path
      d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"
    ></path>
  </svg>`,t.canvas.appendChild(this.dom),this.dom.style.position="absolute";for(var e,i=0;i<document.styleSheets.length;i++)document.styleSheets[i].title==="le5le/loading"&&(e=document.styleSheets[i]);if(!e){var n=document.createElement("style");n.type="text/css",n.title="le5le.com/loading",document.head.appendChild(n),n=document.createElement("style"),n.type="text/css",document.head.appendChild(n),e=n.sheet,e.insertRule(`@keyframes rotatechange {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }`),e.insertRule(`     .topology-loading {
          animation: rotatechange 1s linear 0s infinite normal;
        }`)}}return r.prototype.show=function(t,e){this.dom.style.display="block",this.dom.style.left=t-this.side/2+"px",this.dom.style.top=e-this.side/2+"px"},r.prototype.hide=function(){this.dom.style.display="none"},r}(),ii=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),ni=function(r){ii(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,e,i,n)||this;return o.parentElem=e,o.options=i,o.activeLayer=nt.Store.get(o.generateStoreKey("LT:ActiveLayer")),o.hoverLayer=nt.Store.get(o.generateStoreKey("LT:HoverLayer")),o.animateLayer=nt.Store.get(o.generateStoreKey("LT:AnimateLayer")),nt.Store.set(o.generateStoreKey("LT:offscreen"),o.canvas),o}return t.prototype.render=function(){r.prototype.render.call(this);var e=this.canvas.getContext("2d");e.strokeStyle=this.options.color;for(var i=new a(-this.data.x,-this.data.y,this.width,this.height),n=0,o=this.data.pens;n<o.length;n++){var p=o[n];p.getTID()||p.setTID(this.TID),!(!Jr(p.rect,i)&&p.type===g.Node)&&p.render(e)}this.activeLayer.render(e),this.animateLayer.render(e),this.hoverLayer.render(e)},t}(De),oi=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),si=function(r){oi(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,e,i,n)||this;return o.parentElem=e,o.options=i,o.render=function(){if(o.data&&o.data.bkImage&&!o.bkImg){o.loadBkImg(o.render);return}if(!(!o.width||!o.height||!o.offscreen)){var p=o.canvas.getContext("2d");p.clearRect(0,0,o.canvas.width,o.canvas.height),(o.data.bkColor||o.options.bkColor)&&(p.fillStyle=o.data.bkColor||o.options.bkColor,p.fillRect(0,0,o.width,o.height)),o.bkImg&&o.data.bkImageRect&&p.drawImage(o.bkImg,o.data.bkImageRect.x,o.data.bkImageRect.y,o.data.bkImageRect.width,o.data.bkImageRect.height),(o.data.grid||o.options.grid)&&o.grid(),(o.data.rule||o.options.rule)&&o.rule(),p.drawImage(o.offscreen,0,0,o.width,o.height)}},o.offscreen=nt.Store.get(o.generateStoreKey("LT:offscreen")),o.parentElem.appendChild(o.canvas),o.data=nt.Store.get(o.generateStoreKey("topology-data")),o}return t.prototype.loadBkImg=function(e){var i=this;!this.data.bkImage||(this.bkImg=new Image,this.bkImg.crossOrigin="anonymous",this.bkImg.src=this.data.bkImage,this.bkImg.onload=function(){i.data.bkImageRect||(i.data.bkImageRect=new a(0,0,i.bkImg.naturalWidth,i.bkImg.naturalHeight)),e&&e()})},t.prototype.clearBkImg=function(){this.bkImg=void 0},t.prototype.rule=function(){var e=this.canvas.getContext("2d");e.save(),e.lineWidth=1,e.strokeStyle=ee(.7,this.data.ruleColor||this.options.ruleColor||"#888"),e.beginPath();for(var i=10;i<this.width;i+=10)e.moveTo(i,0),e.lineTo(i,5);for(var i=10;i<this.height;i+=10)e.moveTo(0,i),e.lineTo(5,i);e.stroke(),e.beginPath(),e.strokeStyle=this.data.ruleColor||this.options.ruleColor||"#888",e.fillStyle=e.strokeStyle;for(var i=100;i<this.width;i+=100)e.moveTo(i,0),e.lineTo(i,10),e.fillText(i.toString(),i+4,16);for(var i=100;i<this.height;i+=100)e.moveTo(0,i),e.lineTo(10,i);e.stroke();for(var i=100;i<this.height;i+=100)e.save(),e.beginPath(),e.translate(16,i-4),e.rotate(270*Math.PI/180),e.fillText(i.toString(),0,0),e.restore();e.restore()},t.prototype.grid=function(){var e=this.canvas.getContext("2d");e.save(),e.lineWidth=1,e.strokeStyle=this.data.gridColor||this.options.gridColor||"#f3f3f3",e.beginPath();for(var i=this.data.gridSize||this.options.gridSize,n=i;n<this.width;n+=i)e.moveTo(n,0),e.lineTo(n,this.height);for(var n=i;n<this.height;n+=i)e.moveTo(0,n),e.lineTo(this.width,n);e.stroke(),e.restore()},t}(De),ai=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),hi=function(r){ai(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.hoverAnchorIndex=-1,n.dockLineX=0,n.dockLineY=0,nt.Store.set(n.generateStoreKey("LT:HoverLayer"),n),n}return t.prototype.lineTo=function(e,i){i===void 0&&(i="triangleSolid"),!(!this.line||this.line.locked)&&(this.line.setTo(e,i),(this.line.from.id||this.line.to.id)&&this.line.calcControlPoints(),nt.Store.set(this.generateStoreKey("pts-")+this.line.id,void 0),nt.Store.set(this.generateStoreKey("LT:updateLines"),[this.line]))},t.prototype.lineFrom=function(e){this.line.locked||(this.line.setFrom(e,this.line.fromArrow),(this.line.from.id||this.line.to.id)&&this.line.calcControlPoints(),nt.Store.set(this.generateStoreKey("pts-")+this.line.id,void 0),nt.Store.set(this.generateStoreKey("LT:updateLines"),[this.line]))},t.prototype.render=function(e){var i=this;if(!(this.data.locked===Ht.NoEvent||this.options.hoverColor==="transparent")){if(e.fillStyle=this.options.hoverColor,e.save(),this.options.alwaysAnchor&&this.data.pens.forEach(function(p){if(p.type!==g.Line&&!p.hideAnchor){for(var b=0,z=p.rotatedAnchors;b<z.length;b++){var U=z[b];U.hidden||(e.beginPath(),e.arc(U.x,U.y,U.radius||i.options.anchorRadius,0,Math.PI*2),e.strokeStyle=U.strokeStyle||i.options.hoverColor,e.fillStyle=U.fillStyle||i.options.anchorFillStyle,e.fill(),e.stroke())}i.options.autoAnchor&&(e.beginPath(),e.arc(p.rect.center.x,p.rect.center.y,p.rect.center.radius||i.options.anchorRadius,0,Math.PI*2),e.strokeStyle=i.options.hoverColor,e.fillStyle=i.options.anchorFillStyle,e.fill(),e.stroke())}}),e.restore(),this.node&&!this.data.locked){if(this.node.getTID()||this.node.setTID(this.TID),this.root=this.getRoot(this.node)||this.node,this.root&&(e.save(),e.strokeStyle=this.options.dragColor,e.globalAlpha=.2,this.root.rotate&&(e.translate(this.root.rect.center.x,this.root.rect.center.y),e.rotate((this.root.rotate+this.root.offsetRotate)*Math.PI/180),e.translate(-this.root.rect.center.x,-this.root.rect.center.y)),e.beginPath(),e.strokeRect(this.root.rect.x,this.root.rect.y,this.root.rect.width,this.root.rect.height),e.restore()),!this.options.hideAnchor)for(var n=0;n<this.node.rotatedAnchors.length;++n)this.node.locked||this.node.hideAnchor||this.node.rotatedAnchors[n].hidden&&this.hoverAnchorIndex!==n||(e.beginPath(),e.arc(this.node.rotatedAnchors[n].x,this.node.rotatedAnchors[n].y,this.node.rotatedAnchors[n].radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.node.rotatedAnchors[n].strokeStyle||this.options.hoverColor,e.fillStyle=this.node.rotatedAnchors[n].fillStyle||this.options.anchorFillStyle,e.fill(),e.stroke());this.options.autoAnchor&&(e.beginPath(),e.arc(this.node.rect.center.x,this.node.rect.center.y,this.node.rect.center.radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.options.hoverColor,e.fillStyle=this.options.anchorFillStyle,e.fill(),e.stroke())}if(this.line&&!this.data.locked&&(this.root=this.getRoot(this.line),this.root&&(e.save(),e.strokeStyle=this.options.dragColor,e.globalAlpha=.2,this.root.rotate&&(e.translate(this.root.rect.center.x,this.root.rect.center.y),e.rotate((this.root.rotate+this.root.offsetRotate)*Math.PI/180),e.translate(-this.root.rect.center.x,-this.root.rect.center.y)),e.beginPath(),e.strokeRect(this.root.rect.x,this.root.rect.y,this.root.rect.width,this.root.rect.height),e.restore())),this.dockAnchor&&(e.save(),e.beginPath(),e.arc(this.dockAnchor.x,this.dockAnchor.y,this.dockAnchor.radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.options.dockStrokeStyle,e.fillStyle=this.options.dockFillStyle,e.fill(),e.stroke(),e.restore()),this.hoverLineCP&&(e.beginPath(),e.arc(this.hoverLineCP.x,this.hoverLineCP.y,5,0,Math.PI*2),e.fill()),e.strokeStyle=ee(.5,this.options.hoverColor),e.lineWidth=1,this.dockLineX>0){var o=nt.Store.get(this.generateStoreKey("LT:size"));e.beginPath(),e.moveTo(this.dockLineX,-this.data.y),e.lineTo(this.dockLineX,o.height),e.stroke()}if(this.dockLineY>0){var o=nt.Store.get(this.generateStoreKey("LT:size"));e.beginPath(),e.moveTo(-this.data.x,this.dockLineY),e.lineTo(o.width,this.dockLineY),e.stroke()}this.dragRect&&(e.fillStyle=ee(.2,this.options.dragColor),e.strokeStyle=this.options.dragColor,e.beginPath(),e.strokeRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height),e.fillRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height))}},t.prototype.getRoot=function(e){if(!e.parentId)return null;for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o.id===e.parentId){var p=this.getRoot(o);return p||o}}return null},t.prototype.clear=function(){this.node=void 0,this.line=void 0},t}(ne),ci=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),li=function(r){ci(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.rotateCPs=[],n.sizeCPs=[],n.pens=[],n.rotate=0,n.lastOffsetX=0,n.lastOffsetY=0,n.initialSizeCPs=[],n.nodeRects=[],n.childrenRects={},n.childrenRotate={},n.dockWatchers=[],n.rotating=!1,nt.Store.set(n.generateStoreKey("LT:ActiveLayer"),n),n}return t.prototype.calcControlPoints=function(){if(this.pens.length===1&&this.pens[0]instanceof Nt){if(this.rect=this.pens[0].rect,this.sizeCPs=this.pens[0].rect.toPoints(),this.rotateCPs=[new R(this.pens[0].rect.x+this.pens[0].rect.width/2,this.pens[0].rect.y-35),new R(this.pens[0].rect.x+this.pens[0].rect.width/2,this.pens[0].rect.y)],this.rotate||this.pens[0].rotate){for(var e=0,i=this.sizeCPs;e<i.length;e++){var n=i[e];this.pens[0].rotate&&n.rotate(this.pens[0].rotate,this.pens[0].rect.center),this.rotate&&n.rotate(this.rotate,this.rect.center)}for(var o=0,p=this.rotateCPs;o<p.length;o++){var n=p[o];this.pens[0].rotate&&n.rotate(this.pens[0].rotate,this.pens[0].rect.center),this.rotate&&n.rotate(this.rotate,this.rect.center)}}(this.options.hideRotateCP||this.pens[0].hideRotateCP)&&(this.rotateCPs=[new R(-1e3,-1e3),new R(-1e3,-1e3)]);return}var b=me(this.getPoints()),z=b.x1,U=b.y1,rt=b.x2,ht=b.y2;this.rect=new a(z,U,rt-z,ht-U),this.sizeCPs=[new R(z,U),new R(rt,U),new R(rt,ht),new R(z,ht)],this.rotateCPs=[new R(z+(rt-z)/2,U-35),new R(z+(rt-z)/2,U)],this.options.hideRotateCP&&(this.rotateCPs=[new R(-1e3,-1e3),new R(-1e3,-1e3)])},t.prototype.locked=function(){for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];if(!n.locked)return!1}return!0},t.prototype.getPoints=function(){for(var e=[],i=0,n=this.pens;i<n.length;i++){var o=n[i];if(o.type===g.Node){var p=o.rect.toPoints();if(o.rotate)for(var b=0,z=p;b<z.length;b++){var U=z[b];U.rotate(o.rotate,o.rect.center)}e.push.apply(e,p)}else if(o instanceof Ot){if(o.children)o.children.forEach(function(ht){if(e.push(ht.from),e.push(ht.to),ht.name==="curve")for(var ct=.01;ct<1;ct+=.02)e.push(Xt(ct,ht.from,ht.controlPoints[0],ht.controlPoints[1],ht.to))});else if(o.from&&(e.push(o.from),e.push(o.to),o.name==="curve"))for(var rt=.01;rt<1;rt+=.02)e.push(Xt(rt,o.from,o.controlPoints[0],o.controlPoints[1],o.to))}}return e},t.prototype.clear=function(){this.pens=[],this.sizeCPs=[],this.rotateCPs=[],nt.Store.set(this.generateStoreKey("LT:activeNode"),void 0)},t.prototype.saveNodeRects=function(){this.nodeRects=[],this.childrenRects={};for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];n.type&&n.from?this.nodeRects.push(new a(n.from.x,n.from.y,n.rect.width,n.rect.height)):this.nodeRects.push(new a(n.rect.x,n.rect.y,n.rect.width,n.rect.height)),this.saveChildrenRects(n)}this.initialSizeCPs=[];for(var o=0,p=this.sizeCPs;o<p.length;o++){var n=p[o];this.initialSizeCPs.push(n.clone())}this.getDockWatchers()},t.prototype.saveChildrenRects=function(e){if(!(e.type||!e.children))for(var i=0,n=e.children;i<n.length;i++){var o=n[i];this.childrenRects[o.id]=new a(o.rect.x,o.rect.y,o.rect.width,o.rect.height),this.childrenRotate[o.id]=o.rotate,this.saveChildrenRects(o)}},t.prototype.resize=function(e,i,n){var o=new R(i.x,i.y),p=new R(n.x,n.y);this.pens.length===1&&this.pens[0].rotate%360&&(o.rotate(-this.pens[0].rotate,this.nodeRects[0].center),p.rotate(-this.pens[0].rotate,this.nodeRects[0].center));var b=p.x-o.x,z=p.y-o.y,U=b-this.lastOffsetX,rt=z-this.lastOffsetY;this.lastOffsetX=b,this.lastOffsetY=z;var ht=this.activeRect.width,ct=this.activeRect.height;switch(n.shiftKey&&(rt=U*ct/ht),e){case 0:if(this.activeRect.width-U<5||this.activeRect.height-rt<5)return;n.shiftKey?(U=-U,rt=-rt,this.activeRect.ex+=U,this.activeRect.ey+=rt,this.activeRect.width+=U,this.activeRect.height+=rt):(this.activeRect.x+=U,this.activeRect.y+=rt,this.activeRect.width-=U,this.activeRect.height-=rt);break;case 1:if(this.activeRect.width+U<5||this.activeRect.height-rt<5)return;n.shiftKey?(this.activeRect.ex+=U,this.activeRect.ey+=rt,this.activeRect.width+=U,this.activeRect.height+=rt):(this.activeRect.ex+=U,this.activeRect.y+=rt,this.activeRect.width+=U,this.activeRect.height-=rt);break;case 2:if(this.activeRect.width+U<5||this.activeRect.height+rt<5)return;this.activeRect.ex+=U,this.activeRect.ey+=rt,this.activeRect.width+=U,this.activeRect.height+=rt;break;case 3:if(this.activeRect.width-U<5||this.activeRect.height+rt<5)return;n.shiftKey?(U=-U,rt=-rt,this.activeRect.ex+=U,this.activeRect.ey+=rt,this.activeRect.width+=U,this.activeRect.height+=rt):(this.activeRect.x+=U,this.activeRect.ey+=rt,this.activeRect.width-=U,this.activeRect.height+=rt);break}for(var yt=this.activeRect.width/ht,St=this.activeRect.height/ct,Pt=0,Bt=this.pens;Pt<Bt.length;Pt++){var dt=Bt[Pt];if(!dt.locked){switch(dt.type){case g.Line:break;default:switch(dt.oldRect=dt.rect.clone(),!this.options.disableSizeX&&!n.ctrlKey&&!dt.disableSizeX&&(dt.rect.width*=yt,dt.imageWidth&&(dt.imageWidth*=yt)),!this.options.disableSizeY&&!n.altKey&&!dt.disableSizeY&&(dt.rect.height*=St,dt.imageHeight&&(dt.imageHeight*=St)),(!this.options.disableSizeX&&n.shiftKey&&!dt.disableSizeX||!this.options.disableSizeY&&n.shiftKey&&!dt.disableSizeY)&&(dt.rect.width*=yt,dt.rect.height*=St,dt.imageWidth&&(dt.imageWidth*=yt),dt.imageHeight&&(dt.imageHeight*=St)),e){case 0:dt.rect.x=dt.rect.ex-dt.rect.width,dt.rect.y=dt.rect.ey-dt.rect.height;break;case 1:dt.rect.ex=dt.rect.x+dt.rect.width,dt.rect.y=dt.rect.ey-dt.rect.height;break;case 2:dt.rect.ex=dt.rect.x+dt.rect.width,dt.rect.ey=dt.rect.y+dt.rect.height;break;case 3:dt.rect.x=dt.rect.ex-dt.rect.width,dt.rect.ey=dt.rect.y+dt.rect.height;break}dt.scalePoints(),dt.rect.calcCenter(),dt.init(),dt.calcChildrenRect();break}if(dt.parentId)for(var Gt=void 0,Qt=0,Yt=this.data.pens;Qt<Yt.length;Qt++){var Jt=Yt[Qt];if(Jt.id===dt.parentId){Gt=Jt,dt.calcRectInParent(Gt);break}}}}this.updateLines()},t.prototype.move=function(e,i){if(this.nodeRects.length===this.pens.length){for(var n=0,o=function(ht){if(ht.locked)return"continue";if(ht instanceof Nt){var ct=p.nodeRects[n].x+e-ht.rect.x,yt=p.nodeRects[n].y+i-ht.rect.y;ht.translate(ct,yt);for(var St=p.getLinesOfNode(ht),Pt=0,Bt=St;Pt<Bt.length;Pt++){var dt=Bt[Pt];dt.translate(ct,yt)}if(ht.calcChildrenRect(),ht.parentId&&!ht.locked)for(var Gt=void 0,Qt=0,Yt=p.data.pens;Qt<Yt.length;Qt++){var Jt=Yt[Qt];if(Jt.id===ht.parentId){Gt=Jt,ht.calcRectInParent(Gt);break}}}if(ht instanceof Ot&&ht.from){var oe=p.nodeRects[n].x+e-ht.from.x,se=p.nodeRects[n].y+i-ht.from.y;if(ht.parentId){var pe=x(ht.parentId,p.data.pens);pe.forEach(function(xi){xi.translate(oe,se)})}else ht.translate(oe,se)}++n},p=this,b=0,z=this.pens;b<z.length;b++){var U=z[b];o(U)}this.updateLines(),this.topology.dispatch("move",this.pens)}},t.prototype.getLinesOfNode=function(e){for(var i=[],n=P([e]),o=0,p=this.data.pens;o<p.length;o++){var b=p[o];if(b instanceof Ot){for(var z=b,U=!1,rt=!1,ht=0,ct=n.nodes;ht<ct.length;ht++){var yt=ct[ht];z.from&&z.from.id===yt.id&&(U=!0),z.to&&z.to.id===yt.id&&(rt=!0)}U&&rt&&i.push(z)}}return i},t.prototype.updateLines=function(e){e||(e=this.pens);var i=P(this.data.pens),n=i.lines,o=i.nodes;this.options.autoAnchor||(o=P(e).nodes);for(var p=[],b=0,z=n;b<z.length;b++)for(var U=z[b],rt=0,ht=o;rt<ht.length;rt++){var ct=ht[rt],yt=0;if(U.from&&U.from.id===ct.id){if(U.from.autoAnchor){var St=ct.nearestAnchor(U.to);St.index>-1&&(U.from.anchorIndex=St.index,U.from.direction=St.direction)}U.from.anchorIndex>=0&&(U.from.x=ct.rotatedAnchors[U.from.anchorIndex].x,U.from.y=ct.rotatedAnchors[U.from.anchorIndex].y,++yt)}if(U.to&&U.to.id===ct.id){if(U.to.autoAnchor){var St=ct.nearestAnchor(U.from);St.index>-1&&(U.to.anchorIndex=St.index,U.to.direction=St.direction)}U.to.anchorIndex>=0&&(U.to.x=ct.rotatedAnchors[U.to.anchorIndex].x,U.to.y=ct.rotatedAnchors[U.to.anchorIndex].y,++yt)}yt&&!this.data.manualCps&&U.calcControlPoints(),U.textRect=void 0,nt.Store.set(this.generateStoreKey("pts-")+U.id,void 0),p.push(U)}nt.Store.set(this.generateStoreKey("LT:updateLines"),p)},t.prototype.offsetRotate=function(e){this.rotating=!0;for(var i=0,n=0,o=this.pens;n<o.length;n++){var p=o[n];if(p instanceof Nt){var b=this.nodeRects[i].center.clone();this.pens.length>1&&b.rotate(e,this.rect.center),p.rect.x=b.x-p.rect.width/2,p.rect.y=b.y-p.rect.height/2,p.rect.ex=p.rect.x+p.rect.width,p.rect.ey=p.rect.y+p.rect.height,p.rect.calcCenter(),p.init(),p.offsetRotate=e,p.calcRotateAnchors(p.rotate+p.offsetRotate),this.rotateChildren(p),++i}}this.rotate=e,this.topology.dispatch("rotated",this.pens)},t.prototype.rotateChildren=function(e){if(!(e.type!==g.Node||!e.children))for(var i=0,n=e.children;i<n.length;i++){var o=n[i];if(o.type===g.Node){var p=this.childrenRects[o.id].center.clone(),b=this.childrenRects[o.id].center.clone().rotate(this.rotate,this.rect.center),z=this.childrenRects[o.id].clone();z.translate(b.x-p.x,b.y-p.y),o.rect=z,o.rotate=this.childrenRotate[o.id]+this.rotate,o.init(),this.rotateChildren(o)}}},t.prototype.updateRotate=function(){for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];n.rotate+=n.offsetRotate,n.type===g.Node&&n.rectInParent&&(n.rectInParent.rotate+=n.offsetRotate),n.offsetRotate=0}this.rotate=0,this.rotating=!1},t.prototype.add=function(e){this.has(e)||(this.pens.push(e),e instanceof Nt&&nt.Store.set(this.generateStoreKey("LT:activeNode"),e))},t.prototype.setPens=function(e){this.pens=e,this.pens.length===1&&this.pens[0]instanceof Nt&&nt.Store.set(this.generateStoreKey("LT:activeNode"),this.pens[0])},t.prototype.has=function(e){for(var i=0,n=this.pens;i<n.length;i++){var o=n[i];if(o.id===e.id)return!0}return!1},t.prototype.hasInAll=function(e,i){i||(i=this.pens);for(var n=0,o=i;n<o.length;n++){var p=o[n];if(p.id===e.id)return!0;if(p.children){var b=this.hasInAll(e,p.children);if(b)return!0}}return!1},t.prototype.render=function(e){var i=this;if(!(this.data.locked>Ht.Readonly||this.options.activeColor==="transparent")&&!!this.pens.length){this.pens.forEach(function(ct){ct.getTID()||ct.setTID(i.TID)}),(this.pens.length===1||!this.rotating)&&this.calcControlPoints(),e.save(),e.strokeStyle=this.options.activeColor,e.fillStyle="#fff",e.lineWidth=1;for(var n=this.TID,o=nt.Store.get(this.generateStoreKey("LT:scale"))||1,p=0,b=this.pens;p<b.length;p++){var z=b[p];if(this.data.locked&&z instanceof Nt){var U=new Nt(z);U.setTID(n),U.data=void 0,U.fillStyle=void 0,U.bkType=0,U.icon="",U.image="",U.text="",U.strokeStyle!=="transparent"&&(U.strokeStyle="#ffffff",U.lineWidth+=2,U.render(e),U.strokeStyle=this.options.activeColor,U.lineWidth-=2),U.render(e)}if(z instanceof Ot){var U=new Ot(z);U.lineWidth*=2,U.toArrowSize=(U.toArrowSize*o-1.5*U.lineWidth)/o,U.fromArrowSize=(U.fromArrowSize*o-1.5*U.lineWidth)/o,U.setTID(n),U.strokeStyle=ee(.2,this.options.activeColor),U.borderWidth=4,U.borderColor=ee(.1,this.options.activeColor),U.fromArrowColor=this.options.activeColor,U.toArrowColor=this.options.activeColor,U.render(e),!this.data.locked&&!z.locked&&Mt[z.name]&&Mt[z.name].drawControlPointsFn(e,z)}}if(this.pens.length===1&&this.pens[0].type===g.Line){e.restore();return}if(this.rotate&&this.pens.length>1&&(e.translate(this.rect.center.x,this.rect.center.y),e.rotate(this.rotate*Math.PI/180),e.translate(-this.rect.center.x,-this.rect.center.y)),this.data.locked||this.locked()){e.restore();return}if(e.save(),e.globalAlpha=.3,e.translate(.5,.5),e.beginPath(),e.moveTo(this.sizeCPs[0].x,this.sizeCPs[0].y),e.lineTo(this.sizeCPs[1].x,this.sizeCPs[1].y),e.lineTo(this.sizeCPs[2].x,this.sizeCPs[2].y),e.lineTo(this.sizeCPs[3].x,this.sizeCPs[3].y),e.closePath(),e.stroke(),e.restore(),e.beginPath(),e.moveTo(this.rotateCPs[0].x,this.rotateCPs[0].y),e.lineTo(this.rotateCPs[1].x,this.rotateCPs[1].y),e.stroke(),e.beginPath(),e.arc(this.rotateCPs[0].x,this.rotateCPs[0].y,5,0,Math.PI*2),e.fill(),e.stroke(),!this.options.hideSizeCP&&(this.pens.length>1||!this.pens[0].hideSizeCP)){e.lineWidth=1;for(var rt=0,ht=this.sizeCPs;rt<ht.length;rt++){var z=ht[rt];e.save(),e.beginPath(),this.pens.length===1&&(this.pens[0].rotate||this.rotate)&&(e.translate(z.x,z.y),e.rotate((this.pens[0].rotate+this.rotate)*Math.PI/180),e.translate(-z.x,-z.y)),e.fillRect(z.x-4.5,z.y-4.5,8,8),e.strokeRect(z.x-5.5,z.y-5.5,10,10),e.restore()}}e.restore()}},t.prototype.calcActiveRect=function(){this.pens.length===1?(this.pens[0].rect.height===0&&(this.pens[0].rect.height=1),this.activeRect=m(this.pens[0].rect)):this.activeRect=$t(this.pens)},t.prototype.getDockWatchers=function(){if(this.pens.length===1){this.dockWatchers=this.nodeRects[0].toPoints(),this.dockWatchers.unshift(this.nodeRects[0].center);return}!this.rect||(this.dockWatchers=this.rect.toPoints(),this.dockWatchers.unshift(this.rect.center))},t}(ne),ui=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),fi=function(r){ui(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.pens=new Map,n.lastNow=0,nt.Store.set(n.generateStoreKey("LT:AnimateLayer"),n),n.options.animateColor||(n.options.animateColor="#ff6600"),n.subscribeUpdate=nt.Store.subscribe(n.generateStoreKey("LT:updateLines"),function(o){n.updateLines(o)}),n.subscribePlay=nt.Store.subscribe(n.generateStoreKey("LT:AnimatePlay"),function(o){if(o.stop){if(o.tag){var p=x(o.tag,n.data.pens);p.forEach(function(b){n.pens.has(b.id)&&(n.pens.get(b.id).animateStart=0)})}o.pen&&n.pens.has(o.pen.id)&&(n.pens.get(o.pen.id).animateStart=0)}else o.pen&&(n.pens.has(o.pen.id)?n.pens.get(o.pen.id).animateStart=Date.now():o.pen.type?n.pens.set(o.pen.id,n.getAnimateLine(o.pen)):n.pens.set(o.pen.id,o.pen)),o.tag&&n.readyPlay(o.tag,!1);n.animate()}),n}return t.prototype.getAnimateLine=function(e){var i=new Ot(e);return i.data=i.id,i.id=xt(),i.setTID(this.TID),i.isAnimate=!0,i.toArrow="",i.fromArrow&&i.fromArrow.indexOf("line")<0&&(i.animateFromSize=i.fromArrowSize+i.lineWidth*5),i.toArrow&&i.toArrow.indexOf("line")<0&&(i.animateToSize=i.toArrowSize+i.lineWidth*5),i.animateStart=e.animateStart,i.lineCap="round",i.fillStyle="#fff",i.strokeStyle=i.animateColor||this.options.animateColor,i.length=i.getLen(),i.fromArrowColor||(i.fromArrowColor=i.strokeStyle||nt.Store.get(this.generateStoreKey("LT:color"))),i.toArrowColor||(i.toArrowColor=i.strokeStyle||nt.Store.get(this.generateStoreKey("LT:color"))),i},t.prototype.findLine=function(e){for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o.id===e.data)return o}},t.prototype.readyPlay=function(e,i,n){var o=this,p=new Map;n||(n=this.data.pens),n.forEach(function(b){b.setTID(o.TID),!(!b.visible||p.get(b.id))&&((i&&b.animatePlay||e&&b.tags.indexOf(e)>-1)&&(!b.animateStart||b.animateStart<1)&&(b.animateStart=Date.now()),b instanceof Nt?(b.animateStart>0&&(b.animateReady||b.initAnimate(),p.set(b.id,b)),b.children&&b.children.length&&o.readyPlay(e,i,b.children)):b.animateStart>0?p.set(b.id,o.getAnimateLine(b)):o.pens.has(b.id)&&(o.pens.get(b.id).animateStart=0))}),p.forEach(function(b){b.type?o.pens.set(b.data,b):o.pens.set(b.id,b)})},t.prototype.animate=function(){var e=this;this.timer&&cancelAnimationFrame(this.timer),this.timer=requestAnimationFrame(function(){var i=Date.now();if(i-e.lastNow<e.options.refresh){e.animate();return}e.lastNow=i;var n=!1;e.pens.forEach(function(o){if(!o.animateStart||o.animateStart<1){if(o.type){e.pens.delete(o.data);var p=e.findLine(o);p&&(p.animateStart=0,p.animatePos=o.animatePos)}else e.pens.delete(o.id);return}if(!(o.animateStart>i)){if(o.animateFn?typeof o.animateFn=="function"?o.animateFn():window&&window[o.animateFn]&&window[o.animateFn]():o.animate(i),o.animateStart<1){if(o.type?e.pens.delete(o.data):e.pens.delete(o.id),o.type===g.Line){var p=e.findLine(o);p&&(p.animateStart=0,p.animatePos=o.animatePos)}o.nextAnimate&&e.readyPlay(o.nextAnimate,!1)}n=!0}}),n&&(nt.Store.set(e.generateStoreKey("LT:render"),!0),e.animate())})},t.prototype.updateLines=function(e){this.pens.forEach(function(i,n){if(i instanceof Ot)for(var o=0,p=e;o<p.length;o++){var b=p[o];i.data===b.id&&(i.from=b.from,i.to=b.to,i.controlPoints=b.controlPoints,i.length=i.getLen())}})},t.prototype.render=function(e){var i=this;this.pens.forEach(function(n,o){n.visible&&n instanceof Ot&&(n.getTID()||n.setTID(i.TID),n.render(e))})},t.prototype.stop=function(){this.pens.clear(),this.timer&&(cancelAnimationFrame(this.timer),this.timer=null)},t.prototype.destroy=function(){this.stop(),this.subscribeUpdate.unsubscribe(),this.subscribePlay.unsubscribe()},t}(ne),di=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Kt={},pi=function(r){di(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,n)||this;return o.parentElem=e,o.options=i,o.canvas=document.createElement("div"),o.player=document.createElement("div"),o.audios={},o.iframes={},o.elements={},o.gifs={},o.addDiv=function(p){var b;if(p.audio&&(o.audios[p.id]&&o.audios[p.id].media.src!==p.audio&&(o.audios[p.id].media.src=p.audio),setTimeout(function(){o.setElemPosition(p,o.audios[p.id]&&o.audios[p.id].player||o.addMedia(p,"audio"))})),p.video&&(Kt[p.id]&&Kt[p.id].media.src!==p.video&&(Kt[p.id].media.src=p.video),setTimeout(function(){o.setElemPosition(p,Kt[p.id]&&Kt[p.id].player||o.addMedia(p,"video"))})),p.iframe&&(o.iframes[p.id]?(o.iframes[p.id].src!==p.iframe&&(o.iframes[p.id].src=p.iframe),o.setElemPosition(p,o.iframes[p.id])):(o.addIframe(p),setTimeout(function(){o.addDiv(p)}))),p.elementId&&(o.elements[p.id]||(o.elements[p.id]=document.getElementById(p.elementId),o.elements[p.id]&&o.canvas.appendChild(o.elements[p.id])),o.setElemPosition(p,o.elements[p.id])),p.gif&&(p.image.indexOf(".gif")<0?(p.gif=!1,o.canvas.removeChild(o.gifs[p.id]),o.gifs[p.id]=void 0):p.img&&(o.gifs[p.id]&&o.gifs[p.id].src!==p.image&&(o.gifs[p.id].src=p.image),o.setElemPosition(p,o.gifs[p.id]||o.addGif(p)))),p.imageLoading){p.imageLoadingDom||(p.imageLoadingDom=new Fe(o));var z=p.rect.center;p.imageLoadingDom.show(z.x+o.data.x,z.y+o.data.y)}else(b=p.imageLoadingDom)===null||b===void 0||b.hide();if(p.children)for(var U=0,rt=p.children;U<rt.length;U++){var ht=rt[U];ht.type!==g.Line&&o.addDiv(ht)}},o.createPlayer=function(){o.player.style.position="fixed",o.player.style.outline="none",o.player.style.top="-99999px",o.player.style.height="40px",o.player.style.padding="10px 15px",o.player.style.background="rgba(200,200,200,.1)",o.player.style.display="flex",o.player.style.alignItems="center",o.player.style.userSelect="initial",o.player.style.pointerEvents="initial",o.player.style.zIndex="1",o.playBtn=document.createElement("i"),o.currentTime=document.createElement("span"),o.progress=document.createElement("div"),o.progressCurrent=document.createElement("div"),o.loop=document.createElement("i");var p=document.createElement("i");o.playBtn.className=o.options.playIcon,o.playBtn.style.fontSize="18px",o.playBtn.style.lineHeight="20px",o.playBtn.style.cursor="pointer",o.currentTime.style.padding="0 10px",o.currentTime.innerText="0 / 0",o.progress.style.position="relative",o.progress.style.flexGrow="1",o.progress.style.top="0",o.progress.style.height="4px",o.progress.style.background="#ccc",o.progress.style.borderRadius="2px",o.progress.style.overflow="hidden",o.progress.style.cursor="pointer",o.progressCurrent.style.position="absolute",o.progressCurrent.style.left="0",o.progressCurrent.style.top="0",o.progressCurrent.style.bottom="0",o.progressCurrent.style.width="0",o.progressCurrent.style.background="#52c41a",o.loop.style.margin="0 10px",o.loop.style.padding="2px 5px",o.loop.style.borderRadius="2px",o.loop.className=o.options.loopIcon,o.loop.style.fontSize="18px",o.loop.style.lineHeight="20px",o.loop.style.cursor="pointer",p.className=o.options.fullScreenIcon,p.style.fontSize="17px",p.style.lineHeight="20px",p.style.cursor="pointer",o.player.appendChild(o.playBtn),o.player.appendChild(o.currentTime),o.player.appendChild(o.progress),o.progress.appendChild(o.progressCurrent),o.player.appendChild(o.loop),o.player.appendChild(p),o.playBtn.onclick=function(){o.media.paused?(o.media.play(),o.playBtn.className=o.options.pauseIcon):(o.media.pause(),o.playBtn.className=o.options.playIcon)},o.progress.onclick=function(b){o.media.currentTime=b.offsetX/o.progress.clientWidth*o.media.duration},o.loop.onclick=function(){o.media.loop=!o.media.loop,o.curNode.playLoop=o.media.loop,o.media.loop?o.loop.style.background="#ddd":o.loop.style.background="none"},p.onclick=function(){o.media.requestFullscreen()}},o.getMediaCurrent=function(){!o.media||(o.currentTime.innerText=o.formatSeconds(o.media.currentTime)+" / "+o.formatSeconds(o.media.duration),o.progressCurrent.style.width=o.media.currentTime/o.media.duration*o.progress.clientWidth+"px")},o.addMedia=function(p,b){var z=document.createElement("div"),U=document.createElement("div"),rt=document.createElement(b);return z.id=p.id,U.style.position="absolute",U.style.outline="none",U.style.left="0",U.style.bottom="0",U.style.height="2px",U.style.background="#52c41a",rt.style.position="absolute",rt.style.outline="none",rt.style.left="0",rt.style.right="0",rt.style.top="0",rt.style.bottom="0",b==="video"&&(rt.style.width=p.rect.width+"px",rt.style.height=p.rect.height+"px"),z.style.background="transparent",p.playType===1&&(rt.autoplay=!0),rt.loop=p.playLoop,rt.ontimeupdate=function(){U.style.width=rt.currentTime/rt.duration*p.rect.width+"px",o.getMediaCurrent(),o.media===rt&&(p.playLoop?(rt.loop=!0,o.loop.style.background="#ddd"):(rt.loop=!1,o.loop.style.background="none"))},rt.onended=function(){nt.Store.set(o.generateStoreKey("mediaEnd"),p),o.media===rt&&(o.playBtn.className=o.options.playIcon),o.play(p.nextPlay)},rt.onloadedmetadata=function(){o.getMediaCurrent()},rt.src=p[b],z.appendChild(rt),z.appendChild(U),b==="video"?Kt[p.id]={player:z,current:U,media:rt}:o.audios[p.id]={player:z,current:U,media:rt},o.canvas.appendChild(z),z},o.setElemPosition=function(p,b){!b||(b.style.position="absolute",b.style.outline="none",b.style.left=p.rect.x+o.data.x+"px",b.style.top=p.rect.y+o.data.y+"px",b.style.width=p.rect.width+"px",b.style.height=p.rect.height+"px",b.style.display=p.visible?"inline":"none",(p.rotate!=null||p.offsetRotate!=null)&&(b.style.transform="rotate("+(p.rotate+p.offsetRotate)+"deg)"),p.video&&Kt[p.id]&&Kt[p.id].media&&(Kt[p.id].media.style.width="100%",Kt[p.id].media.style.height="100%"),o.data.locked>Ht.None||p.locked>Ht.None?(b.style.userSelect="initial",b.style.pointerEvents="initial"):(b.style.userSelect="none",b.style.pointerEvents="none"),p.globalAlpha<=1&&(b.style.opacity=String(p.globalAlpha)))},o.removeDiv=function(p){if(o.curNode&&p.id===o.curNode.id&&(o.curNode=void 0,o.media=void 0,o.player.style.top="-99999px"),p.audio&&(o.canvas.removeChild(o.audios[p.id].player),o.audios[p.id]=void 0),p.video&&(o.canvas.removeChild(Kt[p.id].player),Kt[p.id]=void 0),p.iframe&&(o.canvas.removeChild(o.iframes[p.id]),o.iframes[p.id]=void 0),p.elementId&&(o.canvas.removeChild(o.elements[p.id]),o.elements[p.id]=void 0,p.elementId=""),p.gif&&(o.canvas.removeChild(o.gifs[p.id]),o.gifs[p.id]=void 0),p.imageLoadingDom&&o.canvas.removeChild(p.imageLoadingDom.dom),p.children)for(var b=0,z=p.children;b<z.length;b++){var U=z[b];U.type!==g.Line&&o.removeDiv(U)}},o.options.playIcon||(o.options.playIcon="t-icon t-play"),o.options.pauseIcon||(o.options.pauseIcon="t-icon t-pause"),o.options.fullScreenIcon||(o.options.fullScreenIcon="t-icon t-full-screen"),o.options.loopIcon||(o.options.loopIcon="t-icon t-loop"),o.canvas.style.position="absolute",o.canvas.style.left="0",o.canvas.style.top="0",o.canvas.style.outline="none",o.canvas.style.background="transparent",e.appendChild(o.canvas),e.appendChild(o.player),o.createPlayer(),o.subcribeDiv=nt.Store.subscribe(o.generateStoreKey("LT:addDiv"),o.addDiv),o.subcribeDiv=nt.Store.subscribe(o.generateStoreKey("LT:removeDiv"),o.removeDiv),o.subcribePlay=nt.Store.subscribe(o.generateStoreKey("LT:play"),function(p){o.playOne(p.pen,p.pause)}),o.subcribeNode=nt.Store.subscribe(o.generateStoreKey("LT:activeNode"),function(p){if(!p||!p.video&&!p.audio){o.player.style.top="-99999px";return}if(p.audio&&o.audios[p.id])o.media=o.audios[p.id].media;else if(p.video&&Kt[p.id])o.media=Kt[p.id].media;else return;o.curNode=p;var b=o.parentElem.getBoundingClientRect();o.player.style.top=b.top+o.parentElem.clientHeight-40+"px",o.player.style.left=b.left+"px",o.player.style.width=o.parentElem.clientWidth+"px",o.getMediaCurrent(),o.media.paused?o.playBtn.className=o.options.playIcon:o.playBtn.className=o.options.pauseIcon}),document.addEventListener("fullscreenchange",function(p){!o.media||(document.fullscreen?(o.media.controls=!0,o.media.style.userSelect="initial",o.media.style.pointerEvents="initial"):(o.media.style.userSelect="none",o.media.style.pointerEvents="none",o.media.controls=!1))}),o}return t.prototype.play=function(e,i){var n=this;if(!!e){var o=x(e,this.data.pens);o.forEach(function(p){n.playOne(p,i)})}},t.prototype.playOne=function(e,i){e.audio&&this.audios[e.id]&&this.audios[e.id].media?i?this.audios[e.id].media.pause():this.audios[e.id].media.paused&&this.audios[e.id].media.play():e.video&&Kt[e.id].media&&(i?Kt[e.id].media.pause():Kt[e.id].media.paused&&Kt[e.id].media.play())},t.prototype.addIframe=function(e){var i=document.createElement("iframe");return i.scrolling="no",i.frameBorder="0",i.src=e.iframe,this.iframes[e.id]=i,this.canvas.appendChild(i),i},t.prototype.addGif=function(e){return this.gifs[e.id]=e.img,this.canvas.appendChild(e.img),e.img},t.prototype.clear=function(e){if(this.canvas.innerHTML="",this.audios={},Kt={},this.iframes={},this.elements={},this.gifs={},!e)for(var i in C)delete C[i];this.player.style.top="-99999px"},t.prototype.formatSeconds=function(e){var i=Math.floor(e/3600),n=Math.floor(e/60)%60,o=Math.floor(e%60),p=o+"";return n?p=n+":"+o:p="0:"+o,i&&(p=i+":"+n+":"+o),p},t.prototype.resize=function(e){e?(this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px"):(this.options.width&&this.options.width!=="auto"?this.canvas.style.width=this.options.width+"px":this.canvas.style.width=this.parentElem.clientWidth+"px",this.options.height&&this.options.height!=="auto"?this.canvas.style.height=this.options.height+"px":this.canvas.style.height=this.parentElem.clientHeight-8+"px")},t.prototype.render=function(){for(var e=0,i=this.data.pens;e<i.length;e++){var n=i[e];n.getTID()||n.setTID(this.TID),this.addDiv(n)}},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.clear(),this.subcribeDiv.unsubscribe(),this.subcribeNode.unsubscribe(),this.subcribePlay.unsubscribe()},t}(ne),we=function(t){var e=0,i=0,n=0,o=0;if(typeof t=="number")e=i=n=o=t;else if(typeof t=="string"){var p=parseInt(t,10);e=i=n=o=p}else Array.isArray(t)&&(e=t[0],n=be(t[1])?t[0]:t[1],o=be(t[2])?t[0]:t[2],i=be(t[3])?n:t[3]);return[e,n,o,i]};function be(r){return r==null}var yi=function(){function r(t,e){this.url=t,this.cb=e,this.fns={},this.init()}return r.prototype.init=function(){var t=this;this.socket=new WebSocket(this.url),this.socket.onmessage=this.cb,this.socket.onclose=function(){console.info("Canvas websocket closed and reconneting..."),t.init()}},r.prototype.close=function(){this.socket.onclose=void 0,this.socket.close()},r}(),vi=ft(99053),gi=function(){function r(t,e,i,n){this.url=t,this.options=e,this.topics=i,this.cb=n,this.fns={},this.init()}return r.prototype.init=function(){this.client=vi.connect(this.url,this.options),this.client.on("message",this.cb),this.topics&&this.client.subscribe(this.topics.split(","))},r.prototype.publish=function(t,e){this.client.publish(t,e)},r.prototype.close=function(){this.client.end()},r}(),mi={i8:"0.5.38"},wi=function(){function r(t){var e=this;this.parent=t,this.onMouseDownH=function(p){p.preventDefault(),p.stopPropagation(),e.isDownH=p.x,e.x=e.parent.data.x||0,e.lastScrollX=e.scrollX},this.onMouseDownV=function(p){p.preventDefault(),p.stopPropagation(),e.isDownV=p.y,e.y=e.parent.data.y||0,e.lastScrollY=e.scrollY},this.onMouseMove=function(p){if(e.isDownH){var b=p.x-e.isDownH;e.scrollX=e.lastScrollX+b,e.h.style.left=e.scrollX+"px",e.parent.data.x=e.x-b*e.rect.width/e.parent.parentElem.clientWidth}if(e.isDownV){var z=p.y-e.isDownV;e.scrollY=e.lastScrollY+z,e.v.style.top=e.scrollY+"px",e.parent.data.y=e.y-z*e.rect.height/e.parent.parentElem.clientHeight}(e.isDownH||e.isDownV)&&(e.parent.render(),e.parent.divLayer.render())},this.onMouseUp=function(p){!e.isDownH&&!e.isDownV||(e.isDownH=void 0,e.isDownV=void 0,e.scrollX<20?(e.scrollX=20,e.h.style.left=e.scrollX+"px"):e.scrollX>e.parent.parentElem.clientWidth-e.hSize-20&&(e.scrollX=e.parent.parentElem.clientWidth-e.hSize-20,e.h.style.left=e.scrollX+"px"),e.scrollY<20?(e.scrollY=20,e.v.style.top=e.scrollY+"px"):e.scrollY>e.parent.parentElem.clientHeight-e.vSize-20&&(e.scrollY=e.parent.parentElem.clientHeight-e.vSize-20,e.v.style.top=e.scrollY+"px"),e.resize())},this.h=document.createElement("div"),this.v=document.createElement("div"),this.parent.parentElem.appendChild(this.h),this.parent.parentElem.appendChild(this.v),this.h.className="topology-scroll h",this.h.onmousedown=this.onMouseDownH,this.v.className="topology-scroll v",this.v.onmousedown=this.onMouseDownV,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp);for(var i,n=0;n<document.styleSheets.length;n++)document.styleSheets[n].title==="le5le/scroll"&&(i=document.styleSheets[n]);if(!i){var o=document.createElement("style");o.type="text/css",o.title="le5le.com/scroll",document.head.appendChild(o),o=document.createElement("style"),o.type="text/css",document.head.appendChild(o),i=o.sheet,i.insertRule(".topology-scroll{position:absolute;width:8px;height:200px;background:#dddddd;border-radius:10px;z-index:20;cursor:default;}"),i.insertRule(".topology-scroll:hover{background:#cccccc;cursor:pointer}"),i.insertRule(".topology-scroll.v{right:0;top:calc(50% - 100px);}"),i.insertRule(".topology-scroll.h{bottom:2px;left:calc(50% - 100px);width:200px;height:8px;}")}this.init()}return r.prototype.init=function(){this.resize(),this.initPos()},r.prototype.initPos=function(){this.scrollX=(this.parent.parentElem.clientWidth-this.hSize)/2,this.scrollY=(this.parent.parentElem.clientHeight-this.vSize)/2,this.h.style.left=this.scrollX+"px",this.v.style.top=this.scrollY+"px"},r.prototype.resize=function(){this.rect=$t(this.parent.data.pens),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.parent.data.x>0?this.rect.width+=this.parent.data.x+(this.rect.x>0?0:this.rect.x):this.rect.width-=this.parent.data.x+(this.rect.x>0?0:this.rect.x),this.parent.data.y>0?this.rect.height+=this.parent.data.y+(this.rect.y>0?0:this.rect.y):this.rect.height-=this.parent.data.y+(this.rect.y>0?0:this.rect.y),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.hSize=1e3*this.parent.parentElem.clientWidth/this.rect.width/3,this.vSize=1e3*this.parent.parentElem.clientHeight/this.rect.height/3,this.h.style.width=this.hSize+"px",this.v.style.height=this.vSize+"px"},r.prototype.show=function(){this.isShow=!0,this.h.style.display="block",this.v.style.display="block",document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},r.prototype.hide=function(){this.isShow=!1,this.h.style.display="none",this.v.style.display="none",this.destroy()},r.prototype.translate=function(t,e){t&&(this.scrollX-=t*this.parent.parentElem.clientWidth/this.rect.width,this.h.style.left=this.scrollX+"px"),e&&(this.scrollY-=e*this.parent.parentElem.clientHeight/this.rect.height,this.v.style.top=this.scrollY+"px")},r.prototype.wheel=function(t){var e=10;t&&(e=-10),this.scrollY+=e,this.v.style.top=this.scrollY+"px",this.parent.data.y-=e*this.rect.height/this.parent.parentElem.clientHeight,this.parent.render(),this.parent.divLayer.render()},r.prototype.destroy=function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},r}(),ie=function(){return ie=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},ie.apply(this,arguments)},bi=function(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var i=Array(r),n=0,t=0;t<e;t++)for(var o=arguments[t],p=0,b=o.length;p<b;p++,n++)i[n]=o[p];return i},ki=["nw-resize","ne-resize","se-resize","sw-resize"],pt;(function(r){r[r.None=0]="None",r[r.Line=1]="Line",r[r.LineFrom=2]="LineFrom",r[r.LineTo=3]="LineTo",r[r.LineControlPoint=4]="LineControlPoint",r[r.Nodes=5]="Nodes",r[r.ResizeCP=6]="ResizeCP",r[r.HoverAnchors=7]="HoverAnchors",r[r.AutoAnchor=8]="AutoAnchor",r[r.Rotate=9]="Rotate",r[r.GraffitiReady=10]="GraffitiReady",r[r.Graffiti=11]="Graffiti",r[r.LinesReady=12]="LinesReady",r[r.Lines=13]="Lines"})(pt||(pt={}));var ze=10,Si=function(){function r(t,e){var i=this;e===void 0&&(e={}),this.VERSION=mi.i8,this.id=xt(),this.data=re(void 0,this.id),this.caches={index:0,dbIndex:0,list:[]},this.touchStart=0,this.input=document.createElement("textarea"),this.lastTranlated={x:0,y:0},this.moveIn={type:pt.None,activeAnchorIndex:0,hoverAnchorIndex:0,hoverNode:void 0,hoverLine:void 0,activeNode:void 0,lineControlPoint:void 0},this.needCache=!1,this.tip="",this.scheduledAnimationFrame=!1,this.scrolling=!1,this.rendering=!1,this.alreadyCopy=!1,this.onScroll=function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},this.preventDefault=function(n){n.preventDefault()},this.winResize=function(){var n;n&&clearTimeout(n),n=setTimeout(function(){i.resize()},100)},this.calibrateMouse=function(n){return n.x-=i.data.x,n.y-=i.data.y,n},this.subscribeSocket=function(){if(!i.data.socketFn)return!1;i.data.socketEvent||(i.data.socketEvent=!0);try{var n=new Function("e",i.data.socketFn);i.socketFn&&(i.off("websocket",i.socketFn),i.off("mqtt",i.socketFn)),i.on("websocket",n),i.on("mqtt",n),i.socketFn=n}catch(o){return console.error("Create the function for socket:",o),!1}return!0},this.onMouseMove=function(n){var o;if(!(i.scheduledAnimationFrame||((o=i.data)===null||o===void 0?void 0:o.locked)===Ht.NoEvent)){if(i.mouseDown&&!i.mouseDown.restore&&n.buttons!==1&&n.buttons!==2){i.onmouseup(n);return}if(i.mouseDown&&(i.data.locked||i.spaceDown||!i.moveIn.type)){var p=!!i.data.locked;switch(i.options.translateKey){case vt.Right:n.buttons==2&&(p=!0);break;case vt.Any:p=!0;break;case vt.Ctrl:n.ctrlKey&&(p=!0);break;case vt.Shift:n.shiftKey&&(p=!0);break;case vt.Alt:n.altKey&&(p=!0);break;default:(n.ctrlKey||n.altKey||n.buttons==2)&&(p=!0)}if(i.spaceDown||!i.options.disableTranslate&&p&&i.data.locked<Ht.NoMove)return i.translate(n.x,n.y,!0),!1}i.data.locked&&i.mouseDown||(i.scheduledAnimationFrame=!0,i.raf&&cancelAnimationFrame(i.raf),i.raf=requestAnimationFrame(function(){i.raf=void 0;var b=i.calibrateMouse({x:n.x,y:n.y});if(i.moveIn.type===pt.Lines){i.hoverLayer.line&&(i.hoverLayer.lineTo(new R(b.x,b.y),""),n.shiftKey||n.ctrlKey||n.altKey||n.buttons==2?(i.hoverLayer.line.name="curve",i.hoverLayer.line.calcControlPoints()):i.hoverLayer.line.name="line",i.render()),i.scheduledAnimationFrame=!1;return}if(!i.mouseDown){i.getMoveIn(b),i.moveIn.hoverNode!==i.lastHoverNode&&(i.lastHoverNode&&(i.lastHoverNode.moveOut(),i.dispatch("moveOutNode",i.lastHoverNode),i.hideTip(),i.hoverLayer.node=void 0),i.moveIn.hoverNode&&(i.hoverLayer.node=i.moveIn.hoverNode,i.moveIn.hoverNode.moveIn(),i.dispatch("moveInNode",Object.assign(i.moveIn.hoverNode,{evs:{x:n.pageX,y:n.pageY}})),i.showTip(i.moveIn.hoverNode,b))),i.moveIn.hoverLine!==i.lastHoverLine&&!i.moveIn.hoverNode&&(i.lastHoverLine&&(i.lastHoverLine.moveOut(),i.dispatch("moveOutLine",i.lastHoverLine),i.hideTip()),i.moveIn.hoverLine&&(i.hoverLayer.line=i.moveIn.hoverLine,i.moveIn.hoverLine.moveIn(),i.dispatch("moveInLine",Object.assign(i.moveIn.hoverLine,{evs:{x:n.pageX,y:n.pageY}})),i.showTip(i.moveIn.hoverLine,b))),i.moveIn.type===pt.LineControlPoint?i.hoverLayer.hoverLineCP=i.moveIn.lineControlPoint:i.hoverLayer.hoverLineCP&&(i.hoverLayer.hoverLineCP=void 0),(i.moveIn.hoverNode!==i.lastHoverNode||i.moveIn.type===pt.HoverAnchors||i.hoverLayer.lasthoverLineCP!==i.hoverLayer.hoverLineCP)&&(i.hoverLayer.lasthoverLineCP=i.hoverLayer.hoverLineCP,i.render()),i.scheduledAnimationFrame=!1;return}var z=n.x+50>i.parentElem.clientWidth+i.parentElem.scrollLeft,U=n.y+50>i.parentElem.clientHeight+i.parentElem.scrollTop;if(!i.options.disableMoveOutParent&&(z||U)){i.dispatch("moveOutParent",n);var rt=0,ht=0;n.x+50>i.divLayer.canvas.clientWidth&&(rt=-5),n.y+50>i.divLayer.canvas.clientHeight&&(ht=-5),i.translate(rt,ht,!1)}switch(i.hideTip(),i.moveIn.type){case pt.None:i.hoverLayer.dragRect=new a(i.mouseDown.x-i.data.x,i.mouseDown.y-i.data.y,n.x-i.mouseDown.x,n.y-i.mouseDown.y);break;case pt.Nodes:if(i.activeLayer.locked()||i.data.locked)break;var rt=n.x-i.mouseDown.x,ht=n.y-i.mouseDown.y,ct=20;if(n.ctrlKey&&!i.alreadyCopy&&(Math.abs(rt)>=ct||Math.abs(ht)>=ct))i.alreadyCopy=!0,i.copy(),i.paste(),i.needCache=!0;else if(rt||ht){var yt=i.getDockPos(rt,ht,n.ctrlKey||n.shiftKey||n.altKey);i.activeLayer.move(yt.x!=null?yt.x:rt,yt.y!=null?yt.y:ht),i.needCache=!0}break;case pt.ResizeCP:{var St=n.x-i.mouseDown.x,Pt=n.y-i.mouseDown.y;if(St||Pt){var yt=i.getDockPos(St,Pt,n.ctrlKey||n.shiftKey||n.altKey),Bt=Object.assign({},n);yt.x!=null&&(Bt.x=yt.x+i.mouseDown.x),yt.y!=null&&(Bt.y=yt.y+i.mouseDown.y),i.activeLayer.resize(i.moveIn.activeAnchorIndex,i.mouseDown,Bt),i.dispatch("resizePens",i.activeLayer.pens),i.needCache=!0}break}case pt.LineTo:case pt.HoverAnchors:case pt.AutoAnchor:if(i.hoverLayer.dockAnchor&&i.hoverLayer.dockAnchor.hit(n,10))break;var dt=i.data.toArrow;i.moveIn.hoverLine&&(dt=i.moveIn.hoverLine.toArrow),i.hoverLayer.line&&(dt=i.hoverLayer.line.toArrow),i.hoverLayer.line&&(i.activeLayer.pens=[i.hoverLayer.line]);var Gt=i.hoverLayer.line.to.id;if(n.ctrlKey||n.shiftKey||n.altKey)i.hoverLayer.lineTo(new R(b.x,b.y),dt);else{var Qt=i.getLineDock(new R(b.x,b.y),te.In);Gt=Qt.id,i.hoverLayer.lineTo(Qt,dt)}if(i.hoverLayer.line.to.id=Gt,i.hoverLayer.line.parentId){var Yt=i.find(Gt);Yt&&Yt.from&&(Yt.from.x=i.hoverLayer.line.to.x,Yt.from.y=i.hoverLayer.line.to.y)}i.needCache=!0;break;case pt.LineFrom:var Jt=i.hoverLayer.line.from.id;if(n.ctrlKey||n.shiftKey||n.altKey)i.hoverLayer.lineFrom(new R(b.x,b.y));else{var oe=i.getLineDock(new R(b.x,b.y),te.Out);Jt=oe.id,i.hoverLayer.lineFrom(oe)}if(i.hoverLayer.line.from.id=Jt,i.hoverLayer.line.parentId){var Yt=i.find(Jt);Yt&&Yt.to&&(Yt.to.x=i.hoverLayer.line.from.x,Yt.to.y=i.hoverLayer.line.from.y)}i.needCache=!0;break;case pt.Line:{var se=n.x-i.mouseDown.x,pe=n.y-i.mouseDown.y;(se||pe)&&(i.activeLayer.move(se,pe),i.hoverLayer.line.children?i.animateLayer.updateLines(i.hoverLayer.line.children):i.animateLayer.updateLines([i.hoverLayer.line]),i.needCache=!0)}break;case pt.LineControlPoint:i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id].x=b.x,i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id].y=b.y,i.moveIn.hoverLine.textRect=void 0,Mt[i.moveIn.hoverLine.name]&&Mt[i.moveIn.hoverLine.name].dockControlPointFn&&Mt[i.moveIn.hoverLine.name].dockControlPointFn(i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id],i.moveIn.hoverLine),i.needCache=!0,nt.Store.set(i.generateStoreKey("LT:updateLines"),[i.moveIn.hoverLine]);break;case pt.Rotate:i.activeLayer.pens.length&&(i.activeLayer.offsetRotate(i.getAngle(b)),i.activeLayer.updateLines()),i.needCache=!0;break;case pt.Graffiti:i.moveIn.hoverNode.pushPoint(new R(b.x,b.y));break}i.render(),i.scheduledAnimationFrame=!1}))}},this.onmousedown=function(n){if(!(n.button!==0&&n.button!==2)){switch(i.mouseDown=n,n.altKey&&(i.divLayer.canvas.style.cursor="move"),i.inputObj&&i.setNodeText(),i.moveIn.type){case pt.None:i.activeLayer.clear(),i.hoverLayer.clear(),i.dispatch("space",i.mouseDown);break;case pt.Line:case pt.LineControlPoint:n.ctrlKey||n.shiftKey?(i.activeLayer.add(i.moveIn.hoverLine),i.dispatch("multi",i.activeLayer.pens)):(i.activeLayer.pens=[i.moveIn.hoverLine],i.dispatch("line"+(n.button===2?"RightClick":""),Object.assign(i.moveIn.hoverLine,{evs:{x:n.pageX,y:n.pageY}}))),i.hoverLayer.line=i.moveIn.hoverLine,i.hoverLayer.initLine=new Ot(i.moveIn.hoverLine),(i.data.locked||i.moveIn.hoverLine.locked)&&i.moveIn.hoverLine.click();break;case pt.LineFrom:case pt.LineTo:i.activeLayer.pens=[i.moveIn.hoverLine],i.dispatch("line",i.moveIn.hoverLine),i.hoverLayer.line=i.moveIn.hoverLine;break;case pt.HoverAnchors:i.hoverLayer.line=i.addLine({name:i.data.lineName,from:new R(i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].x,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].y,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].direction,i.moveIn.hoverAnchorIndex,i.moveIn.hoverNode.id),fromArrow:i.data.fromArrow,to:new R(i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].x,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].y),toArrow:i.data.toArrow,strokeStyle:i.options.color,lineWidth:i.data.lineWidth}),i.dispatch("anchor",{anchor:i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex],anchorIndex:i.moveIn.hoverAnchorIndex,node:i.moveIn.hoverNode,line:i.hoverLayer.line});break;case pt.AutoAnchor:i.hoverLayer.line=i.addLine({name:i.data.lineName,from:new R(i.moveIn.hoverNode.rect.center.x,i.moveIn.hoverNode.rect.center.y,K.None,0,i.moveIn.hoverNode.id),fromArrow:i.data.fromArrow,to:new R(i.moveIn.hoverNode.rect.center.x,i.moveIn.hoverNode.rect.center.y),toArrow:i.data.toArrow,strokeStyle:i.options.color,lineWidth:i.data.lineWidth}),i.hoverLayer.line.from.autoAnchor=!0,i.dispatch("nodeCenter",i.moveIn.hoverNode);break;case pt.Nodes:if(!i.moveIn.activeNode)break;n.ctrlKey||n.shiftKey?i.moveIn.hoverNode&&i.activeLayer.hasInAll(i.moveIn.hoverNode)?(i.activeLayer.setPens([i.moveIn.hoverNode]),i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.hoverNode)):i.activeLayer.has(i.moveIn.activeNode)||(i.activeLayer.add(i.moveIn.activeNode),i.activeLayer.pens.length>1?i.dispatch("multi",i.activeLayer.pens):i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.activeNode)):n.altKey?i.moveIn.hoverNode?(i.activeLayer.setPens([i.moveIn.hoverNode]),i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.hoverNode)):i.moveIn.hoverLine&&(i.activeLayer.setPens([i.moveIn.hoverLine]),i.dispatch("line",i.moveIn.hoverLine)):i.activeLayer.pens.length<2&&(i.activeLayer.setPens([i.moveIn.activeNode]),i.dispatch("node"+(n.button===2?"RightClick":""),Object.assign(i.moveIn.activeNode,{evs:{x:n.pageX,y:n.pageY}}))),(i.data.locked||i.moveIn.activeNode.locked)&&i.moveIn.activeNode.click(),i.activeLayer.calcActiveRect();break;case pt.Graffiti:var o=i.calibrateMouse({x:n.x,y:n.y});i.moveIn.hoverNode.pushPoint(new R(o.x,o.y));break}i.activeLayer.pens.length&&i.activeLayer.saveNodeRects(),i.render()}},this.onmouseup=function(n){if(!!i.mouseDown){if(i.mouseDown=void 0,i.lastTranlated.x=0,i.lastTranlated.y=0,i.hoverLayer.dockAnchor=void 0,i.hoverLayer.dockLineX=0,i.hoverLayer.dockLineY=0,i.divLayer.canvas.style.cursor="default",i.alreadyCopy=!1,i.hoverLayer.dragRect)i.getPensInRect(i.hoverLayer.dragRect),i.activeLayer.pens&&i.activeLayer.pens.length>1?i.dispatch("multi",i.activeLayer.pens):i.activeLayer.pens&&i.activeLayer.pens[0]&&i.activeLayer.pens[0].type===g.Line?i.dispatch("line"+(n.button===2?"RightClick":""),i.activeLayer.pens[0]):i.activeLayer.pens&&i.activeLayer.pens[0]&&i.activeLayer.pens[0].type===g.Node&&i.dispatch("node"+(n.button===2?"RightClick":""),i.activeLayer.pens[0]),i.activeLayer.calcActiveRect();else{var o=i.calibrateMouse({x:n.x,y:n.y});switch(i.moveIn.type){case pt.Nodes:if(n.ctrlKey&&n.shiftKey&&n.altKey){i.moveIn.hoverNode.manualAnchors||(i.moveIn.hoverNode.manualAnchors=[]);var p=new R(o.x,o.y);p.id=i.moveIn.hoverNode.id,i.moveIn.hoverNode.manualAnchors.push(p),i.moveIn.hoverNode.calcAnchors(),i.needCache=!0}(i.data.locked||i.moveIn.activeNode.locked)&&i.moveIn.activeNode.mouseUp();break;case pt.Line:case pt.LineControlPoint:(i.data.locked||i.moveIn.hoverLine.locked)&&i.moveIn.hoverLine.mouseUp();break;case pt.HoverAnchors:if(i.hoverLayer.line){var b=void 0,z=i.hoverLayer.line,U=z.from,rt=z.to;if(i.hoverLayer.line.to.id){if(!i.options.disableRepeatLine)b=!0;else{var ht=i.data.pens.filter(function(St){return St.type===g.Line&&St.from.isSameAs(i.hoverLayer.line.from)&&St.to.isSameAs(i.hoverLayer.line.to)});b=ht.length<=1}U.id===rt.id&&U.anchorIndex===rt.anchorIndex&&(b=!1)}else b=!i.options.disableEmptyLine&&!i.hoverLayer.line.disableEmptyLine,b=b&&Math.pow(U.x-rt.x,2)+Math.pow(U.y-rt.y,2)>25;b?(i.activeLayer.pens=[i.hoverLayer.line],i.dispatch("addLine",i.hoverLayer.line)):(i.data.pens.pop(),i.activeLayer.clear())}i.offscreen.render(),i.hoverLayer.line=void 0;break;case pt.AutoAnchor:(i.hoverLayer.line.disableEmptyLine||i.options.disableEmptyLine)&&(!i.hoverLayer.line.from.id||!i.hoverLayer.line.to.id)?(i.needCache=!0,i.activeLayer.clear(),i.data.pens.splice(i.findIndex(i.hoverLayer.line),1)):(i.activeLayer.updateLines(),i.dispatch("addLine",i.hoverLayer.line));break;case pt.Rotate:i.activeLayer.updateRotate();break;case pt.LineControlPoint:nt.Store.set(i.generateStoreKey("pts-")+i.moveIn.hoverLine.id,void 0);break;case pt.LineFrom:case pt.LineTo:(i.hoverLayer.line.disableEmptyLine||i.options.disableEmptyLine)&&(!i.hoverLayer.line.from.id||!i.hoverLayer.line.to.id)&&(i.needCache=!0,i.activeLayer.clear(),i.data.pens.splice(i.findIndex(i.hoverLayer.line),1)),i.hoverLayer.line.from.id&&i.hoverLayer.line.to.id&&i.dispatch("lineOn",Object.assign(i.hoverLayer.line,{lineOnDirection:i.moveIn.type}));break;case pt.Graffiti:!i.moveIn.hoverNode.points||i.moveIn.hoverNode.points.length<2?(i.moveIn.type=pt.None,i.data.pens.pop()):(i.moveIn.type=pt.Nodes,i.moveIn.hoverNode.doing=void 0,i.moveIn.hoverNode.calcAnchors(),i.activeLayer.setPens([i.moveIn.hoverNode]),i.hoverLayer.node=i.moveIn.hoverNode,i.needCache=!0);break;case pt.Lines:var ct=void 0;i.moveIn.hoverLine.children&&i.moveIn.hoverLine.children.length&&(ct=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1]),ct||(i.moveIn.hoverLine.children=[]);var yt=new Ot({parentId:i.moveIn.hoverLine.id,name:"line",from:new R(o.x,o.y),fromArrow:ct?"":i.data.fromArrow,to:new R(o.x,o.y),toArrow:"",strokeStyle:i.options.color,lineWidth:i.data.lineWidth});ct&&(yt.from.id=ct.id,yt.from.x=ct.to.x,yt.from.y=ct.to.y,ct.to.id=yt.id),i.moveIn.hoverLine.children.push(yt),i.hoverLayer.line=yt,i.dispatch("addLineInLines",{previous:ct,line:yt})}}i.hoverLayer.dragRect=void 0,i.activeLayer.lastOffsetX=0,i.activeLayer.lastOffsetY=0,i.render(),i.needCache&&i.cache(),i.needCache=!1}},this.ondblclick=function(){i.moveIn.hoverNode?(i.dispatch("dblclick",i.moveIn.hoverNode),i.data.locked||i.moveIn.hoverNode.locked||i.moveIn.hoverNode.hideInput||i.options.hideInput||i.showInput(i.moveIn.hoverNode),i.moveIn.hoverNode.dblclick()):i.moveIn.hoverLine&&(i.dispatch("dblclick",i.moveIn.hoverLine),i.data.locked||i.moveIn.hoverLine.locked||i.moveIn.hoverLine.hideInput||i.options.hideInput||i.showInput(i.moveIn.hoverLine),i.moveIn.hoverLine.dblclick())},this.onkeydown=function(n){if(!(i.data.locked||n.target.tagName==="INPUT"||n.target.tagName==="TEXTAREA")){var o=!1,p=0,b=0;switch(n.key){case" ":i.spaceDown=!0;break;case"a":case"A":i.activeLayer.setPens(bi(i.data.pens)),o=!0;break;case"Delete":case"Backspace":n.ctrlKey||n.metaKey?i.deleteAnchors():i.delete();break;case"ArrowLeft":p=-5,(n.ctrlKey||n.metaKey)&&(p=-1),o=!0;break;case"ArrowUp":b=-5,(n.ctrlKey||n.metaKey)&&(b=-1),o=!0;break;case"ArrowRight":p=5,(n.ctrlKey||n.metaKey)&&(p=1),o=!0;break;case"ArrowDown":b=5,(n.ctrlKey||n.metaKey)&&(b=1),o=!0;break;case"x":case"X":i.cut();break;case"c":case"C":i.copy();break;case"v":case"V":i.paste();break;case"y":case"Y":(n.ctrlKey||n.metaKey)&&i.redo();break;case"z":case"Z":n.shiftKey?i.redo():(n.ctrlKey||n.metaKey)&&i.undo();break;case"Enter":if(i.moveIn.type===pt.Lines){if(i.moveIn.type=pt.None,i.moveIn.hoverLine.doing="",i.hoverLayer.line.getLen()<10&&(i.moveIn.hoverLine.children.pop(),i.hoverLayer.line=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1]),i.moveIn.hoverLine.isNode){var z=[];i.moveIn.hoverLine.children.forEach(function(Pt){z.push(Pt.from),Pt.controlPoints&&Pt.controlPoints.forEach(function(Bt){Bt.data=!0,z.push(Bt)}),z.push(Pt.to)});var U=me(z),rt=U.x1,ht=U.y1,ct=U.x2,yt=U.y2,St=new Nt({name:"lines",rect:new a(rt,ht,ct-rt,yt-ht),points:z,closePath:i.moveIn.hoverLine.closePath});i.activeLayer.add(St),i.data.pens.pop(),i.data.pens.push(St)}else i.hoverLayer.line.toArrow=i.data.toArrow,i.activeLayer.add(i.moveIn.hoverLine);i.moveIn.hoverLine=void 0}o=!0;break;case"Escape":i.moveIn.type===pt.Lines&&(i.moveIn.type=pt.None,i.moveIn.hoverLine.children.pop(),i.hoverLayer.line=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1],i.hoverLayer.line.toArrow=i.data.toArrow,i.moveIn.hoverLine.doing="",i.moveIn.hoverLine=void 0),o=!0;break}!o||(n.preventDefault(),n.stopPropagation(),(p||b)&&(i.activeLayer.saveNodeRects(),i.activeLayer.move(p,b),i.animateLayer.animate()),i.render(),i.cache())}},this._emitter=kt(),this.options=Object.assign({},Lt,e),nt.Store.set(this.generateStoreKey("LT:color"),this.options.color||"#222222"),nt.Store.set(this.generateStoreKey("LT:fontColor"),this.options.fontColor||"#222222"),this.setupDom(t),this.setupSubscribe(),this.setupMouseEvent(),setTimeout(function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},500),setTimeout(function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},1e3),this.cache(),window.topology=this,this.dispatch("loaded")}return Object.defineProperty(r.prototype,"ramCaches",{get:function(){return 5},enumerable:!0,configurable:!0}),r.prototype.setupDom=function(t){typeof t=="string"?this.parentElem=document.getElementById(t):this.parentElem=t,this.parentElem.style.position="relative",this.parentElem.style.overflow="auto",this.parentElem.onresize=this.winResize,window.addEventListener("resize",this.winResize);var e=this.id;this.activeLayer=new li(this.options,e),this.activeLayer.topology=this,this.hoverLayer=new hi(this.options,e),this.animateLayer=new fi(this.options,e),this.offscreen=new ni(this.parentElem,this.options,e),this.canvas=new si(this.parentElem,this.options,e),this.divLayer=new pi(this.parentElem,this.options,e),this.options.scroll&&(this.scrollDom=new wi(this)),this.input.style.position="absolute",this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.input.style.height="0",this.input.style.outline="none",this.input.style.border="1px solid #cdcdcd",this.input.style.resize="none",this.parentElem.appendChild(this.input),this.createMarkdownTip(),this.resize()},r.prototype.setupSubscribe=function(){var t=this;this.subcribe=nt.Store.subscribe(this.generateStoreKey("LT:render"),function(){t.render()}),this.subcribeRender=nt.Store.subscribe("LT:render",function(){t.render()}),this.subcribeImage=nt.Store.subscribe(this.generateStoreKey("LT:imageLoaded"),function(){t.imageTimer&&clearTimeout(t.imageTimer),t.imageTimer=setTimeout(function(){t.render()},100)}),this.subcribeAnimateMoved=nt.Store.subscribe(this.generateStoreKey("LT:rectChanged"),function(e){t.activeLayer.updateLines([e])}),this.subcribeMediaEnd=nt.Store.subscribe(this.generateStoreKey("mediaEnd"),function(e){e.nextPlay&&(t.animateLayer.readyPlay(e.nextPlay),t.animateLayer.animate()),t.dispatch("mediaEnd",e)}),this.subcribeAnimateEnd=nt.Store.subscribe(this.generateStoreKey("animateEnd"),function(e){if(!!e){switch(e.type){case g.Node:t.offscreen.render();break}t.dispatch("animateEnd",e)}}),this.subcribeEmit=nt.Store.subscribe(this.generateStoreKey("LT:emit"),function(e){t.emit(e.event,e)})},r.prototype.setupMouseEvent=function(){var t=this;switch(this.canvasPos=this.divLayer.canvas.getBoundingClientRect(),this.parentElem.addEventListener("scroll",this.onScroll),window.addEventListener("scroll",this.onScroll),this.divLayer.canvas.ondragover=function(e){return e.preventDefault()},this.divLayer.canvas.ondrop=function(e){if(!t.data.locked)try{var i=e.dataTransfer.getData("Topology")||e.dataTransfer.getData("Text");if(!i)return;var n=JSON.parse(i);e.preventDefault();var o=t.calibrateMouse({x:e.offsetX,y:e.offsetY});t.dropNodes(Array.isArray(n)?n:[n],o.x,o.y),t.activeLayer.calcActiveRect()}catch(p){}},Zr()?(this.options.refresh=50,document.addEventListener("gesturestart",this.preventDefault),this.divLayer.canvas.ontouchstart=function(e){t.touchStart=Date.now();var i=new R(e.changedTouches[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.changedTouches[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));if(e.touches.length>1){t.touches=e.touches,t.touchScale=t.data.scale,t.lastTranlated.x=i.x,t.lastTranlated.y=i.y;return}var n=t.calibrateMouse({x:i.x,y:i.y});t.getMoveIn(n),t.hoverLayer.node=t.moveIn.hoverNode,t.hoverLayer.line=t.moveIn.hoverLine,t.lastTranlated.x=i.x,t.lastTranlated.y=i.y,t.onmousedown({x:i.x,y:i.y,ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:0})},this.divLayer.canvas.ontouchmove=function(e){e.stopPropagation();var i=e.touches,n=i.length;!t.touchCenter&&n>1&&(t.touchCenter={x:i[0].pageX+(i[1].pageX-i[0].pageX)/2,y:i[0].pageY+(i[1].pageY-i[0].pageY)/2},t.calibrateMouse(t.touchCenter));var o=Date.now();if(!(o-t.touchStart<50)){if(n>1){if(n===2){var p=e.scale||Math.hypot(i[0].pageX-i[1].pageX,i[0].pageY-i[1].pageY)/Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY);e.preventDefault(),t.scaleTo(p*t.touchScale,t.touchCenter,t.options.scaleCache)}else if(n===3){var b=new R(i[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),i[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.translate(b.x,b.y,!0)}return}e.preventDefault();var z=new R(e.touches[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.touches[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.onMouseMove({x:z.x,y:z.y,ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,buttons:1})}},this.divLayer.canvas.ontouchend=function(e){t.touches=void 0,t.touchCenter=void 0,t.ontouchend(e)}):(this.divLayer.canvas.onmousedown=function(e){if(!(e.target.nodeName==="INPUT"&&e.target.type==="range"&&t.data.locked)){t.touchedNode&&(t.touchedNode.name==="graffiti"?(t.touchedNode.rect=new a(0,0,0,0),t.addNode(t.touchedNode),t.touchedNode=void 0):t.touchedNode.name==="lines"&&(t.addLine(t.touchedNode),t.touchedNode=void 0));var i={x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:e.button,pageX:e.pageX,pageY:e.pageY};t.lastTranlated.x=i.x,t.lastTranlated.y=i.y,t.onmousedown(i)}},this.divLayer.canvas.onmousemove=function(e){t.onMouseMove({x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,buttons:e.buttons,pageX:e.pageX,pageY:e.pageY})},this.divLayer.canvas.onmouseup=function(e){var i={x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:e.button},n=t.hoverLayer.dragRect;if(t.onmouseup(i),!(!t.touchedNode||t.data.locked)){if(n)t.touchedNode=ie(ie({},t.touchedNode),{rect:n});else{var o=t.data,p=o.x,b=o.y;t.touchedNode.rect.x=e.pageX-window.scrollX-t.canvasPos.x-t.touchedNode.rect.width/2-p,t.touchedNode.rect.y=e.pageY-window.scrollY-t.canvasPos.y-t.touchedNode.rect.height/2-b}var z=new Nt(t.touchedNode);t.addNode(z,!0),t.activeLayer.calcActiveRect(),t.touchedNode=void 0}},this.divLayer.canvas.onmouseleave=function(e){[t.tipMarkdown,t.divLayer.player,t.input].includes(e.toElement)||setTimeout(function(){t.hideTip(),t.moveIn.hoverLine=void 0,t.moveIn.hoverNode=void 0},50)}),this.divLayer.canvas.ondblclick=this.ondblclick,this.divLayer.canvas.tabIndex=0,this.divLayer.canvas.onblur=function(){t.mouseDown=void 0},this.divLayer.canvas.onwheel=function(e){if(t.options.scroll&&!e.ctrlKey&&t.scrollDom){t.scrollDom.wheel(e.deltaY<0);return}if(t.data.locked!==Ht.NoEvent){var i=new Date().getTime();if(i-t.touchStart<20){e.preventDefault(),e.stopPropagation();return}if(t.touchStart=new Date().getTime(),!t.options.disableScale){switch(t.options.scaleKey){case vt.Ctrl:if(!e.ctrlKey&&!e.metaKey)return;break;case vt.Shift:if(!e.shiftKey)return;break;case vt.Alt:if(!e.altKey)return;break}e.preventDefault(),e.stopPropagation();var n=new R(e.x-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.y-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.calibrateMouse(n);var o=t.data.scale;return e.deltaY<0?o+=.1:o-=.1,t.scaleTo(o,n,t.options.scaleCache),t.divLayer.canvas.focus(),!1}}},this.options.keydown){case wt.Document:document.addEventListener("keydown",this.onkeydown),document.addEventListener("keyup",function(){t.spaceDown=!1});break;case wt.Canvas:this.divLayer.canvas.addEventListener("keydown",this.onkeydown),this.divLayer.canvas.addEventListener("keyup",function(){t.spaceDown=!1});break}},r.prototype.ontouchend=function(t){var e=new R(t.changedTouches[0].pageX-window.scrollX-(this.canvasPos.left||this.canvasPos.x),t.changedTouches[0].pageY-window.scrollY-(this.canvasPos.top||this.canvasPos.y)),i=this.hoverLayer.dragRect;if(this.onmouseup({x:e.x,y:e.y,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,button:0}),!(!this.touchedNode||this.data.locked)){if(i)this.touchedNode=ie(ie({},this.touchedNode),{rect:i});else{var n=this.data,o=n.x,p=n.y;this.touchedNode.rect.x=t.changedTouches[0].pageX-window.scrollX-this.canvasPos.x-this.touchedNode.rect.width/2-o,this.touchedNode.rect.y=t.changedTouches[0].pageY-window.scrollY-this.canvasPos.y-this.touchedNode.rect.height/2-p}var b=new Nt(this.touchedNode);this.addNode(b,!0),this.activeLayer.calcActiveRect(),this.touchedNode=void 0}},r.prototype.resize=function(t){this.canvas.resize(t),this.offscreen.resize(t),this.divLayer.resize(t),this.render(),this.dispatch("resize",t),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.init()},r.prototype.dropNodes=function(t,e,i){var n=this,o=0,p=0;if(t.length&&t[0].rect){var b=t[0].rect;o=b.x,p=b.y}var z;t.forEach(function(U){if(U.id=xt(),U.name==="graffiti"){U.rect=new a(0,0,0,0),n.addNode(U);return}else if(U.name==="lines"){n.addLine(U),n.mouseDown={x:e,y:i},n.onmouseup(n.mouseDown);return}if(!z)U.rect.x=e-U.rect.width/2<<0,U.rect.y=i-U.rect.height/2<<0,z=U;else{var rt=U.rect,ht=rt.x-o,ct=rt.y-p;U.rect.x=z.rect.x+ht,U.rect.y=z.rect.y+ct}U.type===g.Line?n.addLine(Object.assign({name:"line",from:new R(U.rect.x,U.rect.y),fromArrow:n.data.fromArrow,to:new R(U.rect.x+U.rect.width,U.rect.y+U.rect.height),toArrow:n.data.toArrow,strokeStyle:n.options.color},U),!0):n.addNode(U,!0)}),this.divLayer.canvas.focus()},r.prototype.addNode=function(t,e){var i=this;return e===void 0&&(e=!1),Et[t.name]?(t.TID=this.id,t.init||(t=new Nt(t)),!t.strokeStyle&&this.options.color&&(t.strokeStyle=this.options.color),Tt.forEach(function(n){t[n]||(t[n]=i.options[n])}),this.data.scale!==1&&t.scale(this.data.scale),this.data.pens.push(t),e&&(this.activeLayer.pens=[t]),t.name!=="graffiti"||!t.doing?(this.render(),this.animate(!0),this.cache()):(this.moveIn.type=pt.Graffiti,this.moveIn.hoverNode=t),this.dispatch("addNode",t),t):null},r.prototype.addLine=function(t,e){var i=this;return e===void 0&&(e=!1),t.type===g.Node&&(t.isNode=!0),t.TID=this.id,t.clone||(t=new Ot(t),t.calcControlPoints(!0)),Tt.forEach(function(n){t[n]||(t[n]=i.options[n])}),this.data.scale!==1&&(t.name!=="lines"?t.scale(this.data.scale,t.getCenter()):t.fontSize*=this.data.scale),this.data.pens.push(t),t.name!=="lines"||!t.doing?e&&(this.activeLayer.setPens([t]),this.render(),this.animate(!0),this.cache(),this.dispatch("addLine",t)):(this.activeLayer.clear(),this.hoverLayer.line=void 0,this.moveIn.type=pt.Lines,this.moveIn.hoverLine=t),t},r.prototype.render=function(t){if(t&&(this.activeLayer.pens=[],this.hoverLayer.node=void 0,this.hoverLayer.line=void 0),this.rendering)return this;this.rendering=!0;var e=this.offscreen.canvas.getContext("2d");e.clearRect(0,0,this.offscreen.canvas.width,this.offscreen.canvas.height),e.save(),e.translate(this.data.x,this.data.y),this.offscreen.render(),e.restore(),this.canvas.render(),this.rendering=!1},r.prototype.open=function(t){typeof t!="string"&&t&&t.mqttOptions&&!t.mqttOptions.customClientId&&(t.mqttOptions.clientId=xt()),this.canvas.clearBkImg(),this.data=re(t,this.id),this.subscribeSocket(),nt.Store.set(this.generateStoreKey("LT:scale"),this.data.scale),this.dispatch("scale",this.data.scale),nt.Store.set("LT:bkColor",this.data.bkColor),this.lock(this.data.locked),this.caches.list=[],ti(),this.caches.dbIndex=-1,this.cache(),this.divLayer.clear(),this.animateLayer.stop(),this.render(!0),this.parentElem.scrollLeft=0,this.parentElem.scrollTop=0,this.animate(!0),this.openSocket(),this.openMqtt(),this.doInitJS(),this.dispatch("opened"),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.init()},r.prototype.doInitJS=function(){if(this.data.initJS&&this.data.initJS.trim()){var t=new Function(this.data.initJS);t()}},r.prototype.openSocket=function(t){var e=this;this.closeSocket(),(t||this.data.websocket)&&(this.socket=new yi(t||this.data.websocket,function(i){e.data.socketEvent!==1&&e.doSocket(i.data),e.data.socketEvent&&e.dispatch("websocket",i.data)}))},r.prototype.closeSocket=function(){this.socket&&this.socket.close()},r.prototype.openMqtt=function(t,e){var i=this;this.closeMqtt(),(t||this.data.mqttUrl)&&(this.mqtt=new gi(t||this.data.mqttUrl,e||this.data.mqttOptions,this.data.mqttTopics,function(n,o){i.data.socketEvent!==1&&i.doSocket(o.toString(),u.Mqtt),i.data.socketEvent&&i.dispatch("mqtt",{topic:n,message:o})}))},r.prototype.closeMqtt=function(){this.mqtt&&this.mqtt.close()},r.prototype.doSocket=function(t,e){var i=this;e===void 0&&(e=u.WebSocket);try{t=JSON.parse(t),Array.isArray(t)||(t=[t]),t.forEach(function(n){var o=[];n.actions&&(o=n.actions,delete n.actions);var p=x(n.id||n.tag,i.data.pens);p.forEach(function(b){(b.id===n.id||b.tags&&b.tags.indexOf(n.tag)>-1)&&(b.fromData(b,n),b.doWheres(),b.events&&b.events.forEach(function(z){z.type===e&&(z.params=n,o.push(z))}),o&&o.forEach(function(z){b.doAction(z)}))}),i.willRender()})}catch(n){console.warn(n)}},r.prototype.overflow=function(t){t===void 0&&(t=50);var e=this.getRect(),i=e.width,n=e.height;i<e.ex&&(i=e.ex+t),i<this.canvas.width&&(i=this.canvas.width),n<e.ey&&(n=e.ey+t),n<this.canvas.height&&(n=this.canvas.height);var o={width:i,height:n};return this.resize(o),o},r.prototype.setNodeText=function(){this.inputObj.text=this.input.value,this.inputObj.name==="image"&&this.inputObj.init(),this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.cache(),this.offscreen.render(),this.dispatch("setText",this.inputObj),this.inputObj=void 0},r.prototype.getMoveIn=function(t){if(!(this.moveIn.type>=pt.Graffiti)){if(this.lastHoverNode=this.moveIn.hoverNode,this.lastHoverLine=this.moveIn.hoverLine,this.moveIn.type=pt.None,this.moveIn.hoverNode=void 0,this.moveIn.lineControlPoint=void 0,this.moveIn.hoverLine=void 0,this.hoverLayer.hoverAnchorIndex=-1,!this.data.locked&&!(this.activeLayer.pens.length===1&&this.activeLayer.pens[0].type)&&!this.activeLayer.locked()&&this.activeLayer.rotateCPs[0]&&this.activeLayer.rotateCPs[0].hit(t,15)){this.moveIn.type=pt.Rotate;var e=this.options.rotateCursor;this.divLayer.canvas.style.cursor=e.includes("/")?'url("'+e+'"), auto':e;return}if(this.activeLayer.pens.length>1&&c(t,this.activeLayer.sizeCPs)&&(this.moveIn.type=pt.Nodes),!this.data.locked&&!this.activeLayer.locked()&&!this.options.hideSizeCP&&(this.activeLayer.pens.length>1||!this.activeLayer.pens[0].type&&!this.activeLayer.pens[0].hideSizeCP)){for(var i=0;i<this.activeLayer.sizeCPs.length;++i)if(this.activeLayer.sizeCPs[i].hit(t,10)){this.moveIn.type=pt.ResizeCP,this.moveIn.activeAnchorIndex=i,this.divLayer.canvas.style.cursor=ki[i];return}}if(!this.data.locked)for(var n=0,o=this.activeLayer.pens;n<o.length;n++){var p=o[n];if(p instanceof Ot&&!p.locked){for(var i=0;i<p.controlPoints.length;++i)if(!p.locked&&p.controlPoints[i].hit(t,10)){p.controlPoints[i].id=i,this.moveIn.type=pt.LineControlPoint,this.moveIn.lineControlPoint=p.controlPoints[i],this.moveIn.hoverLine=p,this.divLayer.canvas.style.cursor="pointer";return}if(this.inLine(t,p))return}}this.divLayer.canvas.style.cursor="default";for(var b=this.data.pens.length,z,i=b-1;i>-1;--i)if(this.data.pens[i].type===g.Node&&this.inNode(t,this.data.pens[i])){z&&this.moveIn.type!==pt.HoverAnchors&&this.inLine(t,z);return}else this.data.pens[i].type===g.Line&&this.inLine(t,this.data.pens[i])&&(z=this.data.pens[i])}},r.prototype.inChildNode=function(t,e){if(!e)return null;for(var i=e.length,n=i-1;n>-1;--n){var o=e[n];if(!(!o.visible||o.locked===Ht.NoEvent)){if(o.type===g.Line){if(this.inLine(t,o))return o;continue}var p=this.inChildNode(t,o.children);if(p||(p=this.inNode(t,o,!0),p))return p}}return null},r.prototype.inNode=function(t,e,i){if(i===void 0&&(i=!1),this.data.locked===Ht.NoEvent||!e.visible||e.locked===Ht.NoEvent)return null;var n=this.inChildNode(t,e.children);if(n)return this.moveIn.type<pt.HoverAnchors&&(this.moveIn.type=pt.Nodes,n.stand?this.moveIn.activeNode=n:this.moveIn.activeNode=e),n;if(e.hitInSelf(t)){if(this.moveIn.hoverNode=e,this.moveIn.type=pt.Nodes,!this.data.locked&&!e.locked?this.divLayer.canvas.style.cursor="move":this.divLayer.canvas.style.cursor=this.options.hoverCursor,!this.data.locked&&!e.locked&&!(this.options.hideAnchor||e.hideAnchor||e.rect.width<20||e.rect.height<20)){for(var o=0;o<e.rotatedAnchors.length;++o)if(e.rotatedAnchors[o].hit(t,this.options.anchorSize)){if(!this.mouseDown&&e.rotatedAnchors[o].mode===te.In)continue;this.moveIn.type=pt.HoverAnchors,this.moveIn.hoverAnchorIndex=o,this.hoverLayer.hoverAnchorIndex=o,this.divLayer.canvas.style.cursor="crosshair";break}this.options.autoAnchor&&e.rect.center.hit(t,this.options.anchorSize)&&(this.moveIn.hoverNode=e,this.moveIn.type=pt.AutoAnchor,this.divLayer.canvas.style.cursor="crosshair")}return i||(this.moveIn.activeNode=this.moveIn.hoverNode),e}if(this.options.hideAnchor||e.hideAnchor||this.data.locked||e.locked)return null;if(e.hitInSelf(t,this.options.anchorSize)){for(var o=0;o<e.rotatedAnchors.length;++o)if(e.rotatedAnchors[o].hit(t,this.options.anchorSize)){if(!this.mouseDown&&e.rotatedAnchors[o].mode===te.In)continue;return this.moveIn.hoverNode=e,this.moveIn.type=pt.HoverAnchors,this.moveIn.hoverAnchorIndex=o,this.hoverLayer.hoverAnchorIndex=o,this.divLayer.canvas.style.cursor="crosshair",i||(this.moveIn.activeNode=e),e}}return null},r.prototype.inLine=function(t,e){if(this.data.locked===Ht.NoEvent||!e.visible||e.locked===Ht.NoEvent)return null;if(e.children)for(var i=0,n=e.children;i<n.length;i++){var o=n[i],p=this.inLine(t,o);if(p)return p}if(e.from){if(e.from.hit(t,this.options.anchorSize))return this.moveIn.type=pt.LineFrom,this.moveIn.hoverLine=e,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",e;if(e.to.hit(t,this.options.anchorSize))return this.moveIn.type=pt.LineTo,this.moveIn.hoverLine=e,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",e;if(e.pointIn(t))return this.moveIn.type=pt.Line,this.moveIn.hoverLine=e,this.divLayer.canvas.style.cursor=this.options.hoverCursor,e}return null},r.prototype.getLineDock=function(t,e){e===void 0&&(e=te.Default),this.hoverLayer.dockAnchor=void 0;for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o instanceof Nt){var p=o.hit(t,10);if(!p)continue;if(p.type===g.Line){if(p.from.hit(t,10)){t.x=p.from.x,t.y=p.from.y,this.hoverLayer.dockAnchor=p.from;break}if(p.to.hit(t,10)){t.x=p.to.x,t.y=p.to.y,this.hoverLayer.dockAnchor=p.to;break}break}this.hoverLayer.node=p,this.options.autoAnchor&&p.rect.center.hit(t,10)&&(t.id=p.id,t.autoAnchor=!0,t.x=p.rect.center.x,t.y=p.rect.center.y,this.hoverLayer.dockAnchor=p.rect.center);for(var b=0;b<p.rotatedAnchors.length;++b)if(!(p.rotatedAnchors[b].mode&&p.rotatedAnchors[b].mode!==e)&&p.rotatedAnchors[b].hit(t,10)){t.id=p.id,t.anchorIndex=b,t.autoAnchor=!1,t.direction=p.rotatedAnchors[b].direction,t.x=p.rotatedAnchors[b].x,t.y=p.rotatedAnchors[b].y,this.hoverLayer.dockAnchor=p.rotatedAnchors[b];break}if(this.hoverLayer.dockAnchor)break}else if(o instanceof Ot){if(o.id===this.hoverLayer.line.id)continue;if(o.children){for(var z=!1,U=0,rt=o.children;U<rt.length;U++){var ht=rt[U];if(ht.from.hit(t,10)){t.x=ht.from.x,t.y=ht.from.y,this.hoverLayer.dockAnchor=ht.from,z=!0;break}if(ht.to.hit(t,10)){t.x=ht.to.x,t.y=ht.to.y,this.hoverLayer.dockAnchor=ht.to,z=!0;break}if(ht.controlPoints)for(var ct=0,yt=ht.controlPoints;ct<yt.length;ct++){var St=yt[ct];if(St.hit(t,10)){t.x=St.x,t.y=St.y,this.hoverLayer.dockAnchor=St,z=!0;break}}}if(z)continue}else{if(o.from.hit(t,10)){t.x=o.from.x,t.y=o.from.y,this.hoverLayer.dockAnchor=o.from;continue}if(o.to.hit(t,10)){t.x=o.to.x,t.y=o.to.y,this.hoverLayer.dockAnchor=o.to;continue}if(o.controlPoints)for(var Pt=0,Bt=o.controlPoints;Pt<Bt.length;Pt++){var St=Bt[Pt];if(St.hit(t,10)){t.x=St.x,t.y=St.y,this.hoverLayer.dockAnchor=St;break}}}}}return t},r.prototype.getPensInRect=function(t){var e=this;t.width<0&&(t.width=-t.width,t.x=t.ex,t.ex=t.x+t.width),t.height<0&&(t.height=-t.height,t.y=t.ey,t.ey=t.y+t.height),this.activeLayer.pens=[];for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];o.locked!==Ht.NoEvent&&(o instanceof Nt&&t.hitByRect(o.rect)&&this.activeLayer.add(o),o instanceof Ot&&(o.children?o.children.forEach(function(p){t.hit(p.from)&&t.hit(p.to)&&e.activeLayer.add(p)}):t.hit(o.from)&&t.hit(o.to)&&this.activeLayer.add(o)))}},r.prototype.getAngle=function(t){if(t.x===this.activeLayer.rect.center.x)return t.y<=this.activeLayer.rect.center.y?0:180;if(t.y===this.activeLayer.rect.center.y)return t.x<this.activeLayer.rect.center.x?270:90;var e=t.x-this.activeLayer.rect.center.x,i=t.y-this.activeLayer.rect.center.y,n=Math.atan(Math.abs(e/i))/(2*Math.PI)*360;return e>0&&i>0?n=180-n:e<0&&i>0?n+=180:e<0&&i<0&&(n=360-n),this.activeLayer.pens.length===1?n-this.activeLayer.pens[0].rotate:n},r.prototype.showInput=function(t){this.inputObj=t;var e=t.getTextRect();!e||(this.input.value=t.text||"",this.input.style.left=e.x+this.data.x+"px",this.input.style.top=e.y+this.data.y+"px",this.input.style.width=e.width+"px",this.input.style.height=e.height+"px",this.input.style.zIndex="1000",t.rotate/360?this.input.style.transform="rotate("+t.rotate+"deg)":this.input.style.transform=void 0,this.input.classList.add("set-text-input"),this.input.focus())},r.prototype.getRect=function(t){t||(t=this.data.pens);var e=$t(t);return new a(e.x+this.data.x,e.y+this.data.y,e.width,e.height)},r.prototype.getDockPos=function(t,e,i){this.hoverLayer.dockLineX=0,this.hoverLayer.dockLineY=0;var n={x:void 0,y:void 0};if(i||this.options.disableDockLine)return n;for(var o=0,p=0,b=ze,z=ze,U=0,rt=this.activeLayer.dockWatchers;U<rt.length;U++)for(var ht=rt[U],ct=0,yt=this.data.pens;ct<yt.length;ct++){var St=yt[ct];if(!(!(St instanceof Nt)||this.activeLayer.has(St)||St.name==="text"))for(var Pt=0,Bt=St.dockWatchers;Pt<Bt.length;Pt++){var dt=Bt[Pt];o=Math.abs(dt.x-ht.x-t),o<b&&(b=-99999,n.x=dt.x-ht.x,this.hoverLayer.dockLineX=dt.x|0),p=Math.abs(dt.y-ht.y-e),p<z&&(z=-99999,n.y=dt.y-ht.y,this.hoverLayer.dockLineY=dt.y|0)}}return n},r.prototype.cache=function(){if(!(this.options.cacheLen==0||this.data.locked)){this.caches.index<this.caches.list.length-1&&(this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1),Oe(this.caches.dbIndex+1));var t=this.pureData();this.caches.list.push(t),ei(t,this.caches.dbIndex+1,this.options.cacheLen),this.caches.list.length>this.ramCaches&&this.caches.list.shift(),this.caches.index=this.caches.list.length-1,this.caches.dbIndex++}},r.prototype.cacheReplace=function(t){if(this.options.cacheLen!=0&&t&&t.length){for(var e={},i=0,n=t.length;i<n;i++){var o=t[i],p=o.id;o instanceof Nt?e[p]=new Nt(o):o instanceof Ot&&(e[p]=new Ot(o))}var b=this.caches.list[0];if(!b)return;for(var i=0,n=b.pens.length;i<n;i++){var p=b.pens[i].id;e[p]&&(b.pens[i]=e[p])}}},r.prototype.undo=function(t,e){var i=this;if(t===void 0&&(t=!1),this.options.cacheLen!=0&&!(!e&&this.data.locked||this.caches.index<1)){if(this.divLayer.clear(!0),this.animateLayer.stop(),this.caches.dbIndex--,this.data=re(this.caches.list[--this.caches.index],this.id),this.render(!0),this.divLayer.render(),t&&(this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1),Oe(this.caches.dbIndex)),this.caches.index<=this.caches.list.length/2-1){var n=this.caches.index-0+1;Be(this.caches.dbIndex-n).then(function(o){o&&(i.caches.list.pop(),i.caches.list.unshift(o),i.caches.index++)})}this.dispatch("undo",this.data)}},r.prototype.redo=function(t){var e=this;if(this.options.cacheLen!=0&&!(!t&&this.data.locked||this.caches.index>this.caches.list.length-2)){if(this.divLayer.clear(!0),this.caches.dbIndex++,this.data=re(this.caches.list[++this.caches.index],this.id),this.render(!0),this.divLayer.render(),this.caches.index>=this.caches.list.length/2){var i=this.caches.list.length-this.caches.index;Be(this.caches.dbIndex+i).then(function(n){n&&(e.caches.list.shift(),e.caches.list.push(n),e.caches.index--)})}this.dispatch("redo",this.data)}},r.prototype.toImageCanvas=function(t){t===void 0&&(t=0);var e;this.data.bkImageRect&&(e=new a(this.data.bkImageRect.x-this.data.x,this.data.bkImageRect.y-this.data.y,this.data.bkImageRect.width,this.data.bkImageRect.height));var i=$r($t(this.data.pens),e),n=we(t||0);i.x-=n[3],i.y-=n[0],i.width+=n[3]+n[1],i.height+=n[0]+n[2],i.init();var o=this.offscreen.getDpiRatio();i.scale(o),e&&e.scale(o,i.center);var p=document.createElement("canvas");p.width=i.width,p.height=i.height;var b=p.getContext("2d");b.save(),(this.data.bkColor||this.options.bkColor)&&(b.fillStyle=this.data.bkColor||this.options.bkColor,b.fillRect(0,0,p.width,p.height)),this.data.bkImage&&e&&b.drawImage(this.canvas.bkImg,e.x-i.x,e.y-i.y,e.width,e.height);for(var z=0,U=this.data.pens;z<U.length;z++){var rt=U[z],ht=void 0;rt.type?ht=new Ot(rt):(ht=new Nt(rt,!0),ht.animateFrames=[],ht.img=rt.img,ht.elementId="",ht.elementLoaded=!0,ht.elementRendered=!0),ht.scale(o,i.center),ht.translate(-i.x,-i.y,!0),ht.render(b)}return b.scale(1/o,1/o),b.restore(),p},r.prototype.toImage=function(t,e){t===void 0&&(t=0),e===void 0&&(e=void 0);var i=this.toImageCanvas(t);return e&&i.toBlob(e),i.toDataURL("image/png",1)},r.prototype.saveAsImage=function(t,e){e===void 0&&(e=0);var i=document.createElement("a");i.setAttribute("download",t||"le5le.topology.png"),i.setAttribute("href",this.toImage(e));var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),i.dispatchEvent(n)},r.prototype.delete=function(t,e){if(!(this.data.locked&&!e)){var i=[];if(typeof t=="string")i=w(t,this.data.pens);else for(var n=t||this.activeLayer.pens,o=0;o<n.length;o++){var p=n[o];if(p.type===g.Line&&p.parentId){var b=x(p.parentId,this.data.pens)[0];b&&b.name==="lines"&&(p=b)}w(p.id,this.data.pens).length&&(i.push(p),--o,p.type===g.Node&&this.divLayer.removeDiv(p),this.options.disableEmptyLine&&this.delEmptyLines(p.id),this.animateLayer.pens.delete(p.id))}i.length&&(this.render(!0),this.cache(),this.dispatch("delete",i))}},r.prototype.deleteAnchors=function(t,e){if(!(this.data.locked&&!e)){var i=t||this.activeLayer.pens;i.forEach(function(n){n.type===g.Node&&(n.manualAnchors=void 0,n.calcAnchors())})}},r.prototype.delEmptyLines=function(t){for(var e=0;e<this.data.pens.length;e++)if(this.data.pens[e].type===g.Line){var i=this.data.pens[e];(!i.from.id||!i.to.id||i.from.id===t||i.to.id===t)&&(this.data.pens.splice(e,1),this.animateLayer.pens.delete(i.id),--e)}},r.prototype.cut=function(){if(!this.data.locked){this.clipboard=re({pens:[]});for(var t=0;t<this.activeLayer.pens.length;t++){var e=this.activeLayer.pens[t];this.clipboard.pens.push(e.clone());var i=this.findIndex(e);i>-1&&(e.type===g.Node&&this.divLayer.removeDiv(this.data.pens[i]),this.data.pens.splice(i,1))}this.cache(),this.activeLayer.clear(),this.hoverLayer.node=void 0,this.moveIn.hoverLine=void 0,this.moveIn.hoverNode=void 0,this.render(),this.dispatch("delete",this.clipboard.pens)}},r.prototype.copy=function(){this.clipboard=re({pens:[]});for(var t=0,e=this.activeLayer.pens;t<e.length;t++){var i=e[t];this.clipboard.pens.push(i.clone()),i.parentId=null}this.dispatch("copy",this.clipboard)},r.prototype.paste=function(){if(!(!this.clipboard||this.data.locked)){this.hoverLayer.node=void 0,this.hoverLayer.line=void 0,this.activeLayer.pens=[];for(var t={},e=0,i=this.clipboard.pens;e<i.length;e++){var n=i[e];n.type||(this.pastePen(n,t,20),this.data.pens.push(n),this.activeLayer.add(n))}for(var o=0,p=this.clipboard.pens;o<p.length;o++){var n=p[o];n.type&&(this.pastePen(n,t,20),this.data.pens.push(n),this.activeLayer.add(n))}this.render(),this.animate(!0),this.cache(),this.copy(),this.dispatch("paste",this.clipboard.pens)}},r.prototype.pastePen=function(t,e,i,n){if(e===void 0&&(e={}),i===void 0&&(i=0),t.type){if(t instanceof Ot){t.id=xt(),n&&(t.parentId=n),t.from=new R(t.from.x+i,t.from.y+i,t.from.direction,t.from.anchorIndex,e[t.from.id]),t.to=new R(t.to.x+i,t.to.y+i,t.to.direction,t.to.anchorIndex,e[t.to.id]);for(var p=[],b=0,z=t.controlPoints;b<z.length;b++){var U=z[b];p.push(new R(U.x+i,U.y+i))}t.controlPoints=p}}else{var o=t.id;t.id=xt(),e[o]=t.id,n&&(t.parentId=n),t.rect.x+=i,t.rect.ex+=i,t.rect.y+=i,t.rect.ey+=i,t.manualAnchors&&t.manualAnchors.forEach(function(yt){yt.x+=i,yt.y+=i}),t.points&&t.points.forEach(function(yt){yt.x+=i,yt.y+=i}),t.init()}if(t.children)for(var rt=0,ht=t.children;rt<ht.length;rt++){var ct=ht[rt];this.pastePen(ct,e,i,t.id)}},r.prototype.animate=function(t){t===void 0&&(t=!1),this.animateLayer.readyPlay(void 0,t),this.animateLayer.animate()},r.prototype.updateProps=function(t,e){t===void 0&&(t=!0),e||(e=this.activeLayer.pens);for(var i=0,n=e;i<n.length;i++){var o=n[i];if(o instanceof Nt){if(o.autoRect){var p=this.canvas.canvas.getContext("2d"),b=V(p,o);o.rect.width=b.width+o.lineWidth*2,o.rect.height=b.height}o.init(),o.initRect()}}this.activeLayer.updateLines(e),this.activeLayer.calcControlPoints(),this.activeLayer.saveNodeRects(),this.render(),t&&this.cache()},r.prototype.lock=function(t){this.data.locked=t;for(var e=0,i=this.data.pens;e<i.length;e++){var n=i[e];n.addToDiv&&n.addToDiv()}this.dispatch("locked",this.data.locked)},r.prototype.lockPens=function(t,e){for(var i=0,n=this.data.pens;i<n.length;i++)for(var o=n[i],p=0,b=t;p<b.length;p++){var z=b[p];if(o.id===z.id){o.locked=e,o.addToDiv&&o.addToDiv();break}}this.dispatch("lockPens",{pens:t,lock:e})},r.prototype.up=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1&&i!==e.length-1)e.splice(i+2,0,e[i]),e.splice(i,1);else{var n=T(e,t);if(!n)return;this.up(t,n.children)}},r.prototype.top=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1)e.push(e[i]),e.splice(i,1);else{var n=T(e,t);if(!n)return;this.top(t,n.children)}},r.prototype.down=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1&&i!==0)e.splice(i-1,0,e[i]),e.splice(i+1,1);else{var n=T(e,t);if(!n)return;this.down(t,n.children)}},r.prototype.bottom=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1)e.unshift(e[i]),e.splice(i+1,1);else{var n=T(e,t);if(!n)return;this.bottom(t,n.children)}},r.prototype.getParent=function(t){return T(this.data.pens,t)},r.prototype.combine=function(t,e){e===void 0&&(e=!1),t||(t=this.activeLayer.pens);for(var i=$t(t),n=0,o=t;n<o.length;n++){var p=o[n],b=this.findIndex(p);b>-1&&this.data.pens.splice(b,1)}for(var z=new Nt({name:"combine",rect:new a(i.x,i.y,i.width,i.height),text:"",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,strokeStyle:"transparent",children:[]}),b=0;b<t.length;++b)if(t[b].type===g.Node&&i.width===t[b].rect.width&&i.height===t[b].rect.height){z=t[b],z.children||(z.children=[]),t.splice(b,1);break}for(var U=0,rt=t;U<rt.length;U++){var p=rt[U];p.stand=e,p.parentId=z.id,p.calcRectInParent(z),z.children.push(p)}this.data.pens.push(z),this.activeLayer.setPens([z]),this.dispatch("combine",z),this.cache()},r.prototype.uncombine=function(t){if(t||(t=this.activeLayer.pens[0]),t instanceof Nt){for(var e=0,i=t.children;e<i.length;e++){var n=i[e];n.parentId=void 0,n.rectInParent=void 0,n.locked=Ht.None,this.data.pens.push(n)}var o=this.findIndex(t);o>-1&&t.name==="combine"?this.data.pens.splice(o,1):t.children=void 0,this.cache(),this.activeLayer.clear(),this.hoverLayer.clear(),this.dispatch("uncombine",t)}},r.prototype.find=function(t,e,i){var n;Array.isArray(e)?n=e:(n=this.data.pens,i=e);var o=x(t,n);return i?o:o.length===0?null:o.length===1?o[0]:o},r.prototype.findIndex=function(t,e){return e||(e=this.data.pens),e.findIndex(function(i){return i.id===t.id})},r.prototype.play=function(t,e){this.divLayer.play(t,e)},r.prototype.translate=function(t,e,i,n){var o=this;i||(this.lastTranlated.x=0,this.lastTranlated.y=0);var p=t-this.lastTranlated.x,b=e-this.lastTranlated.y;this.data.x+=p,this.data.y+=b,this.data.bkImageRect&&!this.data.bkImageStatic&&this.data.bkImageRect.translate(p,b),nt.Store.set(this.generateStoreKey("LT:updateLines"),this.data.pens),this.lastTranlated.x=t,this.lastTranlated.y=e,this.render(),this.divLayer.render(),this.animateLayer.stop(),this.cacheTimer&&clearTimeout(this.cacheTimer),this.cacheTimer=setTimeout(function(){var z;o.animateLayer.readyPlay(void 0,!0),o.animateLayer.animate(),(z=o.cache)===null||z===void 0||z.call(o)},300),n||this.dispatch("translate",{x:t,y:e}),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.translate(t,e)},r.prototype.scale=function(t,e,i){i===void 0&&(i=!0),this.data.scale*t<this.options.minScale?(t=this.options.minScale/this.data.scale,this.data.scale=this.options.minScale):this.data.scale*t>this.options.maxScale?(t=this.options.maxScale/this.data.scale,this.data.scale=this.options.maxScale):this.data.scale=Math.round(this.data.scale*t*100)/100,!e&&(e=$t(this.data.pens).center);for(var n=0,o=this.data.pens;n<o.length;n++){var p=o[n];p.scale(t,e)}if(this.data.bkImageRect&&!this.data.bkImageStatic){var b=new R(e.x+this.data.x,e.y+this.data.y);this.data.bkImageRect.scale(t,b)}nt.Store.set(this.generateStoreKey("LT:updateLines"),this.data.pens),nt.Store.set(this.generateStoreKey("LT:scale"),this.data.scale),this.render(),i&&this.cache(),this.dispatch("scale",this.data.scale)},r.prototype.scaleTo=function(t,e,i){i===void 0&&(i=!0),this.scale(t/this.data.scale,e,i)},r.prototype.round=function(){for(var t=0,e=this.data.pens;t<e.length;t++){var i=e[t];i instanceof Nt&&i.round()}},r.prototype.centerView=function(t){if(!!this.hasView()){var e=this.getRect(),i=this.getViewCenter(t),n=e.center;this.translate(i.x-n.x,i.y-n.y);var o=this.canvas.parentElem,p=(o.scrollWidth-o.offsetWidth)/2,b=(o.scrollHeight-o.offsetHeight)/2;return o.scrollTo(p,b),!0}},r.prototype.fitView=function(t){if(!!this.hasView()){var e=this.canvas.parentElem,i=e.offsetWidth,n=e.offsetHeight;this.resize({width:i,height:n});var o=we(t||this.options.viewPadding),p=this.getRect(),b=(i-o[1]-o[3])/p.width,z=(n-o[0]-o[2])/p.height,U=b;b>z&&(U=z),this.scale(U),this.centerView(t)}},r.prototype.hasView=function(){return!!this.data.pens.length},r.prototype.getViewCenter=function(t){var e=we(t||this.options.viewPadding),i=this.canvas,n=i.width,o=i.height;return{x:(n-e[1]-e[3])/2+e[3],y:(o-e[0]-e[2])/2+e[0]}},r.prototype.generateStoreKey=function(t){return this.id+"-"+t},r.prototype.createMarkdownTip=function(){var t=this;this.tipMarkdown=document.createElement("div"),this.tipMarkdown.className="topology-markdown",this.tipMarkdown.style.position="fixed",this.tipMarkdown.style.zIndex="-1",this.tipMarkdown.style.left="-9999px",this.tipMarkdown.style.padding="8px 0",this.tipMarkdown.onmouseleave=function(){t.hideTip(),t.moveIn.hoverLine=void 0,t.moveIn.hoverNode=void 0},this.tipMarkdownContent=document.createElement("div"),this.tipMarkdownContent.style.maxWidth="320px",this.tipMarkdownContent.style.outline="none",this.tipMarkdownContent.style.borderRadius="4px",this.tipMarkdownContent.style.backgroundColor="rgba(0,0,0,.6)",this.tipMarkdownContent.style.color="#fff",this.tipMarkdownContent.style.padding="8px 16px",this.tipMarkdownContent.style.lineHeight="1.8",this.tipMarkdownContent.style.overflowY="auto",this.tipMarkdownContent.style.minHeight="30px",this.tipMarkdownContent.style.maxHeight="400px",this.tipMarkdown.appendChild(this.tipMarkdownContent),this.tipMarkdownArrowUp=document.createElement("div"),this.tipMarkdownArrowUp.className="arrow",this.tipMarkdownArrowUp.style.position="absolute",this.tipMarkdownArrowUp.style.border="6px solid transparent",this.tipMarkdownArrowUp.style.backgroundColor="transparent",this.tipMarkdownArrowUp.style.left="50%",this.tipMarkdownArrowUp.style.transform="translateX(-50%)",this.tipMarkdownArrowUp.style.top="-4px",this.tipMarkdown.appendChild(this.tipMarkdownArrowUp),this.tipMarkdownArrowDown=document.createElement("div"),this.tipMarkdownArrowDown.className="arrow",this.tipMarkdownArrowDown.style.position="absolute",this.tipMarkdownArrowDown.style.border="6px solid transparent",this.tipMarkdownArrowDown.style.left="50%",this.tipMarkdownArrowDown.style.transform="translateX(-50%)",this.tipMarkdownArrowDown.style.backgroundColor="transparent",this.tipMarkdownArrowDown.style.bottom="-4px",this.tipMarkdown.appendChild(this.tipMarkdownArrowDown),document.body.appendChild(this.tipMarkdown)},r.prototype.showTip=function(t,e){if(!(!t||t.id===this.tip||this.data.tooltip===!1||this.data.tooltip===0)){if(t.title){this.divLayer.canvas.title=t.title,this.tip=t.id;return}t.tipId&&(this.tipElem=document.getElementById(t.tipId));var i=this.tipElem;if(t.markdown){i=this.tipMarkdown;var n=window.marked;n?this.tipMarkdownContent.innerHTML=n(t.markdown):this.tipMarkdownContent.innerHTML=t.markdown;for(var o=this.tipMarkdownContent.getElementsByTagName("A"),p=0;p<o.length;++p)o[p].setAttribute("target","_blank")}if(!!i){var b=this.parentElem.getBoundingClientRect(),z=i.getBoundingClientRect(),U=(b.left||b.x)-(z.width-t.rect.width)/2+this.data.x,rt=(b.top||b.y)-z.height-t.rect.height+this.data.y;U+=t.type?e.x:t.rect.x,rt+=t.type?e.y:t.rect.ey,rt>0?(this.tipMarkdownArrowUp.style.borderBottomColor="transparent",this.tipMarkdownArrowDown.style.borderTopColor="rgba(0,0,0,.6)"):(rt+=z.height+t.rect.height,this.tipMarkdownArrowUp.style.borderBottomColor="rgba(0,0,0,.6)",this.tipMarkdownArrowDown.style.borderTopColor="transparent"),i.style.display="block",i.style.position="fixed",i.style.left=U+"px",i.style.top=rt+"px",i.style.zIndex="100",this.tip=t.id,this.dispatch("tip",i)}}},r.prototype.hideTip=function(){!this.tip||(this.tipMarkdown.style.left="-9999px",this.tipMarkdown.style.zIndex="-1",this.tipElem&&(this.tipElem.style.left="-9999px",this.tipElem.style.zIndex="-1",this.tipElem=void 0),this.divLayer.canvas.title="",this.tip="")},r.prototype.scroll=function(t,e){var i=this;this.scrolling||(this.scrolling=!0,this.parentElem.scrollLeft+=t,this.parentElem.scrollTop+=e,setTimeout(function(){i.scrolling=!1},700))},r.prototype.toComponent=function(t){t||(t=this.data.pens);for(var e=$t(t),i=new Nt({name:"combine",rect:new a(e.x,e.y,e.width,e.height),text:"",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,strokeStyle:"transparent",children:[]}),n=0,o=t;n<o.length;n++){var p=o[n];if(p.type===g.Node&&e.width===p.rect.width&&e.height===p.rect.height){i=p,i.children||(i.children=[]);break}}for(var b=0,z=t;b<z.length;b++){var p=z[b];p!==i&&(p.parentId=i.id,p.calcRectInParent(i),i.children.push(p))}return i},r.prototype.clearBkImg=function(){this.canvas.clearBkImg()},r.prototype.dispatch=function(t,e){return this.options.on&&this.options.on(t,e),this.emit(t,e),this},r.prototype.on=function(t,e){return this._emitter.on(t,e),this},r.prototype.off=function(t,e){return this._emitter.off(t,e),this},r.prototype.emit=function(t,e){return this._emitter.emit(t,e),this},r.prototype.getValue=function(t,e){e===void 0&&(e="text");var i=this.find(t);if(!!i&&(Array.isArray(i)&&(i=i[0]),!!i))return i[e]},r.prototype.setValue=function(t,e,i){i===void 0&&(i="text"),typeof t=="object"&&(e=t,t=t.id||t.tag);var n=x(t,this.data.pens);n.forEach(function(o){(o.id===t||o.tags&&o.tags.indexOf(t)>-1)&&(typeof e=="object"?o.fromData(o,e):o[i]=e,o.doWheres(),o.type===g.Node&&(o.animateReady=Nt.cloneState(o)))}),this.willRender()},r.prototype.willRender=function(){var t=this;this.actionTimer||(this.actionTimer=setTimeout(function(){t.render(),t.actionTimer=void 0},100))},r.prototype.setLineName=function(t,e){e===void 0&&(e=!0),this.data.pens.forEach(function(i){i.type&&(i.name=t,i.calcControlPoints())}),e&&this.render()},r.prototype.setColor=function(t){this.options.color=t,nt.Store.set(this.generateStoreKey("LT:color"),t),this.options.fontColor=t,nt.Store.set(this.generateStoreKey("LT:fontColor"),t)},r.prototype.setFontColor=function(t){this.options.fontColor=t,nt.Store.set(this.generateStoreKey("LT:fontColor"),t)},r.prototype.setIconColor=function(t){nt.Store.set(this.generateStoreKey("LT:iconColor"),t)},r.prototype.setBkColor=function(t){this.data.bkColor=t,nt.Store.set("LT:bkColor",t)},r.prototype.pureData=function(){var t=this,e=JSON.parse(JSON.stringify(this.data));return e.pens.forEach(function(i){for(var n in i)(i[n]===void 0||i[n]===void 0)&&delete i[n];if(delete i.TID,delete i.animateCycleIndex,delete i.img,delete i.lastImage,delete i.fillImg,delete i.strokeImg,delete i.lastFillImage,delete i.lastStrokeImage,delete i.imgNaturalWidth,delete i.imgNaturalHeight,delete i.anchors,delete i.rotatedAnchors,delete i.dockWatchers,delete i.elementLoaded,delete i.elementRendered,delete i.animateReady,delete i.imageLoading,delete i.imageLoadingDom,i.animateFrames&&i.animateFrames.length)for(var o=0,p=i.animateFrames;o<p.length;o++){var b=p[o];b.initState&&(delete b.initState.TID,delete b.initState.animateCycleIndex,delete b.initState.img,delete b.initState.lastImage,delete b.initState.imgNaturalWidth,delete b.initState.imgNaturalHeight,delete b.initState.anchors,delete b.initState.rotatedAnchors,delete b.initState.dockWatchers,delete b.initState.elementLoaded,delete b.initState.elementRendered,delete b.initState.fillImg,delete b.initState.strokeImg,delete b.initState.lastFillImage,delete b.initState.lastStrokeImage),b.state&&(delete b.state.TID,delete b.state.animateCycleIndex,delete b.state.img,delete b.state.lastImage,delete b.state.imgNaturalWidth,delete b.state.imgNaturalHeight,delete b.state.anchors,delete b.state.rotatedAnchors,delete b.state.dockWatchers,delete b.state.elementLoaded,delete b.state.elementRendered,delete b.state.fillImg,delete b.state.strokeImg,delete b.state.lastFillImage,delete b.state.lastStrokeImage)}t.pureDataChildren(i)}),e},r.prototype.pureDataChildren=function(t){var e=this;!t.children||t.children.forEach(function(i){for(var n in i)(i[n]===void 0||i[n]===void 0||i[n]==="")&&delete i[n];delete i.TID,delete i.animateCycleIndex,delete i.img,delete i.lastImage,delete i.imgNaturalWidth,delete i.imgNaturalHeight,delete i.anchors,delete i.rotatedAnchors,delete i.dockWatchers,delete i.elementLoaded,delete i.elementRendered,delete i.animateReady,e.pureDataChildren(i)})},r.prototype.destroy=function(){switch(this.scrollDom&&this.scrollDom.destroy(),this.subcribe.unsubscribe(),this.subcribeRender.unsubscribe(),this.subcribeImage.unsubscribe(),this.subcribeAnimateEnd.unsubscribe(),this.subcribeAnimateMoved.unsubscribe(),this.subcribeMediaEnd.unsubscribe(),this.subcribeEmit.unsubscribe(),this.animateLayer.destroy(),this.divLayer.destroy(),this.canvas.destroy(),this.activeLayer.destroy(),this.hoverLayer.destroy(),this.offscreen.destroy(),document.body.removeChild(this.tipMarkdown),window.removeEventListener("resize",this.winResize),this.parentElem.removeEventListener("scroll",this.onScroll),window.removeEventListener("scroll",this.onScroll),document.removeEventListener("gesturestart",this.preventDefault),this.options.keydown){case wt.Document:document.removeEventListener("keydown",this.onkeydown);break;case wt.Canvas:this.divLayer.canvas.removeEventListener("keydown",this.onkeydown);break}this.closeSocket(),this.closeMqtt(),this.socketFn&&(this.off("websocket",this.socketFn),this.off("mqtt",this.socketFn)),this.cache=void 0,this.data=void 0,window.topology=void 0},r}()},19720:function(It,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var ft=function(){function nt(){}return nt.get=function(kt){var vt,wt=new RegExp("(^| )"+kt+"=([^;]*)(;|$)");return(vt=document.cookie.match(wt))?decodeURIComponent(vt[2]):""},nt.set=function(kt,vt,wt){var Tt=window,Lt=Tt.escape(kt)+"="+Tt.escape(vt)+";";if(wt||(wt={}),wt.expires){var At=new Date(new Date().getTime()+wt.expires*1e3*60*60*24);Lt+="expires="+At.toUTCString()+";"}wt.path&&(Lt+="path="+wt.path+";"),wt.domain&&(Lt+="domain="+wt.domain+";"),document.cookie=Lt},nt.delete=function(kt,vt){nt.get(kt)&&(vt||(vt={}),vt.expires=-1,nt.set(kt,"",vt))},nt}();mt.Cookie=ft},32362:function(It,mt,ft){"use strict";function nt(kt){for(var vt in kt)mt.hasOwnProperty(vt)||(mt[vt]=kt[vt])}Object.defineProperty(mt,"__esModule",{value:!0}),nt(ft(19720)),nt(ft(52960)),nt(ft(37763))},17346:function(It,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0}),mt.data={},mt.observers={}},37763:function(It,mt,ft){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var nt=ft(17346),kt=function(){function vt(wt,Tt,Lt){this.key="",this.id=wt,this.key=Tt,this.fn=Lt}return vt.prototype.unsubscribe=function(){delete nt.observers[this.id]},vt}();mt.Observer=kt},52960:function(It,mt,ft){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var nt=ft(17346),kt=ft(37763),vt=ft(32904),wt=function(){function Tt(){this.data={},this.observers={}}return Tt.prototype.get=function(Lt){return Tt.get(Lt,this.data)},Tt.prototype.set=function(Lt,At){Tt.set(Lt,At,this.data,this.observers)},Tt.prototype.updated=function(Lt){Tt.updated(Lt,this.data,this.observers)},Tt.prototype.subscribe=function(Lt,At){return Tt.subscribe(Lt,At,this.data,this.observers)},Tt.get=function(Lt,At){if(At||(At=nt.data),Lt===void 0)return At;for(var xt=Lt.split("."),D=0,Z=xt;D<Z.length;D++){var R=Z[D];if(At=At[R],At===void 0)break}return At},Tt.set=function(Lt,At,xt,D){xt||(xt=nt.data),D||(D=nt.observers);for(var Z=Lt.split("."),R=xt,P=0;P<Z.length-1;++P)R[Z[P]]||(R[Z[P]]={}),R=R[Z[P]];R[Z[Z.length-1]]=At;for(var x in D)Lt.indexOf(D[x].key)===0&&D[x].fn(Tt.get(D[x].key,xt))},Tt.updated=function(Lt,At,xt){xt||(xt=nt.observers);for(var D in xt)Lt.indexOf(xt[D].key)===0&&xt[D].fn(Tt.get(xt[D].key,At))},Tt.subscribe=function(Lt,At,xt,D){D||(D=nt.observers);var Z=vt.s8(),R=new kt.Observer(Z,Lt,At);D[Z]=R;var P=Tt.get(Lt,xt);return P!==void 0&&At(P),R},Tt}();mt.Store=wt},32904:function(It,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});function ft(){return((1+Math.random())*65536|0).toString(16).substring(1)}mt.s4=ft;function nt(){return ft()+ft()}mt.s8=nt},99053:function(It,mt,ft){var nt=ft(94043),kt=ft(79764),vt=ft(25102),wt=ft(21364),Tt=ft(46507),Lt=ft(30352),At=ft(37306),xt=ft(93450);(function(D){It.exports=D()})(function(){return function(){return function D(Z,R,P){function x(c,s){if(!R[c]){if(!Z[c]){var l=void 0;if(!s&&l)return require(c,!0);if(w)return w(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var a=R[c]={exports:{}};Z[c][0].call(a.exports,function(u){return x(Z[c][1][u]||u)},a,a.exports,D,Z,R,P)}return R[c].exports}for(var w=void 0,T=0;T<P.length;T++)x(P[T]);return x}}()({1:[function(D,Z,R){(function(P,x){(function(){"use strict";var w=D("events").EventEmitter,T=D("./store"),c=D("./topic-alias-recv"),s=D("./topic-alias-send"),l=D("mqtt-packet"),d=D("./default-message-id-provider"),a=D("readable-stream").Writable,u=D("inherits"),v=D("reinterval"),m=D("rfdc/default"),g=D("./validations"),k=D("xtend"),y=D("debug")("mqttjs:client"),C=P?P.nextTick:function(L){setTimeout(L,0)},M=x.setImmediate||function(L){C(L)},N={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},Y=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],_={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function G(L,E){var V;E.properties&&(V=E.properties.topicAlias);var $=E.topic.toString();if($.length===0){if(V===void 0)return new Error("Unregistered Topic Alias");if(($=L.topicAliasSend.getTopicByAlias(V))===void 0)return new Error("Unregistered Topic Alias");E.topic=$}V&&delete E.properties.topicAlias}function et(L,E,V){y("sendPacket :: packet: %O",E),y("sendPacket :: emitting `packetsend`"),L.emit("packetsend",E),y("sendPacket :: writing to stream");var $=l.writeToStream(E,L.stream,L.options);y("sendPacket :: writeToStream result %s",$),!$&&V&&V!==S?(y("sendPacket :: handle events on `drain` once through callback."),L.stream.once("drain",V)):V&&(y("sendPacket :: invoking cb"),V())}function B(L,E,V,$){y("storeAndSend :: store packet with cmd %s to outgoingStore",E.cmd);var W,F=E;if(F.cmd==="publish"&&(F=m(E),W=G(L,F)))return V&&V(W);L.outgoingStore.put(F,function(j){if(j)return V&&V(j);$(),et(L,E,V)})}function S(L){y("nop ::",L)}function A(L,E){var V,$=this;if(!(this instanceof A))return new A(L,E);for(V in this.options=E||{},N)this.options[V]===void 0?this.options[V]=N[V]:this.options[V]=E[V];y("MqttClient :: options.protocol",E.protocol),y("MqttClient :: options.protocolVersion",E.protocolVersion),y("MqttClient :: options.username",E.username),y("MqttClient :: options.keepalive",E.keepalive),y("MqttClient :: options.reconnectPeriod",E.reconnectPeriod),y("MqttClient :: options.rejectUnauthorized",E.rejectUnauthorized),y("MqttClient :: options.topicAliasMaximum",E.topicAliasMaximum),this.options.clientId=typeof E.clientId=="string"?E.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),y("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=E.protocolVersion===5&&E.customHandleAcks?E.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=L,this.messageIdProvider=this.options.messageIdProvider===void 0?new d:this.options.messageIdProvider,this.outgoingStore=E.outgoingStore||new T,this.incomingStore=E.incomingStore||new T,this.queueQoSZero=E.queueQoSZero===void 0||E.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,E.topicAliasMaximum>0&&(E.topicAliasMaximum>65535?y("MqttClient :: options.topicAliasMaximum is out of range"):this.topicAliasRecv=new c(E.topicAliasMaximum)),this.on("connect",function(){var W=this.queue;y("connect :: sending queued packets"),function F(){var j=W.shift();y("deliver :: entry %o",j);var q=null;if(!j)return void $._resubscribe();q=j.packet,y("deliver :: call _sendPacket for %o",q);var H=!0;q.messageId&&q.messageId!==0&&($.messageIdProvider.register(q.messageId)||(H=!1)),H?$._sendPacket(q,function(J){j.cb&&j.cb(J),F()}):(y("messageId: %d has already used. The message is skipped and removed.",q.messageId),F())}()}),this.on("close",function(){y("close :: connected set to `false`"),this.connected=!1,y("close :: clearing connackTimer"),clearTimeout(this.connackTimer),y("close :: clearing ping timer"),$.pingTimer!==null&&($.pingTimer.clear(),$.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),y("close :: calling _setupReconnect"),this._setupReconnect()}),w.call(this),y("MqttClient :: setting up stream"),this._setupStream()}u(A,w),A.prototype._setupStream=function(){var L=this,E=this,V=new a,$=l.parser(this.options),W=null,F=[];function j(){if(F.length)C(q);else{var J=W;W=null,J()}}function q(){y("work :: getting next packet in queue");var J=F.shift();if(J)y("work :: packet pulled from queue"),E._handlePacket(J,j);else{y("work :: no packets in queue");var K=W;W=null,y("work :: done flag is %s",!!K),K&&K()}}y("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),y("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),$.on("packet",function(J){y("parser :: on packet push to packets array."),F.push(J)}),V._write=function(J,K,tt){W=tt,y("writable stream :: parsing buffer"),$.parse(J),q()},y("_setupStream :: pipe stream to writable stream"),this.stream.pipe(V),this.stream.on("error",function(J){y("streamErrorHandler :: error",J.message),Y.includes(J.code)?(y("streamErrorHandler :: emitting error"),E.emit("error",J)):S(J)}),this.stream.on("close",function(){var J;y("(%s)stream :: on close",E.options.clientId),(J=E.outgoing)&&(y("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(J).forEach(function(K){J[K].volatile&&typeof J[K].cb=="function"&&(J[K].cb(new Error("Connection closed")),delete J[K])})),y("stream: emit close to MqttClient"),E.emit("close")}),y("_setupStream: sending packet `connect`");var H=Object.create(this.options);if(H.cmd="connect",this.topicAliasRecv&&(H.properties||(H.properties={}),this.topicAliasRecv&&(H.properties.topicAliasMaximum=this.topicAliasRecv.max)),et(this,H),$.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return E.end(function(){return L.emit("error",new Error("Packet has no Authentication Method"))}),this;this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"&&et(this,k({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){y("!!connectTimeout hit!! Calling _cleanUp with force `true`"),E._cleanUp(!0)},this.options.connectTimeout)},A.prototype._handlePacket=function(L,E){var V=this.options;if(V.protocolVersion===5&&V.properties&&V.properties.maximumPacketSize&&V.properties.maximumPacketSize<L.length)return this.emit("error",new Error("exceeding packets size "+L.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(y("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",L),L.cmd){case"publish":this._handlePublish(L,E);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(L),E();break;case"pubrel":this._handlePubrel(L,E);break;case"connack":this._handleConnack(L),E();break;case"auth":this._handleAuth(L),E();break;case"pingresp":this._handlePingresp(L),E();break;case"disconnect":this._handleDisconnect(L),E()}},A.prototype._checkDisconnecting=function(L){return this.disconnecting&&(L&&L!==S?L(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},A.prototype.publish=function(L,E,V,$){y("publish :: message `%s` to topic `%s`",E,L);var W=this.options;if(typeof V=="function"&&($=V,V=null),V=k({qos:0,retain:!1,dup:!1},V),this._checkDisconnecting($))return this;var F=this,j=function(){var H=0;if((V.qos===1||V.qos===2)&&(H=F._nextId())===null)return y("No messageId left"),!1;var J={cmd:"publish",topic:L,payload:E,qos:V.qos,retain:V.retain,messageId:H,dup:V.dup};switch(W.protocolVersion===5&&(J.properties=V.properties),y("publish :: qos",V.qos),V.qos){case 1:case 2:F.outgoing[J.messageId]={volatile:!1,cb:$||S},y("MqttClient:publish: packet cmd: %s",J.cmd),F._sendPacket(J,void 0,V.cbStorePut);break;default:y("MqttClient:publish: packet cmd: %s",J.cmd),F._sendPacket(J,$,V.cbStorePut)}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!j())&&this._storeProcessingQueue.push({invoke:j,cbStorePut:V.cbStorePut,callback:$}),this},A.prototype.subscribe=function(){for(var L=this,E=new Array(arguments.length),V=0;V<arguments.length;V++)E[V]=arguments[V];var $=[],W=E.shift(),F=W.resubscribe,j=E.pop()||S,q=E.pop(),H=this.options.protocolVersion;delete W.resubscribe,typeof W=="string"&&(W=[W]),typeof j!="function"&&(q=j,j=S);var J=g.validateTopics(W);if(J!==null)return M(j,new Error("Invalid topic "+J)),this;if(this._checkDisconnecting(j))return y("subscribe: discconecting true"),this;var K={qos:0};if(H===5&&(K.nl=!1,K.rap=!1,K.rh=0),q=k(K,q),Array.isArray(W)?W.forEach(function(at){if(y("subscribe: array topic %s",at),!Object.prototype.hasOwnProperty.call(L._resubscribeTopics,at)||L._resubscribeTopics[at].qos<q.qos||F){var it={topic:at,qos:q.qos};H===5&&(it.nl=q.nl,it.rap=q.rap,it.rh=q.rh,it.properties=q.properties),y("subscribe: pushing topic `%s` and qos `%s` to subs list",it.topic,it.qos),$.push(it)}}):Object.keys(W).forEach(function(at){if(y("subscribe: object topic %s",at),!Object.prototype.hasOwnProperty.call(L._resubscribeTopics,at)||L._resubscribeTopics[at].qos<W[at].qos||F){var it={topic:at,qos:W[at].qos};H===5&&(it.nl=W[at].nl,it.rap=W[at].rap,it.rh=W[at].rh,it.properties=q.properties),y("subscribe: pushing `%s` to subs list",it),$.push(it)}}),!$.length)return j(null,[]),this;var tt=function(){var it=L._nextId();if(it===null)return y("No messageId left"),!1;var st={cmd:"subscribe",subscriptions:$,qos:1,retain:!1,dup:!1,messageId:it};if(q.properties&&(st.properties=q.properties),L.options.resubscribe){y("subscribe :: resubscribe true");var h=[];$.forEach(function(f){if(L.options.reconnectPeriod>0){var I={qos:f.qos};H===5&&(I.nl=f.nl||!1,I.rap=f.rap||!1,I.rh=f.rh||0,I.properties=f.properties),L._resubscribeTopics[f.topic]=I,h.push(f.topic)}}),L.messageIdToTopic[st.messageId]=h}return L.outgoing[st.messageId]={volatile:!0,cb:function(I,O){if(!I)for(var X=O.granted,Q=0;Q<X.length;Q+=1)$[Q].qos=X[Q];j(I,$)}},y("subscribe :: call _sendPacket"),L._sendPacket(st),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!tt())&&this._storeProcessingQueue.push({invoke:tt,callback:j}),this},A.prototype.unsubscribe=function(){for(var L=this,E=new Array(arguments.length),V=0;V<arguments.length;V++)E[V]=arguments[V];var $=E.shift(),W=E.pop()||S,F=E.pop();typeof $=="string"&&($=[$]),typeof W!="function"&&(F=W,W=S);var j=g.validateTopics($);if(j!==null)return M(W,new Error("Invalid topic "+j)),this;if(L._checkDisconnecting(W))return this;var q=function(){var J=L._nextId();if(J===null)return y("No messageId left"),!1;var K={cmd:"unsubscribe",qos:1,messageId:J};return typeof $=="string"?K.unsubscriptions=[$]:Array.isArray($)&&(K.unsubscriptions=$),L.options.resubscribe&&K.unsubscriptions.forEach(function(tt){delete L._resubscribeTopics[tt]}),typeof F=="object"&&F.properties&&(K.properties=F.properties),L.outgoing[K.messageId]={volatile:!0,cb:W},y("unsubscribe: call _sendPacket"),L._sendPacket(K),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!q())&&this._storeProcessingQueue.push({invoke:q,callback:W}),this},A.prototype.end=function(L,E,V){var $=this;function W(){y("end :: (%s) :: finish :: calling _cleanUp with force %s",$.options.clientId,L),$._cleanUp(L,function(){y("end :: finish :: calling process.nextTick on closeStores"),C(function(){y("end :: closeStores: closing incoming and outgoing stores"),$.disconnected=!0,$.incomingStore.close(function(F){$.outgoingStore.close(function(j){if(y("end :: closeStores: emitting end"),$.emit("end"),V){var q=F||j;y("end :: closeStores: invoking callback with args"),V(q)}})}),$._deferredReconnect&&$._deferredReconnect()}.bind($))},E)}return y("end :: (%s)",this.options.clientId),L!=null&&typeof L=="boolean"||(V=E||S,E=L,L=!1,typeof E!="object"&&(V=E,E=null,typeof V!="function"&&(V=S))),typeof E!="object"&&(V=E,E=null),y("end :: cb? %s",!!V),V=V||S,this.disconnecting?(V(),this):(this._clearReconnect(),this.disconnecting=!0,!L&&Object.keys(this.outgoing).length>0?(y("end :: (%s) :: calling finish in 10ms once outgoing is empty",$.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,W,10))):(y("end :: (%s) :: immediately calling finish",$.options.clientId),W()),this)},A.prototype.removeOutgoingMessage=function(L){var E=this.outgoing[L]?this.outgoing[L].cb:null;return delete this.outgoing[L],this.outgoingStore.del({messageId:L},function(){E(new Error("Message removed"))}),this},A.prototype.reconnect=function(L){y("client reconnect");var E=this,V=function(){L?(E.options.incomingStore=L.incomingStore,E.options.outgoingStore=L.outgoingStore):(E.options.incomingStore=null,E.options.outgoingStore=null),E.incomingStore=E.options.incomingStore||new T,E.outgoingStore=E.options.outgoingStore||new T,E.disconnecting=!1,E.disconnected=!1,E._deferredReconnect=null,E._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=V:V(),this},A.prototype._reconnect=function(){var L=this;y("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(function(){L._setupStream()}),y("client already connected. disconnecting first.")):(y("_reconnect: calling _setupStream"),this._setupStream())},A.prototype._setupReconnect=function(){var L=this;!L.disconnecting&&!L.reconnectTimer&&L.options.reconnectPeriod>0?(this.reconnecting||(y("_setupReconnect :: emit `offline` state"),this.emit("offline"),y("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),y("_setupReconnect :: setting reconnectTimer for %d ms",L.options.reconnectPeriod),L.reconnectTimer=setInterval(function(){y("reconnectTimer :: reconnect triggered!"),L._reconnect()},L.options.reconnectPeriod)):y("_setupReconnect :: doing nothing...")},A.prototype._clearReconnect=function(){y("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},A.prototype._cleanUp=function(L,E){var V=arguments[2];if(E&&(y("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",E)),y("_cleanUp :: forced? %s",L),L)this.options.reconnectPeriod===0&&this.options.clean&&(W=this.outgoing)&&(y("flush: queue exists? %b",!!W),Object.keys(W).forEach(function(F){typeof W[F].cb=="function"&&(W[F].cb(new Error("Connection closed")),delete W[F])})),y("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{var $=k({cmd:"disconnect"},V);y("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket($,M.bind(null,this.stream.end.bind(this.stream)))}var W;this.disconnecting||(y("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer!==null&&(y("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),E&&!this.connected&&(y("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",E),E())},A.prototype._sendPacket=function(L,E,V){y("_sendPacket :: (%s) ::  start",this.options.clientId),V=V||S,E=E||S;var $=function(W,F){if(W.options.protocolVersion===5&&F.cmd==="publish"){var j;F.properties&&(j=F.properties.topicAlias);var q=F.topic.toString();if(W.topicAliasSend)if(j){if(q.length!==0&&(y("applyTopicAlias :: register topic: %s - alias: %d",q,j),!W.topicAliasSend.put(q,j)))return y("applyTopicAlias :: error out of range. topic: %s - alias: %d",q,j),new Error("Sending Topic Alias out of range")}else q.length!==0&&(W.options.autoAssignTopicAlias?(j=W.topicAliasSend.getAliasByTopic(q))?(F.topic="",F.properties=xt(xt({},F.properties),{},{topicAlias:j}),y("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",q,j)):(j=W.topicAliasSend.getLruAlias(),W.topicAliasSend.put(q,j),F.properties=xt(xt({},F.properties),{},{topicAlias:j}),y("applyTopicAlias :: auto assign topic: %s - alias: %d",q,j)):W.options.autoUseTopicAlias&&(j=W.topicAliasSend.getAliasByTopic(q))&&(F.topic="",F.properties=xt(xt({},F.properties),{},{topicAlias:j}),y("applyTopicAlias :: auto use topic: %s - alias: %d",q,j)));else if(j)return y("applyTopicAlias :: error out of range. topic: %s - alias: %d",q,j),new Error("Sending Topic Alias out of range")}}(this,L);if($)E($);else{if(!this.connected)return L.cmd==="auth"?(this._shiftPingInterval(),void et(this,L,E)):(y("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(L,E,V));switch(this._shiftPingInterval(),L.cmd){case"publish":break;case"pubrel":return void B(this,L,E,V);default:return void et(this,L,E)}switch(L.qos){case 2:case 1:B(this,L,E,V);break;case 0:default:et(this,L,E)}y("_sendPacket :: (%s) ::  end",this.options.clientId)}},A.prototype._storePacket=function(L,E,V){y("_storePacket :: packet: %o",L),y("_storePacket :: cb? %s",!!E),V=V||S;var $=L;if($.cmd==="publish"){var W=G(this,$=m(L));if(W)return E&&E(W)}($.qos||0)===0&&this.queueQoSZero||$.cmd!=="publish"?this.queue.push({packet:$,cb:E}):$.qos>0?(E=this.outgoing[$.messageId]?this.outgoing[$.messageId].cb:null,this.outgoingStore.put($,function(F){if(F)return E&&E(F);V()})):E&&E(new Error("No connection to broker"))},A.prototype._setupPingTimer=function(){y("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);var L=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=v(function(){L._checkPing()},1e3*this.options.keepalive))},A.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},A.prototype._checkPing=function(){y("_checkPing :: checking ping..."),this.pingResp?(y("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(y("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))},A.prototype._handlePingresp=function(){this.pingResp=!0},A.prototype._handleConnack=function(L){y("_handleConnack");var E=this.options,V=E.protocolVersion===5?L.reasonCode:L.returnCode;if(clearTimeout(this.connackTimer),delete this.topicAliasSend,L.properties){if(L.properties.topicAliasMaximum){if(L.properties.topicAliasMaximum>65535)return void this.emit("error",new Error("topicAliasMaximum from broker is out of range"));L.properties.topicAliasMaximum>0&&(this.topicAliasSend=new s(L.properties.topicAliasMaximum))}L.properties.serverKeepAlive&&E.keepalive&&(E.keepalive=L.properties.serverKeepAlive,this._shiftPingInterval()),L.properties.maximumPacketSize&&(E.properties||(E.properties={}),E.properties.maximumPacketSize=L.properties.maximumPacketSize)}if(V===0)this.reconnecting=!1,this._onConnect(L);else if(V>0){var $=new Error("Connection refused: "+_[V]);$.code=V,this.emit("error",$)}},A.prototype._handleAuth=function(L){var E=this.options.protocolVersion,V=E===5?L.reasonCode:L.returnCode;if(E!==5){var $=new Error("Protocol error: Auth packets are only supported in MQTT 5. Your version:"+E);return $.code=V,void this.emit("error",$)}var W=this;this.handleAuth(L,function(F,j){if(F)W.emit("error",F);else if(V===24)W.reconnecting=!1,W._sendPacket(j);else{var q=new Error("Connection refused: "+_[V]);F.code=V,W.emit("error",q)}})},A.prototype.handleAuth=function(L,E){E()},A.prototype._handlePublish=function(L,E){y("_handlePublish: packet %o",L),E=E!==void 0?E:S;var V=L.topic.toString(),$=L.payload,W=L.qos,F=L.messageId,j=this,q=this.options,H=[0,16,128,131,135,144,145,151,153];if(this.options.protocolVersion===5){var J;if(L.properties&&(J=L.properties.topicAlias),J!==void 0)if(V.length===0){if(!(J>0&&J<=65535))return y("_handlePublish :: topic alias out of range. alias: %d",J),void this.emit("error",new Error("Received Topic Alias is out of range"));{var K=this.topicAliasRecv.getTopicByAlias(J);if(!K)return y("_handlePublish :: unregistered topic alias. alias: %d",J),void this.emit("error",new Error("Received unregistered Topic Alias"));y("_handlePublish :: topic complemented by alias. topic: %s - alias: %d",V=K,J)}}else{if(!this.topicAliasRecv.put(V,J))return y("_handlePublish :: topic alias out of range. alias: %d",J),void this.emit("error",new Error("Received Topic Alias is out of range"));y("_handlePublish :: registered topic: %s - alias: %d",V,J)}}switch(y("_handlePublish: qos %d",W),W){case 2:q.customHandleAcks(V,$,L,function(tt,at){return tt instanceof Error||(at=tt,tt=null),tt?j.emit("error",tt):H.indexOf(at)===-1?j.emit("error",new Error("Wrong reason code for pubrec")):void(at?j._sendPacket({cmd:"pubrec",messageId:F,reasonCode:at},E):j.incomingStore.put(L,function(){j._sendPacket({cmd:"pubrec",messageId:F},E)}))});break;case 1:q.customHandleAcks(V,$,L,function(tt,at){return tt instanceof Error||(at=tt,tt=null),tt?j.emit("error",tt):H.indexOf(at)===-1?j.emit("error",new Error("Wrong reason code for puback")):(at||j.emit("message",V,$,L),void j.handleMessage(L,function(it){if(it)return E&&E(it);j._sendPacket({cmd:"puback",messageId:F,reasonCode:at},E)}))});break;case 0:this.emit("message",V,$,L),this.handleMessage(L,E);break;default:y("_handlePublish: unknown QoS. Doing nothing.")}},A.prototype.handleMessage=function(L,E){E()},A.prototype._handleAck=function(L){var E=L.messageId,V=L.cmd,$=null,W=this.outgoing[E]?this.outgoing[E].cb:null,F=this,j;if(W){switch(y("_handleAck :: packet type",V),V){case"pubcomp":case"puback":{var q=L.reasonCode;q&&q>0&&q!==16&&((j=new Error("Publish error: "+_[q])).code=q,W(j,L)),delete this.outgoing[E],this.outgoingStore.del(L,W),this.messageIdProvider.deallocate(E),this._invokeStoreProcessingQueue();break}case"pubrec":{$={cmd:"pubrel",qos:2,messageId:E};var H=L.reasonCode;H&&H>0&&H!==16?((j=new Error("Publish error: "+_[H])).code=H,W(j,L)):this._sendPacket($);break}case"suback":delete this.outgoing[E],this.messageIdProvider.deallocate(E);for(var J=0;J<L.granted.length;J++)if((128&L.granted[J])!=0){var K=this.messageIdToTopic[E];K&&K.forEach(function(tt){delete F._resubscribeTopics[tt]})}this._invokeStoreProcessingQueue(),W(null,L);break;case"unsuback":delete this.outgoing[E],this.messageIdProvider.deallocate(E),this._invokeStoreProcessingQueue(),W(null);break;default:F.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&Object.keys(this.outgoing).length===0&&this.emit("outgoingEmpty")}else y("_handleAck :: Server sent an ack in error. Ignoring.")},A.prototype._handlePubrel=function(L,E){y("handling pubrel packet"),E=E!==void 0?E:S;var V=this,$={cmd:"pubcomp",messageId:L.messageId};V.incomingStore.get(L,function(W,F){W?V._sendPacket($,E):(V.emit("message",F.topic,F.payload,F),V.handleMessage(F,function(j){if(j)return E(j);V.incomingStore.del(F,S),V._sendPacket($,E)}))})},A.prototype._handleDisconnect=function(L){this.emit("disconnect",L)},A.prototype._nextId=function(){return this.messageIdProvider.allocate()},A.prototype.getLastMessageId=function(){return this.messageIdProvider.getLastAllocated()},A.prototype._resubscribe=function(){y("_resubscribe");var L=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion===5&&!this.connackPacket.sessionPresent)&&L.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){y("_resubscribe: protocolVersion 5");for(var E=0;E<L.length;E++){var V={};V[L[E]]=this._resubscribeTopics[L[E]],V.resubscribe=!0,this.subscribe(V,{properties:V[L[E]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},A.prototype._onConnect=function(L){if(this.disconnected)return void this.emit("connect",L);var E=this;this.connackPacket=L,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0,function V(){var $=E.outgoingStore.createStream();function W(){E._storeProcessing=!1,E._packetIdsDuringStoreProcessing={}}function F(){$.destroy(),$=null,E._flushStoreProcessingQueue(),W()}E.once("close",F),$.on("error",function(j){W(),E._flushStoreProcessingQueue(),E.removeListener("close",F),E.emit("error",j)}),$.on("end",function(){var j=!0;for(var q in E._packetIdsDuringStoreProcessing)if(!E._packetIdsDuringStoreProcessing[q]){j=!1;break}j?(W(),E.removeListener("close",F),E._invokeAllStoreProcessingQueue(),E.emit("connect",L)):V()}),function j(){if(!!$){E._storeProcessing=!0;var q=$.read(1),H;q?E._packetIdsDuringStoreProcessing[q.messageId]?j():E.disconnecting||E.reconnectTimer?$.destroy&&$.destroy():(H=E.outgoing[q.messageId]?E.outgoing[q.messageId].cb:null,E.outgoing[q.messageId]={volatile:!1,cb:function(K,tt){H&&H(K,tt),j()}},E._packetIdsDuringStoreProcessing[q.messageId]=!0,E.messageIdProvider.register(q.messageId)?E._sendPacket(q):y("messageId: %d has already used.",q.messageId)):$.once("readable",j)}}()}()},A.prototype._invokeStoreProcessingQueue=function(){if(this._storeProcessingQueue.length>0){var L=this._storeProcessingQueue[0];if(L&&L.invoke())return this._storeProcessingQueue.shift(),!0}return!1},A.prototype._invokeAllStoreProcessingQueue=function(){for(;this._invokeStoreProcessingQueue(););},A.prototype._flushStoreProcessingQueue=function(){var L=At(this._storeProcessingQueue),E;try{for(L.s();!(E=L.n()).done;){var V=E.value;V.cbStorePut&&V.cbStorePut(new Error("Connection closed")),V.callback&&V.callback(new Error("Connection closed"))}}catch($){L.e($)}finally{L.f()}this._storeProcessingQueue.splice(0)},Z.exports=A}).call(this)}).call(this,D("_process"),typeof ft.g!="undefined"?ft.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./default-message-id-provider":7,"./store":8,"./topic-alias-recv":9,"./topic-alias-send":10,"./validations":11,_process:50,debug:18,events:22,inherits:24,"mqtt-packet":40,"readable-stream":69,reinterval:70,"rfdc/default":71,xtend:81}],2:[function(D,Z,R){"use strict";var P=D("buffer"),x=P.Buffer,w=D("readable-stream").Transform,T=D("duplexify"),c,s,l,d=!1;Z.exports=function(a,u){if(u.hostname=u.hostname||u.host,!u.hostname)throw new Error("Could not determine host. Specify host manually.");var v=u.protocolId==="MQIsdp"&&u.protocolVersion===3?"mqttv3.1":"mqtt";(function(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})})(u);var m=function(g,k){var y=g.protocol==="alis"?"wss":"ws",C=y+"://"+g.hostname+g.path;return g.port&&g.port!==80&&g.port!==443&&(C=y+"://"+g.hostname+":"+g.port+g.path),typeof g.transformWsUrl=="function"&&(C=g.transformWsUrl(C,g,k)),C}(u,a);return(c=u.my).connectSocket({url:m,protocols:v}),s=function(){var g=new w;return g._write=function(k,y,C){c.sendSocketMessage({data:k.buffer,success:function(){C()},fail:function(){C(new Error)}})},g._flush=function(k){c.closeSocket({success:function(){k()}})},g}(),l=T.obj(),d||(d=!0,c.onSocketOpen(function(){l.setReadable(s),l.setWritable(s),l.emit("connect")}),c.onSocketMessage(function(g){if(typeof g.data=="string"){var k=x.from(g.data,"base64");s.push(k)}else{var y=new FileReader;y.addEventListener("load",function(){var C=y.result;C=C instanceof ArrayBuffer?x.from(C):x.from(C,"utf8"),s.push(C)}),y.readAsArrayBuffer(g.data)}}),c.onSocketClose(function(){l.end(),l.destroy()}),c.onSocketError(function(g){l.destroy(g)})),l}},{buffer:17,duplexify:20,"readable-stream":69}],3:[function(D,Z,R){"use strict";var P=D("net"),x=D("debug")("mqttjs:tcp");Z.exports=function(w,T){T.port=T.port||1883,T.hostname=T.hostname||T.host||"localhost";var c=T.port,s=T.hostname;return x("port %d and host %s",c,s),P.createConnection(c,s)}},{debug:18,net:16}],4:[function(D,Z,R){"use strict";var P=D("tls"),x=D("net"),w=D("debug")("mqttjs:tls");Z.exports=function(T,c){c.port=c.port||8883,c.host=c.hostname||c.host||"localhost",x.isIP(c.host)===0&&(c.servername=c.host),c.rejectUnauthorized=c.rejectUnauthorized!==!1,delete c.path,w("port %d host %s rejectUnauthorized %b",c.port,c.host,c.rejectUnauthorized);var s=P.connect(c);function l(d){c.rejectUnauthorized&&T.emit("error",d),s.end()}return s.on("secureConnect",function(){c.rejectUnauthorized&&!s.authorized?s.emit("error",new Error("TLS not authorized")):s.removeListener("error",l)}),s.on("error",l),s}},{debug:18,net:16,tls:16}],5:[function(D,Z,R){(function(P){(function(){"use strict";var x=D("buffer"),w=x.Buffer,T=D("ws"),c=D("debug")("mqttjs:ws"),s=D("duplexify"),l=D("readable-stream").Transform,d=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],a=P!==void 0&&P.title==="browser"||typeof ft=="function";function u(m,g){var k=m.protocol+"://"+m.hostname+":"+m.port+m.path;return typeof m.transformWsUrl=="function"&&(k=m.transformWsUrl(k,m,g)),k}function v(m){var g=m;return m.hostname||(g.hostname="localhost"),m.port||(m.protocol==="wss"?g.port=443:g.port=80),m.path||(g.path="/"),m.wsOptions||(g.wsOptions={}),a||m.protocol!=="wss"||d.forEach(function(k){Object.prototype.hasOwnProperty.call(m,k)&&!Object.prototype.hasOwnProperty.call(m.wsOptions,k)&&(g.wsOptions[k]=m[k])}),g}Z.exports=a?function(m,g){var k;c("browserStreamBuilder");var y=function(L){var E=v(L);if(E.hostname||(E.hostname=E.host),!E.hostname){if(typeof document=="undefined")throw new Error("Could not determine host. Specify host manually.");var V=new URL(document.URL);E.hostname=V.hostname,E.port||(E.port=V.port)}return E.objectMode===void 0&&(E.objectMode=!(E.binary===!0||E.binary===void 0)),E}(g).browserBufferSize||524288,C=g.browserBufferTimeout||1e3,M=!g.objectMode,N=function(L,E){var V=E.protocolId==="MQIsdp"&&E.protocolVersion===3?"mqttv3.1":"mqtt",$=u(E,L),W=new WebSocket($,[V]);return W.binaryType="arraybuffer",W}(m,g),Y=function(L,E,V){var $=new l({objectModeMode:L.objectMode});return $._write=E,$._flush=V,$}(g,function L(E,V,$){N.bufferedAmount>y&&setTimeout(L,C,E,V,$),M&&typeof E=="string"&&(E=w.from(E,"utf8"));try{N.send(E)}catch(W){return $(W)}$()},function(L){N.close(),L()});g.objectMode||(Y._writev=A),Y.on("close",function(){N.close()});var _=N.addEventListener!==void 0;function G(){k.setReadable(Y),k.setWritable(Y),k.emit("connect")}function et(){k.end(),k.destroy()}function B(L){k.destroy(L)}function S(L){var E=L.data;E=E instanceof ArrayBuffer?w.from(E):w.from(E,"utf8"),Y.push(E)}function A(L,E){for(var V=new Array(L.length),$=0;$<L.length;$++)typeof L[$].chunk=="string"?V[$]=w.from(L[$],"utf8"):V[$]=L[$].chunk;this._write(w.concat(V),"binary",E)}return N.readyState===N.OPEN?k=Y:(k=k=s(void 0,void 0,g),g.objectMode||(k._writev=A),_?N.addEventListener("open",G):N.onopen=G),k.socket=N,_?(N.addEventListener("close",et),N.addEventListener("error",B),N.addEventListener("message",S)):(N.onclose=et,N.onerror=B,N.onmessage=S),k}:function(m,g){c("streamBuilder");var k=v(g),y=u(k,m),C=function(N,Y,_){c("createWebSocket"),c("protocol: "+_.protocolId+" "+_.protocolVersion);var G=_.protocolId==="MQIsdp"&&_.protocolVersion===3?"mqttv3.1":"mqtt";return c("creating new Websocket for url: "+Y+" and protocol: "+G),new T(Y,[G],_.wsOptions)}(0,y,k),M=T.createWebSocketStream(C,k.wsOptions);return M.url=y,C.on("close",function(){M.destroy()}),M}}).call(this)}).call(this,D("_process"))},{_process:50,buffer:17,debug:18,duplexify:20,"readable-stream":69,ws:80}],6:[function(D,Z,R){"use strict";var P=D("buffer"),x=P.Buffer,w=D("readable-stream").Transform,T=D("duplexify"),c,s,l;Z.exports=function(d,a){if(a.hostname=a.hostname||a.host,!a.hostname)throw new Error("Could not determine host. Specify host manually.");var u=a.protocolId==="MQIsdp"&&a.protocolVersion===3?"mqttv3.1":"mqtt";(function(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})})(a);var v=function(g,k){var y=g.protocol==="wxs"?"wss":"ws",C=y+"://"+g.hostname+g.path;return g.port&&g.port!==80&&g.port!==443&&(C=y+"://"+g.hostname+":"+g.port+g.path),typeof g.transformWsUrl=="function"&&(C=g.transformWsUrl(C,g,k)),C}(a,d);c=wx.connectSocket({url:v,protocols:[u]}),s=function(){var g=new w;return g._write=function(k,y,C){c.send({data:k.buffer,success:function(){C()},fail:function(N){C(new Error(N))}})},g._flush=function(k){c.close({success:function(){k()}})},g}(),(l=T.obj())._destroy=function(g,k){c.close({success:function(){k&&k(g)}})};var m=l.destroy;return l.destroy=function(){l.destroy=m;var g=this;setTimeout(function(){c.close({fail:function(){g._destroy(new Error)}})},0)}.bind(l),c.onOpen(function(){l.setReadable(s),l.setWritable(s),l.emit("connect")}),c.onMessage(function(g){var k=g.data;k=k instanceof ArrayBuffer?x.from(k):x.from(k,"utf8"),s.push(k)}),c.onClose(function(){l.end(),l.destroy()}),c.onError(function(g){l.destroy(new Error(g.errMsg))}),l}},{buffer:17,duplexify:20,"readable-stream":69}],7:[function(D,Z,R){"use strict";function P(){if(!(this instanceof P))return new P;this.nextId=Math.max(1,Math.floor(65535*Math.random()))}P.prototype.allocate=function(){var x=this.nextId++;return this.nextId===65536&&(this.nextId=1),x},P.prototype.getLastAllocated=function(){return this.nextId===1?65535:this.nextId-1},P.prototype.register=function(x){return!0},P.prototype.deallocate=function(x){},P.prototype.clear=function(){},Z.exports=P},{}],8:[function(D,Z,R){"use strict";var P=D("xtend"),x=D("readable-stream").Readable,w={objectMode:!0},T={clean:!0};function c(s){if(!(this instanceof c))return new c(s);this.options=s||{},this.options=P(T,s),this._inflights=new Map}c.prototype.put=function(s,l){return this._inflights.set(s.messageId,s),l&&l(),this},c.prototype.createStream=function(){var s=new x(w),l=[],d=!1,a=0;return this._inflights.forEach(function(u,v){l.push(u)}),s._read=function(){!d&&a<l.length?this.push(l[a++]):this.push(null)},s.destroy=function(){if(!d){var u=this;d=!0,setTimeout(function(){u.emit("close")},0)}},s},c.prototype.del=function(s,l){return(s=this._inflights.get(s.messageId))?(this._inflights.delete(s.messageId),l(null,s)):l&&l(new Error("missing packet")),this},c.prototype.get=function(s,l){return(s=this._inflights.get(s.messageId))?l(null,s):l&&l(new Error("missing packet")),this},c.prototype.close=function(s){this.options.clean&&(this._inflights=null),s&&s()},Z.exports=c},{"readable-stream":69,xtend:81}],9:[function(D,Z,R){"use strict";function P(x){if(!(this instanceof P))return new P(x);this.aliasToTopic={},this.max=x}P.prototype.put=function(x,w){return!(w===0||w>this.max)&&(this.aliasToTopic[w]=x,this.length=Object.keys(this.aliasToTopic).length,!0)},P.prototype.getTopicByAlias=function(x){return this.aliasToTopic[x]},P.prototype.clear=function(){this.aliasToTopic={}},Z.exports=P},{}],10:[function(D,Z,R){"use strict";var P=D("lru-cache"),x=D("number-allocator").NumberAllocator;function w(T){if(!(this instanceof w))return new w(T);T>0&&(this.aliasToTopic=new P({max:T}),this.topicToAlias={},this.numberAllocator=new x(1,T),this.max=T,this.length=0)}w.prototype.put=function(T,c){if(c===0||c>this.max)return!1;var s=this.aliasToTopic.get(c);return s&&delete this.topicToAlias[s],this.aliasToTopic.set(c,T),this.topicToAlias[T]=c,this.numberAllocator.use(c),this.length=this.aliasToTopic.length,!0},w.prototype.getTopicByAlias=function(T){return this.aliasToTopic.get(T)},w.prototype.getAliasByTopic=function(T){var c=this.topicToAlias[T];return c!==void 0&&this.aliasToTopic.get(c),c},w.prototype.clear=function(){this.aliasToTopic.reset(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0},w.prototype.getLruAlias=function(){var T=this.numberAllocator.firstVacant();return T||this.aliasToTopic.keys()[this.aliasToTopic.length-1]},Z.exports=w},{"lru-cache":37,"number-allocator":46}],11:[function(D,Z,R){"use strict";function P(x){for(var w=x.split("/"),T=0;T<w.length;T++)if(w[T]!=="+"){if(w[T]==="#")return T===w.length-1;if(w[T].indexOf("+")!==-1||w[T].indexOf("#")!==-1)return!1}return!0}Z.exports={validateTopics:function(w){if(w.length===0)return"empty_topic_list";for(var T=0;T<w.length;T++)if(!P(w[T]))return w[T];return null}}},{}],12:[function(D,Z,R){(function(P){(function(){"use strict";var x=D("../client"),w=D("../store"),T=D("url"),c=D("xtend"),s=D("debug")("mqttjs"),l={};function d(a,u){if(s("connecting to an MQTT broker..."),typeof a!="object"||u||(u=a,a=null),u=u||{},a){var v=T.parse(a,!0);if(v.port!=null&&(v.port=Number(v.port)),(u=c(v,u)).protocol===null)throw new Error("Missing protocol");u.protocol=u.protocol.replace(/:$/,"")}if(function(k){var y;k.auth&&((y=k.auth.match(/^(.+):(.+)$/))?(k.username=y[1],k.password=y[2]):k.username=k.auth)}(u),u.query&&typeof u.query.clientId=="string"&&(u.clientId=u.query.clientId),u.cert&&u.key){if(!u.protocol)throw new Error("Missing secure protocol key");if(["mqtts","wss","wxs","alis"].indexOf(u.protocol)===-1)switch(u.protocol){case"mqtt":u.protocol="mqtts";break;case"ws":u.protocol="wss";break;case"wx":u.protocol="wxs";break;case"ali":u.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+u.protocol+'"!')}}if(!l[u.protocol]){var m=["mqtts","wss"].indexOf(u.protocol)!==-1;u.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(k,y){return(!m||y%2!=0)&&typeof l[k]=="function"})[0]}if(u.clean===!1&&!u.clientId)throw new Error("Missing clientId for unclean clients");u.protocol&&(u.defaultProtocol=u.protocol);var g=new x(function(k){return u.servers&&(k._reconnectCount&&k._reconnectCount!==u.servers.length||(k._reconnectCount=0),u.host=u.servers[k._reconnectCount].host,u.port=u.servers[k._reconnectCount].port,u.protocol=u.servers[k._reconnectCount].protocol?u.servers[k._reconnectCount].protocol:u.defaultProtocol,u.hostname=u.host,k._reconnectCount++),s("calling streambuilder for",u.protocol),l[u.protocol](k,u)},u);return g.on("error",function(){}),g}P!==void 0&&P.title!=="browser"||typeof ft!="function"?(l.mqtt=D("./tcp"),l.tcp=D("./tcp"),l.ssl=D("./tls"),l.tls=D("./tls"),l.mqtts=D("./tls")):(l.wx=D("./wx"),l.wxs=D("./wx"),l.ali=D("./ali"),l.alis=D("./ali")),l.ws=D("./ws"),l.wss=D("./ws"),Z.exports=d,Z.exports.connect=d,Z.exports.MqttClient=x,Z.exports.Store=w}).call(this)}).call(this,D("_process"))},{"../client":1,"../store":8,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:50,debug:18,url:76,xtend:81}],13:[function(D,Z,R){"use strict";R.byteLength=function(a){var u=l(a),v=u[0],m=u[1];return 3*(v+m)/4-m},R.toByteArray=function(a){var u,v,m=l(a),g=m[0],k=m[1],y=new w(function(N,Y,_){return 3*(Y+_)/4-_}(0,g,k)),C=0,M=k>0?g-4:g;for(v=0;v<M;v+=4)u=x[a.charCodeAt(v)]<<18|x[a.charCodeAt(v+1)]<<12|x[a.charCodeAt(v+2)]<<6|x[a.charCodeAt(v+3)],y[C++]=u>>16&255,y[C++]=u>>8&255,y[C++]=255&u;return k===2&&(u=x[a.charCodeAt(v)]<<2|x[a.charCodeAt(v+1)]>>4,y[C++]=255&u),k===1&&(u=x[a.charCodeAt(v)]<<10|x[a.charCodeAt(v+1)]<<4|x[a.charCodeAt(v+2)]>>2,y[C++]=u>>8&255,y[C++]=255&u),y},R.fromByteArray=function(a){for(var u,v=a.length,m=v%3,g=[],k=0,y=v-m;k<y;k+=16383)g.push(d(a,k,k+16383>y?y:k+16383));return m===1?(u=a[v-1],g.push(P[u>>2]+P[u<<4&63]+"==")):m===2&&(u=(a[v-2]<<8)+a[v-1],g.push(P[u>>10]+P[u>>4&63]+P[u<<2&63]+"=")),g.join("")};for(var P=[],x=[],w=typeof Uint8Array!="undefined"?Uint8Array:Array,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,s=T.length;c<s;++c)P[c]=T[c],x[T.charCodeAt(c)]=c;function l(a){var u=a.length;if(u%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var v=a.indexOf("=");return v===-1&&(v=u),[v,v===u?0:4-v%4]}function d(a,u,v){for(var m,g,k=[],y=u;y<v;y+=3)m=(a[y]<<16&16711680)+(a[y+1]<<8&65280)+(255&a[y+2]),k.push(P[(g=m)>>18&63]+P[g>>12&63]+P[g>>6&63]+P[63&g]);return k.join("")}x["-".charCodeAt(0)]=62,x["_".charCodeAt(0)]=63},{}],14:[function(D,Z,R){"use strict";var P=D("buffer"),x=P.Buffer,w=Symbol.for("BufferList");function T(c){if(!(this instanceof T))return new T(c);T._init.call(this,c)}T._init=function(c){Object.defineProperty(this,w,{value:!0}),this._bufs=[],this.length=0,c&&this.append(c)},T.prototype._new=function(c){return new T(c)},T.prototype._offset=function(c){if(c===0)return[0,0];for(var s=0,l=0;l<this._bufs.length;l++){var d=s+this._bufs[l].length;if(c<d||l===this._bufs.length-1)return[l,c-s];s=d}},T.prototype._reverseOffset=function(c){for(var s=c[0],l=c[1],d=0;d<s;d++)l+=this._bufs[d].length;return l},T.prototype.get=function(c){if(!(c>this.length||c<0)){var s=this._offset(c);return this._bufs[s[0]][s[1]]}},T.prototype.slice=function(c,s){return typeof c=="number"&&c<0&&(c+=this.length),typeof s=="number"&&s<0&&(s+=this.length),this.copy(null,0,c,s)},T.prototype.copy=function(c,s,l,d){if((typeof l!="number"||l<0)&&(l=0),(typeof d!="number"||d>this.length)&&(d=this.length),l>=this.length||d<=0)return c||x.alloc(0);var a=!!c,u=this._offset(l),v=d-l,m=v,g=a&&s||0,k=u[1];if(l===0&&d===this.length){if(!a)return this._bufs.length===1?this._bufs[0]:x.concat(this._bufs,this.length);for(var y=0;y<this._bufs.length;y++)this._bufs[y].copy(c,g),g+=this._bufs[y].length;return c}if(m<=this._bufs[u[0]].length-k)return a?this._bufs[u[0]].copy(c,s,k,k+m):this._bufs[u[0]].slice(k,k+m);a||(c=x.allocUnsafe(v));for(var C=u[0];C<this._bufs.length;C++){var M=this._bufs[C].length-k;if(!(m>M)){this._bufs[C].copy(c,g,k,k+m),g+=M;break}this._bufs[C].copy(c,g,k),g+=M,m-=M,k&&(k=0)}return c.length>g?c.slice(0,g):c},T.prototype.shallowSlice=function(c,s){if(c=c||0,s=typeof s!="number"?this.length:s,c<0&&(c+=this.length),s<0&&(s+=this.length),c===s)return this._new();var l=this._offset(c),d=this._offset(s),a=this._bufs.slice(l[0],d[0]+1);return d[1]===0?a.pop():a[a.length-1]=a[a.length-1].slice(0,d[1]),l[1]!==0&&(a[0]=a[0].slice(l[1])),this._new(a)},T.prototype.toString=function(c,s,l){return this.slice(s,l).toString(c)},T.prototype.consume=function(c){if(c=Math.trunc(c),Number.isNaN(c)||c<=0)return this;for(;this._bufs.length;){if(!(c>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(c),this.length-=c;break}c-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},T.prototype.duplicate=function(){for(var c=this._new(),s=0;s<this._bufs.length;s++)c.append(this._bufs[s]);return c},T.prototype.append=function(c){if(c==null)return this;if(c.buffer)this._appendBuffer(x.from(c.buffer,c.byteOffset,c.byteLength));else if(Array.isArray(c))for(var s=0;s<c.length;s++)this.append(c[s]);else if(this._isBufferList(c))for(var l=0;l<c._bufs.length;l++)this.append(c._bufs[l]);else typeof c=="number"&&(c=c.toString()),this._appendBuffer(x.from(c));return this},T.prototype._appendBuffer=function(c){this._bufs.push(c),this.length+=c.length},T.prototype.indexOf=function(c,s,l){if(l===void 0&&typeof s=="string"&&(l=s,s=void 0),typeof c=="function"||Array.isArray(c))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof c=="number"?c=x.from([c]):typeof c=="string"?c=x.from(c,l):this._isBufferList(c)?c=c.slice():Array.isArray(c.buffer)?c=x.from(c.buffer,c.byteOffset,c.byteLength):x.isBuffer(c)||(c=x.from(c)),s=Number(s||0),isNaN(s)&&(s=0),s<0&&(s=this.length+s),s<0&&(s=0),c.length===0)return s>this.length?this.length:s;for(var d=this._offset(s),a=d[0],u=d[1];a<this._bufs.length;a++){for(var v=this._bufs[a];u<v.length;)if(v.length-u>=c.length){var m=v.indexOf(c,u);if(m!==-1)return this._reverseOffset([a,m]);u=v.length-c.length+1}else{var g=this._reverseOffset([a,u]);if(this._match(g,c))return g;u++}u=0}return-1},T.prototype._match=function(c,s){if(this.length-c<s.length)return!1;for(var l=0;l<s.length;l++)if(this.get(c+l)!==s[l])return!1;return!0},function(){var c={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(var s in c)(function(l){T.prototype[l]=c[l]===null?function(d,a){return this.slice(d,d+a)[l](0,a)}:function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.slice(d,d+c[l])[l](0)}})(s)}(),T.prototype._isBufferList=function(c){return c instanceof T||T.isBufferList(c)},T.isBufferList=function(c){return c!=null&&c[w]},Z.exports=T},{buffer:17}],15:[function(D,Z,R){"use strict";var P=D("readable-stream").Duplex,x=D("inherits"),w=D("./BufferList");function T(c){if(!(this instanceof T))return new T(c);if(typeof c=="function"){this._callback=c;var s=function(l){this._callback&&(this._callback(l),this._callback=null)}.bind(this);this.on("pipe",function(l){l.on("error",s)}),this.on("unpipe",function(l){l.removeListener("error",s)}),c=null}w._init.call(this,c),P.call(this)}x(T,P),Object.assign(T.prototype,w.prototype),T.prototype._new=function(c){return new T(c)},T.prototype._write=function(c,s,l){this._appendBuffer(c),typeof l=="function"&&l()},T.prototype._read=function(c){if(!this.length)return this.push(null);c=Math.min(c,this.length),this.push(this.slice(0,c)),this.consume(c)},T.prototype.end=function(c){P.prototype.end.call(this,c),this._callback&&(this._callback(null,this.slice()),this._callback=null)},T.prototype._destroy=function(c,s){this._bufs.length=0,this.length=0,s(c)},T.prototype._isBufferList=function(c){return c instanceof T||c instanceof w||T.isBufferList(c)},T.isBufferList=w.isBufferList,Z.exports=T,Z.exports.BufferListStream=T,Z.exports.BufferList=w},{"./BufferList":14,inherits:24,"readable-stream":69}],16:[function(D,Z,R){},{}],17:[function(D,Z,R){(function(P){(function(){"use strict";var x=D("base64-js"),w=D("ieee754");R.Buffer=s,R.SlowBuffer=function(h){return+h!=h&&(h=0),s.alloc(+h)},R.INSPECT_MAX_BYTES=50;var T=2147483647;function c(h){if(h>T)throw new RangeError('The value "'+h+'" is invalid for option "size"');var f=new Uint8Array(h);return f.__proto__=s.prototype,f}function s(h,f,I){if(typeof h=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return a(h)}return l(h,f,I)}function l(h,f,I){if(typeof h=="string")return function(Q,ot){if(typeof ot=="string"&&ot!==""||(ot="utf8"),!s.isEncoding(ot))throw new TypeError("Unknown encoding: "+ot);var ut=0|m(Q,ot),lt=c(ut),gt=lt.write(Q,ot);return gt!==ut&&(lt=lt.slice(0,gt)),lt}(h,f);if(ArrayBuffer.isView(h))return u(h);if(h==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);if(it(h,ArrayBuffer)||h&&it(h.buffer,ArrayBuffer))return function(Q,ot,ut){if(ot<0||Q.byteLength<ot)throw new RangeError('"offset" is outside of buffer bounds');if(Q.byteLength<ot+(ut||0))throw new RangeError('"length" is outside of buffer bounds');var lt;return lt=ot===void 0&&ut===void 0?new Uint8Array(Q):ut===void 0?new Uint8Array(Q,ot):new Uint8Array(Q,ot,ut),lt.__proto__=s.prototype,lt}(h,f,I);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var O=h.valueOf&&h.valueOf();if(O!=null&&O!==h)return s.from(O,f,I);var X=function(Q){if(s.isBuffer(Q)){var ot=0|v(Q.length),ut=c(ot);return ut.length===0||Q.copy(ut,0,0,ot),ut}if(Q.length!==void 0)return typeof Q.length!="number"||st(Q.length)?c(0):u(Q);if(Q.type==="Buffer"&&Array.isArray(Q.data))return u(Q.data)}(h);if(X)return X;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return s.from(h[Symbol.toPrimitive]("string"),f,I);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h)}function d(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(h<0)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function a(h){return d(h),c(h<0?0:0|v(h))}function u(h){for(var f=h.length<0?0:0|v(h.length),I=c(f),O=0;O<f;O+=1)I[O]=255&h[O];return I}function v(h){if(h>=T)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+T.toString(16)+" bytes");return 0|h}function m(h,f){if(s.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||it(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof h);var I=h.length,O=arguments.length>2&&arguments[2]===!0;if(!O&&I===0)return 0;for(var X=!1;;)switch(f){case"ascii":case"latin1":case"binary":return I;case"utf8":case"utf-8":return K(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*I;case"hex":return I>>>1;case"base64":return tt(h).length;default:if(X)return O?-1:K(h).length;f=(""+f).toLowerCase(),X=!0}}function g(h,f,I){var O=h[f];h[f]=h[I],h[I]=O}function k(h,f,I,O,X){if(h.length===0)return-1;if(typeof I=="string"?(O=I,I=0):I>2147483647?I=2147483647:I<-2147483648&&(I=-2147483648),st(I=+I)&&(I=X?0:h.length-1),I<0&&(I=h.length+I),I>=h.length){if(X)return-1;I=h.length-1}else if(I<0){if(!X)return-1;I=0}if(typeof f=="string"&&(f=s.from(f,O)),s.isBuffer(f))return f.length===0?-1:y(h,f,I,O,X);if(typeof f=="number")return f&=255,typeof Uint8Array.prototype.indexOf=="function"?X?Uint8Array.prototype.indexOf.call(h,f,I):Uint8Array.prototype.lastIndexOf.call(h,f,I):y(h,[f],I,O,X);throw new TypeError("val must be string, number or Buffer")}function y(h,f,I,O,X){var Q,ot=1,ut=h.length,lt=f.length;if(O!==void 0&&((O=String(O).toLowerCase())==="ucs2"||O==="ucs-2"||O==="utf16le"||O==="utf-16le")){if(h.length<2||f.length<2)return-1;ot=2,ut/=2,lt/=2,I/=2}function gt(qt,Rt){return ot===1?qt[Rt]:qt.readUInt16BE(Rt*ot)}if(X){var bt=-1;for(Q=I;Q<ut;Q++)if(gt(h,Q)===gt(f,bt===-1?0:Q-bt)){if(bt===-1&&(bt=Q),Q-bt+1===lt)return bt*ot}else bt!==-1&&(Q-=Q-bt),bt=-1}else for(I+lt>ut&&(I=ut-lt),Q=I;Q>=0;Q--){for(var Wt=!0,Ft=0;Ft<lt;Ft++)if(gt(h,Q+Ft)!==gt(f,Ft)){Wt=!1;break}if(Wt)return Q}return-1}function C(h,f,I,O){I=Number(I)||0;var X=h.length-I;O?(O=Number(O))>X&&(O=X):O=X;var Q=f.length;O>Q/2&&(O=Q/2);for(var ot=0;ot<O;++ot){var ut=parseInt(f.substr(2*ot,2),16);if(st(ut))return ot;h[I+ot]=ut}return ot}function M(h,f,I,O){return at(K(f,h.length-I),h,I,O)}function N(h,f,I,O){return at(function(X){for(var Q=[],ot=0;ot<X.length;++ot)Q.push(255&X.charCodeAt(ot));return Q}(f),h,I,O)}function Y(h,f,I,O){return N(h,f,I,O)}function _(h,f,I,O){return at(tt(f),h,I,O)}function G(h,f,I,O){return at(function(X,Q){for(var ot,ut,lt,gt=[],bt=0;bt<X.length&&!((Q-=2)<0);++bt)ot=X.charCodeAt(bt),ut=ot>>8,lt=ot%256,gt.push(lt),gt.push(ut);return gt}(f,h.length-I),h,I,O)}function et(h,f,I){return f===0&&I===h.length?x.fromByteArray(h):x.fromByteArray(h.slice(f,I))}function B(h,f,I){I=Math.min(h.length,I);for(var O=[],X=f;X<I;){var Q,ot,ut,lt,gt=h[X],bt=null,Wt=gt>239?4:gt>223?3:gt>191?2:1;if(X+Wt<=I)switch(Wt){case 1:gt<128&&(bt=gt);break;case 2:(192&(Q=h[X+1]))==128&&(lt=(31&gt)<<6|63&Q)>127&&(bt=lt);break;case 3:Q=h[X+1],ot=h[X+2],(192&Q)==128&&(192&ot)==128&&(lt=(15&gt)<<12|(63&Q)<<6|63&ot)>2047&&(lt<55296||lt>57343)&&(bt=lt);break;case 4:Q=h[X+1],ot=h[X+2],ut=h[X+3],(192&Q)==128&&(192&ot)==128&&(192&ut)==128&&(lt=(15&gt)<<18|(63&Q)<<12|(63&ot)<<6|63&ut)>65535&&lt<1114112&&(bt=lt)}bt===null?(bt=65533,Wt=1):bt>65535&&(bt-=65536,O.push(bt>>>10&1023|55296),bt=56320|1023&bt),O.push(bt),X+=Wt}return function(Ft){var qt=Ft.length;if(qt<=S)return String.fromCharCode.apply(String,Ft);for(var Rt="",_t=0;_t<qt;)Rt+=String.fromCharCode.apply(String,Ft.slice(_t,_t+=S));return Rt}(O)}R.kMaxLength=T,s.TYPED_ARRAY_SUPPORT=function(){try{var h=new Uint8Array(1);return h.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},h.foo()===42}catch(f){return!1}}(),s.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),typeof Symbol!="undefined"&&Symbol.species!=null&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(h,f,I){return l(h,f,I)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(h,f,I){return function(O,X,Q){return d(O),O<=0?c(O):X!==void 0?typeof Q=="string"?c(O).fill(X,Q):c(O).fill(X):c(O)}(h,f,I)},s.allocUnsafe=function(h){return a(h)},s.allocUnsafeSlow=function(h){return a(h)},s.isBuffer=function(h){return h!=null&&h._isBuffer===!0&&h!==s.prototype},s.compare=function(h,f){if(it(h,Uint8Array)&&(h=s.from(h,h.offset,h.byteLength)),it(f,Uint8Array)&&(f=s.from(f,f.offset,f.byteLength)),!s.isBuffer(h)||!s.isBuffer(f))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(h===f)return 0;for(var I=h.length,O=f.length,X=0,Q=Math.min(I,O);X<Q;++X)if(h[X]!==f[X]){I=h[X],O=f[X];break}return I<O?-1:O<I?1:0},s.isEncoding=function(h){switch(String(h).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(h,f){if(!Array.isArray(h))throw new TypeError('"list" argument must be an Array of Buffers');if(h.length===0)return s.alloc(0);var I;if(f===void 0)for(f=0,I=0;I<h.length;++I)f+=h[I].length;var O=s.allocUnsafe(f),X=0;for(I=0;I<h.length;++I){var Q=h[I];if(it(Q,Uint8Array)&&(Q=s.from(Q)),!s.isBuffer(Q))throw new TypeError('"list" argument must be an Array of Buffers');Q.copy(O,X),X+=Q.length}return O},s.byteLength=m,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var h=this.length;if(h%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var f=0;f<h;f+=2)g(this,f,f+1);return this},s.prototype.swap32=function(){var h=this.length;if(h%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var f=0;f<h;f+=4)g(this,f,f+3),g(this,f+1,f+2);return this},s.prototype.swap64=function(){var h=this.length;if(h%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var f=0;f<h;f+=8)g(this,f,f+7),g(this,f+1,f+6),g(this,f+2,f+5),g(this,f+3,f+4);return this},s.prototype.toString=function(){var h=this.length;return h===0?"":arguments.length===0?B(this,0,h):function(f,I,O){var X=!1;if((I===void 0||I<0)&&(I=0),I>this.length||((O===void 0||O>this.length)&&(O=this.length),O<=0)||(O>>>=0)<=(I>>>=0))return"";for(f||(f="utf8");;)switch(f){case"hex":return E(this,I,O);case"utf8":case"utf-8":return B(this,I,O);case"ascii":return A(this,I,O);case"latin1":case"binary":return L(this,I,O);case"base64":return et(this,I,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,I,O);default:if(X)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase(),X=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(h){if(!s.isBuffer(h))throw new TypeError("Argument must be a Buffer");return this===h||s.compare(this,h)===0},s.prototype.inspect=function(){var h="",f=R.INSPECT_MAX_BYTES;return h=this.toString("hex",0,f).replace(/(.{2})/g,"$1 ").trim(),this.length>f&&(h+=" ... "),"<Buffer "+h+">"},s.prototype.compare=function(h,f,I,O,X){if(it(h,Uint8Array)&&(h=s.from(h,h.offset,h.byteLength)),!s.isBuffer(h))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof h);if(f===void 0&&(f=0),I===void 0&&(I=h?h.length:0),O===void 0&&(O=0),X===void 0&&(X=this.length),f<0||I>h.length||O<0||X>this.length)throw new RangeError("out of range index");if(O>=X&&f>=I)return 0;if(O>=X)return-1;if(f>=I)return 1;if(f>>>=0,I>>>=0,O>>>=0,X>>>=0,this===h)return 0;for(var Q=X-O,ot=I-f,ut=Math.min(Q,ot),lt=this.slice(O,X),gt=h.slice(f,I),bt=0;bt<ut;++bt)if(lt[bt]!==gt[bt]){Q=lt[bt],ot=gt[bt];break}return Q<ot?-1:ot<Q?1:0},s.prototype.includes=function(h,f,I){return this.indexOf(h,f,I)!==-1},s.prototype.indexOf=function(h,f,I){return k(this,h,f,I,!0)},s.prototype.lastIndexOf=function(h,f,I){return k(this,h,f,I,!1)},s.prototype.write=function(h,f,I,O){if(f===void 0)O="utf8",I=this.length,f=0;else if(I===void 0&&typeof f=="string")O=f,I=this.length,f=0;else{if(!isFinite(f))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");f>>>=0,isFinite(I)?(I>>>=0,O===void 0&&(O="utf8")):(O=I,I=void 0)}var X=this.length-f;if((I===void 0||I>X)&&(I=X),h.length>0&&(I<0||f<0)||f>this.length)throw new RangeError("Attempt to write outside buffer bounds");O||(O="utf8");for(var Q=!1;;)switch(O){case"hex":return C(this,h,f,I);case"utf8":case"utf-8":return M(this,h,f,I);case"ascii":return N(this,h,f,I);case"latin1":case"binary":return Y(this,h,f,I);case"base64":return _(this,h,f,I);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,h,f,I);default:if(Q)throw new TypeError("Unknown encoding: "+O);O=(""+O).toLowerCase(),Q=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function A(h,f,I){var O="";I=Math.min(h.length,I);for(var X=f;X<I;++X)O+=String.fromCharCode(127&h[X]);return O}function L(h,f,I){var O="";I=Math.min(h.length,I);for(var X=f;X<I;++X)O+=String.fromCharCode(h[X]);return O}function E(h,f,I){var O=h.length;(!f||f<0)&&(f=0),(!I||I<0||I>O)&&(I=O);for(var X="",Q=f;Q<I;++Q)X+=J(h[Q]);return X}function V(h,f,I){for(var O=h.slice(f,I),X="",Q=0;Q<O.length;Q+=2)X+=String.fromCharCode(O[Q]+256*O[Q+1]);return X}function $(h,f,I){if(h%1!=0||h<0)throw new RangeError("offset is not uint");if(h+f>I)throw new RangeError("Trying to access beyond buffer length")}function W(h,f,I,O,X,Q){if(!s.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>X||f<Q)throw new RangeError('"value" argument is out of bounds');if(I+O>h.length)throw new RangeError("Index out of range")}function F(h,f,I,O,X,Q){if(I+O>h.length)throw new RangeError("Index out of range");if(I<0)throw new RangeError("Index out of range")}function j(h,f,I,O,X){return f=+f,I>>>=0,X||F(h,0,I,4),w.write(h,f,I,O,23,4),I+4}function q(h,f,I,O,X){return f=+f,I>>>=0,X||F(h,0,I,8),w.write(h,f,I,O,52,8),I+8}s.prototype.slice=function(h,f){var I=this.length;h=~~h,f=f===void 0?I:~~f,h<0?(h+=I)<0&&(h=0):h>I&&(h=I),f<0?(f+=I)<0&&(f=0):f>I&&(f=I),f<h&&(f=h);var O=this.subarray(h,f);return O.__proto__=s.prototype,O},s.prototype.readUIntLE=function(h,f,I){h>>>=0,f>>>=0,I||$(h,f,this.length);for(var O=this[h],X=1,Q=0;++Q<f&&(X*=256);)O+=this[h+Q]*X;return O},s.prototype.readUIntBE=function(h,f,I){h>>>=0,f>>>=0,I||$(h,f,this.length);for(var O=this[h+--f],X=1;f>0&&(X*=256);)O+=this[h+--f]*X;return O},s.prototype.readUInt8=function(h,f){return h>>>=0,f||$(h,1,this.length),this[h]},s.prototype.readUInt16LE=function(h,f){return h>>>=0,f||$(h,2,this.length),this[h]|this[h+1]<<8},s.prototype.readUInt16BE=function(h,f){return h>>>=0,f||$(h,2,this.length),this[h]<<8|this[h+1]},s.prototype.readUInt32LE=function(h,f){return h>>>=0,f||$(h,4,this.length),(this[h]|this[h+1]<<8|this[h+2]<<16)+16777216*this[h+3]},s.prototype.readUInt32BE=function(h,f){return h>>>=0,f||$(h,4,this.length),16777216*this[h]+(this[h+1]<<16|this[h+2]<<8|this[h+3])},s.prototype.readIntLE=function(h,f,I){h>>>=0,f>>>=0,I||$(h,f,this.length);for(var O=this[h],X=1,Q=0;++Q<f&&(X*=256);)O+=this[h+Q]*X;return O>=(X*=128)&&(O-=Math.pow(2,8*f)),O},s.prototype.readIntBE=function(h,f,I){h>>>=0,f>>>=0,I||$(h,f,this.length);for(var O=f,X=1,Q=this[h+--O];O>0&&(X*=256);)Q+=this[h+--O]*X;return Q>=(X*=128)&&(Q-=Math.pow(2,8*f)),Q},s.prototype.readInt8=function(h,f){return h>>>=0,f||$(h,1,this.length),128&this[h]?-1*(255-this[h]+1):this[h]},s.prototype.readInt16LE=function(h,f){h>>>=0,f||$(h,2,this.length);var I=this[h]|this[h+1]<<8;return 32768&I?4294901760|I:I},s.prototype.readInt16BE=function(h,f){h>>>=0,f||$(h,2,this.length);var I=this[h+1]|this[h]<<8;return 32768&I?4294901760|I:I},s.prototype.readInt32LE=function(h,f){return h>>>=0,f||$(h,4,this.length),this[h]|this[h+1]<<8|this[h+2]<<16|this[h+3]<<24},s.prototype.readInt32BE=function(h,f){return h>>>=0,f||$(h,4,this.length),this[h]<<24|this[h+1]<<16|this[h+2]<<8|this[h+3]},s.prototype.readFloatLE=function(h,f){return h>>>=0,f||$(h,4,this.length),w.read(this,h,!0,23,4)},s.prototype.readFloatBE=function(h,f){return h>>>=0,f||$(h,4,this.length),w.read(this,h,!1,23,4)},s.prototype.readDoubleLE=function(h,f){return h>>>=0,f||$(h,8,this.length),w.read(this,h,!0,52,8)},s.prototype.readDoubleBE=function(h,f){return h>>>=0,f||$(h,8,this.length),w.read(this,h,!1,52,8)},s.prototype.writeUIntLE=function(h,f,I,O){h=+h,f>>>=0,I>>>=0,O||W(this,h,f,I,Math.pow(2,8*I)-1,0);var X=1,Q=0;for(this[f]=255&h;++Q<I&&(X*=256);)this[f+Q]=h/X&255;return f+I},s.prototype.writeUIntBE=function(h,f,I,O){h=+h,f>>>=0,I>>>=0,O||W(this,h,f,I,Math.pow(2,8*I)-1,0);var X=I-1,Q=1;for(this[f+X]=255&h;--X>=0&&(Q*=256);)this[f+X]=h/Q&255;return f+I},s.prototype.writeUInt8=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,1,255,0),this[f]=255&h,f+1},s.prototype.writeUInt16LE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,2,65535,0),this[f]=255&h,this[f+1]=h>>>8,f+2},s.prototype.writeUInt16BE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,2,65535,0),this[f]=h>>>8,this[f+1]=255&h,f+2},s.prototype.writeUInt32LE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,4,4294967295,0),this[f+3]=h>>>24,this[f+2]=h>>>16,this[f+1]=h>>>8,this[f]=255&h,f+4},s.prototype.writeUInt32BE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,4,4294967295,0),this[f]=h>>>24,this[f+1]=h>>>16,this[f+2]=h>>>8,this[f+3]=255&h,f+4},s.prototype.writeIntLE=function(h,f,I,O){if(h=+h,f>>>=0,!O){var X=Math.pow(2,8*I-1);W(this,h,f,I,X-1,-X)}var Q=0,ot=1,ut=0;for(this[f]=255&h;++Q<I&&(ot*=256);)h<0&&ut===0&&this[f+Q-1]!==0&&(ut=1),this[f+Q]=(h/ot>>0)-ut&255;return f+I},s.prototype.writeIntBE=function(h,f,I,O){if(h=+h,f>>>=0,!O){var X=Math.pow(2,8*I-1);W(this,h,f,I,X-1,-X)}var Q=I-1,ot=1,ut=0;for(this[f+Q]=255&h;--Q>=0&&(ot*=256);)h<0&&ut===0&&this[f+Q+1]!==0&&(ut=1),this[f+Q]=(h/ot>>0)-ut&255;return f+I},s.prototype.writeInt8=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,1,127,-128),h<0&&(h=255+h+1),this[f]=255&h,f+1},s.prototype.writeInt16LE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,2,32767,-32768),this[f]=255&h,this[f+1]=h>>>8,f+2},s.prototype.writeInt16BE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,2,32767,-32768),this[f]=h>>>8,this[f+1]=255&h,f+2},s.prototype.writeInt32LE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,4,2147483647,-2147483648),this[f]=255&h,this[f+1]=h>>>8,this[f+2]=h>>>16,this[f+3]=h>>>24,f+4},s.prototype.writeInt32BE=function(h,f,I){return h=+h,f>>>=0,I||W(this,h,f,4,2147483647,-2147483648),h<0&&(h=4294967295+h+1),this[f]=h>>>24,this[f+1]=h>>>16,this[f+2]=h>>>8,this[f+3]=255&h,f+4},s.prototype.writeFloatLE=function(h,f,I){return j(this,h,f,!0,I)},s.prototype.writeFloatBE=function(h,f,I){return j(this,h,f,!1,I)},s.prototype.writeDoubleLE=function(h,f,I){return q(this,h,f,!0,I)},s.prototype.writeDoubleBE=function(h,f,I){return q(this,h,f,!1,I)},s.prototype.copy=function(h,f,I,O){if(!s.isBuffer(h))throw new TypeError("argument should be a Buffer");if(I||(I=0),O||O===0||(O=this.length),f>=h.length&&(f=h.length),f||(f=0),O>0&&O<I&&(O=I),O===I||h.length===0||this.length===0)return 0;if(f<0)throw new RangeError("targetStart out of bounds");if(I<0||I>=this.length)throw new RangeError("Index out of range");if(O<0)throw new RangeError("sourceEnd out of bounds");O>this.length&&(O=this.length),h.length-f<O-I&&(O=h.length-f+I);var X=O-I;if(this===h&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(f,I,O);else if(this===h&&I<f&&f<O)for(var Q=X-1;Q>=0;--Q)h[Q+f]=this[Q+I];else Uint8Array.prototype.set.call(h,this.subarray(I,O),f);return X},s.prototype.fill=function(h,f,I,O){if(typeof h=="string"){if(typeof f=="string"?(O=f,f=0,I=this.length):typeof I=="string"&&(O=I,I=this.length),O!==void 0&&typeof O!="string")throw new TypeError("encoding must be a string");if(typeof O=="string"&&!s.isEncoding(O))throw new TypeError("Unknown encoding: "+O);if(h.length===1){var X=h.charCodeAt(0);(O==="utf8"&&X<128||O==="latin1")&&(h=X)}}else typeof h=="number"&&(h&=255);if(f<0||this.length<f||this.length<I)throw new RangeError("Out of range index");if(I<=f)return this;var Q;if(f>>>=0,I=I===void 0?this.length:I>>>0,h||(h=0),typeof h=="number")for(Q=f;Q<I;++Q)this[Q]=h;else{var ot=s.isBuffer(h)?h:s.from(h,O),ut=ot.length;if(ut===0)throw new TypeError('The value "'+h+'" is invalid for argument "value"');for(Q=0;Q<I-f;++Q)this[Q+f]=ot[Q%ut]}return this};var H=/[^+/0-9A-Za-z-_]/g;function J(h){return h<16?"0"+h.toString(16):h.toString(16)}function K(h,f){var I;f=f||1/0;for(var O=h.length,X=null,Q=[],ot=0;ot<O;++ot){if((I=h.charCodeAt(ot))>55295&&I<57344){if(!X){if(I>56319){(f-=3)>-1&&Q.push(239,191,189);continue}if(ot+1===O){(f-=3)>-1&&Q.push(239,191,189);continue}X=I;continue}if(I<56320){(f-=3)>-1&&Q.push(239,191,189),X=I;continue}I=65536+(X-55296<<10|I-56320)}else X&&(f-=3)>-1&&Q.push(239,191,189);if(X=null,I<128){if((f-=1)<0)break;Q.push(I)}else if(I<2048){if((f-=2)<0)break;Q.push(I>>6|192,63&I|128)}else if(I<65536){if((f-=3)<0)break;Q.push(I>>12|224,I>>6&63|128,63&I|128)}else{if(!(I<1114112))throw new Error("Invalid code point");if((f-=4)<0)break;Q.push(I>>18|240,I>>12&63|128,I>>6&63|128,63&I|128)}}return Q}function tt(h){return x.toByteArray(function(f){if((f=(f=f.split("=")[0]).trim().replace(H,"")).length<2)return"";for(;f.length%4!=0;)f+="=";return f}(h))}function at(h,f,I,O){for(var X=0;X<O&&!(X+I>=f.length||X>=h.length);++X)f[X+I]=h[X];return X}function it(h,f){return h instanceof f||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===f.name}function st(h){return h!=h}}).call(this)}).call(this,D("buffer").Buffer)},{"base64-js":13,buffer:17,ieee754:23}],18:[function(D,Z,R){(function(P){(function(){R.formatArgs=function(w){if(w[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+w[0]+(this.useColors?"%c ":" ")+"+"+Z.exports.humanize(this.diff),!!this.useColors){var T="color: "+this.color;w.splice(1,0,T,"color: inherit");var c=0,s=0;w[0].replace(/%[a-zA-Z%]/g,function(l){l!=="%%"&&l==="%c"&&(s=++c)}),w.splice(s,0,T)}},R.save=function(w){try{w?R.storage.setItem("debug",w):R.storage.removeItem("debug")}catch(T){}},R.load=function(){var w;try{w=R.storage.getItem("debug")}catch(T){}return!w&&P!==void 0&&"env"in P&&(w=P.env.DEBUG),w},R.useColors=function(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},R.storage=function(){try{return localStorage}catch(w){}}(),R.destroy=function(){var w=!1;return function(){w||(w=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),R.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],R.log=console.debug||console.log||function(){},Z.exports=D("./common")(R);var x=Z.exports.formatters;x.j=function(w){try{return JSON.stringify(w)}catch(T){return"[UnexpectedJSONParseError]: "+T.message}}}).call(this)}).call(this,D("_process"))},{"./common":19,_process:50}],19:[function(D,Z,R){Z.exports=function(P){function x(c){var s,l,d,a=null;function u(){for(var v=arguments.length,m=new Array(v),g=0;g<v;g++)m[g]=arguments[g];if(!!u.enabled){var k=u,y=Number(new Date),C=y-(s||y);k.diff=C,k.prev=s,k.curr=y,s=y,m[0]=x.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");var M=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,function(N,Y){if(N==="%%")return"%";M++;var _=x.formatters[Y];if(typeof _=="function"){var G=m[M];N=_.call(k,G),m.splice(M,1),M--}return N}),x.formatArgs.call(k,m),(k.log||x.log).apply(k,m)}}return u.namespace=c,u.useColors=x.useColors(),u.color=x.selectColor(c),u.extend=w,u.destroy=x.destroy,Object.defineProperty(u,"enabled",{enumerable:!0,configurable:!1,get:function(){return a!==null?a:(l!==x.namespaces&&(l=x.namespaces,d=x.enabled(c)),d)},set:function(m){a=m}}),typeof x.init=="function"&&x.init(u),u}function w(c,s){var l=x(this.namespace+(s===void 0?":":s)+c);return l.log=this.log,l}function T(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}return x.debug=x,x.default=x,x.coerce=function(c){return c instanceof Error?c.stack||c.message:c},x.disable=function(){var c=[].concat(Lt(x.names.map(T)),Lt(x.skips.map(T).map(function(s){return"-"+s}))).join(",");return x.enable(""),c},x.enable=function(c){var s;x.save(c),x.namespaces=c,x.names=[],x.skips=[];var l=(typeof c=="string"?c:"").split(/[\s,]+/),d=l.length;for(s=0;s<d;s++)l[s]&&((c=l[s].replace(/\*/g,".*?"))[0]==="-"?x.skips.push(new RegExp("^"+c.substr(1)+"$")):x.names.push(new RegExp("^"+c+"$")))},x.enabled=function(c){if(c[c.length-1]==="*")return!0;var s,l;for(s=0,l=x.skips.length;s<l;s++)if(x.skips[s].test(c))return!1;for(s=0,l=x.names.length;s<l;s++)if(x.names[s].test(c))return!0;return!1},x.humanize=D("ms"),x.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(P).forEach(function(c){x[c]=P[c]}),x.names=[],x.skips=[],x.formatters={},x.selectColor=function(c){for(var s=0,l=0;l<c.length;l++)s=(s<<5)-s+c.charCodeAt(l),s|=0;return x.colors[Math.abs(s)%x.colors.length]},x.enable(x.load()),x}},{ms:45}],20:[function(D,Z,R){(function(P,x){(function(){var w=D("readable-stream"),T=D("end-of-stream"),c=D("inherits"),s=D("stream-shift"),l=x.from&&x.from!==Uint8Array.from?x.from([0]):new x([0]),d=function(g,k){g._corked?g.once("uncork",k):k()},a=function(g,k){return function(y){y?function(C,M){C._autoDestroy&&C.destroy(M)}(g,y.message==="premature close"?null:y):k&&!g._ended&&g.end()}},u=function(){},v=function m(g,k,y){if(!(this instanceof m))return new m(g,k,y);w.Duplex.call(this,y),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!y||y.autoDestroy!==!1,this._forwardDestroy=!y||y.destroy!==!1,this._forwardEnd=!y||y.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,g&&this.setWritable(g),k&&this.setReadable(k)};c(v,w.Duplex),v.obj=function(m,g,k){return k||(k={}),k.objectMode=!0,k.highWaterMark=16,new v(m,g,k)},v.prototype.cork=function(){++this._corked==1&&this.emit("cork")},v.prototype.uncork=function(){this._corked&&--this._corked==0&&this.emit("uncork")},v.prototype.setWritable=function(m){if(this._unwrite&&this._unwrite(),this.destroyed)m&&m.destroy&&m.destroy();else if(m!==null&&m!==!1){var g=this,k=T(m,{writable:!0,readable:!1},a(this,this._forwardEnd)),y=function(){var M=g._ondrain;g._ondrain=null,M&&M()};this._unwrite&&P.nextTick(y),this._writable=m,this._writable.on("drain",y),this._unwrite=function(){g._writable.removeListener("drain",y),k()},this.uncork()}else this.end()},v.prototype.setReadable=function(m){if(this._unread&&this._unread(),this.destroyed)m&&m.destroy&&m.destroy();else{if(m===null||m===!1)return this.push(null),void this.resume();var g,k=this,y=T(m,{writable:!1,readable:!0},a(this)),C=function(){k._forward()},M=function(){k.push(null)};this._drained=!0,this._readable=m,this._readable2=m._readableState?m:(g=m,new w.Readable({objectMode:!0,highWaterMark:16}).wrap(g)),this._readable2.on("readable",C),this._readable2.on("end",M),this._unread=function(){k._readable2.removeListener("readable",C),k._readable2.removeListener("end",M),y()},this._forward()}},v.prototype._read=function(){this._drained=!0,this._forward()},v.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var m;for(this._forwarding=!0;this._drained&&(m=s(this._readable2))!==null;)this.destroyed||(this._drained=this.push(m));this._forwarding=!1}},v.prototype.destroy=function(m,g){if(g||(g=u),this.destroyed)return g(null);this.destroyed=!0;var k=this;P.nextTick(function(){k._destroy(m),g(null)})},v.prototype._destroy=function(m){if(m){var g=this._ondrain;this._ondrain=null,g?g(m):this.emit("error",m)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},v.prototype._write=function(m,g,k){if(!this.destroyed)return this._corked?d(this,this._write.bind(this,m,g,k)):m===l?this._finish(k):this._writable?void(this._writable.write(m)===!1?this._ondrain=k:this.destroyed||k()):k()},v.prototype._finish=function(m){var g=this;this.emit("preend"),d(this,function(){var k,y;k=g._forwardEnd&&g._writable,y=function(){g._writableState.prefinished===!1&&(g._writableState.prefinished=!0),g.emit("prefinish"),d(g,m)},k?k._writableState&&k._writableState.finished?y():k._writableState?k.end(y):(k.end(),y()):y()})},v.prototype.end=function(m,g,k){return typeof m=="function"?this.end(null,null,m):typeof g=="function"?this.end(m,null,g):(this._ended=!0,m&&this.write(m),this._writableState.ending||this._writableState.destroyed||this.write(l),w.Writable.prototype.end.call(this,k))},Z.exports=v}).call(this)}).call(this,D("_process"),D("buffer").Buffer)},{_process:50,buffer:17,"end-of-stream":21,inherits:24,"readable-stream":69,"stream-shift":74}],21:[function(D,Z,R){(function(P){(function(){var x=D("once"),w=function(){},T=function c(s,l,d){if(typeof l=="function")return c(s,null,l);l||(l={}),d=x(d||w);var a=s._writableState,u=s._readableState,v=l.readable||l.readable!==!1&&s.readable,m=l.writable||l.writable!==!1&&s.writable,g=!1,k=function(){s.writable||y()},y=function(){m=!1,v||d.call(s)},C=function(){v=!1,m||d.call(s)},M=function(B){d.call(s,B?new Error("exited with error code: "+B):null)},N=function(B){d.call(s,B)},Y=function(){P.nextTick(_)},_=function(){if(!g)return(!v||u&&u.ended&&!u.destroyed)&&(!m||a&&a.ended&&!a.destroyed)?void 0:d.call(s,new Error("premature close"))},G=function(){s.req.on("finish",y)};return function(et){return et.setHeader&&typeof et.abort=="function"}(s)?(s.on("complete",y),s.on("abort",Y),s.req?G():s.on("request",G)):m&&!a&&(s.on("end",k),s.on("close",k)),function(et){return et.stdio&&Array.isArray(et.stdio)&&et.stdio.length===3}(s)&&s.on("exit",M),s.on("end",C),s.on("finish",y),l.error!==!1&&s.on("error",N),s.on("close",Y),function(){g=!0,s.removeListener("complete",y),s.removeListener("abort",Y),s.removeListener("request",G),s.req&&s.req.removeListener("finish",y),s.removeListener("end",k),s.removeListener("close",k),s.removeListener("finish",y),s.removeListener("exit",M),s.removeListener("end",C),s.removeListener("error",N),s.removeListener("close",Y)}};Z.exports=T}).call(this)}).call(this,D("_process"))},{_process:50,once:48}],22:[function(D,Z,R){var P=Object.create||function(y){var C=function(){};return C.prototype=y,new C},x=Object.keys||function(y){var C=[];for(var M in y)Object.prototype.hasOwnProperty.call(y,M)&&C.push(M);return M},w=Function.prototype.bind||function(y){var C=this;return function(){return C.apply(y,arguments)}};function T(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=P(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}Z.exports=T,T.EventEmitter=T,T.prototype._events=void 0,T.prototype._maxListeners=void 0;var c,s=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),c=l.x===0}catch(y){c=!1}function d(y){return y._maxListeners===void 0?T.defaultMaxListeners:y._maxListeners}function a(y,C,M,N){var Y,_,G;if(typeof M!="function")throw new TypeError('"listener" argument must be a function');if((_=y._events)?(_.newListener&&(y.emit("newListener",C,M.listener?M.listener:M),_=y._events),G=_[C]):(_=y._events=P(null),y._eventsCount=0),G){if(typeof G=="function"?G=_[C]=N?[M,G]:[G,M]:N?G.unshift(M):G.push(M),!G.warned&&(Y=d(y))&&Y>0&&G.length>Y){G.warned=!0;var et=new Error("Possible EventEmitter memory leak detected. "+G.length+' "'+String(C)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');et.name="MaxListenersExceededWarning",et.emitter=y,et.type=C,et.count=G.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",et.name,et.message)}}else G=_[C]=M,++y._eventsCount;return y}function u(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var y=new Array(arguments.length),C=0;C<y.length;++C)y[C]=arguments[C];this.listener.apply(this.target,y)}}function v(y,C,M){var N={fired:!1,wrapFn:void 0,target:y,type:C,listener:M},Y=w.call(u,N);return Y.listener=M,N.wrapFn=Y,Y}function m(y,C,M){var N=y._events;if(!N)return[];var Y=N[C];return Y?typeof Y=="function"?M?[Y.listener||Y]:[Y]:M?function(_){for(var G=new Array(_.length),et=0;et<G.length;++et)G[et]=_[et].listener||_[et];return G}(Y):k(Y,Y.length):[]}function g(y){var C=this._events;if(C){var M=C[y];if(typeof M=="function")return 1;if(M)return M.length}return 0}function k(y,C){for(var M=new Array(C),N=0;N<C;++N)M[N]=y[N];return M}c?Object.defineProperty(T,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(C){if(typeof C!="number"||C<0||C!=C)throw new TypeError('"defaultMaxListeners" must be a positive number');s=C}}):T.defaultMaxListeners=s,T.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||isNaN(y))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=y,this},T.prototype.getMaxListeners=function(){return d(this)},T.prototype.emit=function(y){var C,M,N,Y,_,G,et=y==="error";if(G=this._events)et=et&&G.error==null;else if(!et)return!1;if(et){if(arguments.length>1&&(C=arguments[1]),C instanceof Error)throw C;var B=new Error('Unhandled "error" event. ('+C+")");throw B.context=C,B}if(!(M=G[y]))return!1;var S=typeof M=="function";switch(N=arguments.length){case 1:(function(A,L,E){if(L)A.call(E);else for(var V=A.length,$=k(A,V),W=0;W<V;++W)$[W].call(E)})(M,S,this);break;case 2:(function(A,L,E,V){if(L)A.call(E,V);else for(var $=A.length,W=k(A,$),F=0;F<$;++F)W[F].call(E,V)})(M,S,this,arguments[1]);break;case 3:(function(A,L,E,V,$){if(L)A.call(E,V,$);else for(var W=A.length,F=k(A,W),j=0;j<W;++j)F[j].call(E,V,$)})(M,S,this,arguments[1],arguments[2]);break;case 4:(function(A,L,E,V,$,W){if(L)A.call(E,V,$,W);else for(var F=A.length,j=k(A,F),q=0;q<F;++q)j[q].call(E,V,$,W)})(M,S,this,arguments[1],arguments[2],arguments[3]);break;default:for(Y=new Array(N-1),_=1;_<N;_++)Y[_-1]=arguments[_];(function(A,L,E,V){if(L)A.apply(E,V);else for(var $=A.length,W=k(A,$),F=0;F<$;++F)W[F].apply(E,V)})(M,S,this,Y)}return!0},T.prototype.addListener=function(y,C){return a(this,y,C,!1)},T.prototype.on=T.prototype.addListener,T.prototype.prependListener=function(y,C){return a(this,y,C,!0)},T.prototype.once=function(y,C){if(typeof C!="function")throw new TypeError('"listener" argument must be a function');return this.on(y,v(this,y,C)),this},T.prototype.prependOnceListener=function(y,C){if(typeof C!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(y,v(this,y,C)),this},T.prototype.removeListener=function(y,C){var M,N,Y,_,G;if(typeof C!="function")throw new TypeError('"listener" argument must be a function');if(!(N=this._events))return this;if(!(M=N[y]))return this;if(M===C||M.listener===C)--this._eventsCount==0?this._events=P(null):(delete N[y],N.removeListener&&this.emit("removeListener",y,M.listener||C));else if(typeof M!="function"){for(Y=-1,_=M.length-1;_>=0;_--)if(M[_]===C||M[_].listener===C){G=M[_].listener,Y=_;break}if(Y<0)return this;Y===0?M.shift():function(et,B){for(var S=B,A=S+1,L=et.length;A<L;S+=1,A+=1)et[S]=et[A];et.pop()}(M,Y),M.length===1&&(N[y]=M[0]),N.removeListener&&this.emit("removeListener",y,G||C)}return this},T.prototype.removeAllListeners=function(y){var C,M,N;if(!(M=this._events))return this;if(!M.removeListener)return arguments.length===0?(this._events=P(null),this._eventsCount=0):M[y]&&(--this._eventsCount==0?this._events=P(null):delete M[y]),this;if(arguments.length===0){var Y,_=x(M);for(N=0;N<_.length;++N)(Y=_[N])!=="removeListener"&&this.removeAllListeners(Y);return this.removeAllListeners("removeListener"),this._events=P(null),this._eventsCount=0,this}if(typeof(C=M[y])=="function")this.removeListener(y,C);else if(C)for(N=C.length-1;N>=0;N--)this.removeListener(y,C[N]);return this},T.prototype.listeners=function(y){return m(this,y,!0)},T.prototype.rawListeners=function(y){return m(this,y,!1)},T.listenerCount=function(y,C){return typeof y.listenerCount=="function"?y.listenerCount(C):g.call(y,C)},T.prototype.listenerCount=g,T.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],23:[function(D,Z,R){R.read=function(P,x,w,T,c){var s,l,d=8*c-T-1,a=(1<<d)-1,u=a>>1,v=-7,m=w?c-1:0,g=w?-1:1,k=P[x+m];for(m+=g,s=k&(1<<-v)-1,k>>=-v,v+=d;v>0;s=256*s+P[x+m],m+=g,v-=8);for(l=s&(1<<-v)-1,s>>=-v,v+=T;v>0;l=256*l+P[x+m],m+=g,v-=8);if(s===0)s=1-u;else{if(s===a)return l?NaN:1/0*(k?-1:1);l+=Math.pow(2,T),s-=u}return(k?-1:1)*l*Math.pow(2,s-T)},R.write=function(P,x,w,T,c,s){var l,d,a,u=8*s-c-1,v=(1<<u)-1,m=v>>1,g=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=T?0:s-1,y=T?1:-1,C=x<0||x===0&&1/x<0?1:0;for(x=Math.abs(x),isNaN(x)||x===1/0?(d=isNaN(x)?1:0,l=v):(l=Math.floor(Math.log(x)/Math.LN2),x*(a=Math.pow(2,-l))<1&&(l--,a*=2),(x+=l+m>=1?g/a:g*Math.pow(2,1-m))*a>=2&&(l++,a/=2),l+m>=v?(d=0,l=v):l+m>=1?(d=(x*a-1)*Math.pow(2,c),l+=m):(d=x*Math.pow(2,m-1)*Math.pow(2,c),l=0));c>=8;P[w+k]=255&d,k+=y,d/=256,c-=8);for(l=l<<c|d,u+=c;u>0;P[w+k]=255&l,k+=y,l/=256,u-=8);P[w+k-y]|=128*C}},{}],24:[function(D,Z,R){typeof Object.create=="function"?Z.exports=function(P,x){x&&(P.super_=x,P.prototype=Object.create(x.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}))}:Z.exports=function(P,x){if(x){P.super_=x;var w=function(){};w.prototype=x.prototype,P.prototype=new w,P.prototype.constructor=P}}},{}],25:[function(D,Z,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var P=function(){function x(w,T){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=w,this.value=T}return x.prototype.rotateLeft=function(){var w=this.parent,T=this.brother,c=this.leftChild,s=this.rightChild;if(!s)throw new Error("unknown error");var l=s.leftChild,d=s.rightChild;return w&&(w.leftChild===this?w.leftChild=s:w.rightChild===this&&(w.rightChild=s)),s.parent=w,s.brother=T,s.leftChild=this,s.rightChild=d,T&&(T.brother=s),this.parent=s,this.brother=d,this.leftChild=c,this.rightChild=l,d&&(d.parent=s,d.brother=this),c&&(c.parent=this,c.brother=l),l&&(l.parent=this,l.brother=c),s},x.prototype.rotateRight=function(){var w=this.parent,T=this.brother,c=this.leftChild;if(!c)throw new Error("unknown error");var s=this.rightChild,l=c.leftChild,d=c.rightChild;return w&&(w.leftChild===this?w.leftChild=c:w.rightChild===this&&(w.rightChild=c)),c.parent=w,c.brother=T,c.leftChild=l,c.rightChild=this,T&&(T.brother=c),l&&(l.parent=c,l.brother=this),this.parent=c,this.brother=l,this.leftChild=d,this.rightChild=s,d&&(d.parent=this,d.brother=s),s&&(s.parent=this,s.brother=d),c},x.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},x.TreeNodeColorType={red:!0,black:!1},x}();Object.freeze(P),R.default=P},{}],26:[function(D,Z,R){"use strict";var P=this&&this.__generator||function(w,T){var c,s,l,d,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return d={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function u(v){return function(m){return function(g){if(c)throw new TypeError("Generator is already executing.");for(;a;)try{if(c=1,s&&(l=2&g[0]?s.return:g[0]?s.throw||((l=s.return)&&l.call(s),0):s.next)&&!(l=l.call(s,g[1])).done)return l;switch(s=0,l&&(g=[2&g[0],l.value]),g[0]){case 0:case 1:l=g;break;case 4:return a.label++,{value:g[1],done:!1};case 5:a.label++,s=g[1],g=[0];continue;case 7:g=a.ops.pop(),a.trys.pop();continue;default:if(!(l=(l=a.trys).length>0&&l[l.length-1])&&(g[0]===6||g[0]===2)){a=0;continue}if(g[0]===3&&(!l||g[1]>l[0]&&g[1]<l[3])){a.label=g[1];break}if(g[0]===6&&a.label<l[1]){a.label=l[1],l=g;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(g);break}l[2]&&a.ops.pop(),a.trys.pop();continue}g=T.call(w,a)}catch(k){g=[6,k],s=0}finally{c=l=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([v,m])}}};function x(w){var T=this;w===void 0&&(w=[]);var c=[],s=0,l=0,d=0,a=0,u=0,v=0;this.size=function(){return v},this.empty=function(){return v===0},this.clear=function(){s=d=l=a=u=v=0,g.call(this,x.bucketSize),v=0},this.front=function(){return c[s][l]},this.back=function(){return c[d][a]},this.forEach=function(k){if(!this.empty()){var y=0;if(s!==d){for(M=l;M<x.bucketSize;++M)k(c[s][M],y++);for(M=s+1;M<d;++M)for(var C=0;C<x.bucketSize;++C)k(c[M][C],y++);for(M=0;M<=a;++M)k(c[d][M],y++)}else for(var M=l;M<=a;++M)k(c[s][M],y++)}};var m=function(y){var C=s*x.bucketSize+l,M=C+y,N=d*x.bucketSize+a;if(M<C||M>N)throw new Error("pos should more than 0 and less than queue's size");return{curNodeBucketIndex:Math.floor(M/x.bucketSize),curNodePointerIndex:M%x.bucketSize}};this.getElementByPos=function(k){var y=m(k),C=y.curNodeBucketIndex,M=y.curNodePointerIndex;return c[C][M]},this.eraseElementByPos=function(k){var y=this;if(k<0||k>v)throw new Error("pos should more than 0 and less than queue's size");if(k===0)this.popFront();else if(k===this.size())this.popBack();else{for(var C=[],M=k+1;M<v;++M)C.push(this.getElementByPos(M));this.cut(k),this.popBack(),C.forEach(function(N){return y.pushBack(N)})}},this.eraseElementByValue=function(k){if(!this.empty()){var y=[];this.forEach(function(N){N!==k&&y.push(N)});for(var C=y.length,M=0;M<C;++M)this.setElementByPos(M,y[M]);this.cut(C-1)}};var g=function(y){for(var C=[],M=y*x.sigma,N=Math.max(Math.ceil(M/x.bucketSize),2),Y=0;Y<N;++Y)C.push(new Array(x.bucketSize));var _=Math.ceil(y/x.bucketSize),G=Math.floor(N/2)-Math.floor(_/2),et=G,B=0;if(this.size())for(Y=0;Y<_;++Y){for(var S=0;S<x.bucketSize;++S)if(C[G+Y][S]=this.front(),this.popFront(),this.empty()){et=G+Y,B=S;break}if(this.empty())break}c=C,s=G,l=0,d=et,a=B,u=N,v=y};this.pushBack=function(k){this.empty()||(d===u-1&&a===x.bucketSize-1&&g.call(this,this.size()),a<x.bucketSize-1?++a:d<u-1&&(++d,a=0)),++v,c[d][a]=k},this.popBack=function(){this.empty()||(this.size()!==1&&(a>0?--a:s<d&&(--d,a=x.bucketSize-1)),v>0&&--v)},this.setElementByPos=function(k,y){var C=m(k),M=C.curNodeBucketIndex,N=C.curNodePointerIndex;c[M][N]=y},this.insert=function(k,y,C){var M=this;if(C===void 0&&(C=1),k===0)for(;C--;)this.pushFront(y);else if(k===this.size())for(;C--;)this.pushBack(y);else{for(var N=[],Y=k;Y<v;++Y)N.push(this.getElementByPos(Y));for(this.cut(k-1),Y=0;Y<C;++Y)this.pushBack(y);N.forEach(function(_){return M.pushBack(_)})}},this.find=function(k){if(s===d){for(var y=l;y<=a;++y)if(c[s][y]===k)return!0;return!1}for(y=l;y<x.bucketSize;++y)if(c[s][y]===k)return!0;for(y=s+1;y<d;++y)for(var C=0;C<x.bucketSize;++C)if(c[y][C]===k)return!0;for(y=0;y<=a;++y)if(c[d][y]===k)return!0;return!1},this.reverse=function(){for(var k=0,y=v-1;k<y;){var C=this.getElementByPos(k);this.setElementByPos(k,this.getElementByPos(y)),this.setElementByPos(y,C),++k,--y}},this.unique=function(){if(!this.empty()){var k=[],y=this.front();this.forEach(function(M,N){N!==0&&M===y||(k.push(M),y=M)});for(var C=0;C<v;++C)this.setElementByPos(C,k[C]);this.cut(k.length-1)}},this.sort=function(k){var y=[];this.forEach(function(M){y.push(M)}),y.sort(k);for(var C=0;C<v;++C)this.setElementByPos(C,y[C])},this.pushFront=function(k){this.empty()||(s===0&&l===0&&g.call(this,this.size()),l>0?--l:s>0&&(--s,l=x.bucketSize-1)),++v,c[s][l]=k},this.popFront=function(){this.empty()||(this.size()!==1&&(l<x.bucketSize-1?++l:s<d&&(++s,l=0)),v>0&&--v)},this.shrinkToFit=function(){var k=this,y=[];this.forEach(function(Y){y.push(Y)});var C=y.length;c=[];for(var M=Math.ceil(C/x.bucketSize),N=0;N<M;++N)c.push(new Array(x.bucketSize));this.clear(),y.forEach(function(Y){return k.pushBack(Y)})},this.cut=function(k){if(k<0)this.clear();else{var y=m(k),C=y.curNodeBucketIndex,M=y.curNodePointerIndex;d=C,a=M,v=k+1}},this[Symbol.iterator]=function(){return function(){var k,y;return P(this,function(C){switch(C.label){case 0:if(v===0)return[2];if(s!==d)return[3,5];y=l,C.label=1;case 1:return y<=a?[4,c[s][y]]:[3,4];case 2:C.sent(),C.label=3;case 3:return++y,[3,1];case 4:return[2];case 5:y=l,C.label=6;case 6:return y<x.bucketSize?[4,c[s][y]]:[3,9];case 7:C.sent(),C.label=8;case 8:return++y,[3,6];case 9:y=s+1,C.label=10;case 10:if(!(y<d))return[3,15];k=0,C.label=11;case 11:return k<x.bucketSize?[4,c[y][k]]:[3,14];case 12:C.sent(),C.label=13;case 13:return++k,[3,11];case 14:return++y,[3,10];case 15:y=0,C.label=16;case 16:return y<=a?[4,c[d][y]]:[3,19];case 17:C.sent(),C.label=18;case 18:return++y,[3,16];case 19:return[2]}})}()},function(){var k=x.bucketSize;w.size?k=w.size():w.length&&(k=w.length);var y=k*x.sigma;u=Math.ceil(y/x.bucketSize),u=Math.max(u,3);for(var C=0;C<u;++C)c.push(new Array(x.bucketSize));var M=Math.ceil(k/x.bucketSize);s=Math.floor(u/2)-Math.floor(M/2),d=s,w.forEach(function(N){return T.pushBack(N)})}(),Object.freeze(this)}Object.defineProperty(R,"__esModule",{value:!0}),x.sigma=3,x.bucketSize=5e3,Object.freeze(x),R.default=x},{}],27:[function(D,Z,R){"use strict";var P=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(k){return function(y){return function(C){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&C[0]?a.return:C[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,C[1])).done)return u;switch(a=0,u&&(C=[2&C[0],u.value]),C[0]){case 0:case 1:u=C;break;case 4:return m.label++,{value:C[1],done:!1};case 5:m.label++,a=C[1],C=[0];continue;case 7:C=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(C[0]===6||C[0]===2)){m=0;continue}if(C[0]===3&&(!u||C[1]>u[0]&&C[1]<u[3])){m.label=C[1];break}if(C[0]===6&&m.label<u[1]){m.label=u[1],u=C;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(C);break}u[2]&&m.ops.pop(),m.trys.pop();continue}C=l.call(s,m)}catch(M){C=[6,M],a=0}finally{d=u=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}([k,y])}}},x=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(R,"__esModule",{value:!0});var w=D("../LinkList/LinkList"),T=D("../Map/Map");function c(s,l,d){var a=this;if(s===void 0&&(s=[]),l===void 0&&(l=c.initSize),d=d||function(g){var k,y,C=0,M="";if(typeof g=="number")C=((C=Math.floor(g))<<5)-C,C&=C;else{M=typeof g!="string"?JSON.stringify(g):g;try{for(var N=x(M),Y=N.next();!Y.done;Y=N.next())C=(C<<5)-C+Y.value.charCodeAt(0),C&=C}catch(_){k={error:_}}finally{try{Y&&!Y.done&&(y=N.return)&&y.call(N)}finally{if(k)throw k.error}}}return C^=C>>>16},(l&l-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var u=0,v=[],m=Math.max(c.initSize,Math.min(c.maxSize,l));this.size=function(){return u},this.empty=function(){return u===0},this.clear=function(){u=0,m=l,v=[]},this.forEach=function(g){var k=0;v.forEach(function(y){y.forEach(function(C){g(C,k++)})})},this.setElement=function(g,k){var y,C;if(g==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(k!=null){var M=d(g)&m-1;if(v[M]){var N=v[M].size();if(v[M]instanceof w.default){try{for(var Y=x(v[M]),_=Y.next();!_.done;_=Y.next()){var G=_.value;if(G.key===g)return void(G.value=k)}}catch(B){y={error:B}}finally{try{_&&!_.done&&(C=Y.return)&&C.call(Y)}finally{if(y)throw y.error}}v[M].pushBack({key:g,value:k}),v[M].size()>=c.treeifyThreshold&&(v[M]=new T.default(v[M]))}else v[M].setElement(g,k);var et=v[M].size();u+=et-N}else++u,v[M]=new w.default([{key:g,value:k}]);u>m*c.sigma&&function(B){if(!(B>=c.maxSize)){m=2*B;var S=[];v.forEach(function(A,L){if(!A.empty()){if(A instanceof w.default&&A.size()===1){var E=A.front(),V=E.key,$=E.value;S[d(V)&m-1]=new w.default([{key:V,value:$}])}else if(A instanceof T.default){var W=new w.default,F=new w.default;A.forEach(function(H){(d(H.key)&B)==0?W.pushBack(H):F.pushBack(H)}),W.size()>c.untreeifyThreshold?S[L]=new T.default(W):W.size()&&(S[L]=W),F.size()>c.untreeifyThreshold?S[L+B]=new T.default(F):F.size()&&(S[L+B]=F)}else{var j=new w.default,q=new w.default;A.forEach(function(H){(d(H.key)&B)==0?j.pushBack(H):q.pushBack(H)}),j.size()&&(S[L]=j),q.size()&&(S[L+B]=q)}v[L].clear()}}),v=S}}.call(this,m)}else this.eraseElementByKey(g)},this.getElementByKey=function(g){var k,y,C=d(g)&m-1;if(v[C]){if(v[C]instanceof T.default)return v[C].getElementByKey(g);try{for(var M=x(v[C]),N=M.next();!N.done;N=M.next()){var Y=N.value;if(Y.key===g)return Y.value}}catch(_){k={error:_}}finally{try{N&&!N.done&&(y=M.return)&&y.call(M)}finally{if(k)throw k.error}}}},this.eraseElementByKey=function(g){var k,y,C=d(g)&m-1;if(v[C]){var M=v[C].size();if(v[C]instanceof T.default)v[C].eraseElementByKey(g),v[C].size()<=c.untreeifyThreshold&&(v[C]=new w.default(v[C]));else{var N=-1;try{for(var Y=x(v[C]),_=Y.next();!_.done;_=Y.next())if(++N,_.value.key===g){v[C].eraseElementByPos(N);break}}catch(et){k={error:et}}finally{try{_&&!_.done&&(y=Y.return)&&y.call(Y)}finally{if(k)throw k.error}}}var G=v[C].size();u+=G-M}},this.find=function(g){var k,y,C=d(g)&m-1;if(!v[C])return!1;if(v[C]instanceof T.default)return v[C].find(g);try{for(var M=x(v[C]),N=M.next();!N.done;N=M.next())if(N.value.key===g)return!0}catch(Y){k={error:Y}}finally{try{N&&!N.done&&(y=M.return)&&y.call(M)}finally{if(k)throw k.error}}return!1},this[Symbol.iterator]=function(){return function(){var g,k,y,C,M,N;return P(this,function(Y){switch(Y.label){case 0:g=0,Y.label=1;case 1:if(!(g<m))return[3,10];for(;g<m&&!v[g];)++g;if(g>=m)return[3,10];Y.label=2;case 2:Y.trys.push([2,7,8,9]),M=void 0,k=x(v[g]),y=k.next(),Y.label=3;case 3:return y.done?[3,6]:[4,y.value];case 4:Y.sent(),Y.label=5;case 5:return y=k.next(),[3,3];case 6:return[3,9];case 7:return C=Y.sent(),M={error:C},[3,9];case 8:try{y&&!y.done&&(N=k.return)&&N.call(k)}finally{if(M)throw M.error}return[7];case 9:return++g,[3,1];case 10:return[2]}})}()},s.forEach(function(g){var k=g.key,y=g.value;return a.setElement(k,y)}),Object.freeze(this)}c.initSize=16,c.maxSize=1<<30,c.sigma=.75,c.treeifyThreshold=8,c.untreeifyThreshold=6,c.minTreeifySize=64,Object.freeze(c),R.default=c},{"../LinkList/LinkList":29,"../Map/Map":30}],28:[function(D,Z,R){"use strict";var P=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(k){return function(y){return function(C){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&C[0]?a.return:C[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,C[1])).done)return u;switch(a=0,u&&(C=[2&C[0],u.value]),C[0]){case 0:case 1:u=C;break;case 4:return m.label++,{value:C[1],done:!1};case 5:m.label++,a=C[1],C=[0];continue;case 7:C=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(C[0]===6||C[0]===2)){m=0;continue}if(C[0]===3&&(!u||C[1]>u[0]&&C[1]<u[3])){m.label=C[1];break}if(C[0]===6&&m.label<u[1]){m.label=u[1],u=C;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(C);break}u[2]&&m.ops.pop(),m.trys.pop();continue}C=l.call(s,m)}catch(M){C=[6,M],a=0}finally{d=u=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}([k,y])}}},x=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(R,"__esModule",{value:!0});var w=D("../Set/Set"),T=D("../LinkList/LinkList");function c(s,l,d){var a=this;if(s===void 0&&(s=[]),l===void 0&&(l=c.initSize),d=d||function(g){var k=0,y="";if(typeof g=="number")k=((k=Math.floor(g))<<5)-k,k&=k;else{y=typeof g!="string"?JSON.stringify(g):g;for(var C=0;C<y.length;C++)k=(k<<5)-k+y.charCodeAt(C),k&=k}return k^=k>>>16},(l&l-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var u=0,v=[],m=Math.max(c.initSize,Math.min(c.maxSize,l));this.size=function(){return u},this.empty=function(){return u===0},this.clear=function(){u=0,m=l,v=[]},this.forEach=function(g){var k=0;v.forEach(function(y){y.forEach(function(C){g(C,k++)})})},this.insert=function(g){if(g==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");var k=d(g)&m-1;if(v[k]){var y=v[k].size();if(v[k]instanceof T.default){if(v[k].find(g))return;v[k].pushBack(g),v[k].size()>=c.treeifyThreshold&&(v[k]=new w.default(v[k]))}else v[k].insert(g);var C=v[k].size();u+=C-y}else v[k]=new T.default([g]),++u;u>m*c.sigma&&function(M){if(!(M>=c.maxSize)){m=2*M;var N=[];v.forEach(function(Y,_){if(!Y.empty()){if(Y instanceof T.default&&Y.size()===1){var G=Y.front();if(G===void 0)throw new Error("unknown error");N[d(G)&m-1]=new T.default([G])}else if(Y instanceof w.default){var et=new T.default,B=new T.default;Y.forEach(function(L){(d(L)&M)==0?et.pushBack(L):B.pushBack(L)}),et.size()>c.untreeifyThreshold?N[_]=new w.default(et):et.size()&&(N[_]=et),B.size()>c.untreeifyThreshold?N[_+M]=new w.default(B):B.size()&&(N[_+M]=B)}else{var S=new T.default,A=new T.default;Y.forEach(function(L){(d(L)&M)==0?S.pushBack(L):A.pushBack(L)}),S.size()&&(N[_]=S),A.size()&&(N[_+M]=A)}v[_].clear()}}),v=N}}.call(this,m)},this.eraseElementByValue=function(g){var k=d(g)&m-1;if(v[k]){var y=v[k].size();v[k].eraseElementByValue(g),v[k]instanceof w.default&&v[k].size()<=c.untreeifyThreshold&&(v[k]=new T.default(v[k]));var C=v[k].size();u+=C-y}},this.find=function(g){var k=d(g)&m-1;return!!v[k]&&v[k].find(g)},this[Symbol.iterator]=function(){return function(){var g,k,y,C,M,N;return P(this,function(Y){switch(Y.label){case 0:g=0,Y.label=1;case 1:if(!(g<m))return[3,10];for(;g<m&&!v[g];)++g;if(g>=m)return[3,10];Y.label=2;case 2:Y.trys.push([2,7,8,9]),M=void 0,k=x(v[g]),y=k.next(),Y.label=3;case 3:return y.done?[3,6]:[4,y.value];case 4:Y.sent(),Y.label=5;case 5:return y=k.next(),[3,3];case 6:return[3,9];case 7:return C=Y.sent(),M={error:C},[3,9];case 8:try{y&&!y.done&&(N=k.return)&&N.call(k)}finally{if(M)throw M.error}return[7];case 9:return++g,[3,1];case 10:return[2]}})}()},s.forEach(function(g){return a.insert(g)}),Object.freeze(this)}c.initSize=16,c.maxSize=1<<30,c.sigma=.75,c.treeifyThreshold=8,c.untreeifyThreshold=6,c.minTreeifySize=64,Object.freeze(c),R.default=c},{"../LinkList/LinkList":29,"../Set/Set":33}],29:[function(D,Z,R){"use strict";var P=this&&this.__generator||function(T,c){var s,l,d,a,u={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return a={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function v(m){return function(g){return function(k){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,l&&(d=2&k[0]?l.return:k[0]?l.throw||((d=l.return)&&d.call(l),0):l.next)&&!(d=d.call(l,k[1])).done)return d;switch(l=0,d&&(k=[2&k[0],d.value]),k[0]){case 0:case 1:d=k;break;case 4:return u.label++,{value:k[1],done:!1};case 5:u.label++,l=k[1],k=[0];continue;case 7:k=u.ops.pop(),u.trys.pop();continue;default:if(!(d=(d=u.trys).length>0&&d[d.length-1])&&(k[0]===6||k[0]===2)){u=0;continue}if(k[0]===3&&(!d||k[1]>d[0]&&k[1]<d[3])){u.label=k[1];break}if(k[0]===6&&u.label<d[1]){u.label=d[1],d=k;break}if(d&&u.label<d[2]){u.label=d[2],u.ops.push(k);break}d[2]&&u.ops.pop(),u.trys.pop();continue}k=c.call(T,u)}catch(y){k=[6,y],l=0}finally{s=d=0}if(5&k[0])throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}([m,g])}}};Object.defineProperty(R,"__esModule",{value:!0});var x=function(){return function(T){this.value=void 0,this.pre=void 0,this.next=void 0,this.value=T}}();function w(T){var c=this;T===void 0&&(T=[]);var s=0,l=void 0,d=void 0;this.size=function(){return s},this.empty=function(){return s===0},this.clear=function(){l=d=void 0,s=0},this.front=function(){return l==null?void 0:l.value},this.back=function(){return d==null?void 0:d.value},this.forEach=function(a){for(var u=l,v=0;u;){if(u.value===void 0)throw new Error("unknown error");a(u.value,v++),u=u.next}},this.getElementByPos=function(a){if(a<0||a>=s)throw new Error("pos must more then 0 and less then the list length");for(var u=l;a--&&u;)u=u.next;if(!u||u.value===void 0)throw new Error("unknown error");return u.value},this.eraseElementByPos=function(a){if(a<0||a>=s)throw new Error("erase pos must more then 0 and less then the list length");if(a===0)this.popFront();else if(a===s-1)this.popBack();else{for(var u=l;a--;){if(!(u==null?void 0:u.next))throw new Error("unknown error");u=u.next}if(!u||!u.pre||!u.next)throw new Error("unknown error");var v=u.pre,m=u.next;m.pre=v,v.next=m,s>0&&--s}},this.eraseElementByValue=function(a){for(;l&&l.value===a;)this.popFront();for(;d&&d.value===a;)this.popBack();if(l)for(var u=l;u;){if(u.value===a){var v=u.pre,m=u.next;m&&(m.pre=v),v&&(v.next=m),s>0&&--s}u=u.next}},this.pushBack=function(a){if(a==null)throw new Error("you can't push null or undefined here");++s;var u=new x(a);d?(d.next=u,u.pre=d,d=u):l=d=u},this.popBack=function(){d&&(s>0&&--s,d&&(l===d?l=d=void 0:(d=d.pre)&&(d.next=void 0)))},this.setElementByPos=function(a,u){if(u==null)throw new Error("you can't set null or undefined here");if(a<0||a>=s)throw new Error("pos must more then 0 and less then the list length");for(var v=l;a--;){if(!v)throw new Error("unknown error");v=v.next}v&&(v.value=u)},this.insert=function(a,u,v){if(v===void 0&&(v=1),u==null)throw new Error("you can't insert null or undefined here");if(a<0||a>s)throw new Error("insert pos must more then 0 and less then or equal to the list length");if(v<0)throw new Error("insert size must more than 0");if(a===0)for(;v--;)this.pushFront(u);else if(a===s)for(;v--;)this.pushBack(u);else{for(var m=l,g=1;g<a;++g){if(!(m==null?void 0:m.next))throw new Error("unknown error");m=m==null?void 0:m.next}if(!m)throw new Error("unknown error");var k=m.next;for(s+=v;v--;)m.next=new x(u),m.next.pre=m,m=m.next;m.next=k,k&&(k.pre=m)}},this.find=function(a){for(var u=l;u;){if(u.value===a)return!0;u=u.next}return!1},this.reverse=function(){for(var a=l,u=d,v=0;a&&u&&2*v<s;){var m=a.value;a.value=u.value,u.value=m,a=a.next,u=u.pre,++v}},this.unique=function(){for(var a=l;a;){for(var u=a;u&&u.next&&u.value===u.next.value;)u=u.next,s>0&&--s;a.next=u.next,a.next&&(a.next.pre=a),a=a.next}},this.sort=function(a){var u=[];this.forEach(function(m){u.push(m)}),u.sort(a);var v=l;u.forEach(function(m){v&&(v.value=m,v=v.next)})},this.pushFront=function(a){if(a==null)throw new Error("you can't push null or undefined here");++s;var u=new x(a);l?(u.next=l,l.pre=u,l=u):l=d=u},this.popFront=function(){l&&(s>0&&--s,l&&(l===d?l=d=void 0:(l=l.next)&&(l.pre=void 0)))},this.merge=function(a){var u=this,v=l;a.forEach(function(m){for(;v&&v.value!==void 0&&v.value<=m;)v=v.next;if(v===void 0)u.pushBack(m),v=d;else if(v===l)u.pushFront(m),v=l;else{++s;var g=v.pre;g&&(g.next=new x(m),g.next.pre=g,g.next.next=v,v&&(v.pre=g.next))}})},this[Symbol.iterator]=function(){return function(){var a;return P(this,function(u){switch(u.label){case 0:a=l,u.label=1;case 1:if(a===void 0)return[3,3];if(!a.value)throw new Error("unknown error");return[4,a.value];case 2:return u.sent(),a=a.next,[3,1];case 3:return[2]}})}()},T.forEach(function(a){return c.pushBack(a)}),Object.freeze(this)}Object.freeze(w),R.default=w},{}],30:[function(D,Z,R){"use strict";var P=this&&this.__generator||function(c,s){var l,d,a,u,v={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(g){return function(k){return function(y){if(l)throw new TypeError("Generator is already executing.");for(;v;)try{if(l=1,d&&(a=2&y[0]?d.return:y[0]?d.throw||((a=d.return)&&a.call(d),0):d.next)&&!(a=a.call(d,y[1])).done)return a;switch(d=0,a&&(y=[2&y[0],a.value]),y[0]){case 0:case 1:a=y;break;case 4:return v.label++,{value:y[1],done:!1};case 5:v.label++,d=y[1],y=[0];continue;case 7:y=v.ops.pop(),v.trys.pop();continue;default:if(!(a=(a=v.trys).length>0&&a[a.length-1])&&(y[0]===6||y[0]===2)){v=0;continue}if(y[0]===3&&(!a||y[1]>a[0]&&y[1]<a[3])){v.label=y[1];break}if(y[0]===6&&v.label<a[1]){v.label=a[1],a=y;break}if(a&&v.label<a[2]){v.label=a[2],v.ops.push(y);break}a[2]&&v.ops.pop(),v.trys.pop();continue}y=s.call(c,v)}catch(C){y=[6,C],d=0}finally{l=a=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([g,k])}}},x=this&&this.__values||function(c){var s=typeof Symbol=="function"&&Symbol.iterator,l=s&&c[s],d=0;if(l)return l.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(R,"__esModule",{value:!0});var w=D("../Base/TreeNode");function T(c,s){var l=this;c===void 0&&(c=[]),s=s||function(B,S){return B<S?-1:B>S?1:0};var d=0,a=new w.default;a.color=w.default.TreeNodeColorType.black,this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.key=a.value=void 0,a.leftChild=a.rightChild=a.brother=void 0};var u=function B(S){if(!S||S.key===void 0)throw new Error("unknown error");return S.leftChild?B(S.leftChild):S},v=function B(S){if(!S||S.key===void 0)throw new Error("unknown error");return S.rightChild?B(S.rightChild):S};this.front=function(){if(!this.empty()){var B=u(a);if(B.key===void 0||B.value===void 0)throw new Error("unknown error");return{key:B.key,value:B.value}}},this.back=function(){if(!this.empty()){var B=v(a);if(B.key===void 0||B.value===void 0)throw new Error("unknown error");return{key:B.key,value:B.value}}},this.forEach=function(B){var S,A,L=0;try{for(var E=x(this),V=E.next();!V.done;V=E.next())B(V.value,L++)}catch($){S={error:$}}finally{try{V&&!V.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}},this.getElementByPos=function(B){var S,A;if(B<0||B>=this.size())throw new Error("pos must more than 0 and less than set's size");var L=0;try{for(var E=x(this),V=E.next();!V.done;V=E.next()){var $=V.value;if(L===B)return $;++L}}catch(W){S={error:W}}finally{try{V&&!V.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}throw new Error("unknown Error")};var m=function B(S,A){if(S&&S.key!==void 0&&S.value!==void 0){var L=s(S.key,A);return L===0?{key:S.key,value:S.value}:L<0?B(S.rightChild,A):B(S.leftChild,A)||{key:S.key,value:S.value}}};this.lowerBound=function(B){return m(a,B)};var g=function B(S,A){if(S&&S.key!==void 0&&S.value!==void 0)return s(S.key,A)<=0?B(S.rightChild,A):B(S.leftChild,A)||{key:S.key,value:S.value}};this.upperBound=function(B){return g(a,B)};var k=function B(S,A){if(S&&S.key!==void 0&&S.value!==void 0){var L=s(S.key,A);return L===0?{key:S.key,value:S.value}:L>0?B(S.leftChild,A):B(S.rightChild,A)||{key:S.key,value:S.value}}};this.reverseLowerBound=function(B){return k(a,B)};var y=function B(S,A){if(S&&S.key!==void 0&&S.value!==void 0)return s(S.key,A)>=0?B(S.leftChild,A):B(S.rightChild,A)||{key:S.key,value:S.value}};this.reverseUpperBound=function(B){return y(a,B)};var C=function B(S){var A=S.parent;if(!A){if(S===a)return;throw new Error("unknown error")}if(S.color!==w.default.TreeNodeColorType.red){var L=S.brother;if(!L)throw new Error("unknown error");if(S===A.leftChild)if(L.color===w.default.TreeNodeColorType.red){L.color=w.default.TreeNodeColorType.black,A.color=w.default.TreeNodeColorType.red;var E=A.rotateLeft();a===A&&(a=E),B(S)}else L.color===w.default.TreeNodeColorType.black&&(L.rightChild&&L.rightChild.color===w.default.TreeNodeColorType.red?(L.color=A.color,A.color=w.default.TreeNodeColorType.black,L.rightChild&&(L.rightChild.color=w.default.TreeNodeColorType.black),E=A.rotateLeft(),a===A&&(a=E),S.color=w.default.TreeNodeColorType.black):L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||!L.leftChild||L.leftChild.color!==w.default.TreeNodeColorType.red?L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||(L.color=w.default.TreeNodeColorType.red,B(A)):(L.color=w.default.TreeNodeColorType.red,L.leftChild&&(L.leftChild.color=w.default.TreeNodeColorType.black),E=L.rotateRight(),a===L&&(a=E),B(S)));else S===A.rightChild&&(L.color===w.default.TreeNodeColorType.red?(L.color=w.default.TreeNodeColorType.black,A.color=w.default.TreeNodeColorType.red,E=A.rotateRight(),a===A&&(a=E),B(S)):L.color===w.default.TreeNodeColorType.black&&(L.leftChild&&L.leftChild.color===w.default.TreeNodeColorType.red?(L.color=A.color,A.color=w.default.TreeNodeColorType.black,L.leftChild&&(L.leftChild.color=w.default.TreeNodeColorType.black),E=A.rotateRight(),a===A&&(a=E),S.color=w.default.TreeNodeColorType.black):L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||!L.rightChild||L.rightChild.color!==w.default.TreeNodeColorType.red?L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||(L.color=w.default.TreeNodeColorType.red,B(A)):(L.color=w.default.TreeNodeColorType.red,L.rightChild&&(L.rightChild.color=w.default.TreeNodeColorType.black),E=L.rotateLeft(),a===L&&(a=E),B(S))))}else S.color=w.default.TreeNodeColorType.black},M=function(S){for(var A=S;A.leftChild||A.rightChild;){if(A.rightChild){A=u(A.rightChild);var L=S.key;S.key=A.key,A.key=L;var E=S.value;S.value=A.value,A.value=E,S=A}A.leftChild&&(A=v(A.leftChild),L=S.key,S.key=A.key,A.key=L,E=S.value,S.value=A.value,A.value=E,S=A)}C(A),A&&A.remove(),--d,a.color=w.default.TreeNodeColorType.black},N=function B(S,A){return!(!S||S.key===void 0)&&(!!B(S.leftChild,A)||!!A(S)||B(S.rightChild,A))};this.eraseElementByPos=function(B){if(B<0||B>=d)throw new Error("pos must more than 0 and less than set's size");var S=0;N(a,function(A){return B===S?(M(A),!0):(++S,!1)})},this.eraseElementByKey=function(B){if(!this.empty()){var S=G(a,B);S!==void 0&&S.key!==void 0&&s(S.key,B)===0&&M(S)}};var Y=function B(S,A){if(!S||S.key===void 0)throw new Error("unknown error");var L=s(A,S.key);return L<0?S.leftChild?B(S.leftChild,A):(S.leftChild=new w.default,S.leftChild.parent=S,S.leftChild.brother=S.rightChild,S.rightChild&&(S.rightChild.brother=S.leftChild),S.leftChild):L>0?S.rightChild?B(S.rightChild,A):(S.rightChild=new w.default,S.rightChild.parent=S,S.rightChild.brother=S.leftChild,S.leftChild&&(S.leftChild.brother=S.rightChild),S.rightChild):S},_=function B(S){var A=S.parent;if(!A){if(S===a)return;throw new Error("unknown error")}if(A.color!==w.default.TreeNodeColorType.black&&A.color===w.default.TreeNodeColorType.red){var L=A.brother,E=A.parent;if(!E)throw new Error("unknown error");if(L&&L.color===w.default.TreeNodeColorType.red)L.color=A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red,B(E);else if(!L||L.color===w.default.TreeNodeColorType.black)if(A===E.leftChild)if(S===A.leftChild){A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red;var V=E.rotateRight();E===a&&(a=V)}else S===A.rightChild&&(V=A.rotateLeft(),E===a&&(a=V),B(A));else A===E.rightChild&&(S===A.leftChild?(V=A.rotateRight(),E===a&&(a=V),B(A)):S===A.rightChild&&(A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red,V=E.rotateLeft(),E===a&&(a=V)))}};this.setElement=function(B,S){if(B==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(S!=null){if(this.empty())return++d,a.key=B,a.value=S,void(a.color=w.default.TreeNodeColorType.black);var A=Y(a,B);A.key===void 0||s(A.key,B)!==0?(++d,A.key=B,A.value=S,_(A),a.color=w.default.TreeNodeColorType.black):A.value=S}else this.eraseElementByKey(B)};var G=function B(S,A){if(S&&S.key!==void 0){var L=s(A,S.key);return L<0?B(S.leftChild,A):L>0?B(S.rightChild,A):S}};this.find=function(B){return!!G(a,B)},this.getElementByKey=function(B){var S=G(a,B);if((S==null?void 0:S.key)===void 0||(S==null?void 0:S.value)===void 0)throw new Error("unknown error");return S.value},this.union=function(B){var S=this;B.forEach(function(A){var L=A.key,E=A.value;return S.setElement(L,E)})},this.getHeight=function(){if(this.empty())return 0;var B=function S(A){return A?Math.max(S(A.leftChild),S(A.rightChild))+1:1};return B(a)};var et=function B(S){return P(this,function(A){switch(A.label){case 0:return S&&S.key!==void 0&&S.value!==void 0?[5,x(B(S.leftChild))]:[2];case 1:return A.sent(),[4,{key:S.key,value:S.value}];case 2:return A.sent(),[5,x(B(S.rightChild))];case 3:return A.sent(),[2]}})};this[Symbol.iterator]=function(){return et(a)},c.forEach(function(B){var S=B.key,A=B.value;return l.setElement(S,A)}),Object.freeze(this)}Object.freeze(T),R.default=T},{"../Base/TreeNode":25}],31:[function(D,Z,R){"use strict";function P(x,w){x===void 0&&(x=[]),w=w||function(d,a){return d>a?-1:d<a?1:0};var T=[];x.forEach(function(d){return T.push(d)});var c=T.length,s=function(a,u){if(a<0||a>=c)throw new Error("unknown error");if(u<0||u>=c)throw new Error("unknown error");var v=T[a];T[a]=T[u],T[u]=v},l=function(a){if(a<0||a>=c)throw new Error("unknown error");var u=2*a+1,v=2*a+2;u<c&&w(T[a],T[u])>0&&s(a,u),v<c&&w(T[a],T[v])>0&&s(a,v)};(function(){for(var d=Math.floor((c-1)/2);d>=0;--d)for(var a=d,u=2*a+1;u<c;){var v=u+1,m=u;if(v<c&&w(T[u],T[v])>0&&(m=v),w(T[a],T[m])<=0)break;s(a,m),u=2*(a=m)+1}})(),this.size=function(){return c},this.empty=function(){return c===0},this.clear=function(){c=0,T.length=0},this.push=function(d){if(T.push(d),++c!=1)for(var a=c-1;a>0;){var u=Math.floor((a-1)/2);if(w(T[u],d)<=0)break;l(u),a=u}},this.pop=function(){if(!this.empty())if(this.size()!==1){var d=T[c-1];--c;for(var a=0;a<this.size();){var u=2*a+1,v=2*a+2;if(u>=this.size())break;var m=u;if(v<this.size()&&w(T[u],T[v])>0&&(m=v),w(T[m],d)>=0)break;T[a]=T[m],a=m}T[a]=d}else--c},this.top=function(){return T[0]},Object.freeze(this)}Object.defineProperty(R,"__esModule",{value:!0}),Object.freeze(P),R.default=P},{}],32:[function(D,Z,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var P=D("../LinkList/LinkList");function x(w){w===void 0&&(w=[]);var T=new P.default(w);this.size=function(){return T.size()},this.empty=function(){return T.empty()},this.clear=function(){T.clear()},this.push=function(c){T.pushBack(c)},this.pop=function(){T.popFront()},this.front=function(){return T.front()},Object.freeze(this)}Object.freeze(x),R.default=x},{"../LinkList/LinkList":29}],33:[function(D,Z,R){"use strict";var P=this&&this.__generator||function(c,s){var l,d,a,u,v={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(g){return function(k){return function(y){if(l)throw new TypeError("Generator is already executing.");for(;v;)try{if(l=1,d&&(a=2&y[0]?d.return:y[0]?d.throw||((a=d.return)&&a.call(d),0):d.next)&&!(a=a.call(d,y[1])).done)return a;switch(d=0,a&&(y=[2&y[0],a.value]),y[0]){case 0:case 1:a=y;break;case 4:return v.label++,{value:y[1],done:!1};case 5:v.label++,d=y[1],y=[0];continue;case 7:y=v.ops.pop(),v.trys.pop();continue;default:if(!(a=(a=v.trys).length>0&&a[a.length-1])&&(y[0]===6||y[0]===2)){v=0;continue}if(y[0]===3&&(!a||y[1]>a[0]&&y[1]<a[3])){v.label=y[1];break}if(y[0]===6&&v.label<a[1]){v.label=a[1],a=y;break}if(a&&v.label<a[2]){v.label=a[2],v.ops.push(y);break}a[2]&&v.ops.pop(),v.trys.pop();continue}y=s.call(c,v)}catch(C){y=[6,C],d=0}finally{l=a=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([g,k])}}},x=this&&this.__values||function(c){var s=typeof Symbol=="function"&&Symbol.iterator,l=s&&c[s],d=0;if(l)return l.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(R,"__esModule",{value:!0});var w=D("../Base/TreeNode");function T(c,s){var l=this;c===void 0&&(c=[]),s=s||function(B,S){return B<S?-1:B>S?1:0};var d=0,a=new w.default;a.color=w.default.TreeNodeColorType.black,this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.key=void 0,a.leftChild=a.rightChild=a.brother=a.parent=void 0,a.color=w.default.TreeNodeColorType.black};var u=function B(S){if(!S||S.key===void 0)throw new Error("unknown error");return S.leftChild?B(S.leftChild):S},v=function B(S){if(!S||S.key===void 0)throw new Error("unknown error");return S.rightChild?B(S.rightChild):S};this.front=function(){if(!this.empty())return u(a).key},this.back=function(){if(!this.empty())return v(a).key},this.forEach=function(B){var S,A,L=0;try{for(var E=x(this),V=E.next();!V.done;V=E.next())B(V.value,L++)}catch($){S={error:$}}finally{try{V&&!V.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}},this.getElementByPos=function(B){var S,A;if(B<0||B>=this.size())throw new Error("pos must more than 0 and less than set's size");var L=0;try{for(var E=x(this),V=E.next();!V.done;V=E.next()){var $=V.value;if(L===B)return $;++L}}catch(W){S={error:W}}finally{try{V&&!V.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}throw new Error("unknown error")};var m=function B(S){var A=S.parent;if(!A){if(S===a)return;throw new Error("unknown error")}if(S.color!==w.default.TreeNodeColorType.red){var L=S.brother;if(!L)throw new Error("unknown error");if(S===A.leftChild)if(L.color===w.default.TreeNodeColorType.red){L.color=w.default.TreeNodeColorType.black,A.color=w.default.TreeNodeColorType.red;var E=A.rotateLeft();a===A&&(a=E),B(S)}else L.color===w.default.TreeNodeColorType.black&&(L.rightChild&&L.rightChild.color===w.default.TreeNodeColorType.red?(L.color=A.color,A.color=w.default.TreeNodeColorType.black,L.rightChild&&(L.rightChild.color=w.default.TreeNodeColorType.black),E=A.rotateLeft(),a===A&&(a=E),S.color=w.default.TreeNodeColorType.black):L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||!L.leftChild||L.leftChild.color!==w.default.TreeNodeColorType.red?L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||(L.color=w.default.TreeNodeColorType.red,B(A)):(L.color=w.default.TreeNodeColorType.red,L.leftChild&&(L.leftChild.color=w.default.TreeNodeColorType.black),E=L.rotateRight(),a===L&&(a=E),B(S)));else S===A.rightChild&&(L.color===w.default.TreeNodeColorType.red?(L.color=w.default.TreeNodeColorType.black,A.color=w.default.TreeNodeColorType.red,E=A.rotateRight(),a===A&&(a=E),B(S)):L.color===w.default.TreeNodeColorType.black&&(L.leftChild&&L.leftChild.color===w.default.TreeNodeColorType.red?(L.color=A.color,A.color=w.default.TreeNodeColorType.black,L.leftChild&&(L.leftChild.color=w.default.TreeNodeColorType.black),E=A.rotateRight(),a===A&&(a=E),S.color=w.default.TreeNodeColorType.black):L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||!L.rightChild||L.rightChild.color!==w.default.TreeNodeColorType.red?L.leftChild&&L.leftChild.color!==w.default.TreeNodeColorType.black||L.rightChild&&L.rightChild.color!==w.default.TreeNodeColorType.black||(L.color=w.default.TreeNodeColorType.red,B(A)):(L.color=w.default.TreeNodeColorType.red,L.rightChild&&(L.rightChild.color=w.default.TreeNodeColorType.black),E=L.rotateLeft(),a===L&&(a=E),B(S))))}else S.color=w.default.TreeNodeColorType.black},g=function(S){for(var A=S;A.leftChild||A.rightChild;){if(A.rightChild){A=u(A.rightChild);var L=S.key;S.key=A.key,A.key=L,S=A}A.leftChild&&(A=v(A.leftChild),L=S.key,S.key=A.key,A.key=L,S=A)}m(A),A&&A.remove(),--d,a.color=w.default.TreeNodeColorType.black},k=function B(S,A){return!(!S||S.key===void 0)&&(!!B(S.leftChild,A)||!!A(S)||B(S.rightChild,A))};this.eraseElementByPos=function(B){if(B<0||B>=d)throw new Error("pos must more than 0 and less than set's size");var S=0;k(a,function(A){return B===S?(g(A),!0):(++S,!1)})},this.eraseElementByValue=function(B){if(!this.empty()){var S=M(a,B);S!==void 0&&S.key!==void 0&&s(S.key,B)===0&&g(S)}};var y=function B(S,A){if(!S||S.key===void 0)throw new Error("unknown error");var L=s(A,S.key);return L<0?S.leftChild?B(S.leftChild,A):(S.leftChild=new w.default,S.leftChild.parent=S,S.leftChild.brother=S.rightChild,S.rightChild&&(S.rightChild.brother=S.leftChild),S.leftChild):L>0?S.rightChild?B(S.rightChild,A):(S.rightChild=new w.default,S.rightChild.parent=S,S.rightChild.brother=S.leftChild,S.leftChild&&(S.leftChild.brother=S.rightChild),S.rightChild):S},C=function B(S){var A=S.parent;if(!A){if(S===a)return;throw new Error("unknown error")}if(A.color!==w.default.TreeNodeColorType.black&&A.color===w.default.TreeNodeColorType.red){var L=A.brother,E=A.parent;if(!E)throw new Error("unknown error");if(L&&L.color===w.default.TreeNodeColorType.red)L.color=A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red,B(E);else if(!L||L.color===w.default.TreeNodeColorType.black)if(A===E.leftChild)if(S===A.leftChild){A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red;var V=E.rotateRight();E===a&&(a=V)}else S===A.rightChild&&(V=A.rotateLeft(),E===a&&(a=V),B(A));else A===E.rightChild&&(S===A.leftChild?(V=A.rotateRight(),E===a&&(a=V),B(A)):S===A.rightChild&&(A.color=w.default.TreeNodeColorType.black,E.color=w.default.TreeNodeColorType.red,V=E.rotateLeft(),E===a&&(a=V)))}};this.insert=function(B){if(B==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty())return++d,a.key=B,void(a.color=w.default.TreeNodeColorType.black);var S=y(a,B);S.key!==void 0&&s(S.key,B)===0||(++d,S.key=B,C(S),a.color=w.default.TreeNodeColorType.black)};var M=function B(S,A){if(S&&S.key!==void 0){var L=s(A,S.key);return L<0?B(S.leftChild,A):L>0?B(S.rightChild,A):S}};this.find=function(B){var S=M(a,B);return S!==void 0&&S.key!==void 0&&s(S.key,B)===0};var N=function B(S,A){if(S&&S.key!==void 0){var L=s(S.key,A);if(L===0)return S.key;if(L<0)return B(S.rightChild,A);var E=B(S.leftChild,A);return E!==void 0?E:S.key}};this.lowerBound=function(B){return N(a,B)};var Y=function B(S,A){if(S&&S.key!==void 0){if(s(S.key,A)<=0)return B(S.rightChild,A);var L=B(S.leftChild,A);return L!==void 0?L:S.key}};this.upperBound=function(B){return Y(a,B)};var _=function B(S,A){if(S&&S.key!==void 0){var L=s(S.key,A);if(L===0)return S.key;if(L>0)return B(S.leftChild,A);var E=B(S.rightChild,A);return E!==void 0?E:S.key}};this.reverseLowerBound=function(B){return _(a,B)};var G=function B(S,A){if(S&&S.key!==void 0){if(s(S.key,A)>=0)return B(S.leftChild,A);var L=B(S.rightChild,A);return L!==void 0?L:S.key}};this.reverseUpperBound=function(B){return G(a,B)},this.union=function(B){var S=this;B.forEach(function(A){return S.insert(A)})},this.getHeight=function(){if(this.empty())return 0;var B=function S(A){return A?Math.max(S(A.leftChild),S(A.rightChild))+1:1};return B(a)};var et=function B(S){return P(this,function(A){switch(A.label){case 0:return S&&S.key!==void 0?[5,x(B(S.leftChild))]:[2];case 1:return A.sent(),[4,S.key];case 2:return A.sent(),[5,x(B(S.rightChild))];case 3:return A.sent(),[2]}})};this[Symbol.iterator]=function(){return et(a)},c.forEach(function(B){return l.insert(B)}),Object.freeze(this)}Object.freeze(T),R.default=T},{"../Base/TreeNode":25}],34:[function(D,Z,R){"use strict";function P(x){var w=this;x===void 0&&(x=[]);var T=0,c=[];this.size=function(){return T},this.empty=function(){return T===0},this.clear=function(){T=0,c.length=0},this.push=function(s){c.push(s),++T},this.pop=function(){c.pop(),T>0&&--T},this.top=function(){return c[T-1]},x.forEach(function(s){return w.push(s)}),Object.freeze(this)}Object.defineProperty(R,"__esModule",{value:!0}),Object.freeze(P),R.default=P},{}],35:[function(D,Z,R){"use strict";var P=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(k){return function(y){return function(C){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&C[0]?a.return:C[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,C[1])).done)return u;switch(a=0,u&&(C=[2&C[0],u.value]),C[0]){case 0:case 1:u=C;break;case 4:return m.label++,{value:C[1],done:!1};case 5:m.label++,a=C[1],C=[0];continue;case 7:C=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(C[0]===6||C[0]===2)){m=0;continue}if(C[0]===3&&(!u||C[1]>u[0]&&C[1]<u[3])){m.label=C[1];break}if(C[0]===6&&m.label<u[1]){m.label=u[1],u=C;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(C);break}u[2]&&m.ops.pop(),m.trys.pop();continue}C=l.call(s,m)}catch(M){C=[6,M],a=0}finally{d=u=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}([k,y])}}},x=this&&this.__read||function(s,l){var d=typeof Symbol=="function"&&s[Symbol.iterator];if(!d)return s;var a,u,v=d.call(s),m=[];try{for(;(l===void 0||l-- >0)&&!(a=v.next()).done;)m.push(a.value)}catch(g){u={error:g}}finally{try{a&&!a.done&&(d=v.return)&&d.call(v)}finally{if(u)throw u.error}}return m},w=this&&this.__spreadArray||function(s,l,d){if(d||arguments.length===2)for(var a,u=0,v=l.length;u<v;u++)!a&&u in l||(a||(a=Array.prototype.slice.call(l,0,u)),a[u]=l[u]);return s.concat(a||Array.prototype.slice.call(l))},T=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};function c(s){var l=this;s===void 0&&(s=[]);var d=0,a=[];this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.length=0},this.front=function(){if(!this.empty())return a[0]},this.back=function(){if(!this.empty())return a[d-1]},this.forEach=function(u){a.forEach(u)},this.getElementByPos=function(u){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");return a[u]},this.eraseElementByPos=function(u){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");for(var v=u;v<d-1;++v)a[v]=a[v+1];this.popBack()},this.eraseElementByValue=function(u){var v=[];this.forEach(function(g){g!==u&&v.push(g)}),v.forEach(function(g,k){a[k]=g});for(var m=v.length;d>m;)this.popBack()},this.pushBack=function(u){a.push(u),++d},this.popBack=function(){a.pop(),d>0&&--d},this.setElementByPos=function(u,v){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");a[u]=v},this.insert=function(u,v,m){if(m===void 0&&(m=1),u<0||u>d)throw new Error("pos must more than 0 and less than or equal to vector's size");a.splice.apply(a,w([u,0],x(new Array(m).fill(v)),!1)),d+=m},this.find=function(u){return a.includes(u)},this.reverse=function(){a.reverse()},this.unique=function(){var u,v=[];this.forEach(function(g,k){k!==0&&g===u||(v.push(g),u=g)}),v.forEach(function(g,k){a[k]=g});for(var m=v.length;d>m;)this.popBack()},this.sort=function(u){a.sort(u)},this[Symbol.iterator]=function(){return function(){return P(this,function(u){switch(u.label){case 0:return[5,T(a)];case 1:return[2,u.sent()]}})}()},s.forEach(function(u){return l.pushBack(u)}),Object.freeze(this)}Object.defineProperty(R,"__esModule",{value:!0}),Object.freeze(c),R.default=c},{}],36:[function(D,Z,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.HashMap=R.HashSet=R.Map=R.Set=R.PriorityQueue=R.Deque=R.LinkList=R.Queue=R.Stack=R.Vector=void 0;var P=D("./Vector/Vector");R.Vector=P.default;var x=D("./Stack/Stack");R.Stack=x.default;var w=D("./Queue/Queue");R.Queue=w.default;var T=D("./LinkList/LinkList");R.LinkList=T.default;var c=D("./Deque/Deque");R.Deque=c.default;var s=D("./PriorityQueue/PriorityQueue");R.PriorityQueue=s.default;var l=D("./Set/Set");R.Set=l.default;var d=D("./Map/Map");R.Map=d.default;var a=D("./HashSet/HashSet");R.HashSet=a.default;var u=D("./HashMap/HashMap");R.HashMap=u.default},{"./Deque/Deque":26,"./HashMap/HashMap":27,"./HashSet/HashSet":28,"./LinkList/LinkList":29,"./Map/Map":30,"./PriorityQueue/PriorityQueue":31,"./Queue/Queue":32,"./Set/Set":33,"./Stack/Stack":34,"./Vector/Vector":35}],37:[function(D,Z,R){"use strict";var P=D("yallist"),x=Symbol("max"),w=Symbol("length"),T=Symbol("lengthCalculator"),c=Symbol("allowStale"),s=Symbol("maxAge"),l=Symbol("dispose"),d=Symbol("noDisposeOnSet"),a=Symbol("lruList"),u=Symbol("cache"),v=Symbol("updateAgeOnGet"),m=function(){return 1},g=function(_,G,et){var B=_[u].get(G);if(B){var S=B.value;if(k(_,S)){if(C(_,B),!_[c])return}else et&&(_[v]&&(B.value.now=Date.now()),_[a].unshiftNode(B));return S.value}},k=function(_,G){if(!G||!G.maxAge&&!_[s])return!1;var et=Date.now()-G.now;return G.maxAge?et>G.maxAge:_[s]&&et>_[s]},y=function(_){if(_[w]>_[x])for(var G=_[a].tail;_[w]>_[x]&&G!==null;){var et=G.prev;C(_,G),G=et}},C=function(_,G){if(G){var et=G.value;_[l]&&_[l](et.key,et.value),_[w]-=et.length,_[u].delete(et.key),_[a].removeNode(G)}},M=function Y(_,G,et,B,S){Tt(this,Y),this.key=_,this.value=G,this.length=et,this.now=B,this.maxAge=S||0},N=function(_,G,et,B){var S=et.value;k(_,S)&&(C(_,et),_[c]||(S=void 0)),S&&G.call(B,S.value,S.key,_)};Z.exports=function(){function Y(_){if(Tt(this,Y),typeof _=="number"&&(_={max:_}),_||(_={}),_.max&&(typeof _.max!="number"||_.max<0))throw new TypeError("max must be a non-negative number");this[x]=_.max||1/0;var G=_.length||m;if(this[T]=typeof G!="function"?m:G,this[c]=_.stale||!1,_.maxAge&&typeof _.maxAge!="number")throw new TypeError("maxAge must be a number");this[s]=_.maxAge||0,this[l]=_.dispose,this[d]=_.noDisposeOnSet||!1,this[v]=_.updateAgeOnGet||!1,this.reset()}return wt(Y,[{key:"max",get:function(){return this[x]},set:function(G){if(typeof G!="number"||G<0)throw new TypeError("max must be a non-negative number");this[x]=G||1/0,y(this)}},{key:"allowStale",get:function(){return this[c]},set:function(G){this[c]=!!G}},{key:"maxAge",get:function(){return this[s]},set:function(G){if(typeof G!="number")throw new TypeError("maxAge must be a non-negative number");this[s]=G,y(this)}},{key:"lengthCalculator",get:function(){return this[T]},set:function(G){var et=this;typeof G!="function"&&(G=m),G!==this[T]&&(this[T]=G,this[w]=0,this[a].forEach(function(B){B.length=et[T](B.value,B.key),et[w]+=B.length})),y(this)}},{key:"length",get:function(){return this[w]}},{key:"itemCount",get:function(){return this[a].length}},{key:"rforEach",value:function(G,et){et=et||this;for(var B=this[a].tail;B!==null;){var S=B.prev;N(this,G,B,et),B=S}}},{key:"forEach",value:function(G,et){et=et||this;for(var B=this[a].head;B!==null;){var S=B.next;N(this,G,B,et),B=S}}},{key:"keys",value:function(){return this[a].toArray().map(function(G){return G.key})}},{key:"values",value:function(){return this[a].toArray().map(function(G){return G.value})}},{key:"reset",value:function(){var G=this;this[l]&&this[a]&&this[a].length&&this[a].forEach(function(et){return G[l](et.key,et.value)}),this[u]=new Map,this[a]=new P,this[w]=0}},{key:"dump",value:function(){var G=this;return this[a].map(function(et){return!k(G,et)&&{k:et.key,v:et.value,e:et.now+(et.maxAge||0)}}).toArray().filter(function(et){return et})}},{key:"dumpLru",value:function(){return this[a]}},{key:"set",value:function(G,et,B){if((B=B||this[s])&&typeof B!="number")throw new TypeError("maxAge must be a number");var S=B?Date.now():0,A=this[T](et,G);if(this[u].has(G)){if(A>this[x])return C(this,this[u].get(G)),!1;var L=this[u].get(G).value;return this[l]&&(this[d]||this[l](G,L.value)),L.now=S,L.maxAge=B,L.value=et,this[w]+=A-L.length,L.length=A,this.get(G),y(this),!0}var E=new M(G,et,A,S,B);return E.length>this[x]?(this[l]&&this[l](G,et),!1):(this[w]+=E.length,this[a].unshift(E),this[u].set(G,this[a].head),y(this),!0)}},{key:"has",value:function(G){if(!this[u].has(G))return!1;var et=this[u].get(G).value;return!k(this,et)}},{key:"get",value:function(G){return g(this,G,!0)}},{key:"peek",value:function(G){return g(this,G,!1)}},{key:"pop",value:function(){var G=this[a].tail;return G?(C(this,G),G.value):null}},{key:"del",value:function(G){C(this,this[u].get(G))}},{key:"load",value:function(G){this.reset();for(var et=Date.now(),B=G.length-1;B>=0;B--){var S=G[B],A=S.e||0;if(A===0)this.set(S.k,S.v);else{var L=A-et;L>0&&this.set(S.k,S.v,L)}}}},{key:"prune",value:function(){var G=this;this[u].forEach(function(et,B){return g(G,B,!1)})}}]),Y}()},{yallist:83}],38:[function(D,Z,R){(function(P){(function(){var x=Z.exports;x.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},x.codes={};for(var w in x.types){var T=x.types[w];x.codes[T]=w}x.CMD_SHIFT=4,x.CMD_MASK=240,x.DUP_MASK=8,x.QOS_MASK=3,x.QOS_SHIFT=1,x.RETAIN_MASK=1,x.VARBYTEINT_MASK=127,x.VARBYTEINT_FIN_MASK=128,x.VARBYTEINT_MAX=268435455,x.SESSIONPRESENT_MASK=1,x.SESSIONPRESENT_HEADER=P.from([x.SESSIONPRESENT_MASK]),x.CONNACK_HEADER=P.from([x.codes.connack<<x.CMD_SHIFT]),x.USERNAME_MASK=128,x.PASSWORD_MASK=64,x.WILL_RETAIN_MASK=32,x.WILL_QOS_MASK=24,x.WILL_QOS_SHIFT=3,x.WILL_FLAG_MASK=4,x.CLEAN_SESSION_MASK=2,x.CONNECT_HEADER=P.from([x.codes.connect<<x.CMD_SHIFT]),x.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},x.propertiesCodes={};for(var c in x.properties){var s=x.properties[c];x.propertiesCodes[s]=c}function l(d){return[0,1,2].map(function(a){return[0,1].map(function(u){return[0,1].map(function(v){var m=P.alloc(1);return m.writeUInt8(x.codes[d]<<x.CMD_SHIFT|(u?x.DUP_MASK:0)|a<<x.QOS_SHIFT|v,0,!0),m})})})}x.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},x.PUBLISH_HEADER=l("publish"),x.SUBSCRIBE_HEADER=l("subscribe"),x.SUBSCRIBE_OPTIONS_QOS_MASK=3,x.SUBSCRIBE_OPTIONS_NL_MASK=1,x.SUBSCRIBE_OPTIONS_NL_SHIFT=2,x.SUBSCRIBE_OPTIONS_RAP_MASK=1,x.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,x.SUBSCRIBE_OPTIONS_RH_MASK=3,x.SUBSCRIBE_OPTIONS_RH_SHIFT=4,x.SUBSCRIBE_OPTIONS_RH=[0,16,32],x.SUBSCRIBE_OPTIONS_NL=4,x.SUBSCRIBE_OPTIONS_RAP=8,x.SUBSCRIBE_OPTIONS_QOS=[0,1,2],x.UNSUBSCRIBE_HEADER=l("unsubscribe"),x.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},x.SUBACK_HEADER=P.from([x.codes.suback<<x.CMD_SHIFT]),x.VERSION3=P.from([3]),x.VERSION4=P.from([4]),x.VERSION5=P.from([5]),x.VERSION131=P.from([131]),x.VERSION132=P.from([132]),x.QOS=[0,1,2].map(function(d){return P.from([d])}),x.EMPTY={pingreq:P.from([x.codes.pingreq<<4,0]),pingresp:P.from([x.codes.pingresp<<4,0]),disconnect:P.from([x.codes.disconnect<<4,0])}}).call(this)}).call(this,D("buffer").Buffer)},{buffer:17}],39:[function(D,Z,R){(function(P){(function(){var x=D("./writeToStream"),w=D("events"),T=function(c){"use strict";kt(l,c);var s=vt(l);function l(){var d;return Tt(this,l),d=s.call(this),d._array=new Array(20),d._i=0,d}return wt(l,[{key:"write",value:function(a){return this._array[this._i++]=a,!0}},{key:"concat",value:function(){var a=0,u=new Array(this._array.length),v=this._array,m,g=0;for(m=0;m<v.length&&v[m]!==void 0;m++)typeof v[m]!="string"?u[m]=v[m].length:u[m]=P.byteLength(v[m]),a+=u[m];var k=P.allocUnsafe(a);for(m=0;m<v.length&&v[m]!==void 0;m++)typeof v[m]!="string"?(v[m].copy(k,g),g+=u[m]):(k.write(v[m],g),g+=u[m]);return k}}]),l}(w);Z.exports=function(c,s){var l=new T;return x(c,l,s),l.concat()}}).call(this)}).call(this,D("buffer").Buffer)},{"./writeToStream":44,buffer:17,events:22}],40:[function(D,Z,R){R.parser=D("./parser").parser,R.generate=D("./generate"),R.writeToStream=D("./writeToStream")},{"./generate":39,"./parser":43,"./writeToStream":44}],41:[function(D,Z,R){(function(P){(function(){var x=65536,w={},T=P.isBuffer(P.from([1,2]).subarray(0,1));function c(s){var l=P.allocUnsafe(2);return l.writeUInt8(s>>8,0),l.writeUInt8(255&s,1),l}Z.exports={cache:w,generateCache:function(){for(var l=0;l<x;l++)w[l]=c(l)},generateNumber:c,genBufVariableByteInt:function(l){var d=0,a=0,u=P.allocUnsafe(4);do d=l%128|0,(l=l/128|0)>0&&(d|=128),u.writeUInt8(d,a++);while(l>0&&a<4);return l>0&&(a=0),T?u.subarray(0,a):u.slice(0,a)},generate4ByteBuffer:function(l){var d=P.allocUnsafe(4);return d.writeUInt32BE(l,0),d}}}).call(this)}).call(this,D("buffer").Buffer)},{buffer:17}],42:[function(D,Z,R){Z.exports=function(){"use strict";function P(){Tt(this,P),this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}return P}()},{}],43:[function(D,Z,R){var P=D("bl"),x=D("events"),w=D("./packet"),T=D("./constants"),c=D("debug")("mqtt-packet:parser"),s=function(l){"use strict";kt(a,l);var d=vt(a);function a(){var u;return Tt(this,a),u=d.call(this),u.parser=u.constructor.parser,u}return wt(a,[{key:"_resetState",value:function(){c("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new w,this.error=null,this._list=P(),this._stateCounter=0}},{key:"parse",value:function(v){for(this.error&&this._resetState(),this._list.append(v),c("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,c("parse: state complete. _stateCounter is now: %d",this._stateCounter),c("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return c("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}},{key:"_parseHeader",value:function(){var v=this._list.readUInt8(0);return this.packet.cmd=T.types[v>>T.CMD_SHIFT],this.packet.retain=(v&T.RETAIN_MASK)!=0,this.packet.qos=v>>T.QOS_SHIFT&T.QOS_MASK,this.packet.dup=(v&T.DUP_MASK)!=0,c("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}},{key:"_parseLength",value:function(){var v=this._parseVarByteNum(!0);return v&&(this.packet.length=v.value,this._list.consume(v.bytes)),c("_parseLength %d",v.value),!!v}},{key:"_parsePayload",value:function(){c("_parsePayload: payload %O",this._list);var v=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}v=!0}return c("_parsePayload complete result: %s",v),v}},{key:"_parseConnect",value:function(){var v,m,g,k;c("_parseConnect");var y={},C=this.packet,M=this._parseString();if(M===null)return this._emitError(new Error("Cannot parse protocolId"));if(M!=="MQTT"&&M!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(C.protocolId=M,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(C.protocolVersion=this._list.readUInt8(this._pos),C.protocolVersion>=128&&(C.bridgeMode=!0,C.protocolVersion=C.protocolVersion-128),C.protocolVersion!==3&&C.protocolVersion!==4&&C.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(y.username=this._list.readUInt8(this._pos)&T.USERNAME_MASK,y.password=this._list.readUInt8(this._pos)&T.PASSWORD_MASK,y.will=this._list.readUInt8(this._pos)&T.WILL_FLAG_MASK,y.will&&(C.will={},C.will.retain=(this._list.readUInt8(this._pos)&T.WILL_RETAIN_MASK)!=0,C.will.qos=(this._list.readUInt8(this._pos)&T.WILL_QOS_MASK)>>T.WILL_QOS_SHIFT),C.clean=(this._list.readUInt8(this._pos)&T.CLEAN_SESSION_MASK)!=0,this._pos++,C.keepalive=this._parseNum(),C.keepalive===-1)return this._emitError(new Error("Packet too short"));if(C.protocolVersion===5){var N=this._parseProperties();Object.getOwnPropertyNames(N).length&&(C.properties=N)}var Y=this._parseString();if(Y===null)return this._emitError(new Error("Packet too short"));if(C.clientId=Y,c("_parseConnect: packet.clientId: %s",C.clientId),y.will){if(C.protocolVersion===5){var _=this._parseProperties();Object.getOwnPropertyNames(_).length&&(C.will.properties=_)}if((v=this._parseString())===null)return this._emitError(new Error("Cannot parse will topic"));if(C.will.topic=v,c("_parseConnect: packet.will.topic: %s",C.will.topic),(m=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse will payload"));C.will.payload=m,c("_parseConnect: packet.will.paylaod: %s",C.will.payload)}if(y.username){if((k=this._parseString())===null)return this._emitError(new Error("Cannot parse username"));C.username=k,c("_parseConnect: packet.username: %s",C.username)}if(y.password){if((g=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse password"));C.password=g}return this.settings=C,c("_parseConnect: complete"),C}},{key:"_parseConnack",value:function(){c("_parseConnack");var v=this.packet;if(this._list.length<1)return null;if(v.sessionPresent=!!(this._list.readUInt8(this._pos++)&T.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?v.reasonCode=this._list.readUInt8(this._pos++):v.reasonCode=0;else{if(this._list.length<2)return null;v.returnCode=this._list.readUInt8(this._pos++)}if(v.returnCode===-1||v.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}c("_parseConnack: complete")}},{key:"_parsePublish",value:function(){c("_parsePublish");var v=this.packet;if(v.topic=this._parseString(),v.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(v.qos>0)||this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}v.payload=this._list.slice(this._pos,v.length),c("_parsePublish: payload from buffer list: %o",v.payload)}}},{key:"_parseSubscribe",value:function(){c("_parseSubscribe");var v=this.packet,m,g,k,y,C,M,N;if(v.qos!==1)return this._emitError(new Error("Wrong subscribe header"));if(v.subscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var Y=this._parseProperties();Object.getOwnPropertyNames(Y).length&&(v.properties=Y)}for(;this._pos<v.length;){if((m=this._parseString())===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=v.length)return this._emitError(new Error("Malformed Subscribe Payload"));k=(g=this._parseByte())&T.SUBSCRIBE_OPTIONS_QOS_MASK,M=(g>>T.SUBSCRIBE_OPTIONS_NL_SHIFT&T.SUBSCRIBE_OPTIONS_NL_MASK)!=0,C=(g>>T.SUBSCRIBE_OPTIONS_RAP_SHIFT&T.SUBSCRIBE_OPTIONS_RAP_MASK)!=0,y=g>>T.SUBSCRIBE_OPTIONS_RH_SHIFT&T.SUBSCRIBE_OPTIONS_RH_MASK,N={topic:m,qos:k},this.settings.protocolVersion===5?(N.nl=M,N.rap=C,N.rh=y):this.settings.bridgeMode&&(N.rh=0,N.rap=!0,N.nl=!0),c("_parseSubscribe: push subscription `%s` to subscription",N),v.subscriptions.push(N)}}}},{key:"_parseSuback",value:function(){c("_parseSuback");var v=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}},{key:"_parseUnsubscribe",value:function(){c("_parseUnsubscribe");var v=this.packet;if(v.unsubscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}for(;this._pos<v.length;){var g=this._parseString();if(g===null)return this._emitError(new Error("Cannot parse topic"));c("_parseUnsubscribe: push topic `%s` to unsubscriptions",g),v.unsubscriptions.push(g)}}}},{key:"_parseUnsuback",value:function(){c("_parseUnsuback");var v=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(this.settings.protocolVersion===5){var m=this._parseProperties();for(Object.getOwnPropertyNames(m).length&&(v.properties=m),v.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}},{key:"_parseConfirmation",value:function(){c("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);var v=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5&&(v.length>2?(v.reasonCode=this._parseByte(),c("_parseConfirmation: packet.reasonCode `%d`",v.reasonCode)):v.reasonCode=0,v.length>3)){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}return!0}},{key:"_parseDisconnect",value:function(){var v=this.packet;if(c("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?v.reasonCode=this._parseByte():v.reasonCode=0;var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}return c("_parseDisconnect result: true"),!0}},{key:"_parseAuth",value:function(){c("_parseAuth");var v=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));v.reasonCode=this._parseByte();var m=this._parseProperties();return Object.getOwnPropertyNames(m).length&&(v.properties=m),c("_parseAuth: result: true"),!0}},{key:"_parseMessageId",value:function(){var v=this.packet;return v.messageId=this._parseNum(),v.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(c("_parseMessageId: packet.messageId %d",v.messageId),!0)}},{key:"_parseString",value:function(v){var m=this._parseNum(),g=m+this._pos;if(m===-1||g>this._list.length||g>this.packet.length)return null;var k=this._list.toString("utf8",this._pos,g);return this._pos+=m,c("_parseString: result: %s",k),k}},{key:"_parseStringPair",value:function(){return c("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}},{key:"_parseBuffer",value:function(){var v=this._parseNum(),m=v+this._pos;if(v===-1||m>this._list.length||m>this.packet.length)return null;var g=this._list.slice(this._pos,m);return this._pos+=v,c("_parseBuffer: result: %o",g),g}},{key:"_parseNum",value:function(){if(this._list.length-this._pos<2)return-1;var v=this._list.readUInt16BE(this._pos);return this._pos+=2,c("_parseNum: result: %s",v),v}},{key:"_parse4ByteNum",value:function(){if(this._list.length-this._pos<4)return-1;var v=this._list.readUInt32BE(this._pos);return this._pos+=4,c("_parse4ByteNum: result: %s",v),v}},{key:"_parseVarByteNum",value:function(v){c("_parseVarByteNum");for(var m,g=0,k=1,y=0,C=!1,M=this._pos?this._pos:0;g<4&&M+g<this._list.length;){if(y+=k*((m=this._list.readUInt8(M+g++))&T.VARBYTEINT_MASK),k*=128,(m&T.VARBYTEINT_FIN_MASK)==0){C=!0;break}if(this._list.length<=g)break}return!C&&g===4&&this._list.length>=g&&this._emitError(new Error("Invalid variable byte integer")),M&&(this._pos+=g),c("_parseVarByteNum: result: %o",C=!!C&&(v?{bytes:g,value:y}:y)),C}},{key:"_parseByte",value:function(){var v;return this._pos<this._list.length&&(v=this._list.readUInt8(this._pos),this._pos++),c("_parseByte: result: %o",v),v}},{key:"_parseByType",value:function(v){switch(c("_parseByType: type: %s",v),v){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}},{key:"_parseProperties",value:function(){c("_parseProperties");for(var v=this._parseVarByteNum(),m=this._pos+v,g={};this._pos<m;){var k=this._parseByte();if(!k)return this._emitError(new Error("Cannot parse property code type")),!1;var y=T.propertiesCodes[k];if(!y)return this._emitError(new Error("Unknown property")),!1;if(y!=="userProperties")g[y]?Array.isArray(g[y])?g[y].push(this._parseByType(T.propertiesTypes[y])):(g[y]=[g[y]],g[y].push(this._parseByType(T.propertiesTypes[y]))):g[y]=this._parseByType(T.propertiesTypes[y]);else{g[y]||(g[y]=Object.create(null));var C=this._parseByType(T.propertiesTypes[y]);if(g[y][C.name])if(Array.isArray(g[y][C.name]))g[y][C.name].push(C.value);else{var M=g[y][C.name];g[y][C.name]=[M],g[y][C.name].push(C.value)}else g[y][C.name]=C.value}}return g}},{key:"_newPacket",value:function(){return c("_newPacket"),this.packet&&(this._list.consume(this.packet.length),c("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),c("_newPacket: new packet"),this.packet=new w,this._pos=0,!0}},{key:"_emitError",value:function(v){c("_emitError"),this.error=v,this.emit("error",v)}}],[{key:"parser",value:function(v){return this instanceof a?(this.settings=v||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new a().parser(v)}}]),a}(x);Z.exports=s},{"./constants":38,"./packet":42,bl:15,debug:18,events:22}],44:[function(D,Z,R){(function(P){(function(){var x=D("./constants"),w=P.allocUnsafe(0),T=P.from([0]),c=D("./numbers"),s=D("process-nextick-args").nextTick,l=D("debug")("mqtt-packet:writeToStream"),d=c.cache,a=c.generateNumber,u=c.generateCache,v=c.genBufVariableByteInt,m=c.generate4ByteBuffer,g=G,k=!0;function y(W,F,j){switch(l("generate called"),F.cork&&(F.cork(),s(C,F)),k&&(k=!1,u()),l("generate: packet.cmd: %s",W.cmd),W.cmd){case"connect":return function(q,H,J){var K=q||{},tt=K.protocolId||"MQTT",at=K.protocolVersion||4,it=K.will,st=K.clean,h=K.keepalive||0,f=K.clientId||"",I=K.username,O=K.password,X=K.properties;st===void 0&&(st=!0);var Q=0;if(!tt||typeof tt!="string"&&!P.isBuffer(tt))return H.emit("error",new Error("Invalid protocolId")),!1;if(Q+=tt.length+2,at!==3&&at!==4&&at!==5)return H.emit("error",new Error("Invalid protocol version")),!1;if(Q+=1,(typeof f=="string"||P.isBuffer(f))&&(f||at>=4)&&(f||st))Q+=P.byteLength(f)+2;else{if(at<4)return H.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*st==0)return H.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof h!="number"||h<0||h>65535||h%1!=0)return H.emit("error",new Error("Invalid keepalive")),!1;if(Q+=2,Q+=1,at===5){var ot=S(H,X);if(!ot)return!1;Q+=ot.length}if(it){if(typeof it!="object")return H.emit("error",new Error("Invalid will")),!1;if(!it.topic||typeof it.topic!="string")return H.emit("error",new Error("Invalid will topic")),!1;if(Q+=P.byteLength(it.topic)+2,Q+=2,it.payload){if(!(it.payload.length>=0))return H.emit("error",new Error("Invalid will payload")),!1;typeof it.payload=="string"?Q+=P.byteLength(it.payload):Q+=it.payload.length}var ut={};if(at===5){if(!(ut=S(H,it.properties)))return!1;Q+=ut.length}}var lt=!1;if(I!=null){if(!$(I))return H.emit("error",new Error("Invalid username")),!1;lt=!0,Q+=P.byteLength(I)+2}if(O!=null){if(!lt)return H.emit("error",new Error("Username is required to use password")),!1;if(!$(O))return H.emit("error",new Error("Invalid password")),!1;Q+=V(O)+2}H.write(x.CONNECT_HEADER),N(H,Q),B(H,tt),K.bridgeMode&&(at+=128),H.write(at===131?x.VERSION131:at===132?x.VERSION132:at===4?x.VERSION4:at===5?x.VERSION5:x.VERSION3);var gt=0;return gt|=I!=null?x.USERNAME_MASK:0,gt|=O!=null?x.PASSWORD_MASK:0,gt|=it&&it.retain?x.WILL_RETAIN_MASK:0,gt|=it&&it.qos?it.qos<<x.WILL_QOS_SHIFT:0,gt|=it?x.WILL_FLAG_MASK:0,gt|=st?x.CLEAN_SESSION_MASK:0,H.write(P.from([gt])),g(H,h),at===5&&ot.write(),B(H,f),it&&(at===5&&ut.write(),Y(H,it.topic),B(H,it.payload)),I!=null&&B(H,I),O!=null&&B(H,O),!0}(W,F);case"connack":return function(q,H,J){var K=J?J.protocolVersion:4,tt=q||{},at=K===5?tt.reasonCode:tt.returnCode,it=tt.properties,st=2;if(typeof at!="number")return H.emit("error",new Error("Invalid return code")),!1;var h=null;if(K===5){if(!(h=S(H,it)))return!1;st+=h.length}return H.write(x.CONNACK_HEADER),N(H,st),H.write(tt.sessionPresent?x.SESSIONPRESENT_HEADER:T),H.write(P.from([at])),h!=null&&h.write(),!0}(W,F,j);case"publish":return function(q,H,J){l("publish: packet: %o",q);var K=J?J.protocolVersion:4,tt=q||{},at=tt.qos||0,it=tt.retain?x.RETAIN_MASK:0,st=tt.topic,h=tt.payload||w,f=tt.messageId,I=tt.properties,O=0;if(typeof st=="string")O+=P.byteLength(st)+2;else{if(!P.isBuffer(st))return H.emit("error",new Error("Invalid topic")),!1;O+=st.length+2}if(P.isBuffer(h)?O+=h.length:O+=P.byteLength(h),at&&typeof f!="number")return H.emit("error",new Error("Invalid messageId")),!1;at&&(O+=2);var X=null;if(K===5){if(!(X=S(H,I)))return!1;O+=X.length}return H.write(x.PUBLISH_HEADER[at][tt.dup?1:0][it?1:0]),N(H,O),g(H,V(st)),H.write(st),at>0&&g(H,f),X!=null&&X.write(),l("publish: payload: %o",h),H.write(h)}(W,F,j);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(q,H,J){var K=J?J.protocolVersion:4,tt=q||{},at=tt.cmd||"puback",it=tt.messageId,st=tt.dup&&at==="pubrel"?x.DUP_MASK:0,h=0,f=tt.reasonCode,I=tt.properties,O=K===5?3:2;if(at==="pubrel"&&(h=1),typeof it!="number")return H.emit("error",new Error("Invalid messageId")),!1;var X=null;if(K===5&&typeof I=="object"){if(!(X=A(H,I,J,O)))return!1;O+=X.length}return H.write(x.ACKS[at][h][st][0]),N(H,O),g(H,it),K===5&&H.write(P.from([f])),X!==null&&X.write(),!0}(W,F,j);case"subscribe":return function(q,H,J){l("subscribe: packet: ");var K=J?J.protocolVersion:4,tt=q||{},at=tt.dup?x.DUP_MASK:0,it=tt.messageId,st=tt.subscriptions,h=tt.properties,f=0;if(typeof it!="number")return H.emit("error",new Error("Invalid messageId")),!1;f+=2;var I=null;if(K===5){if(!(I=S(H,h)))return!1;f+=I.length}if(typeof st!="object"||!st.length)return H.emit("error",new Error("Invalid subscriptions")),!1;for(var O=0;O<st.length;O+=1){var X=st[O].topic,Q=st[O].qos;if(typeof X!="string")return H.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if(typeof Q!="number")return H.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(K===5){var ot=st[O].nl||!1;if(typeof ot!="boolean")return H.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;var ut=st[O].rap||!1;if(typeof ut!="boolean")return H.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var lt=st[O].rh||0;if(typeof lt!="number"||lt>2)return H.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}f+=P.byteLength(X)+2+1}l("subscribe: writing to stream: %o",x.SUBSCRIBE_HEADER),H.write(x.SUBSCRIBE_HEADER[1][at?1:0][0]),N(H,f),g(H,it),I!==null&&I.write();var gt=!0,bt=At(st),Wt;try{for(bt.s();!(Wt=bt.n()).done;){var Ft=Wt.value,qt=Ft.topic,Rt=Ft.qos,_t=+Ft.nl,Ct=+Ft.rap,ae=Ft.rh,Zt=void 0;Y(H,qt),Zt=x.SUBSCRIBE_OPTIONS_QOS[Rt],K===5&&(Zt|=_t?x.SUBSCRIBE_OPTIONS_NL:0,Zt|=Ct?x.SUBSCRIBE_OPTIONS_RAP:0,Zt|=ae?x.SUBSCRIBE_OPTIONS_RH[ae]:0),gt=H.write(P.from([Zt]))}}catch(ye){bt.e(ye)}finally{bt.f()}return gt}(W,F,j);case"suback":return function(q,H,J){var K=J?J.protocolVersion:4,tt=q||{},at=tt.messageId,it=tt.granted,st=tt.properties,h=0;if(typeof at!="number")return H.emit("error",new Error("Invalid messageId")),!1;if(h+=2,typeof it!="object"||!it.length)return H.emit("error",new Error("Invalid qos vector")),!1;for(var f=0;f<it.length;f+=1){if(typeof it[f]!="number")return H.emit("error",new Error("Invalid qos vector")),!1;h+=1}var I=null;if(K===5){if(!(I=A(H,st,J,h)))return!1;h+=I.length}return H.write(x.SUBACK_HEADER),N(H,h),g(H,at),I!==null&&I.write(),H.write(P.from(it))}(W,F,j);case"unsubscribe":return function(q,H,J){var K=J?J.protocolVersion:4,tt=q||{},at=tt.messageId,it=tt.dup?x.DUP_MASK:0,st=tt.unsubscriptions,h=tt.properties,f=0;if(typeof at!="number")return H.emit("error",new Error("Invalid messageId")),!1;if(f+=2,typeof st!="object"||!st.length)return H.emit("error",new Error("Invalid unsubscriptions")),!1;for(var I=0;I<st.length;I+=1){if(typeof st[I]!="string")return H.emit("error",new Error("Invalid unsubscriptions")),!1;f+=P.byteLength(st[I])+2}var O=null;if(K===5){if(!(O=S(H,h)))return!1;f+=O.length}H.write(x.UNSUBSCRIBE_HEADER[1][it?1:0][0]),N(H,f),g(H,at),O!==null&&O.write();for(var X=!0,Q=0;Q<st.length;Q++)X=Y(H,st[Q]);return X}(W,F,j);case"unsuback":return function(q,H,J){var K=J?J.protocolVersion:4,tt=q||{},at=tt.messageId,it=tt.dup?x.DUP_MASK:0,st=tt.granted,h=tt.properties,f=tt.cmd,I=2;if(typeof at!="number")return H.emit("error",new Error("Invalid messageId")),!1;if(K===5){if(typeof st!="object"||!st.length)return H.emit("error",new Error("Invalid qos vector")),!1;for(var O=0;O<st.length;O+=1){if(typeof st[O]!="number")return H.emit("error",new Error("Invalid qos vector")),!1;I+=1}}var X=null;if(K===5){if(!(X=A(H,h,J,I)))return!1;I+=X.length}return H.write(x.ACKS[f][0][it][0]),N(H,I),g(H,at),X!==null&&X.write(),K===5&&H.write(P.from(st)),!0}(W,F,j);case"pingreq":case"pingresp":return function(q,H,J){return H.write(x.EMPTY[q.cmd])}(W,F);case"disconnect":return function(q,H,J){var K=J?J.protocolVersion:4,tt=q||{},at=tt.reasonCode,it=tt.properties,st=K===5?1:0,h=null;if(K===5){if(!(h=A(H,it,J,st)))return!1;st+=h.length}return H.write(P.from([x.codes.disconnect<<4])),N(H,st),K===5&&H.write(P.from([at])),h!==null&&h.write(),!0}(W,F,j);case"auth":return function(q,H,J){var K=J?J.protocolVersion:4,tt=q||{},at=tt.reasonCode,it=tt.properties,st=K===5?1:0;K!==5&&H.emit("error",new Error("Invalid mqtt version for auth packet"));var h=A(H,it,J,st);return h?(st+=h.length,H.write(P.from([x.codes.auth<<4])),N(H,st),H.write(P.from([at])),h!==null&&h.write(),!0):!1}(W,F,j);default:return F.emit("error",new Error("Unknown command")),!1}}function C(W){W.uncork()}Object.defineProperty(y,"cacheNumbers",{get:function(){return g===G},set:function(F){F?(d&&Object.keys(d).length!==0||(k=!0),g=G):(k=!1,g=et)}});var M={};function N(W,F){if(F>x.VARBYTEINT_MAX)return W.emit("error",new Error("Invalid variable byte integer: ".concat(F))),!1;var j=M[F];return j||(j=v(F),F<16384&&(M[F]=j)),l("writeVarByteInt: writing to stream: %o",j),W.write(j)}function Y(W,F){var j=P.byteLength(F);return g(W,j),l("writeString: %s",F),W.write(F,"utf8")}function _(W,F,j){Y(W,F),Y(W,j)}function G(W,F){return l("writeNumberCached: number: %d",F),l("writeNumberCached: %o",d[F]),W.write(d[F])}function et(W,F){var j=a(F);return l("writeNumberGenerated: %o",j),W.write(j)}function B(W,F){typeof F=="string"?Y(W,F):F?(g(W,F.length),W.write(F)):g(W,0)}function S(W,F){if(typeof F!="object"||F.length!=null)return{length:1,write:function(){E(W,{},0)}};var j=0;function q(it,st){var h=0;switch(x.propertiesTypes[it]){case"byte":if(typeof st!="boolean")return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=2;break;case"int8":if(typeof st!="number"||st<0||st>255)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=2;break;case"binary":if(st&&st===null)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=1+P.byteLength(st)+2;break;case"int16":if(typeof st!="number"||st<0||st>65535)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=3;break;case"int32":if(typeof st!="number"||st<0||st>4294967295)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=5;break;case"var":if(typeof st!="number"||st<0||st>268435455)return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=1+P.byteLength(v(st));break;case"string":if(typeof st!="string")return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=3+P.byteLength(st.toString());break;case"pair":if(typeof st!="object")return W.emit("error",new Error("Invalid ".concat(it,": ").concat(st))),!1;h+=Object.getOwnPropertyNames(st).reduce(function(f,I){var O=st[I];return Array.isArray(O)?f+=O.reduce(function(X,Q){return X+=3+P.byteLength(I.toString())+2+P.byteLength(Q.toString())},0):f+=3+P.byteLength(I.toString())+2+P.byteLength(st[I].toString()),f},0);break;default:return W.emit("error",new Error("Invalid property ".concat(it,": ").concat(st))),!1}return h}if(F)for(var H in F){var J=0,K=0,tt=F[H];if(Array.isArray(tt))for(var at=0;at<tt.length;at++){if(!(K=q(H,tt[at])))return!1;J+=K}else{if(!(K=q(H,tt)))return!1;J=K}if(!J)return!1;j+=J}return{length:P.byteLength(v(j))+j,write:function(){E(W,F,j)}}}function A(W,F,j,q){var H=["reasonString","userProperties"],J=j&&j.properties&&j.properties.maximumPacketSize?j.properties.maximumPacketSize:0,K=S(W,F);if(J)for(;q+K.length>J;){var tt=H.shift();if(!tt||!F[tt])return!1;delete F[tt],K=S(W,F)}return K}function L(W,F,j){switch(x.propertiesTypes[F]){case"byte":W.write(P.from([x.properties[F]])),W.write(P.from([+j]));break;case"int8":W.write(P.from([x.properties[F]])),W.write(P.from([j]));break;case"binary":W.write(P.from([x.properties[F]])),B(W,j);break;case"int16":W.write(P.from([x.properties[F]])),g(W,j);break;case"int32":W.write(P.from([x.properties[F]])),function(q,H){var J=m(H);l("write4ByteNumber: %o",J),q.write(J)}(W,j);break;case"var":W.write(P.from([x.properties[F]])),N(W,j);break;case"string":W.write(P.from([x.properties[F]])),Y(W,j);break;case"pair":Object.getOwnPropertyNames(j).forEach(function(q){var H=j[q];Array.isArray(H)?H.forEach(function(J){W.write(P.from([x.properties[F]])),_(W,q.toString(),J.toString())}):(W.write(P.from([x.properties[F]])),_(W,q.toString(),H.toString()))});break;default:return W.emit("error",new Error("Invalid property ".concat(F," value: ").concat(j))),!1}}function E(W,F,j){N(W,j);for(var q in F)if(Object.prototype.hasOwnProperty.call(F,q)&&F[q]!==null){var H=F[q];if(Array.isArray(H))for(var J=0;J<H.length;J++)L(W,q,H[J]);else L(W,q,H)}}function V(W){return W?W instanceof P?W.length:P.byteLength(W):0}function $(W){return typeof W=="string"||W instanceof P}Z.exports=y}).call(this)}).call(this,D("buffer").Buffer)},{"./constants":38,"./numbers":41,buffer:17,debug:18,"process-nextick-args":49}],45:[function(D,Z,R){var P=1e3,x=60*P,w=60*x,T=24*w,c=7*T,s=365.25*T;function l(d,a,u,v){var m=a>=1.5*u;return Math.round(d/u)+" "+v+(m?"s":"")}Z.exports=function(d,a){a=a||{};var u=typeof d;if(u==="string"&&d.length>0)return function(v){if(!((v=String(v)).length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(v);if(!!m){var g=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return g*s;case"weeks":case"week":case"w":return g*c;case"days":case"day":case"d":return g*T;case"hours":case"hour":case"hrs":case"hr":case"h":return g*w;case"minutes":case"minute":case"mins":case"min":case"m":return g*x;case"seconds":case"second":case"secs":case"sec":case"s":return g*P;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}(d);if(u==="number"&&isFinite(d))return a.long?function(v){var m=Math.abs(v);return m>=T?l(v,m,T,"day"):m>=w?l(v,m,w,"hour"):m>=x?l(v,m,x,"minute"):m>=P?l(v,m,P,"second"):v+" ms"}(d):function(v){var m=Math.abs(v);return m>=T?Math.round(v/T)+"d":m>=w?Math.round(v/w)+"h":m>=x?Math.round(v/x)+"m":m>=P?Math.round(v/P)+"s":v+"ms"}(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],46:[function(D,Z,R){var P=D("./lib/number-allocator.js");Z.exports.NumberAllocator=P},{"./lib/number-allocator.js":47}],47:[function(D,Z,R){"use strict";var P=D("js-sdsl").Set,x=D("debug")("number-allocator:trace"),w=D("debug")("number-allocator:error");function T(s,l){this.low=s,this.high=l}function c(s,l){if(!(this instanceof c))return new c(s,l);this.min=s,this.max=l,this.ss=new P([],function(d,a){return d.compare(a)}),x("Create"),this.clear()}T.prototype.equals=function(s){return this.low===s.low&&this.high===s.high},T.prototype.compare=function(s){return this.low<s.low&&this.high<s.low?-1:s.low<this.low&&s.high<this.low?1:0},c.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},c.prototype.alloc=function(){if(this.ss.size()===0)return x("alloc():empty"),null;var s=this.ss.front(),l=s.low;return l+1<=s.high?++s.low:this.ss.eraseElementByPos(0),x("alloc():"+l),l},c.prototype.use=function(s){var l=new T(s,s),d=this.ss.lowerBound(l);if(d){if(d.equals(l))return this.ss.eraseElementByValue(d),x("use():"+s),!0;if(d.low>s)return!1;if(d.low===s)return++d.low,x("use():"+s),!0;if(d.high===s)return--d.high,x("use():"+s),!0;var a=d.low;return d.low=s+1,this.ss.insert(new T(a,s-1)),x("use():"+s),!0}return x("use():failed"),!1},c.prototype.free=function(s){if(s<this.min||s>this.max)return void w("free():"+s+" is out of range");var l=new T(s,s),d=this.ss.lowerBound(l);if(d){if(d.low<=s&&s<=d.high)return void w("free():"+s+" has already been vacant");if(d===this.ss.front())s+1===d.low?--d.low:this.ss.insert(l);else{var a=this.ss.reverseLowerBound(l);a.high+1===s?s+1===d.low?(this.ss.eraseElementByValue(a),d.low=a.low):a.high=s:s+1===d.low?d.low=s:this.ss.insert(l)}}else{if(d===this.ss.front())return void this.ss.insert(l);var u=this.ss.reverseLowerBound(l);u.high+1===s?u.high=s:this.ss.insert(l)}x("free():"+s)},c.prototype.clear=function(){x("clear()"),this.ss.clear(),this.ss.insert(new T(this.min,this.max))},c.prototype.intervalCount=function(){return this.ss.size()},c.prototype.dump=function(){console.log("length:"+this.ss.size());var s=At(this.ss),l;try{for(s.s();!(l=s.n()).done;){var d=l.value;console.log(d)}}catch(a){s.e(a)}finally{s.f()}},Z.exports=c},{debug:18,"js-sdsl":36}],48:[function(D,Z,R){var P=D("wrappy");function x(T){var c=function s(){return s.called?s.value:(s.called=!0,s.value=T.apply(this,arguments))};return c.called=!1,c}function w(T){var c=function l(){if(l.called)throw new Error(l.onceError);return l.called=!0,l.value=T.apply(this,arguments)},s=T.name||"Function wrapped with `once`";return c.onceError=s+" shouldn't be called more than once",c.called=!1,c}Z.exports=P(x),Z.exports.strict=P(w),x.proto=x(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return x(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return w(this)},configurable:!0})})},{wrappy:79}],49:[function(D,Z,R){(function(P){(function(){"use strict";P===void 0||!P.version||P.version.indexOf("v0.")===0||P.version.indexOf("v1.")===0&&P.version.indexOf("v1.8.")!==0?Z.exports={nextTick:function(w,T,c,s){if(typeof w!="function")throw new TypeError('"callback" argument must be a function');var l,d,a=arguments.length;switch(a){case 0:case 1:return P.nextTick(w);case 2:return P.nextTick(function(){w.call(null,T)});case 3:return P.nextTick(function(){w.call(null,T,c)});case 4:return P.nextTick(function(){w.call(null,T,c,s)});default:for(l=new Array(a-1),d=0;d<l.length;)l[d++]=arguments[d];return P.nextTick(function(){w.apply(null,l)})}}}:Z.exports=P}).call(this)}).call(this,D("_process"))},{_process:50}],50:[function(D,Z,R){var P,x,w=Z.exports={};function T(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function s(y){if(P===setTimeout)return setTimeout(y,0);if((P===T||!P)&&setTimeout)return P=setTimeout,setTimeout(y,0);try{return P(y,0)}catch(C){try{return P.call(null,y,0)}catch(M){return P.call(this,y,0)}}}(function(){try{P=typeof setTimeout=="function"?setTimeout:T}catch(y){P=T}try{x=typeof clearTimeout=="function"?clearTimeout:c}catch(y){x=c}})();var l,d=[],a=!1,u=-1;function v(){a&&l&&(a=!1,l.length?d=l.concat(d):u=-1,d.length&&m())}function m(){if(!a){var y=s(v);a=!0;for(var C=d.length;C;){for(l=d,d=[];++u<C;)l&&l[u].run();u=-1,C=d.length}l=null,a=!1,function(M){if(x===clearTimeout)return clearTimeout(M);if((x===c||!x)&&clearTimeout)return x=clearTimeout,clearTimeout(M);try{x(M)}catch(N){try{return x.call(null,M)}catch(Y){return x.call(this,M)}}}(y)}}function g(y,C){this.fun=y,this.array=C}function k(){}w.nextTick=function(y){var C=new Array(arguments.length-1);if(arguments.length>1)for(var M=1;M<arguments.length;M++)C[M-1]=arguments[M];d.push(new g(y,C)),d.length!==1||a||s(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=k,w.addListener=k,w.once=k,w.off=k,w.removeListener=k,w.removeAllListeners=k,w.emit=k,w.prependListener=k,w.prependOnceListener=k,w.listeners=function(y){return[]},w.binding=function(y){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(y){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],51:[function(D,Z,R){(function(P){(function(){(function(x){var w=typeof R=="object"&&R&&!R.nodeType&&R,T=typeof Z=="object"&&Z&&!Z.nodeType&&Z,c=typeof P=="object"&&P;c.global!==c&&c.window!==c&&c.self!==c||(x=c);var s,l,d=2147483647,a=36,u=1,v=26,m=38,g=700,k=72,y=128,C="-",M=/^xn--/,N=/[^\x20-\x7E]/,Y=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},G=a-u,et=Math.floor,B=String.fromCharCode;function S(q){throw new RangeError(_[q])}function A(q,H){for(var J=q.length,K=[];J--;)K[J]=H(q[J]);return K}function L(q,H){var J=q.split("@"),K="";return J.length>1&&(K=J[0]+"@",q=J[1]),K+A((q=q.replace(Y,".")).split("."),H).join(".")}function E(q){for(var H,J,K=[],tt=0,at=q.length;tt<at;)(H=q.charCodeAt(tt++))>=55296&&H<=56319&&tt<at?(64512&(J=q.charCodeAt(tt++)))==56320?K.push(((1023&H)<<10)+(1023&J)+65536):(K.push(H),tt--):K.push(H);return K}function V(q){return A(q,function(H){var J="";return H>65535&&(J+=B((H-=65536)>>>10&1023|55296),H=56320|1023&H),J+=B(H)}).join("")}function $(q,H){return q+22+75*(q<26)-((H!=0)<<5)}function W(q,H,J){var K=0;for(q=J?et(q/g):q>>1,q+=et(q/H);q>G*v>>1;K+=a)q=et(q/G);return et(K+(G+1)*q/(q+m))}function F(q){var H,J,K,tt,at,it,st,h,f,I,O,X=[],Q=q.length,ot=0,ut=y,lt=k;for((J=q.lastIndexOf(C))<0&&(J=0),K=0;K<J;++K)q.charCodeAt(K)>=128&&S("not-basic"),X.push(q.charCodeAt(K));for(tt=J>0?J+1:0;tt<Q;){for(at=ot,it=1,st=a;tt>=Q&&S("invalid-input"),((h=(O=q.charCodeAt(tt++))-48<10?O-22:O-65<26?O-65:O-97<26?O-97:a)>=a||h>et((d-ot)/it))&&S("overflow"),ot+=h*it,!(h<(f=st<=lt?u:st>=lt+v?v:st-lt));st+=a)it>et(d/(I=a-f))&&S("overflow"),it*=I;lt=W(ot-at,H=X.length+1,at==0),et(ot/H)>d-ut&&S("overflow"),ut+=et(ot/H),ot%=H,X.splice(ot++,0,ut)}return V(X)}function j(q){var H,J,K,tt,at,it,st,h,f,I,O,X,Q,ot,ut,lt=[];for(X=(q=E(q)).length,H=y,J=0,at=k,it=0;it<X;++it)(O=q[it])<128&&lt.push(B(O));for(K=tt=lt.length,tt&&lt.push(C);K<X;){for(st=d,it=0;it<X;++it)(O=q[it])>=H&&O<st&&(st=O);for(st-H>et((d-J)/(Q=K+1))&&S("overflow"),J+=(st-H)*Q,H=st,it=0;it<X;++it)if((O=q[it])<H&&++J>d&&S("overflow"),O==H){for(h=J,f=a;!(h<(I=f<=at?u:f>=at+v?v:f-at));f+=a)ut=h-I,ot=a-I,lt.push(B($(I+ut%ot,0))),h=et(ut/ot);lt.push(B($(h,0))),at=W(J,Q,K==tt),J=0,++K}++J,++H}return lt.join("")}if(s={version:"1.4.1",ucs2:{decode:E,encode:V},decode:F,encode:j,toASCII:function(H){return L(H,function(J){return N.test(J)?"xn--"+j(J):J})},toUnicode:function(H){return L(H,function(J){return M.test(J)?F(J.slice(4).toLowerCase()):J})}},w&&T)if(Z.exports==w)T.exports=s;else for(l in s)s.hasOwnProperty(l)&&(w[l]=s[l]);else x.punycode=s})(this)}).call(this)}).call(this,typeof ft.g!="undefined"?ft.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],52:[function(D,Z,R){"use strict";function P(w,T){return Object.prototype.hasOwnProperty.call(w,T)}Z.exports=function(w,T,c,s){T=T||"&",c=c||"=";var l={};if(typeof w!="string"||w.length===0)return l;var d=/\+/g;w=w.split(T);var a=1e3;s&&typeof s.maxKeys=="number"&&(a=s.maxKeys);var u=w.length;a>0&&u>a&&(u=a);for(var v=0;v<u;++v){var m,g,k,y,C=w[v].replace(d,"%20"),M=C.indexOf(c);M>=0?(m=C.substr(0,M),g=C.substr(M+1)):(m=C,g=""),k=decodeURIComponent(m),y=decodeURIComponent(g),P(l,k)?x(l[k])?l[k].push(y):l[k]=[l[k],y]:l[k]=y}return l};var x=Array.isArray||function(w){return Object.prototype.toString.call(w)==="[object Array]"}},{}],53:[function(D,Z,R){"use strict";var P=function(s){switch(typeof s){case"string":return s;case"boolean":return s?"true":"false";case"number":return isFinite(s)?s:"";default:return""}};Z.exports=function(c,s,l,d){return s=s||"&",l=l||"=",c===null&&(c=void 0),typeof c=="object"?w(T(c),function(a){var u=encodeURIComponent(P(a))+l;return x(c[a])?w(c[a],function(v){return u+encodeURIComponent(P(v))}).join(s):u+encodeURIComponent(P(c[a]))}).join(s):d?encodeURIComponent(P(d))+l+encodeURIComponent(P(c)):""};var x=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};function w(c,s){if(c.map)return c.map(s);for(var l=[],d=0;d<c.length;d++)l.push(s(c[d],d));return l}var T=Object.keys||function(c){var s=[];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&s.push(l);return s}},{}],54:[function(D,Z,R){"use strict";R.decode=R.parse=D("./decode"),R.encode=R.stringify=D("./encode")},{"./decode":52,"./encode":53}],55:[function(D,Z,R){"use strict";var P={};function x(T,c,s){s||(s=Error);var l=function(d){var a,u;function v(m,g,k){return d.call(this,function(y,C,M){return typeof c=="string"?c:c(y,C,M)}(m,g,k))||this}return u=d,(a=v).prototype=Object.create(u.prototype),a.prototype.constructor=a,a.__proto__=u,v}(s);l.prototype.name=s.name,l.prototype.code=T,P[T]=l}function w(T,c){if(Array.isArray(T)){var s=T.length;return T=T.map(function(l){return String(l)}),s>2?"one of ".concat(c," ").concat(T.slice(0,s-1).join(", "),", or ")+T[s-1]:s===2?"one of ".concat(c," ").concat(T[0]," or ").concat(T[1]):"of ".concat(c," ").concat(T[0])}return"of ".concat(c," ").concat(String(T))}x("ERR_INVALID_OPT_VALUE",function(T,c){return'The value "'+c+'" is invalid for option "'+T+'"'},TypeError),x("ERR_INVALID_ARG_TYPE",function(T,c,s){var l,d,a,u;if(typeof c=="string"&&(d="not ",c.substr(!a||a<0?0:+a,d.length)===d)?(l="must not be",c=c.replace(/^not /,"")):l="must be",function(m,g,k){return(k===void 0||k>m.length)&&(k=m.length),m.substring(k-g.length,k)===g}(T," argument"))u="The ".concat(T," ").concat(l," ").concat(w(c,"type"));else{var v=function(m,g,k){return typeof k!="number"&&(k=0),!(k+g.length>m.length)&&m.indexOf(g,k)!==-1}(T,".")?"property":"argument";u='The "'.concat(T,'" ').concat(v," ").concat(l," ").concat(w(c,"type"))}return u+=". Received type ".concat(typeof s)},TypeError),x("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),x("ERR_METHOD_NOT_IMPLEMENTED",function(T){return"The "+T+" method is not implemented"}),x("ERR_STREAM_PREMATURE_CLOSE","Premature close"),x("ERR_STREAM_DESTROYED",function(T){return"Cannot call "+T+" after a stream was destroyed"}),x("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),x("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),x("ERR_STREAM_WRITE_AFTER_END","write after end"),x("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),x("ERR_UNKNOWN_ENCODING",function(T){return"Unknown encoding: "+T},TypeError),x("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),Z.exports.codes=P},{}],56:[function(D,Z,R){(function(P){(function(){"use strict";var x=Object.keys||function(v){var m=[];for(var g in v)m.push(g);return m};Z.exports=d;var w=D("./_stream_readable"),T=D("./_stream_writable");D("inherits")(d,w);for(var c=x(T.prototype),s=0;s<c.length;s++){var l=c[s];d.prototype[l]||(d.prototype[l]=T.prototype[l])}function d(v){if(!(this instanceof d))return new d(v);w.call(this,v),T.call(this,v),this.allowHalfOpen=!0,v&&(v.readable===!1&&(this.readable=!1),v.writable===!1&&(this.writable=!1),v.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}function a(){this._writableState.ended||P.nextTick(u,this)}function u(v){v.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(d.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(m){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=m,this._writableState.destroyed=m)}})}).call(this)}).call(this,D("_process"))},{"./_stream_readable":58,"./_stream_writable":60,_process:50,inherits:24}],57:[function(D,Z,R){"use strict";Z.exports=x;var P=D("./_stream_transform");function x(w){if(!(this instanceof x))return new x(w);P.call(this,w)}D("inherits")(x,P),x.prototype._transform=function(w,T,c){c(null,w)}},{"./_stream_transform":59,inherits:24}],58:[function(D,Z,R){(function(P,x){(function(){"use strict";var w;Z.exports=S,S.ReadableState=B,D("events").EventEmitter;var T=function(f,I){return f.listeners(I).length},c=D("./internal/streams/stream"),s=D("buffer").Buffer,l=x.Uint8Array||function(){},d,a=D("util");d=a&&a.debuglog?a.debuglog("stream"):function(){};var u,v,m,g=D("./internal/streams/buffer_list"),k=D("./internal/streams/destroy"),y=D("./internal/streams/state").getHighWaterMark,C=D("../errors").codes,M=C.ERR_INVALID_ARG_TYPE,N=C.ERR_STREAM_PUSH_AFTER_EOF,Y=C.ERR_METHOD_NOT_IMPLEMENTED,_=C.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;D("inherits")(S,c);var G=k.errorOrDestroy,et=["error","close","destroy","pause","resume"];function B(h,f,I){w=w||D("./_stream_duplex"),h=h||{},typeof I!="boolean"&&(I=f instanceof w),this.objectMode=!!h.objectMode,I&&(this.objectMode=this.objectMode||!!h.readableObjectMode),this.highWaterMark=y(this,h,"readableHighWaterMark",I),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=h.emitClose!==!1,this.autoDestroy=!!h.autoDestroy,this.destroyed=!1,this.defaultEncoding=h.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,h.encoding&&(u||(u=D("string_decoder/").StringDecoder),this.decoder=new u(h.encoding),this.encoding=h.encoding)}function S(h){if(w=w||D("./_stream_duplex"),!(this instanceof S))return new S(h);var f=this instanceof w;this._readableState=new B(h,this,f),this.readable=!0,h&&(typeof h.read=="function"&&(this._read=h.read),typeof h.destroy=="function"&&(this._destroy=h.destroy)),c.call(this)}function A(h,f,I,O,X){d("readableAddChunk",f);var Q,ot=h._readableState;if(f===null)ot.reading=!1,function(ut,lt){if(d("onEofChunk"),!lt.ended){if(lt.decoder){var gt=lt.decoder.end();gt&&gt.length&&(lt.buffer.push(gt),lt.length+=lt.objectMode?1:gt.length)}lt.ended=!0,lt.sync?$(ut):(lt.needReadable=!1,lt.emittedReadable||(lt.emittedReadable=!0,W(ut)))}}(h,ot);else if(X||(Q=function(ut,lt){var gt;bt=lt,s.isBuffer(bt)||bt instanceof l||typeof lt=="string"||lt===void 0||ut.objectMode||(gt=new M("chunk",["string","Buffer","Uint8Array"],lt));var bt;return gt}(ot,f)),Q)G(h,Q);else if(ot.objectMode||f&&f.length>0)if(typeof f=="string"||ot.objectMode||Object.getPrototypeOf(f)===s.prototype||(f=function(ut){return s.from(ut)}(f)),O)ot.endEmitted?G(h,new _):L(h,ot,f,!0);else if(ot.ended)G(h,new N);else{if(ot.destroyed)return!1;ot.reading=!1,ot.decoder&&!I?(f=ot.decoder.write(f),ot.objectMode||f.length!==0?L(h,ot,f,!1):F(h,ot)):L(h,ot,f,!1)}else O||(ot.reading=!1,F(h,ot));return!ot.ended&&(ot.length<ot.highWaterMark||ot.length===0)}function L(h,f,I,O){f.flowing&&f.length===0&&!f.sync?(f.awaitDrain=0,h.emit("data",I)):(f.length+=f.objectMode?1:I.length,O?f.buffer.unshift(I):f.buffer.push(I),f.needReadable&&$(h)),F(h,f)}Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(f){this._readableState&&(this._readableState.destroyed=f)}}),S.prototype.destroy=k.destroy,S.prototype._undestroy=k.undestroy,S.prototype._destroy=function(h,f){f(h)},S.prototype.push=function(h,f){var I,O=this._readableState;return O.objectMode?I=!0:typeof h=="string"&&((f=f||O.defaultEncoding)!==O.encoding&&(h=s.from(h,f),f=""),I=!0),A(this,h,f,!1,I)},S.prototype.unshift=function(h){return A(this,h,null,!0,!1)},S.prototype.isPaused=function(){return this._readableState.flowing===!1},S.prototype.setEncoding=function(h){u||(u=D("string_decoder/").StringDecoder);var f=new u(h);this._readableState.decoder=f,this._readableState.encoding=this._readableState.decoder.encoding;for(var I=this._readableState.buffer.head,O="";I!==null;)O+=f.write(I.data),I=I.next;return this._readableState.buffer.clear(),O!==""&&this._readableState.buffer.push(O),this._readableState.length=O.length,this};var E=1073741824;function V(h,f){return h<=0||f.length===0&&f.ended?0:f.objectMode?1:h!=h?f.flowing&&f.length?f.buffer.head.data.length:f.length:(h>f.highWaterMark&&(f.highWaterMark=function(I){return I>=E?I=E:(I--,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,I|=I>>>16,I++),I}(h)),h<=f.length?h:f.ended?f.length:(f.needReadable=!0,0))}function $(h){var f=h._readableState;d("emitReadable",f.needReadable,f.emittedReadable),f.needReadable=!1,f.emittedReadable||(d("emitReadable",f.flowing),f.emittedReadable=!0,P.nextTick(W,h))}function W(h){var f=h._readableState;d("emitReadable_",f.destroyed,f.length,f.ended),f.destroyed||!f.length&&!f.ended||(h.emit("readable"),f.emittedReadable=!1),f.needReadable=!f.flowing&&!f.ended&&f.length<=f.highWaterMark,K(h)}function F(h,f){f.readingMore||(f.readingMore=!0,P.nextTick(j,h,f))}function j(h,f){for(;!f.reading&&!f.ended&&(f.length<f.highWaterMark||f.flowing&&f.length===0);){var I=f.length;if(d("maybeReadMore read 0"),h.read(0),I===f.length)break}f.readingMore=!1}function q(h){var f=h._readableState;f.readableListening=h.listenerCount("readable")>0,f.resumeScheduled&&!f.paused?f.flowing=!0:h.listenerCount("data")>0&&h.resume()}function H(h){d("readable nexttick read 0"),h.read(0)}function J(h,f){d("resume",f.reading),f.reading||h.read(0),f.resumeScheduled=!1,h.emit("resume"),K(h),f.flowing&&!f.reading&&h.read(0)}function K(h){var f=h._readableState;for(d("flow",f.flowing);f.flowing&&h.read()!==null;);}function tt(h,f){return f.length===0?null:(f.objectMode?I=f.buffer.shift():!h||h>=f.length?(I=f.decoder?f.buffer.join(""):f.buffer.length===1?f.buffer.first():f.buffer.concat(f.length),f.buffer.clear()):I=f.buffer.consume(h,f.decoder),I);var I}function at(h){var f=h._readableState;d("endReadable",f.endEmitted),f.endEmitted||(f.ended=!0,P.nextTick(it,f,h))}function it(h,f){if(d("endReadableNT",h.endEmitted,h.length),!h.endEmitted&&h.length===0&&(h.endEmitted=!0,f.readable=!1,f.emit("end"),h.autoDestroy)){var I=f._writableState;(!I||I.autoDestroy&&I.finished)&&f.destroy()}}function st(h,f){for(var I=0,O=h.length;I<O;I++)if(h[I]===f)return I;return-1}S.prototype.read=function(h){d("read",h),h=parseInt(h,10);var f=this._readableState,I=h;if(h!==0&&(f.emittedReadable=!1),h===0&&f.needReadable&&((f.highWaterMark!==0?f.length>=f.highWaterMark:f.length>0)||f.ended))return d("read: emitReadable",f.length,f.ended),f.length===0&&f.ended?at(this):$(this),null;if((h=V(h,f))===0&&f.ended)return f.length===0&&at(this),null;var O,X=f.needReadable;return d("need readable",X),(f.length===0||f.length-h<f.highWaterMark)&&d("length less than watermark",X=!0),f.ended||f.reading?d("reading or ended",X=!1):X&&(d("do read"),f.reading=!0,f.sync=!0,f.length===0&&(f.needReadable=!0),this._read(f.highWaterMark),f.sync=!1,f.reading||(h=V(I,f))),(O=h>0?tt(h,f):null)===null?(f.needReadable=f.length<=f.highWaterMark,h=0):(f.length-=h,f.awaitDrain=0),f.length===0&&(f.ended||(f.needReadable=!0),I!==h&&f.ended&&at(this)),O!==null&&this.emit("data",O),O},S.prototype._read=function(h){G(this,new Y("_read()"))},S.prototype.pipe=function(h,f){var I=this,O=this._readableState;switch(O.pipesCount){case 0:O.pipes=h;break;case 1:O.pipes=[O.pipes,h];break;default:O.pipes.push(h)}O.pipesCount+=1,d("pipe count=%d opts=%j",O.pipesCount,f);var X=(!f||f.end!==!1)&&h!==P.stdout&&h!==P.stderr?ot:qt;function Q(Rt,_t){d("onunpipe"),Rt===I&&_t&&_t.hasUnpiped===!1&&(_t.hasUnpiped=!0,d("cleanup"),h.removeListener("close",Wt),h.removeListener("finish",Ft),h.removeListener("drain",ut),h.removeListener("error",bt),h.removeListener("unpipe",Q),I.removeListener("end",ot),I.removeListener("end",qt),I.removeListener("data",gt),lt=!0,!O.awaitDrain||h._writableState&&!h._writableState.needDrain||ut())}function ot(){d("onend"),h.end()}O.endEmitted?P.nextTick(X):I.once("end",X),h.on("unpipe",Q);var ut=function(Rt){return function(){var _t=Rt._readableState;d("pipeOnDrain",_t.awaitDrain),_t.awaitDrain&&_t.awaitDrain--,_t.awaitDrain===0&&T(Rt,"data")&&(_t.flowing=!0,K(Rt))}}(I);h.on("drain",ut);var lt=!1;function gt(Rt){d("ondata");var _t=h.write(Rt);d("dest.write",_t),_t===!1&&((O.pipesCount===1&&O.pipes===h||O.pipesCount>1&&st(O.pipes,h)!==-1)&&!lt&&(d("false write response, pause",O.awaitDrain),O.awaitDrain++),I.pause())}function bt(Rt){d("onerror",Rt),qt(),h.removeListener("error",bt),T(h,"error")===0&&G(h,Rt)}function Wt(){h.removeListener("finish",Ft),qt()}function Ft(){d("onfinish"),h.removeListener("close",Wt),qt()}function qt(){d("unpipe"),I.unpipe(h)}return I.on("data",gt),function(Rt,_t,Ct){if(typeof Rt.prependListener=="function")return Rt.prependListener(_t,Ct);Rt._events&&Rt._events[_t]?Array.isArray(Rt._events[_t])?Rt._events[_t].unshift(Ct):Rt._events[_t]=[Ct,Rt._events[_t]]:Rt.on(_t,Ct)}(h,"error",bt),h.once("close",Wt),h.once("finish",Ft),h.emit("pipe",I),O.flowing||(d("pipe resume"),I.resume()),h},S.prototype.unpipe=function(h){var f=this._readableState,I={hasUnpiped:!1};if(f.pipesCount===0)return this;if(f.pipesCount===1)return h&&h!==f.pipes?this:(h||(h=f.pipes),f.pipes=null,f.pipesCount=0,f.flowing=!1,h&&h.emit("unpipe",this,I),this);if(!h){var O=f.pipes,X=f.pipesCount;f.pipes=null,f.pipesCount=0,f.flowing=!1;for(var Q=0;Q<X;Q++)O[Q].emit("unpipe",this,{hasUnpiped:!1});return this}var ot=st(f.pipes,h);return ot===-1?this:(f.pipes.splice(ot,1),f.pipesCount-=1,f.pipesCount===1&&(f.pipes=f.pipes[0]),h.emit("unpipe",this,I),this)},S.prototype.on=function(h,f){var I=c.prototype.on.call(this,h,f),O=this._readableState;return h==="data"?(O.readableListening=this.listenerCount("readable")>0,O.flowing!==!1&&this.resume()):h==="readable"&&(O.endEmitted||O.readableListening||(O.readableListening=O.needReadable=!0,O.flowing=!1,O.emittedReadable=!1,d("on readable",O.length,O.reading),O.length?$(this):O.reading||P.nextTick(H,this))),I},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(h,f){var I=c.prototype.removeListener.call(this,h,f);return h==="readable"&&P.nextTick(q,this),I},S.prototype.removeAllListeners=function(h){var f=c.prototype.removeAllListeners.apply(this,arguments);return h!=="readable"&&h!==void 0||P.nextTick(q,this),f},S.prototype.resume=function(){var h=this._readableState;return h.flowing||(d("resume"),h.flowing=!h.readableListening,function(f,I){I.resumeScheduled||(I.resumeScheduled=!0,P.nextTick(J,f,I))}(this,h)),h.paused=!1,this},S.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},S.prototype.wrap=function(h){var f=this,I=this._readableState,O=!1;for(var X in h.on("end",function(){if(d("wrapped end"),I.decoder&&!I.ended){var ot=I.decoder.end();ot&&ot.length&&f.push(ot)}f.push(null)}),h.on("data",function(ot){d("wrapped data"),I.decoder&&(ot=I.decoder.write(ot)),(!I.objectMode||ot!=null)&&(I.objectMode||ot&&ot.length)&&(f.push(ot)||(O=!0,h.pause()))}),h)this[X]===void 0&&typeof h[X]=="function"&&(this[X]=function(ot){return function(){return h[ot].apply(h,arguments)}}(X));for(var Q=0;Q<et.length;Q++)h.on(et[Q],this.emit.bind(this,et[Q]));return this._read=function(ot){d("wrapped _read",ot),O&&(O=!1,h.resume())},this},typeof Symbol=="function"&&(S.prototype[Symbol.asyncIterator]=function(){return v===void 0&&(v=D("./internal/streams/async_iterator")),v(this)}),Object.defineProperty(S.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(S.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(S.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(f){this._readableState&&(this._readableState.flowing=f)}}),S._fromList=tt,Object.defineProperty(S.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(S.from=function(h,f){return m===void 0&&(m=D("./internal/streams/from")),m(S,h,f)})}).call(this)}).call(this,D("_process"),typeof ft.g!="undefined"?ft.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/async_iterator":61,"./internal/streams/buffer_list":62,"./internal/streams/destroy":63,"./internal/streams/from":65,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,events:22,inherits:24,"string_decoder/":75,util:16}],59:[function(D,Z,R){"use strict";Z.exports=l;var P=D("../errors").codes,x=P.ERR_METHOD_NOT_IMPLEMENTED,w=P.ERR_MULTIPLE_CALLBACK,T=P.ERR_TRANSFORM_ALREADY_TRANSFORMING,c=P.ERR_TRANSFORM_WITH_LENGTH_0,s=D("./_stream_duplex");function l(u){if(!(this instanceof l))return new l(u);s.call(this,u),this._transformState={afterTransform:function(v,m){var g=this._transformState;g.transforming=!1;var k=g.writecb;if(k===null)return this.emit("error",new w);g.writechunk=null,g.writecb=null,m!=null&&this.push(m),k(v);var y=this._readableState;y.reading=!1,(y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,u&&(typeof u.transform=="function"&&(this._transform=u.transform),typeof u.flush=="function"&&(this._flush=u.flush)),this.on("prefinish",d)}function d(){var u=this;typeof this._flush!="function"||this._readableState.destroyed?a(this,null,null):this._flush(function(v,m){a(u,v,m)})}function a(u,v,m){if(v)return u.emit("error",v);if(m!=null&&u.push(m),u._writableState.length)throw new c;if(u._transformState.transforming)throw new T;return u.push(null)}D("inherits")(l,s),l.prototype.push=function(u,v){return this._transformState.needTransform=!1,s.prototype.push.call(this,u,v)},l.prototype._transform=function(u,v,m){m(new x("_transform()"))},l.prototype._write=function(u,v,m){var g=this._transformState;if(g.writecb=m,g.writechunk=u,g.writeencoding=v,!g.transforming){var k=this._readableState;(g.needTransform||k.needReadable||k.length<k.highWaterMark)&&this._read(k.highWaterMark)}},l.prototype._read=function(u){var v=this._transformState;v.writechunk===null||v.transforming?v.needTransform=!0:(v.transforming=!0,this._transform(v.writechunk,v.writeencoding,v.afterTransform))},l.prototype._destroy=function(u,v){s.prototype._destroy.call(this,u,function(m){v(m)})}},{"../errors":55,"./_stream_duplex":56,inherits:24}],60:[function(D,Z,R){(function(P,x){(function(){"use strict";function w(F){var j=this;this.next=null,this.entry=null,this.finish=function(){(function(q,H,J){var K=q.entry;for(q.entry=null;K;){var tt=K.callback;H.pendingcb--,tt(J),K=K.next}H.corkedRequestsFree.next=q})(j,F)}}var T;Z.exports=S,S.WritableState=B;var c={deprecate:D("util-deprecate")},s=D("./internal/streams/stream"),l=D("buffer").Buffer,d=x.Uint8Array||function(){},a,u=D("./internal/streams/destroy"),v=D("./internal/streams/state").getHighWaterMark,m=D("../errors").codes,g=m.ERR_INVALID_ARG_TYPE,k=m.ERR_METHOD_NOT_IMPLEMENTED,y=m.ERR_MULTIPLE_CALLBACK,C=m.ERR_STREAM_CANNOT_PIPE,M=m.ERR_STREAM_DESTROYED,N=m.ERR_STREAM_NULL_VALUES,Y=m.ERR_STREAM_WRITE_AFTER_END,_=m.ERR_UNKNOWN_ENCODING,G=u.errorOrDestroy;function et(){}function B(F,j,q){T=T||D("./_stream_duplex"),F=F||{},typeof q!="boolean"&&(q=j instanceof T),this.objectMode=!!F.objectMode,q&&(this.objectMode=this.objectMode||!!F.writableObjectMode),this.highWaterMark=v(this,F,"writableHighWaterMark",q),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var H=F.decodeStrings===!1;this.decodeStrings=!H,this.defaultEncoding=F.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(J){(function(K,tt){var at=K._writableState,it=at.sync,st=at.writecb;if(typeof st!="function")throw new y;if(function(f){f.writing=!1,f.writecb=null,f.length-=f.writelen,f.writelen=0}(at),tt)(function(f,I,O,X,Q){--I.pendingcb,O?(P.nextTick(Q,X),P.nextTick(W,f,I),f._writableState.errorEmitted=!0,G(f,X)):(Q(X),f._writableState.errorEmitted=!0,G(f,X),W(f,I))})(K,at,it,tt,st);else{var h=V(at)||K.destroyed;h||at.corked||at.bufferProcessing||!at.bufferedRequest||E(K,at),it?P.nextTick(L,K,at,h,st):L(K,at,h,st)}})(j,J)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=F.emitClose!==!1,this.autoDestroy=!!F.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}function S(F){var j=this instanceof(T=T||D("./_stream_duplex"));if(!j&&!a.call(S,this))return new S(F);this._writableState=new B(F,this,j),this.writable=!0,F&&(typeof F.write=="function"&&(this._write=F.write),typeof F.writev=="function"&&(this._writev=F.writev),typeof F.destroy=="function"&&(this._destroy=F.destroy),typeof F.final=="function"&&(this._final=F.final)),s.call(this)}function A(F,j,q,H,J,K,tt){j.writelen=H,j.writecb=tt,j.writing=!0,j.sync=!0,j.destroyed?j.onwrite(new M("write")):q?F._writev(J,j.onwrite):F._write(J,K,j.onwrite),j.sync=!1}function L(F,j,q,H){q||function(J,K){K.length===0&&K.needDrain&&(K.needDrain=!1,J.emit("drain"))}(F,j),j.pendingcb--,H(),W(F,j)}function E(F,j){j.bufferProcessing=!0;var q=j.bufferedRequest;if(F._writev&&q&&q.next){var H=j.bufferedRequestCount,J=new Array(H),K=j.corkedRequestsFree;K.entry=q;for(var tt=0,at=!0;q;)J[tt]=q,q.isBuf||(at=!1),q=q.next,tt+=1;J.allBuffers=at,A(F,j,!0,j.length,J,"",K.finish),j.pendingcb++,j.lastBufferedRequest=null,K.next?(j.corkedRequestsFree=K.next,K.next=null):j.corkedRequestsFree=new w(j),j.bufferedRequestCount=0}else{for(;q;){var it=q.chunk,st=q.encoding,h=q.callback;if(A(F,j,!1,j.objectMode?1:it.length,it,st,h),q=q.next,j.bufferedRequestCount--,j.writing)break}q===null&&(j.lastBufferedRequest=null)}j.bufferedRequest=q,j.bufferProcessing=!1}function V(F){return F.ending&&F.length===0&&F.bufferedRequest===null&&!F.finished&&!F.writing}function $(F,j){F._final(function(q){j.pendingcb--,q&&G(F,q),j.prefinished=!0,F.emit("prefinish"),W(F,j)})}function W(F,j){var q=V(j);if(q&&(function(J,K){K.prefinished||K.finalCalled||(typeof J._final!="function"||K.destroyed?(K.prefinished=!0,J.emit("prefinish")):(K.pendingcb++,K.finalCalled=!0,P.nextTick($,J,K)))}(F,j),j.pendingcb===0&&(j.finished=!0,F.emit("finish"),j.autoDestroy))){var H=F._readableState;(!H||H.autoDestroy&&H.endEmitted)&&F.destroy()}return q}D("inherits")(S,s),B.prototype.getBuffer=function(){for(var F=this.bufferedRequest,j=[];F;)j.push(F),F=F.next;return j},function(){try{Object.defineProperty(B.prototype,"buffer",{get:c.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(F){}}(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(j){return!!a.call(this,j)||this===S&&j&&j._writableState instanceof B}})):a=function(j){return j instanceof this},S.prototype.pipe=function(){G(this,new C)},S.prototype.write=function(F,j,q){var H,J=this._writableState,K=!1,tt=!J.objectMode&&(H=F,l.isBuffer(H)||H instanceof d);return tt&&!l.isBuffer(F)&&(F=function(at){return l.from(at)}(F)),typeof j=="function"&&(q=j,j=null),tt?j="buffer":j||(j=J.defaultEncoding),typeof q!="function"&&(q=et),J.ending?function(at,it){var st=new Y;G(at,st),P.nextTick(it,st)}(this,q):(tt||function(at,it,st,h){var f;return st===null?f=new N:typeof st=="string"||it.objectMode||(f=new g("chunk",["string","Buffer"],st)),!f||(G(at,f),P.nextTick(h,f),!1)}(this,J,F,q))&&(J.pendingcb++,K=function(at,it,st,h,f,I){if(!st){var O=function(ut,lt,gt){return ut.objectMode||ut.decodeStrings===!1||typeof lt!="string"||(lt=l.from(lt,gt)),lt}(it,h,f);h!==O&&(st=!0,f="buffer",h=O)}var X=it.objectMode?1:h.length;it.length+=X;var Q=it.length<it.highWaterMark;if(Q||(it.needDrain=!0),it.writing||it.corked){var ot=it.lastBufferedRequest;it.lastBufferedRequest={chunk:h,encoding:f,isBuf:st,callback:I,next:null},ot?ot.next=it.lastBufferedRequest:it.bufferedRequest=it.lastBufferedRequest,it.bufferedRequestCount+=1}else A(at,it,!1,X,h,f,I);return Q}(this,J,tt,F,j,q)),K},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var F=this._writableState;F.corked&&(F.corked--,F.writing||F.corked||F.bufferProcessing||!F.bufferedRequest||E(this,F))},S.prototype.setDefaultEncoding=function(F){if(typeof F=="string"&&(F=F.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((F+"").toLowerCase())>-1))throw new _(F);return this._writableState.defaultEncoding=F,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(F,j,q){q(new k("_write()"))},S.prototype._writev=null,S.prototype.end=function(F,j,q){var H=this._writableState;return typeof F=="function"?(q=F,F=null,j=null):typeof j=="function"&&(q=j,j=null),F!=null&&this.write(F,j),H.corked&&(H.corked=1,this.uncork()),H.ending||function(J,K,tt){K.ending=!0,W(J,K),tt&&(K.finished?P.nextTick(tt):J.once("finish",tt)),K.ended=!0,J.writable=!1}(this,H,q),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(j){this._writableState&&(this._writableState.destroyed=j)}}),S.prototype.destroy=u.destroy,S.prototype._undestroy=u.undestroy,S.prototype._destroy=function(F,j){j(F)}}).call(this)}).call(this,D("_process"),typeof ft.g!="undefined"?ft.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/destroy":63,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,inherits:24,"util-deprecate":78}],61:[function(D,Z,R){(function(P){(function(){"use strict";var x;function w(C,M,N){return M in C?Object.defineProperty(C,M,{value:N,enumerable:!0,configurable:!0,writable:!0}):C[M]=N,C}var T=D("./end-of-stream"),c=Symbol("lastResolve"),s=Symbol("lastReject"),l=Symbol("error"),d=Symbol("ended"),a=Symbol("lastPromise"),u=Symbol("handlePromise"),v=Symbol("stream");function m(C,M){return{value:C,done:M}}function g(C){var M=C[c];if(M!==null){var N=C[v].read();N!==null&&(C[a]=null,C[c]=null,C[s]=null,M(m(N,!1)))}}var k=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((w(x={get stream(){return this[v]},next:function(){var M=this,N=this[l];if(N!==null)return Promise.reject(N);if(this[d])return Promise.resolve(m(void 0,!0));if(this[v].destroyed)return new Promise(function(et,B){P.nextTick(function(){M[l]?B(M[l]):et(m(void 0,!0))})});var Y,_=this[a];if(_)Y=new Promise(function(et,B){return function(S,A){et.then(function(){B[d]?S(m(void 0,!0)):B[u](S,A)},A)}}(_,this));else{var G=this[v].read();if(G!==null)return Promise.resolve(m(G,!1));Y=new Promise(this[u])}return this[a]=Y,Y}},Symbol.asyncIterator,function(){return this}),w(x,"return",function(){var C=this;return new Promise(function(M,N){C[v].destroy(null,function(Y){Y?N(Y):M(m(void 0,!0))})})}),x),k);Z.exports=function(C){var M,N=Object.create(y,(w(M={},v,{value:C,writable:!0}),w(M,c,{value:null,writable:!0}),w(M,s,{value:null,writable:!0}),w(M,l,{value:null,writable:!0}),w(M,d,{value:C._readableState.endEmitted,writable:!0}),w(M,u,{value:function(_,G){var et=N[v].read();et?(N[a]=null,N[c]=null,N[s]=null,_(m(et,!1))):(N[c]=_,N[s]=G)},writable:!0}),M));return N[a]=null,T(C,function(Y){if(Y&&Y.code!=="ERR_STREAM_PREMATURE_CLOSE"){var _=N[s];return _!==null&&(N[a]=null,N[c]=null,N[s]=null,_(Y)),void(N[l]=Y)}var G=N[c];G!==null&&(N[a]=null,N[c]=null,N[s]=null,G(m(void 0,!0))),N[d]=!0}),C.on("readable",function(Y){P.nextTick(g,Y)}.bind(null,N)),N}}).call(this)}).call(this,D("_process"))},{"./end-of-stream":64,_process:50}],62:[function(D,Z,R){"use strict";function P(l,d){var a=Object.keys(l);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(l);d&&(u=u.filter(function(v){return Object.getOwnPropertyDescriptor(l,v).enumerable})),a.push.apply(a,u)}return a}function x(l,d,a){return d in l?Object.defineProperty(l,d,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[d]=a,l}function w(l,d){for(var a=0;a<d.length;a++){var u=d[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(l,u.key,u)}}var T=D("buffer").Buffer,c=D("util").inspect,s=c&&c.custom||"inspect";Z.exports=function(){function l(){(function(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,l),this.head=null,this.tail=null,this.length=0}var d,a,u;return d=l,(a=[{key:"push",value:function(m){var g={data:m,next:null};this.length>0?this.tail.next=g:this.head=g,this.tail=g,++this.length}},{key:"unshift",value:function(m){var g={data:m,next:this.head};this.length===0&&(this.tail=g),this.head=g,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var g=this.head,k=""+g.data;g=g.next;)k+=m+g.data;return k}},{key:"concat",value:function(m){if(this.length===0)return T.alloc(0);for(var g,k,y,C=T.allocUnsafe(m>>>0),M=this.head,N=0;M;)g=M.data,k=C,y=N,T.prototype.copy.call(g,k,y),N+=M.data.length,M=M.next;return C}},{key:"consume",value:function(m,g){var k;return m<this.head.data.length?(k=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):k=m===this.head.data.length?this.shift():g?this._getString(m):this._getBuffer(m),k}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var g=this.head,k=1,y=g.data;for(m-=y.length;g=g.next;){var C=g.data,M=m>C.length?C.length:m;if(M===C.length?y+=C:y+=C.slice(0,m),(m-=M)===0){M===C.length?(++k,g.next?this.head=g.next:this.head=this.tail=null):(this.head=g,g.data=C.slice(M));break}++k}return this.length-=k,y}},{key:"_getBuffer",value:function(m){var g=T.allocUnsafe(m),k=this.head,y=1;for(k.data.copy(g),m-=k.data.length;k=k.next;){var C=k.data,M=m>C.length?C.length:m;if(C.copy(g,g.length-m,0,M),(m-=M)===0){M===C.length?(++y,k.next?this.head=k.next:this.head=this.tail=null):(this.head=k,k.data=C.slice(M));break}++y}return this.length-=y,g}},{key:s,value:function(m,g){return c(this,function(k){for(var y=1;y<arguments.length;y++){var C=arguments[y]!=null?arguments[y]:{};y%2?P(Object(C),!0).forEach(function(M){x(k,M,C[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(C)):P(Object(C)).forEach(function(M){Object.defineProperty(k,M,Object.getOwnPropertyDescriptor(C,M))})}return k}({},g,{depth:0,customInspect:!1}))}}])&&w(d.prototype,a),u&&w(d,u),l}()},{buffer:17,util:16}],63:[function(D,Z,R){(function(P){(function(){"use strict";function x(c,s){T(c,s),w(c)}function w(c){c._writableState&&!c._writableState.emitClose||c._readableState&&!c._readableState.emitClose||c.emit("close")}function T(c,s){c.emit("error",s)}Z.exports={destroy:function(s,l){var d=this,a=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return a||u?(l?l(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,P.nextTick(T,this,s)):P.nextTick(T,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(v){!l&&v?d._writableState?d._writableState.errorEmitted?P.nextTick(w,d):(d._writableState.errorEmitted=!0,P.nextTick(x,d,v)):P.nextTick(x,d,v):l?(P.nextTick(w,d),l(v)):P.nextTick(w,d)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(s,l){var d=s._readableState,a=s._writableState;d&&d.autoDestroy||a&&a.autoDestroy?s.destroy(l):s.emit("error",l)}}}).call(this)}).call(this,D("_process"))},{_process:50}],64:[function(D,Z,R){"use strict";var P=D("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function x(){}Z.exports=function w(T,c,s){if(typeof c=="function")return w(T,null,c);c||(c={}),s=function(M){var N=!1;return function(){if(!N){N=!0;for(var Y=arguments.length,_=new Array(Y),G=0;G<Y;G++)_[G]=arguments[G];M.apply(this,_)}}}(s||x);var l=c.readable||c.readable!==!1&&T.readable,d=c.writable||c.writable!==!1&&T.writable,a=function(){T.writable||v()},u=T._writableState&&T._writableState.finished,v=function(){d=!1,u=!0,l||s.call(T)},m=T._readableState&&T._readableState.endEmitted,g=function(){l=!1,m=!0,d||s.call(T)},k=function(N){s.call(T,N)},y=function(){var N;return l&&!m?(T._readableState&&T._readableState.ended||(N=new P),s.call(T,N)):d&&!u?(T._writableState&&T._writableState.ended||(N=new P),s.call(T,N)):void 0},C=function(){T.req.on("finish",v)};return function(M){return M.setHeader&&typeof M.abort=="function"}(T)?(T.on("complete",v),T.on("abort",y),T.req?C():T.on("request",C)):d&&!T._writableState&&(T.on("end",a),T.on("close",a)),T.on("end",g),T.on("finish",v),c.error!==!1&&T.on("error",k),T.on("close",y),function(){T.removeListener("complete",v),T.removeListener("abort",y),T.removeListener("request",C),T.req&&T.req.removeListener("finish",v),T.removeListener("end",a),T.removeListener("close",a),T.removeListener("finish",v),T.removeListener("end",g),T.removeListener("error",k),T.removeListener("close",y)}}},{"../../../errors":55}],65:[function(D,Z,R){Z.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],66:[function(D,Z,R){"use strict";var P,x=D("../../../errors").codes,w=x.ERR_MISSING_ARGS,T=x.ERR_STREAM_DESTROYED;function c(d){if(d)throw d}function s(d){d()}function l(d,a){return d.pipe(a)}Z.exports=function(){for(var d=arguments.length,a=new Array(d),u=0;u<d;u++)a[u]=arguments[u];var v,m=function(k){return k.length?typeof k[k.length-1]!="function"?c:k.pop():c}(a);if(Array.isArray(a[0])&&(a=a[0]),a.length<2)throw new w("streams");var g=a.map(function(k,y){var C=y<a.length-1;return function(M,N,Y,_){_=function(B){var S=!1;return function(){S||(S=!0,B.apply(void 0,arguments))}}(_);var G=!1;M.on("close",function(){G=!0}),P===void 0&&(P=D("./end-of-stream")),P(M,{readable:N,writable:Y},function(B){if(B)return _(B);G=!0,_()});var et=!1;return function(B){if(!G&&!et)return et=!0,function(S){return S.setHeader&&typeof S.abort=="function"}(M)?M.abort():typeof M.destroy=="function"?M.destroy():void _(B||new T("pipe"))}}(k,C,y>0,function(M){v||(v=M),M&&g.forEach(s),C||(g.forEach(s),m(v))})});return a.reduce(l)}},{"../../../errors":55,"./end-of-stream":64}],67:[function(D,Z,R){"use strict";var P=D("../../../errors").codes.ERR_INVALID_OPT_VALUE;Z.exports={getHighWaterMark:function(w,T,c,s){var l=function(d,a,u){return d.highWaterMark!=null?d.highWaterMark:a?d[u]:null}(T,s,c);if(l!=null){if(!isFinite(l)||Math.floor(l)!==l||l<0)throw new P(s?c:"highWaterMark",l);return Math.floor(l)}return w.objectMode?16:16384}}},{"../../../errors":55}],68:[function(D,Z,R){Z.exports=D("events").EventEmitter},{events:22}],69:[function(D,Z,R){(R=Z.exports=D("./lib/_stream_readable.js")).Stream=R,R.Readable=R,R.Writable=D("./lib/_stream_writable.js"),R.Duplex=D("./lib/_stream_duplex.js"),R.Transform=D("./lib/_stream_transform.js"),R.PassThrough=D("./lib/_stream_passthrough.js"),R.finished=D("./lib/internal/streams/end-of-stream.js"),R.pipeline=D("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":56,"./lib/_stream_passthrough.js":57,"./lib/_stream_readable.js":58,"./lib/_stream_transform.js":59,"./lib/_stream_writable.js":60,"./lib/internal/streams/end-of-stream.js":64,"./lib/internal/streams/pipeline.js":66}],70:[function(D,Z,R){"use strict";Z.exports=function(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("interval needed");var P;if(arguments.length>0){P=new Array(arguments.length-2);for(var x=0;x<P.length;x++)P[x]=arguments[x+2]}return new function(w,T,c){var s=this;this._callback=w,this._args=c,this._interval=setInterval(w,T,this._args),this.reschedule=function(l){l||(l=s._interval),s._interval&&clearInterval(s._interval),s._interval=setInterval(s._callback,l,s._args)},this.clear=function(){s._interval&&(clearInterval(s._interval),s._interval=void 0)},this.destroy=function(){s._interval&&clearInterval(s._interval),s._callback=void 0,s._interval=void 0,s._args=void 0}}(arguments[0],arguments[1],P)}},{}],71:[function(D,Z,R){"use strict";Z.exports=D("./index.js")()},{"./index.js":72}],72:[function(D,Z,R){(function(P){(function(){"use strict";function x(w){return w instanceof P?P.from(w):new w.constructor(w.buffer.slice(),w.byteOffset,w.length)}Z.exports=function(w){return(w=w||{}).circles?function(c){var s=[],l=[];return c.proto?function a(u){if(typeof u!="object"||u===null)return u;if(u instanceof Date)return new Date(u);if(Array.isArray(u))return d(u,a);if(u instanceof Map)return new Map(d(Array.from(u),a));if(u instanceof Set)return new Set(d(Array.from(u),a));var v={};for(var m in s.push(u),l.push(v),u){var g=u[m];if(typeof g!="object"||g===null)v[m]=g;else if(g instanceof Date)v[m]=new Date(g);else if(g instanceof Map)v[m]=new Map(d(Array.from(g),a));else if(g instanceof Set)v[m]=new Set(d(Array.from(g),a));else if(ArrayBuffer.isView(g))v[m]=x(g);else{var k=s.indexOf(g);v[m]=k!==-1?l[k]:a(g)}}return s.pop(),l.pop(),v}:function a(u){if(typeof u!="object"||u===null)return u;if(u instanceof Date)return new Date(u);if(Array.isArray(u))return d(u,a);if(u instanceof Map)return new Map(d(Array.from(u),a));if(u instanceof Set)return new Set(d(Array.from(u),a));var v={};for(var m in s.push(u),l.push(v),u)if(Object.hasOwnProperty.call(u,m)!==!1){var g=u[m];if(typeof g!="object"||g===null)v[m]=g;else if(g instanceof Date)v[m]=new Date(g);else if(g instanceof Map)v[m]=new Map(d(Array.from(g),a));else if(g instanceof Set)v[m]=new Set(d(Array.from(g),a));else if(ArrayBuffer.isView(g))v[m]=x(g);else{var k=s.indexOf(g);v[m]=k!==-1?l[k]:a(g)}}return s.pop(),l.pop(),v};function d(a,u){for(var v=Object.keys(a),m=new Array(v.length),g=0;g<v.length;g++){var k=v[g],y=a[k];if(typeof y!="object"||y===null)m[k]=y;else if(y instanceof Date)m[k]=new Date(y);else if(ArrayBuffer.isView(y))m[k]=x(y);else{var C=s.indexOf(y);m[k]=C!==-1?l[C]:u(y)}}return m}}(w):w.proto?function c(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return T(s,c);if(s instanceof Map)return new Map(T(Array.from(s),c));if(s instanceof Set)return new Set(T(Array.from(s),c));var l={};for(var d in s){var a=s[d];typeof a!="object"||a===null?l[d]=a:a instanceof Date?l[d]=new Date(a):a instanceof Map?l[d]=new Map(T(Array.from(a),c)):a instanceof Set?l[d]=new Set(T(Array.from(a),c)):ArrayBuffer.isView(a)?l[d]=x(a):l[d]=c(a)}return l}:function c(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return T(s,c);if(s instanceof Map)return new Map(T(Array.from(s),c));if(s instanceof Set)return new Set(T(Array.from(s),c));var l={};for(var d in s)if(Object.hasOwnProperty.call(s,d)!==!1){var a=s[d];typeof a!="object"||a===null?l[d]=a:a instanceof Date?l[d]=new Date(a):a instanceof Map?l[d]=new Map(T(Array.from(a),c)):a instanceof Set?l[d]=new Set(T(Array.from(a),c)):ArrayBuffer.isView(a)?l[d]=x(a):l[d]=c(a)}return l};function T(c,s){for(var l=Object.keys(c),d=new Array(l.length),a=0;a<l.length;a++){var u=l[a],v=c[u];typeof v!="object"||v===null?d[u]=v:v instanceof Date?d[u]=new Date(v):ArrayBuffer.isView(v)?d[u]=x(v):d[u]=s(v)}return d}}}).call(this)}).call(this,D("buffer").Buffer)},{buffer:17}],73:[function(D,Z,R){var P=D("buffer"),x=P.Buffer;function w(c,s){for(var l in c)s[l]=c[l]}function T(c,s,l){return x(c,s,l)}x.from&&x.alloc&&x.allocUnsafe&&x.allocUnsafeSlow?Z.exports=P:(w(P,R),R.Buffer=T),T.prototype=Object.create(x.prototype),w(x,T),T.from=function(c,s,l){if(typeof c=="number")throw new TypeError("Argument must not be a number");return x(c,s,l)},T.alloc=function(c,s,l){if(typeof c!="number")throw new TypeError("Argument must be a number");var d=x(c);return s!==void 0?typeof l=="string"?d.fill(s,l):d.fill(s):d.fill(0),d},T.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return x(c)},T.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return P.SlowBuffer(c)}},{buffer:17}],74:[function(D,Z,R){Z.exports=function(P){var x=P._readableState;return x?x.objectMode||typeof P._duplexState=="number"?P.read():P.read((w=x,w.buffer.length?w.buffer.head?w.buffer.head.data.length:w.buffer[0].length:w.length)):null;var w}},{}],75:[function(D,Z,R){"use strict";var P=D("safe-buffer").Buffer,x=P.isEncoding||function(m){switch((m=""+m)&&m.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function w(m){var g;switch(this.encoding=function(k){var y=function(C){if(!C)return"utf8";for(var M;;)switch(C){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return C;default:if(M)return;C=(""+C).toLowerCase(),M=!0}}(k);if(typeof y!="string"&&(P.isEncoding===x||!x(k)))throw new Error("Unknown encoding: "+k);return y||k}(m),this.encoding){case"utf16le":this.text=s,this.end=l,g=4;break;case"utf8":this.fillLast=c,g=4;break;case"base64":this.text=d,this.end=a,g=3;break;default:return this.write=u,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=P.allocUnsafe(g)}function T(m){return m<=127?0:m>>5==6?2:m>>4==14?3:m>>3==30?4:m>>6==2?-1:-2}function c(m){var g=this.lastTotal-this.lastNeed,k=function(y,C,M){if((192&C[0])!=128)return y.lastNeed=0,"\uFFFD";if(y.lastNeed>1&&C.length>1){if((192&C[1])!=128)return y.lastNeed=1,"\uFFFD";if(y.lastNeed>2&&C.length>2&&(192&C[2])!=128)return y.lastNeed=2,"\uFFFD"}}(this,m);return k!==void 0?k:this.lastNeed<=m.length?(m.copy(this.lastChar,g,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(m.copy(this.lastChar,g,0,m.length),void(this.lastNeed-=m.length))}function s(m,g){if((m.length-g)%2==0){var k=m.toString("utf16le",g);if(k){var y=k.charCodeAt(k.length-1);if(y>=55296&&y<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1],k.slice(0,-1)}return k}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=m[m.length-1],m.toString("utf16le",g,m.length-1)}function l(m){var g=m&&m.length?this.write(m):"";if(this.lastNeed){var k=this.lastTotal-this.lastNeed;return g+this.lastChar.toString("utf16le",0,k)}return g}function d(m,g){var k=(m.length-g)%3;return k===0?m.toString("base64",g):(this.lastNeed=3-k,this.lastTotal=3,k===1?this.lastChar[0]=m[m.length-1]:(this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1]),m.toString("base64",g,m.length-k))}function a(m){var g=m&&m.length?this.write(m):"";return this.lastNeed?g+this.lastChar.toString("base64",0,3-this.lastNeed):g}function u(m){return m.toString(this.encoding)}function v(m){return m&&m.length?this.write(m):""}R.StringDecoder=w,w.prototype.write=function(m){if(m.length===0)return"";var g,k;if(this.lastNeed){if((g=this.fillLast(m))===void 0)return"";k=this.lastNeed,this.lastNeed=0}else k=0;return k<m.length?g?g+this.text(m,k):this.text(m,k):g||""},w.prototype.end=function(m){var g=m&&m.length?this.write(m):"";return this.lastNeed?g+"\uFFFD":g},w.prototype.text=function(m,g){var k=function(C,M,N){var Y=M.length-1;if(Y<N)return 0;var _=T(M[Y]);return _>=0?(_>0&&(C.lastNeed=_-1),_):--Y<N||_===-2?0:(_=T(M[Y]))>=0?(_>0&&(C.lastNeed=_-2),_):--Y<N||_===-2?0:(_=T(M[Y]))>=0?(_>0&&(_===2?_=0:C.lastNeed=_-3),_):0}(this,m,g);if(!this.lastNeed)return m.toString("utf8",g);this.lastTotal=k;var y=m.length-(k-this.lastNeed);return m.copy(this.lastChar,0,y),m.toString("utf8",g,y)},w.prototype.fillLast=function(m){if(this.lastNeed<=m.length)return m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,m.length),this.lastNeed-=m.length}},{"safe-buffer":73}],76:[function(D,Z,R){"use strict";var P=D("punycode"),x=D("./util");function w(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}R.parse=M,R.resolve=function(N,Y){return M(N,!1,!0).resolve(Y)},R.resolveObject=function(N,Y){return N?M(N,!1,!0).resolveObject(Y):Y},R.format=function(N){return x.isString(N)&&(N=M(N)),N instanceof w?N.format():w.prototype.format.call(N)},R.Url=w;var T=/^([a-z0-9.+-]+:)/i,c=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),d=["'"].concat(l),a=["%","/","?",";","#"].concat(d),u=["/","?","#"],v=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},k={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},C=D("querystring");function M(N,Y,_){if(N&&x.isObject(N)&&N instanceof w)return N;var G=new w;return G.parse(N,Y,_),G}w.prototype.parse=function(N,Y,_){if(!x.isString(N))throw new TypeError("Parameter 'url' must be a string, not "+typeof N);var G=N.indexOf("?"),et=G!==-1&&G<N.indexOf("#")?"?":"#",B=N.split(et);B[0]=B[0].replace(/\\/g,"/");var S=N=B.join(et);if(S=S.trim(),!_&&N.split("#").length===1){var A=s.exec(S);if(A)return this.path=S,this.href=S,this.pathname=A[1],A[2]?(this.search=A[2],this.query=Y?C.parse(this.search.substr(1)):this.search.substr(1)):Y&&(this.search="",this.query={}),this}var L=T.exec(S);if(L){var E=(L=L[0]).toLowerCase();this.protocol=E,S=S.substr(L.length)}if(_||L||S.match(/^\/\/[^@\/]+@[^@\/]+/)){var V=S.substr(0,2)==="//";!V||L&&k[L]||(S=S.substr(2),this.slashes=!0)}if(!k[L]&&(V||L&&!y[L])){for(var $,W,F=-1,j=0;j<u.length;j++)(q=S.indexOf(u[j]))!==-1&&(F===-1||q<F)&&(F=q);for((W=F===-1?S.lastIndexOf("@"):S.lastIndexOf("@",F))!==-1&&($=S.slice(0,W),S=S.slice(W+1),this.auth=decodeURIComponent($)),F=-1,j=0;j<a.length;j++){var q;(q=S.indexOf(a[j]))!==-1&&(F===-1||q<F)&&(F=q)}F===-1&&(F=S.length),this.host=S.slice(0,F),S=S.slice(F),this.parseHost(),this.hostname=this.hostname||"";var H=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!H)for(var J=this.hostname.split(/\./),K=(j=0,J.length);j<K;j++){var tt=J[j];if(tt&&!tt.match(v)){for(var at="",it=0,st=tt.length;it<st;it++)tt.charCodeAt(it)>127?at+="x":at+=tt[it];if(!at.match(v)){var h=J.slice(0,j),f=J.slice(j+1),I=tt.match(m);I&&(h.push(I[1]),f.unshift(I[2])),f.length&&(S="/"+f.join(".")+S),this.hostname=h.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),H||(this.hostname=P.toASCII(this.hostname));var O=this.port?":"+this.port:"",X=this.hostname||"";this.host=X+O,this.href+=this.host,H&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),S[0]!=="/"&&(S="/"+S))}if(!g[E])for(j=0,K=d.length;j<K;j++){var Q=d[j];if(S.indexOf(Q)!==-1){var ot=encodeURIComponent(Q);ot===Q&&(ot=escape(Q)),S=S.split(Q).join(ot)}}var ut=S.indexOf("#");ut!==-1&&(this.hash=S.substr(ut),S=S.slice(0,ut));var lt=S.indexOf("?");if(lt!==-1?(this.search=S.substr(lt),this.query=S.substr(lt+1),Y&&(this.query=C.parse(this.query)),S=S.slice(0,lt)):Y&&(this.search="",this.query={}),S&&(this.pathname=S),y[E]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){O=this.pathname||"";var gt=this.search||"";this.path=O+gt}return this.href=this.format(),this},w.prototype.format=function(){var N=this.auth||"";N&&(N=(N=encodeURIComponent(N)).replace(/%3A/i,":"),N+="@");var Y=this.protocol||"",_=this.pathname||"",G=this.hash||"",et=!1,B="";this.host?et=N+this.host:this.hostname&&(et=N+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(et+=":"+this.port)),this.query&&x.isObject(this.query)&&Object.keys(this.query).length&&(B=C.stringify(this.query));var S=this.search||B&&"?"+B||"";return Y&&Y.substr(-1)!==":"&&(Y+=":"),this.slashes||(!Y||y[Y])&&et!==!1?(et="//"+(et||""),_&&_.charAt(0)!=="/"&&(_="/"+_)):et||(et=""),G&&G.charAt(0)!=="#"&&(G="#"+G),S&&S.charAt(0)!=="?"&&(S="?"+S),Y+et+(_=_.replace(/[?#]/g,function(A){return encodeURIComponent(A)}))+(S=S.replace("#","%23"))+G},w.prototype.resolve=function(N){return this.resolveObject(M(N,!1,!0)).format()},w.prototype.resolveObject=function(N){if(x.isString(N)){var Y=new w;Y.parse(N,!1,!0),N=Y}for(var _=new w,G=Object.keys(this),et=0;et<G.length;et++){var B=G[et];_[B]=this[B]}if(_.hash=N.hash,N.href==="")return _.href=_.format(),_;if(N.slashes&&!N.protocol){for(var S=Object.keys(N),A=0;A<S.length;A++){var L=S[A];L!=="protocol"&&(_[L]=N[L])}return y[_.protocol]&&_.hostname&&!_.pathname&&(_.path=_.pathname="/"),_.href=_.format(),_}if(N.protocol&&N.protocol!==_.protocol){if(!y[N.protocol]){for(var E=Object.keys(N),V=0;V<E.length;V++){var $=E[V];_[$]=N[$]}return _.href=_.format(),_}if(_.protocol=N.protocol,N.host||k[N.protocol])_.pathname=N.pathname;else{for(var W=(N.pathname||"").split("/");W.length&&!(N.host=W.shift()););N.host||(N.host=""),N.hostname||(N.hostname=""),W[0]!==""&&W.unshift(""),W.length<2&&W.unshift(""),_.pathname=W.join("/")}if(_.search=N.search,_.query=N.query,_.host=N.host||"",_.auth=N.auth,_.hostname=N.hostname||N.host,_.port=N.port,_.pathname||_.search){var F=_.pathname||"",j=_.search||"";_.path=F+j}return _.slashes=_.slashes||N.slashes,_.href=_.format(),_}var q=_.pathname&&_.pathname.charAt(0)==="/",H=N.host||N.pathname&&N.pathname.charAt(0)==="/",J=H||q||_.host&&N.pathname,K=J,tt=_.pathname&&_.pathname.split("/")||[],at=(W=N.pathname&&N.pathname.split("/")||[],_.protocol&&!y[_.protocol]);if(at&&(_.hostname="",_.port=null,_.host&&(tt[0]===""?tt[0]=_.host:tt.unshift(_.host)),_.host="",N.protocol&&(N.hostname=null,N.port=null,N.host&&(W[0]===""?W[0]=N.host:W.unshift(N.host)),N.host=null),J=J&&(W[0]===""||tt[0]==="")),H)_.host=N.host||N.host===""?N.host:_.host,_.hostname=N.hostname||N.hostname===""?N.hostname:_.hostname,_.search=N.search,_.query=N.query,tt=W;else if(W.length)tt||(tt=[]),tt.pop(),tt=tt.concat(W),_.search=N.search,_.query=N.query;else if(!x.isNullOrUndefined(N.search))return at&&(_.hostname=_.host=tt.shift(),(I=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=I.shift(),_.host=_.hostname=I.shift())),_.search=N.search,_.query=N.query,x.isNull(_.pathname)&&x.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.href=_.format(),_;if(!tt.length)return _.pathname=null,_.search?_.path="/"+_.search:_.path=null,_.href=_.format(),_;for(var it=tt.slice(-1)[0],st=(_.host||N.host||tt.length>1)&&(it==="."||it==="..")||it==="",h=0,f=tt.length;f>=0;f--)(it=tt[f])==="."?tt.splice(f,1):it===".."?(tt.splice(f,1),h++):h&&(tt.splice(f,1),h--);if(!J&&!K)for(;h--;h)tt.unshift("..");!J||tt[0]===""||tt[0]&&tt[0].charAt(0)==="/"||tt.unshift(""),st&&tt.join("/").substr(-1)!=="/"&&tt.push("");var I,O=tt[0]===""||tt[0]&&tt[0].charAt(0)==="/";return at&&(_.hostname=_.host=O?"":tt.length?tt.shift():"",(I=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=I.shift(),_.host=_.hostname=I.shift())),(J=J||_.host&&tt.length)&&!O&&tt.unshift(""),tt.length?_.pathname=tt.join("/"):(_.pathname=null,_.path=null),x.isNull(_.pathname)&&x.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.auth=N.auth||_.auth,_.slashes=_.slashes||N.slashes,_.href=_.format(),_},w.prototype.parseHost=function(){var N=this.host,Y=c.exec(N);Y&&((Y=Y[0])!==":"&&(this.port=Y.substr(1)),N=N.substr(0,N.length-Y.length)),N&&(this.hostname=N)}},{"./util":77,punycode:51,querystring:54}],77:[function(D,Z,R){"use strict";Z.exports={isString:function(x){return typeof x=="string"},isObject:function(x){return typeof x=="object"&&x!==null},isNull:function(x){return x===null},isNullOrUndefined:function(x){return x==null}}},{}],78:[function(D,Z,R){(function(P){(function(){function x(w){try{if(!P.localStorage)return!1}catch(c){return!1}var T=P.localStorage[w];return T!=null&&String(T).toLowerCase()==="true"}Z.exports=function(w,T){if(x("noDeprecation"))return w;var c=!1;return function(){if(!c){if(x("throwDeprecation"))throw new Error(T);x("traceDeprecation")?console.trace(T):console.warn(T),c=!0}return w.apply(this,arguments)}}}).call(this)}).call(this,typeof ft.g!="undefined"?ft.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],79:[function(D,Z,R){Z.exports=function P(x,w){if(x&&w)return P(x)(w);if(typeof x!="function")throw new TypeError("need wrapper function");return Object.keys(x).forEach(function(c){T[c]=x[c]}),T;function T(){for(var c=new Array(arguments.length),s=0;s<c.length;s++)c[s]=arguments[s];var l=x.apply(this,c),d=c[c.length-1];return typeof l=="function"&&l!==d&&Object.keys(d).forEach(function(a){l[a]=d[a]}),l}}},{}],80:[function(D,Z,R){"use strict";Z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],81:[function(D,Z,R){Z.exports=function(){for(var x={},w=0;w<arguments.length;w++){var T=arguments[w];for(var c in T)P.call(T,c)&&(x[c]=T[c])}return x};var P=Object.prototype.hasOwnProperty},{}],82:[function(D,Z,R){"use strict";Z.exports=function(P){P.prototype[Symbol.iterator]=nt.mark(function x(){var w;return nt.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:w=this.head;case 1:if(!w){c.next=7;break}return c.next=4,w.value;case 4:w=w.next,c.next=1;break;case 7:case"end":return c.stop()}},x,this)})}},{}],83:[function(D,Z,R){"use strict";function P(s){var l=this;if(l instanceof P||(l=new P),l.tail=null,l.head=null,l.length=0,s&&typeof s.forEach=="function")s.forEach(function(u){l.push(u)});else if(arguments.length>0)for(var d=0,a=arguments.length;d<a;d++)l.push(arguments[d]);return l}function x(s,l,d){var a=l===s.head?new c(d,null,l,s):new c(d,l,l.next,s);return a.next===null&&(s.tail=a),a.prev===null&&(s.head=a),s.length++,a}function w(s,l){s.tail=new c(l,s.tail,null,s),s.head||(s.head=s.tail),s.length++}function T(s,l){s.head=new c(l,null,s.head,s),s.tail||(s.tail=s.head),s.length++}function c(s,l,d,a){if(!(this instanceof c))return new c(s,l,d,a);this.list=a,this.value=s,l?(l.next=this,this.prev=l):this.prev=null,d?(d.prev=this,this.next=d):this.next=null}Z.exports=P,P.Node=c,P.create=P,P.prototype.removeNode=function(s){if(s.list!==this)throw new Error("removing node which does not belong to this list");var l=s.next,d=s.prev;return l&&(l.prev=d),d&&(d.next=l),s===this.head&&(this.head=l),s===this.tail&&(this.tail=d),s.list.length--,s.next=null,s.prev=null,s.list=null,l},P.prototype.unshiftNode=function(s){if(s!==this.head){s.list&&s.list.removeNode(s);var l=this.head;s.list=this,s.next=l,l&&(l.prev=s),this.head=s,this.tail||(this.tail=s),this.length++}},P.prototype.pushNode=function(s){if(s!==this.tail){s.list&&s.list.removeNode(s);var l=this.tail;s.list=this,s.prev=l,l&&(l.next=s),this.tail=s,this.head||(this.head=s),this.length++}},P.prototype.push=function(){for(var s=0,l=arguments.length;s<l;s++)w(this,arguments[s]);return this.length},P.prototype.unshift=function(){for(var s=0,l=arguments.length;s<l;s++)T(this,arguments[s]);return this.length},P.prototype.pop=function(){if(this.tail){var s=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,s}},P.prototype.shift=function(){if(this.head){var s=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,s}},P.prototype.forEach=function(s,l){l=l||this;for(var d=this.head,a=0;d!==null;a++)s.call(l,d.value,a,this),d=d.next},P.prototype.forEachReverse=function(s,l){l=l||this;for(var d=this.tail,a=this.length-1;d!==null;a--)s.call(l,d.value,a,this),d=d.prev},P.prototype.get=function(s){for(var l=0,d=this.head;d!==null&&l<s;l++)d=d.next;if(l===s&&d!==null)return d.value},P.prototype.getReverse=function(s){for(var l=0,d=this.tail;d!==null&&l<s;l++)d=d.prev;if(l===s&&d!==null)return d.value},P.prototype.map=function(s,l){l=l||this;for(var d=new P,a=this.head;a!==null;)d.push(s.call(l,a.value,this)),a=a.next;return d},P.prototype.mapReverse=function(s,l){l=l||this;for(var d=new P,a=this.tail;a!==null;)d.push(s.call(l,a.value,this)),a=a.prev;return d},P.prototype.reduce=function(s,l){var d,a=this.head;if(arguments.length>1)d=l;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");a=this.head.next,d=this.head.value}for(var u=0;a!==null;u++)d=s(d,a.value,u),a=a.next;return d},P.prototype.reduceReverse=function(s,l){var d,a=this.tail;if(arguments.length>1)d=l;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");a=this.tail.prev,d=this.tail.value}for(var u=this.length-1;a!==null;u--)d=s(d,a.value,u),a=a.prev;return d},P.prototype.toArray=function(){for(var s=new Array(this.length),l=0,d=this.head;d!==null;l++)s[l]=d.value,d=d.next;return s},P.prototype.toArrayReverse=function(){for(var s=new Array(this.length),l=0,d=this.tail;d!==null;l++)s[l]=d.value,d=d.prev;return s},P.prototype.slice=function(s,l){(l=l||this.length)<0&&(l+=this.length),(s=s||0)<0&&(s+=this.length);var d=new P;if(l<s||l<0)return d;s<0&&(s=0),l>this.length&&(l=this.length);for(var a=0,u=this.head;u!==null&&a<s;a++)u=u.next;for(;u!==null&&a<l;a++,u=u.next)d.push(u.value);return d},P.prototype.sliceReverse=function(s,l){(l=l||this.length)<0&&(l+=this.length),(s=s||0)<0&&(s+=this.length);var d=new P;if(l<s||l<0)return d;s<0&&(s=0),l>this.length&&(l=this.length);for(var a=this.length,u=this.tail;u!==null&&a>l;a--)u=u.prev;for(;u!==null&&a>s;a--,u=u.prev)d.push(u.value);return d},P.prototype.splice=function(s,l){s>this.length&&(s=this.length-1),s<0&&(s=this.length+s);for(var d=0,a=this.head;a!==null&&d<s;d++)a=a.next;var u=[];for(d=0;a&&d<l;d++)u.push(a.value),a=this.removeNode(a);for(a===null&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev),d=0;d<(arguments.length<=2?0:arguments.length-2);d++)a=x(this,a,d+2<2||arguments.length<=d+2?void 0:arguments[d+2]);return u},P.prototype.reverse=function(){for(var s=this.head,l=this.tail,d=s;d!==null;d=d.prev){var a=d.prev;d.prev=d.next,d.next=a}return this.head=l,this.tail=s,this};try{D("./iterator.js")(P)}catch(s){}},{"./iterator.js":82}]},{},[12])(12)})}}]);
