(self.webpackChunkrh_template_umi=self.webpackChunkrh_template_umi||[]).push([[889],{263:function(Pt){function mt(ct){if(ct===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ct}Pt.exports=mt},46507:function(Pt){function mt(ct,tt){if(!(ct instanceof tt))throw new TypeError("Cannot call a class as a function")}Pt.exports=mt},21364:function(Pt){function mt(tt,vt){for(var dt=0;dt<vt.length;dt++){var St=vt[dt];St.enumerable=St.enumerable||!1,St.configurable=!0,"value"in St&&(St.writable=!0),Object.defineProperty(tt,St.key,St)}}function ct(tt,vt,dt){return vt&&mt(tt.prototype,vt),dt&&mt(tt,dt),tt}Pt.exports=ct},25102:function(Pt,mt,ct){var tt=ct(74752),vt=ct(63213),dt=ct(26416);function St(gt){var ut=vt();return function(){var wt=tt(gt),D;if(ut){var V=tt(this).constructor;D=Reflect.construct(wt,arguments,V)}else D=wt.apply(this,arguments);return dt(this,D)}}Pt.exports=St},74752:function(Pt){function mt(ct){return Pt.exports=mt=Object.setPrototypeOf?Object.getPrototypeOf:function(vt){return vt.__proto__||Object.getPrototypeOf(vt)},mt(ct)}Pt.exports=mt},79764:function(Pt,mt,ct){var tt=ct(31748);function vt(dt,St){if(typeof St!="function"&&St!==null)throw new TypeError("Super expression must either be null or a function");dt.prototype=Object.create(St&&St.prototype,{constructor:{value:dt,writable:!0,configurable:!0}}),St&&tt(dt,St)}Pt.exports=vt},63213:function(Pt){function mt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(ct){return!1}}Pt.exports=mt},26416:function(Pt,mt,ct){var tt=ct(74770),vt=ct(263);function dt(St,gt){return gt&&(tt(gt)==="object"||typeof gt=="function")?gt:vt(St)}Pt.exports=dt},31748:function(Pt){function mt(ct,tt){return Pt.exports=mt=Object.setPrototypeOf||function(dt,St){return dt.__proto__=St,dt},mt(ct,tt)}Pt.exports=mt},74770:function(Pt){function mt(ct){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Pt.exports=mt=function(vt){return typeof vt}:Pt.exports=mt=function(vt){return vt&&typeof Symbol=="function"&&vt.constructor===Symbol&&vt!==Symbol.prototype?"symbol":typeof vt},mt(ct)}Pt.exports=mt},25835:function(){},66273:function(){},9058:function(Pt,mt,ct){"use strict";ct.d(mt,{$E:function(){return tt},zR:function(){return dt},bs:function(){return St}});function tt(w,C){w.beginPath(),w.ellipse(C.rect.x+C.rect.width/2,C.rect.y+C.rect.height/2,C.rect.width/2,C.rect.height/2,0,0,Math.PI*2),w.stroke(),w.beginPath(),w.fillStyle=w.strokeStyle,w.ellipse(C.rect.x+C.rect.width/2,C.rect.y+C.rect.height/2,C.rect.width/4,C.rect.height/4,0,0,Math.PI*2),w.fill()}var vt=ct(16220);function dt(w){w.iconRect=new vt.UL(0,0,0,0)}function St(w){var C=w.rect.width*5/7,c=w.rect.height*5/7;w.textRect=new vt.UL(w.rect.x+(w.rect.width-C)/2,w.rect.y+(w.rect.height-c)/2,C,c),w.fullTextRect=w.textRect}function gt(w){w.iconRect=new Rect(0,0,0,0)}function ut(w){w.textRect=new Rect(w.rect.x,w.rect.y,w.rect.width,w.rect.height),w.fullTextRect=w.textRect}function Ct(w){w.anchors.push(new Point(w.rect.x,w.rect.y+w.rect.height/2,Direction.Left)),w.anchors.push(new Point(w.rect.ex,w.rect.y+w.rect.height/2,Direction.Right));for(var C=5,c=C;w.rect.x+c<w.rect.ex;c=c+C){var s=new Point(w.rect.x+c,w.rect.y,Direction.Up),l=new Point(w.rect.x+c,w.rect.ey,Direction.Bottom);s.hidden=!0,l.hidden=!0,w.anchors.push(s),w.anchors.push(l)}}function wt(w){w.anchors.push(new Point(w.rect.x+w.rect.width/2,w.rect.y,Direction.Up)),w.anchors.push(new Point(w.rect.x+w.rect.width/2,w.rect.ey,Direction.Bottom));for(var C=5,c=C;w.rect.y+c<w.rect.ey;c=c+C){var s=new Point(w.rect.x,w.rect.y+c,Direction.Left),l=new Point(w.rect.ex,w.rect.y+c,Direction.Right);s.hidden=!0,l.hidden=!0,w.anchors.push(s),w.anchors.push(l)}}function D(w){w.iconRect=new Rect(0,0,0,0)}function V(w){w.textRect=new Rect(w.rect.x+10,w.rect.y,20,w.rect.height),w.fullTextRect=w.textRect}function P(w){w.iconRect=new Rect(0,0,0,0)}function L(w){w.textRect=new Rect(w.rect.x,w.rect.y,w.rect.width,40),w.fullTextRect=w.textRect}function b(){registerNode("activityFinal",activityFinal,null,activityFinalIconRect,activityFinalTextRect),registerNode("swimlaneV",swimlaneV,null,swimlaneVIconRect,swimlaneVTextRect),registerNode("swimlaneH",swimlaneH,null,swimlaneHIconRect,swimlaneHTextRect),registerNode("forkH",fork,forkHAnchors,forkIconRect,forkTextRect),registerNode("forkV",fork,forkVAnchors,forkIconRect,forkTextRect)}},79885:function(Pt,mt,ct){"use strict";ct.d(mt,{z2:function(){return St}});var tt=ct(16220),vt={};function dt(gt,ut){(0,tt.C9)(gt,ut);var Ct=vt.echarts||window.echarts;!ut.data||!Ct||(typeof ut.data=="string"&&(ut.data=JSON.parse(ut.data)),!!ut.data.echarts&&(ut.elementId||(ut.elementId=(0,tt.s8)()),ut.elementLoaded||(vt[ut.id]={div:(0,tt.wC)(ut)},ut.elementLoaded=!0,document.body.appendChild(vt[ut.id].div),ut.addToDiv(),vt[ut.id].chart=Ct.init(vt[ut.id].div,ut.data.echarts.theme),ut.elementRendered=!1,setTimeout(function(){vt[ut.id].chart.resize()})),ut.elementRendered||setTimeout(function(){vt[ut.id].chart.setOption(ut.data.echarts.option),vt[ut.id].chart.resize(),ut.elementRendered=!0})))}function St(gt){vt.echarts=gt,!vt.echarts&&!window.echarts&&(0,tt.fs)("https://cdn.bootcdn.net/ajax/libs/echarts/4.8.0/echarts.min.js",null,!0),(0,tt.iZ)("echarts",dt,null,null,null)}},16220:function(Pt,mt,ct){"use strict";ct.d(mt,{x1:function(){return Mt},NB:function(){return At},aH:function(){return g},E9:function(){return P},UL:function(){return a},d3:function(){return gi},wC:function(){return qr},Dz:function(){return Jt},fs:function(){return Vr},C9:function(){return M},iZ:function(){return Ee},s8:function(){return wt}});var tt=ct(32362);function vt(r){return{all:r=r||new Map,on:function(e,i){var n=r.get(e);n&&n.push(i)||r.set(e,[i])},off:function(e,i){var n=r.get(e);n&&n.splice(n.indexOf(i)>>>0,1)},emit:function(e,i){(r.get(e)||[]).slice().map(function(n){n(i)}),(r.get("*")||[]).slice().map(function(n){n(e,i)})}}}var dt;(function(r){r[r.Any=-1]="Any",r[r.CtrlOrAlt=0]="CtrlOrAlt",r[r.Ctrl=1]="Ctrl",r[r.Shift=2]="Shift",r[r.Alt=3]="Alt",r[r.Right=4]="Right"})(dt||(dt={}));var St;(function(r){r[r.None=-1]="None",r[r.Document=0]="Document",r[r.Canvas=1]="Canvas"})(St||(St={}));var gt=["fontColor","fontFamily","fontSize","lineHeight","textAlign","textBaseline"],ut={cacheLen:30,refresh:30,fontColor:"#222222",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"center",textBaseline:"middle",color:"#222222",activeColor:"#1890ff",hoverColor:"#fa541c",anchorRadius:4,anchorFillStyle:"#fff",dockStrokeStyle:"#fa541c",dockFillStyle:"#fa541c",dragColor:"#1890ff",rotateCursor:"/assets/img/rotate.cur",hoverCursor:"pointer",minScale:.3,maxScale:5,anchorSize:5,keydown:St.Document,viewPadding:0,gridSize:10,gridColor:"#f3f3f3",ruleColor:"#888888"};function Ct(){return((1+Math.random())*65536|0).toString(16).substring(1)}function wt(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function D(){return Ct()+wt()}function V(){return wt()+wt()}var P=function(){function r(t,e,i,n,o,p,x){this.x=t,this.y=e,this.direction=i,this.anchorIndex=n,this.id=o,this.hidden=p,this.autoAnchor=x}return r.prototype.floor=function(){this.x|=0,this.y|=0},r.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},r.prototype.clone=function(){var t=new r(this.x,this.y,this.direction,this.anchorIndex,this.id,this.hidden,this.autoAnchor);return this.data&&(t.data=this.data),this.mode&&(t.mode=this.mode),t},r.prototype.hit=function(t,e){return e===void 0&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},r.prototype.rotate=function(t,e){if(!t||t===360)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,n=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=n,this},r.prototype.isSameAs=function(t){return this.anchorIndex===t.anchorIndex&&this.direction===t.direction&&this.id===t.id},r}();window.topologyPoint=P,window.Le5leTopologyPoint=P;function L(r){for(var t={nodes:[],lines:[]},e=0,i=r;e<i.length;e++){var n=i[e];if(n.type){t.lines.push(n);continue}t.nodes.push(n),n.children&&(t.nodes.push.apply(t.nodes,L(n.children).nodes),t.lines.push.apply(t.lines,L(n.children).lines))}return t}function b(r,t){var e=[];return t.forEach(function(i){(i.id===r||i.tags.indexOf(r)>-1)&&e.push(i),i.children&&e.push.apply(e,b(r,i.children))}),e}function w(r,t){for(var e=[],i=0;i<t.length;i++)t[i].id===r||t[i].tags.indexOf(r)>-1?(e.push(t[i]),t.splice(i,1),--i):t[i].children&&e.push.apply(e,w(r,t[i].children));return e}function C(r,t){for(var e,i=0,n=r;i<n.length;i++){var o=n[i];if(!o.type&&!!o.children)for(var p=0,x=o.children;p<x.length;p++){var U=x[p];if(U.id===t.id)return o;if(!U.type&&U.children&&(e=C(U.children,t),e))return e}}return e}function c(r,t){if(t.length<3)return!1;for(var e=!1,i=t[t.length-1],n=0,o=t;n<o.length;n++){var p=o[n];i.y>r.y!=p.y>r.y&&p.x+(r.y-p.y)*(i.x-p.x)/(i.y-p.y)>r.x&&(e=!e),i=p}return e}function s(r,t,e,i){i===void 0&&(i=1);var n=Math.atan2(t.y-e.y,e.x-t.x);i=i>5?i:5;var o=Math.sin(n)*i,p=Math.cos(n)*i,x=[new P(t.x-o,t.y-p),new P(e.x-o,e.y-p),new P(e.x+o,e.y+p),new P(t.x+o,t.y+p)];return c(r,x)}function l(r,t){var e=Math.sqrt(Math.pow(Math.abs(r.x-t.x),2)+Math.pow(Math.abs(r.y-t.y),2));return e|0}function d(r,t,e,i){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M"+r.x+" "+r.y+" C"+t.x+" "+t.y+" "+e.x+" "+e.y+" "+i.x+" "+i.y),n.getTotalLength()|0}var a=function(){function r(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.center=new P(0,0),i<0&&(i=0),n<0&&(n=0),this.init()}return r.prototype.init=function(){this.ex=this.x+this.width,this.ey=this.y+this.height,this.calcCenter()},r.prototype.floor=function(){this.x|=0,this.y|=0,this.width|=0,this.height|=0,this.init()},r.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height),this.init()},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.hit=function(t,e){return e===void 0&&(e=0),t&&t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},r.prototype.hitByRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},r.prototype.hitRotate=function(t,e,i){for(var n=this.toPoints(),o=0,p=n;o<p.length;o++){var x=p[o];x.rotate(e,i)}return c(t,n)},r.prototype.calcCenter=function(){this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2},r.prototype.toPoints=function(){return[new P(this.x,this.y),new P(this.ex,this.y),new P(this.ex,this.ey),new P(this.x,this.ey)]},r.prototype.translate=function(t,e){this.x+=t,this.y+=e,this.ex+=t,this.ey+=e,this.calcCenter()},r.prototype.scale=function(t,e,i){e||(e=this.center),i===void 0&&(i=t),this.x=e.x-(e.x-this.x)*t,this.y=e.y-(e.y-this.y)*i,this.width*=t,this.height*=i,this.init()},r}();window.topologyRect=a;var u;(function(r){r[r.Click=0]="Click",r[r.DblClick=1]="DblClick",r[r.WebSocket=2]="WebSocket",r[r.Mqtt=3]="Mqtt",r[r.MoveIn=4]="MoveIn",r[r.MoveOut=5]="MoveOut",r[r.MouseUp=6]="MouseUp"})(u||(u={}));var v;(function(r){r[r.Link=0]="Link",r[r.StartAnimate=1]="StartAnimate",r[r.Function=2]="Function",r[r.WindowFn=3]="WindowFn",r[r.SetProps=4]="SetProps",r[r.PauseAnimate=5]="PauseAnimate",r[r.StopAnimate=6]="StopAnimate",r[r.Emit=7]="Emit"})(v||(v={}));function m(r){if(Array.isArray(r)){var t=[];return r.forEach(function(n){t.push(m(n))}),t}else if(typeof r=="object"){if(r===null)return null;if(r.constructor===RegExp)return r;var e={};for(var i in r)e[i]=m(r[i]);return e}return r}var g;(function(r){r[r.Node=0]="Node",r[r.Line=1]="Line"})(g||(g={}));var k=["link","doStartAnimate","doFn","doWindowFn","","doPauseAnimate","doStopAnimate","doEmit"],y={name:"",tags:[],visible:!0,rect:new a(0,0,0,0),fontColor:"",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,fontStyle:"normal",fontWeight:"normal",textAlign:"center",textBaseline:"middle",textBackground:"",animateCycleIndex:0,events:[],dash:0,lineDashOffset:0,lineWidth:1,strokeStyle:"",fillStyle:"",globalAlpha:1,rotate:0,offsetRotate:0,textMaxLine:0,textOffsetX:0,textOffsetY:0,animatePos:0},T={},O=function(){function r(){}return r.prototype.fromData=function(t,e){e?typeof e=="string"&&(e=JSON.parse(e)):e={},y.id=wt(),t=Object.assign({},y,t);for(var i in t)this[i]=t[i];for(var i in e)this[i]=e[i];Array.isArray(this.tags)&&(this.tags=Object.assign([],this.tags)),this.rect&&(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height)),this.lineWidth=this.lineWidth||1,!this.fontColor&&e.font&&(this.fontColor=e.font.color||this.fontColor,this.fontFamily=e.font.fontFamily||this.fontFamily,this.fontSize=e.font.fontSize||this.fontSize,this.lineHeight=e.font.lineHeight||this.lineHeight,this.fontStyle=e.font.fontStyle||this.fontStyle,this.fontWeight=e.font.fontWeight||this.fontWeight,this.textAlign=e.font.textAlign||this.textAlign,this.textBaseline=e.font.textBaseline||this.textBaseline,this.textBackground=e.font.background||this.textBackground,delete this.font),this.events&&(this.events=m(this.events)),this.wheres&&(this.wheres=m(this.wheres)),typeof this.data=="object"&&(this.data=JSON.parse(JSON.stringify(this.data))),delete this.img,delete this.animateStart,delete this.animateReady},r.prototype.render=function(t){if(!!this.visible){if(this.from&&!this.to){if(this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.render(t)}return}if(t.save(),t.setAttrs&&t.setAttrs(this),(this.rotate||this.offsetRotate)&&(t.translate(this.rect.center.x,this.rect.center.y),t.rotate((this.rotate+this.offsetRotate)*Math.PI/180),t.translate(-this.rect.center.x,-this.rect.center.y)),this.lineWidth>1&&(t.lineWidth=this.lineWidth),this.strokeImage?this.strokeImage===this.lastStrokeImage&&this.strokeImg?t.strokeStyle=t.createPattern(this.strokeImg,"repeat"):this.loadStrokeImg():t.strokeStyle=this.strokeStyle||tt.Store.get(this.generateStoreKey("LT:color")),this.fillImage?this.fillImage===this.lastFillImage&&this.fillImg?t.fillStyle=t.createPattern(this.fillImg,"repeat"):this.loadFillImg():this.fillStyle&&(t.fillStyle=this.fillStyle),this.lineCap?t.lineCap=this.lineCap:this.type===g.Line&&(t.lineCap="round"),this.globalAlpha<1&&(t.globalAlpha=this.globalAlpha),this.lineDash)t.setLineDash(this.lineDash);else switch(this.dash){case 1:t.setLineDash([5,5]);break;case 2:t.setLineDash([10,10]);break;case 3:t.setLineDash([10,10,2,10]);break;case 4:t.setLineDash([1,16]);break}if(this.lineDashOffset&&(t.lineDashOffset=this.lineDashOffset),this.shadowColor&&(t.shadowColor=this.shadowColor,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur),this.draw(t),t.restore(),this.children)for(var o=0,p=this.children;o<p.length;o++){var n=p[o];n.render(t)}}},r.prototype.loadFillImg=function(){var t=this;if(!!this.fillImage){var e=new Image;e.crossOrigin="anonymous",e.src=this.fillImage,e.onload=function(){t.lastFillImage=t.fillImage,t.fillImg=e,T[t.fillImage]={img:e},tt.Store.set(t.generateStoreKey("LT:imageLoaded"),!0)}}},r.prototype.loadStrokeImg=function(){var t=this;if(!!this.strokeImage){var e=new Image;e.crossOrigin="anonymous",e.src=this.strokeImage,e.onload=function(){t.lastStrokeImage=t.strokeImage,t.strokeImg=e,T[t.strokeImage]={img:e},tt.Store.set(t.generateStoreKey("LT:imageLoaded"),!0)}}},r.prototype.click=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.Click&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.mouseUp=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MouseUp&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.dblclick=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.DblClick&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.moveIn=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MoveIn&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.moveOut=function(){if(!!this.events)for(var t=0,e=this.events;t<e.length;t++){var i=e[t];i.type===u.MoveOut&&this[k[i.action]]&&this[k[i.action]](i.value,i.params)}},r.prototype.doWheres=function(){var t=this;!this.wheres||this.wheres.forEach(function(e){if(e.fn instanceof Function)e.fn(t)&&e.actions&&e.actions.forEach(function(n){t.doAction(n)});else if(e.fn&&e.fn.trim()){var i=new Function("pen",e.fn);i(t)&&e.actions&&e.actions.forEach(function(n){t.doAction(n)})}else{var i=new Function("attr","return attr "+e.comparison+" "+e.value);i(t[e.key])&&e.actions&&e.actions.forEach(function(o){t.doAction(o)})}})},r.prototype.doAction=function(t){switch(t.do||t.action){case 0:case"Link":this.link(t.url||t.value,t._blank||t.params);break;case 1:case"StartAnimate":this.doStartAnimate(t.tag||t.value);break;case 5:case"PauseAnimate":this.doPauseAnimate(t.tag||t.value);break;case 6:case"StopAnimate":this.doStopAnimate(t.tag||t.value);break;case 2:case"Function":this.doFn(t.fn||t.value,t.params);break;case 3:case"WindowFn":this.doWindowFn(t.fn||t.value,t.params);break;case 7:case"Emit":this.doEmit(t.fn||t.value,t.params);break}},r.prototype.show=function(){return this.visible=!0,this},r.prototype.hide=function(){return this.visible=!1,this},r.prototype.isVisible=function(){return this.visible},r.prototype.getTID=function(){return this.TID},r.prototype.setTID=function(t){if(this.TID=t,this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.setTID(t)}return this},r.prototype.startAnimate=function(){this.animateStart=Date.now(),this.type===g.Node&&!this.animateReady&&this.initAnimate(),tt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this}),this.playType===2&&this.play()},r.prototype.play=function(t){tt.Store.set(this.generateStoreKey("LT:play"),{pen:this,pause:t})},r.prototype.link=function(t,e){window.open(t,e===void 0?"_blank":e)},r.prototype.doStartAnimate=function(t,e){t?tt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t}):this.startAnimate()},r.prototype.doPauseAnimate=function(t,e){t?tt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t,stop:!0}):this.pauseAnimate()},r.prototype.doStopAnimate=function(t,e){t?tt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{tag:t,stop:!0}):this.stopAnimate()},r.prototype.doFn=function(t,e){if(t instanceof Function)return t(this,e);var i=new Function("pen","params",t);i(this,e)},r.prototype.doWindowFn=function(t,e){window[t](this,e)},r.prototype.doEmit=function(t,e){tt.Store.set(this.generateStoreKey("LT:emit"),{event:t,params:e,pen:this})},r.prototype.generateStoreKey=function(t){return this.TID+"-"+t},r}();function M(r,t){var e=t.borderRadius,i=t.borderRadius;t.borderRadius<1&&(e=t.rect.width*t.borderRadius,i=t.rect.height*t.borderRadius);var n=e<i?e:i;t.rect.width<2*n&&(n=t.rect.width/2),t.rect.height<2*n&&(n=t.rect.height/2),r.beginPath(),r.moveTo(t.rect.x+n,t.rect.y),r.arcTo(t.rect.x+t.rect.width,t.rect.y,t.rect.x+t.rect.width,t.rect.y+t.rect.height,n),r.arcTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height,t.rect.x,t.rect.y+t.rect.height,n),r.arcTo(t.rect.x,t.rect.y+t.rect.height,t.rect.x,t.rect.y,n),r.arcTo(t.rect.x,t.rect.y,t.rect.x+t.rect.width,t.rect.y,n),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function Y(r,t){r.beginPath(),r.ellipse(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height/2,t.rect.width/2,t.rect.height/2,0,0,Math.PI*2),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function N(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function G(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height/2),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function et(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function F(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x,t.rect.y+t.rect.height*2/3),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function S(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height/3),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height),r.lineTo(t.rect.x+(t.rect.width-t.rect.height/2),t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height*2/3),r.lineTo(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function _(r){var t=[],e="";r||(r="");for(var i=0;i<r.length;++i){var n=r.charCodeAt(i);if(n<33||n>126){e&&(t.push(e),e=""),t.push(r[i]);continue}else e+=r[i]}return e&&t.push(e),t}function E(r,t,e,i){for(var n=[],o=t[0]||"",p=1;p<t.length;++p){var x=t[p]||"",U=o+x,W=U.match(/[\u4e00-\u9fa5]/g)||"",it=W.length;(U.length-it)*i*.5+it*i<e?o+=x:(n.push(o),o=x)}return n.push(o),n}function R(r,t){t.text&&!t.text.split&&(t.text+="");var e=[];switch(t.whiteSpace){case"nowrap":e.push(t.text);break;case"pre-line":e=t.text.split(/[\n]/g);break;default:for(var i=t.getTextRect(),n=t.text.split(/[\n]/g),o=0;o<n.length;++o){var p=E(r,_(n[o]),i.width,t.fontSize);e.push.apply(e,p)}break}return(t.displayFormat||t.displayFormat===0)&&e.forEach(function(x,U){var W=Number(x);isNaN(W)||(e[U]=W.toFixed(t.displayFormat))}),e}function q(r,t){for(var e=R(r,t),i=0,n=0,o=e;n<o.length;n++){var p=o[n];r.font=(t.fontStyle||"normal")+" normal "+(t.fontWeight||"normal")+" "+t.fontSize+"px/"+t.lineHeight+" "+t.fontFamily;var x=r.measureText(p),U=x.width;U>i&&(i=U)}return{width:i,height:e.length*t.fontSize*t.lineHeight}}function Z(r,t,e,i,n,o){if(!(!t||!o)){var p=r.measureText(t).width;r.save(),r.fillStyle=o;var x=e-p/2,U=i-n/2;switch(r.textAlign){case"left":x=e;break;case"right":x=e-p;break}switch(r.textBaseline){case"top":U=i;break;case"bottom":U=i-n;break}r.fillRect(x,U,p,n),r.restore()}}function K(r,t,e,i,n,o,p,x,U){!x||x>t.length?x=t.length:x=Math.ceil(x);for(var W=0;W<x-1;++W)U&&Z(r,t[W],e,i+W*p,p,U),r.fillText(t[W],e,i+W*p);if(x<t.length){var it=(t[x-1]||"")+"...";t[x-1]&&r.measureText(it).width>n&&(it=t[x-1].substr(0,t[x-1].length-2)+"..."),U&&Z(r,it,e,i+(x-1)*p,p,U),r.fillText(it,e,i+(x-1)*p)}else U&&Z(r,t[x-1],e,i+(x-1)*p,p,U),r.fillText(t[x-1],e,i+(x-1)*p)}function z(r,t){if(!!t.text){t.text.split||(t.text+=""),r.save(),r.beginPath(),delete r.shadowColor,delete r.shadowBlur,r.font=(t.fontStyle||"normal")+" normal "+(t.fontWeight||"normal")+" "+t.fontSize+"px/"+t.lineHeight+" "+t.fontFamily,t.fontColor?r.fillStyle=t.fontColor:r.fillStyle=tt.Store.get(t.generateStoreKey("LT:fontColor")),t.textAlign&&(r.textAlign=t.textAlign),t.textBaseline&&(r.textBaseline=t.textBaseline);var e=t.getTextRect();if(!e){r.restore();return}var i=R(r,t),n=t.fontSize*t.lineHeight,o=t.textMaxLine>0&&t.textMaxLine<i.length?t.textMaxLine:i.length,p=e.x+e.width/2,x=e.y+(e.height-n*o)/2+n*4/7;switch(r.textAlign){case"left":p=e.x;break;case"right":p=e.x+e.width;break}switch(r.textBaseline){case"top":x=e.y+(n-t.fontSize)/2;break;case"bottom":x=e.ey-n*o+n;break}K(r,i,p+t.textOffsetX,x+t.textOffsetY,e.width,e.height,n,o,t.textBackground),r.restore()}}function j(r,t){r.save(),r.textAlign="center",r.textBaseline="middle";var e=t.getIconRect(),i=e.x+e.width/2,n=e.y+e.height/2;switch(t.imageAlign){case"top":n=e.y,r.textBaseline="top";break;case"bottom":n=e.ey,r.textBaseline="bottom";break;case"left":i=e.x,r.textAlign="left";break;case"right":i=e.ex,r.textAlign="right";break;case"left-top":i=e.x,n=e.y,r.textAlign="left",r.textBaseline="top";break;case"right-top":i=e.ex,n=e.y,r.textAlign="right",r.textBaseline="top";break;case"left-bottom":i=e.x,n=e.ey,r.textAlign="left",r.textBaseline="bottom";break;case"right-bottom":i=e.ex,n=e.ey,r.textAlign="right",r.textBaseline="bottom";break}t.iconSize>0?r.font=t.iconSize+"px "+t.iconFamily:e.width>e.height?r.font=e.height+"px "+t.iconFamily:r.font=e.width+"px "+t.iconFamily,r.fillStyle=t.iconColor||tt.Store.get(t.generateStoreKey("LT:iconColor"))||t.fontColor,t.iconRotate&&(r.translate(e.center.x,e.center.y),r.rotate(t.iconRotate*Math.PI/180),r.translate(-e.center.x,-e.center.y)),r.beginPath(),r.fillText(t.icon,i,n),r.restore()}function H(r,t){r.beginPath();var e=t.rect.y+t.rect.height/2;r.moveTo(t.rect.x,e),r.lineTo(t.rect.x+t.rect.width,e),r.stroke()}var A;(function(r){r[r.None=0]="None",r[r.Up=1]="Up",r[r.Right=2]="Right",r[r.Bottom=3]="Bottom",r[r.Left=4]="Left"})(A||(A={}));function J(r){r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y,A.Up)),r.anchors.push(new P(r.rect.x+r.rect.width*3/4,r.rect.y+r.rect.height/2,A.Right)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,A.Bottom)),r.anchors.push(new P(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height/2,A.Left))}function rt(r){r.anchors.push(new P(r.rect.x,r.rect.y+r.rect.height/2,A.Left)),r.anchors.push(new P(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,A.Right))}function $(r){var t=r.rect.y+r.rect.height/2;r.anchors.push(new P(r.rect.x,t,A.Left)),r.anchors.push(new P(r.rect.x+r.rect.width,t,A.Right));for(var e=topology.data.scale||1,i=r.rect.x+5*e;i<r.rect.ex;i+=5*e){var n=new P(i,t,A.Bottom);n.hidden=!0,r.anchors.push(n)}}function at(r){var t=r.rect.width/2,e=r.rect.height/2;t>e?t=e:e=t;var i=r.rect.height/10;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function nt(r){var t=r.rect.height/20;t<5&&(t=0),r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height*2/3-t,r.rect.width/2,r.rect.height/3-5);var e=r.rect.width*5/7,i=r.rect.height*5/7;r.fullTextRect=new a(r.rect.x+(r.rect.width-e)/2,r.rect.y+(r.rect.height-i)/2,e,i)}function st(r){var t=r.rect.width*2/7,e=r.rect.height*2/7;t>e?t=e:e=t;var i=t;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function h(r){r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height*2/3,r.rect.width/2,r.rect.height/3-5);var t=r.rect.width/2,e=r.rect.height*3/7;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height/2-5,t,e)}function f(r){var t=r.rect.width/3,e=r.rect.height/3;t>e?t=e:e=t;var i=r.rect.width/5;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function I(r){var t=r.rect.height/10;t<5&&(t=0),r.textRect=new a(r.rect.x+r.rect.width/3,r.rect.y+r.rect.height*2/3-t,r.rect.width/3,r.rect.height/3-5);var e=r.rect.width/2,i=r.rect.height*1/2;r.fullTextRect=new a(r.rect.x+(r.rect.width-e)/2,r.rect.y+r.rect.height/4,e,i)}function B(r){r.iconRect=new a(0,0,0,0)}function X(r){r.textRect=new a(r.rect.x+r.rect.height/2,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height/2,r.rect.height/3),r.fullTextRect=r.textRect}function Q(r){r.iconRect=new a(0,0,0,0)}function ot(r){r.textRect=new a(r.rect.x,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height/2,r.rect.height/3),r.fullTextRect=r.textRect}function pt(r){r.iconRect=new a(0,0,0,0)}function ft(r){r.textRect=new a(r.rect.x+r.rect.height/2,r.rect.y+r.rect.height/3,r.rect.width-r.rect.height,r.rect.height/3),r.fullTextRect=r.textRect}function xt(r){r.iconRect=new a(0,0,0,0)}function Tt(r){r.fullTextRect=new a(r.rect.x+10,r.rect.y+r.rect.height/2-20,r.rect.width-20,20),r.textRect=r.fullTextRect}function Kt(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y),r.lineTo(t.to.x,t.to.y),r.stroke()}function Dt(r,t){}function Ht(r){r.controlPoints=[]}var bt=50;function _t(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y);for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.lineTo(n.x,n.y)}r.lineTo(t.to.x,t.to.y),r.stroke()}function Qt(r,t){r.save(),r.fillStyle="#fff",r.lineWidth=2;for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.beginPath(),r.arc(n.x,n.y,4,0,Math.PI*2),r.stroke(),r.fill()}r.restore()}function oe(r){r.controlPoints=[];var t=me(r.from,r.to);r.from.direction&&r.controlPoints.push(t);var e=me(r.to,r.from),i;switch(t.direction){case A.Up:i=De(t,e);break;case A.Right:i=Ue(t,e);break;case A.Bottom:i=Fe(t,e);break;case A.Left:i=ze(t,e);break}r.controlPoints.push.apply(r.controlPoints,i),r.to.direction&&r.controlPoints.push(e)}function Gt(r,t){if(!t.controlPoints||!t.controlPoints.length)return s(r,t.from,t.to,t.lineWidth/2);if(s(r,t.from,t.controlPoints[0])||s(r,t.to,t.controlPoints[t.controlPoints.length-1]))return!0;for(var e=0;e<t.controlPoints.length-1;++e)if(s(r,t.controlPoints[e],t.controlPoints[e+1]))return!0;return!1}function fe(r,t){var e=[t.from];e.push.apply(e,t.controlPoints),e.push(t.to);for(var i=0,n=e;i<n.length;i++){var o=n[i];Math.abs(r.x-o.x)<7&&(r.x=o.x),Math.abs(r.y-o.y)<7&&(r.y=o.y)}}function me(r,t){var e=r.clone();switch(r.direction){case A.Up:t.y<r.y?e.y-=Math.round((r.y-t.y)/2):e.y-=bt;break;case A.Right:t.x>r.x?e.x+=Math.round((t.x-r.x)/2):e.x+=bt;break;case A.Bottom:t.y>r.y?e.y+=Math.round((t.y-r.y)/2):e.y+=bt;break;case A.Left:t.x<r.x?e.x-=Math.round((r.x-t.x)/2):e.x-=bt;break}return e}function De(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.y>t.y)return t.direction===A.Up&&r.y-t.y>3*bt?r.x<t.x?t.x-r.x<bt?[new P(r.x-2*bt,r.y),new P(r.x-2*bt,t.y)]:[new P(r.x,t.y)]:r.x-t.x<bt?[new P(r.x+2*bt,r.y),new P(r.x+2*bt,t.y)]:[new P(r.x,t.y)]:t.direction===A.Left&&r.x>t.x||t.direction===A.Right&&r.x<t.x?[new P(t.x,r.y)]:[new P(r.x,t.y)];if(t.direction===A.Bottom){if(r.x<t.x)return se(r,t);var e=se(t,r);return[e[1],e[0]]}else return[new P(t.x,r.y)]}function Fe(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.y<t.y)return t.direction===A.Bottom&&t.y-r.y>3*bt?r.x<t.x?t.x-r.x<bt?[new P(r.x-2*bt,r.y),new P(r.x-2*bt,t.y)]:[new P(r.x,t.y)]:r.x-t.x<bt?[new P(r.x+2*bt,r.y),new P(r.x+2*bt,t.y)]:[new P(r.x,t.y)]:t.direction===A.Left&&r.x>t.x||t.direction===A.Right&&r.x<t.x?[new P(t.x,r.y)]:[new P(r.x,t.y)];if(t.direction===A.Up){if(r.x<t.x)return se(r,t);var e=se(t,r);return[e[1],e[0]]}else return[new P(t.x,r.y)]}function ze(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.x>t.x)return t.direction===A.Left&&r.x-t.x>3*bt?r.y<t.y?t.y-r.y<bt?[new P(r.x,r.y+2*bt),new P(t.x,r.y+2*bt)]:[new P(t.x,r.y)]:r.y-t.y<bt?[new P(r.x,r.y-2*bt),new P(t.x,r.y-2*bt)]:[new P(t.x,r.y)]:t.direction===A.Left||t.direction===A.Up&&r.y<t.y||t.direction===A.Bottom&&r.y>t.y?[new P(t.x,r.y)]:[new P(r.x,t.y)];if(t.direction===A.Right){if(r.y<t.y)return ae(r,t);var e=ae(t,r);return[e[1],e[0]]}else return[new P(r.x,t.y)]}function Ue(r,t){if(r.x===t.x||r.y===t.y)return[];if(r.x<t.x)return t.direction===A.Right&&t.x-r.x>3*bt?r.y<t.y?t.y-r.y<bt?[new P(r.x,r.y-2*bt),new P(t.x,r.y-2*bt)]:[new P(t.x,r.y)]:r.y-t.y<bt?[new P(r.x,r.y+2*bt),new P(t.x,r.y+2*bt)]:[new P(t.x,r.y)]:t.direction===A.Right||t.direction===A.Up&&r.y<t.y||t.direction===A.Bottom&&r.y>t.y?[new P(t.x,r.y)]:[new P(r.x,t.y)];if(t.direction===A.Left){if(r.y<t.y)return ae(r,t);var e=ae(t,r);return[e[1],e[0]]}else return[new P(r.x,t.y)]}function se(r,t){var e=r.x+(t.x-r.x)/2;return[new P(e,r.y),new P(e,t.y)]}function ae(r,t){var e=r.y+(t.y-r.y)/2;return[new P(r.x,e),new P(t.x,e)]}function de(r){var t=parseInt,e=Math.round,i=r.length,n={};if(i>9){var o=r=r.split(","),p=o[0],x=o[1],U=o[2],W=o[3];if(i=r.length,i<3||i>4)return null;n.r=t(p[3]=="a"?p.slice(5):p.slice(4)),n.g=t(x),n.b=t(U),n.a=W?parseFloat(W):-1}else{if(i==8||i==6||i<4)return null;i<6&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]+(i>4?r[4]+r[4]:"")),r=t(r.slice(1),16),i==9||i==5?(n.r=r>>24&255,n.g=r>>16&255,n.b=r>>8&255,n.a=e((r&255)/.255)/1e3):(n.r=r>>16,n.g=r>>8&255,n.b=r&255,n.a=-1)}return n}function we(r,t,e,i){var n,o,p,x,U,W,it,ht=Math.round,lt=typeof e=="string";return typeof r!="number"||r<-1||r>1||typeof t!="string"||t[0]!="r"&&t[0]!="#"||e&&!lt||(it=t.length>9,it=lt?e.length>9?!0:e=="c"?!it:!1:it,U=de(t),x=r<0,W=e&&e!="c"?de(e):x?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},r=x?r*-1:r,x=1-r,!U||!W)?null:(i?(n=ht(x*U.r+r*W.r),o=ht(x*U.g+r*W.g),p=ht(x*U.b+r*W.b)):(n=ht(Math.pow(x*Math.pow(U.r,2)+r*Math.pow(W.r,2),.5)),o=ht(Math.pow(x*Math.pow(U.g,2)+r*Math.pow(W.g,2),.5)),p=ht(Math.pow(x*Math.pow(U.b,2)+r*Math.pow(W.b,2),.5))),lt=U.a,W=W.a,U=lt>=0||W>=0,lt=U?lt<0?W:W<0?lt:lt*x+W*r:0,it?"rgb"+(U?"a(":"(")+n+","+o+","+p+(U?","+ht(lt*1e3)/1e3:"")+")":"#"+(4294967296+n*16777216+o*65536+p*256+(U?ht(lt*255):0)).toString(16).slice(1,U?void 0:-2))}function $t(r,t){var e=de(t)||{r:0,g:0,b:0};return e.a<0?"rgba("+e.r+","+e.g+","+e.b+","+r+")":"rgba("+e.r+","+e.g+","+e.b+","+(r+e.a)+")"}function Wt(r,t){return+t?+t:!t||t[t.length-1]!=="%"?0:(t=t.substr(0,t.length-1),r*+t/100)}function We(r,t){var e=r.x-t.x,i=r.y-t.y;return Math.sqrt(e*e+i*i)}var je=80;function be(r,t){r.beginPath(),r.moveTo(t.from.x,t.from.y),r.bezierCurveTo(t.controlPoints[0].x,t.controlPoints[0].y,t.controlPoints[1].x,t.controlPoints[1].y,t.to.x,t.to.y),r.stroke()}function ke(r,t){r.save(),r.fillStyle=$t(.5,r.strokeStyle+""),r.lineWidth=1,r.beginPath(),r.moveTo(t.from.x,t.from.y),r.lineTo(t.controlPoints[0].x,t.controlPoints[0].y),r.stroke(),r.beginPath(),r.moveTo(t.to.x,t.to.y),r.lineTo(t.controlPoints[1].x,t.controlPoints[1].y),r.stroke(),r.fillStyle="#fff",r.lineWidth=2;for(var e=0,i=t.controlPoints;e<i.length;e++){var n=i[e];r.beginPath(),r.arc(n.x,n.y,4,0,Math.PI*2),r.stroke(),r.fill()}r.restore()}function Ke(r){r.from.direction||(r.from.direction=A.Bottom),r.to.direction||(r.to.direction=(r.from.direction+2)%4,r.to.direction||(r.to.direction=A.Left)),r.controlPoints=[xe(r.from,r.to),xe(r.to,r.from)],tt.Store.set(he(r,"pts-")+r.id,void 0)}function Se(r,t){var e=tt.Store.get(he(t,"pts-")+t.id);if(!e){if(e=[t.from],t.controlPoints)for(var i=.01;i<1;i+=.01)e.push(Vt(i,t.from,t.controlPoints[0],t.controlPoints[1],t.to));e.push(t.to),tt.Store.set(he(t,"pts-")+t.id,e)}for(var n=e.length-1,i=0;i<n;++i)if(s(r,e[i],e[i+1]))return!0;return!1}function Vt(r,t,e,i,n){var o=t.x,p=t.y,x=n.x,U=n.y,W=e.x,it=e.y,ht=i.x,lt=i.y,Lt=o*(1-r)*(1-r)*(1-r)+3*W*r*(1-r)*(1-r)+3*ht*r*r*(1-r)+x*r*r*r,It=p*(1-r)*(1-r)*(1-r)+3*it*r*(1-r)*(1-r)+3*lt*r*r*(1-r)+U*r*r*r;return new P(Lt,It)}function xe(r,t){var e=new P(r.x,r.y,r.direction,r.anchorIndex,r.id),i=window.topologyControlPtDistance||je;if((r.direction===A.Up||r.direction===A.Bottom)&&Math.abs(r.x-t.x)<3)return t.y>r.y?(i=Math.round((t.y-r.y)/3),e.y+=i):(i=Math.round((r.y-t.y)/3),e.y-=i),e;if((r.direction===A.Left||r.direction===A.Right)&&Math.abs(r.y-t.y)<3)return t.x>r.x?(i=Math.round((t.x-r.x)/3),e.x+=i):(i=Math.round((r.x-t.x)/3),e.x-=i),e;switch(r.direction){case A.Up:e.y-=i;break;case A.Right:e.x+=i;break;case A.Bottom:e.y+=i;break;case A.Left:e.x-=i;break}return e}function he(r,t){return r.getTID()+"-"+t}var ce=20;function He(r){switch(r.from.direction||(r.from.direction=A.Bottom),r.to.direction||(r.to.direction=(r.from.direction+2)%4,r.to.direction||(r.to.direction=A.Left)),r.from.direction){case A.Up:r.controlPoints=[new P(r.from.x,r.from.y-ce),new P(r.from.x,r.to.y)];break;case A.Right:r.controlPoints=[new P(r.from.x+ce,r.from.y),new P(r.from.x,r.to.y)];break;case A.Bottom:r.controlPoints=[new P(r.from.x,r.from.y+ce),new P(r.from.x,r.to.y)];break;case A.Left:r.controlPoints=[new P(r.from.x-ce,r.from.y),new P(r.from.x,r.to.y)];break}tt.Store.set(he(r,"pts-")+r.id,void 0)}function Ce(r,t,e,i,n){i+=r.lineWidth*3;var o=r.lineWidth/10;r.lineWidth<2&&(r.lineWidth=2,o=0),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth+o*5,-e.y),r.moveTo(e.x,e.y+o),r.lineTo(e.x,e.y-o),r.lineTo(e.x-i,e.y-i/3),r.lineTo(e.x-i,e.y+i/3),r.closePath(),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function qe(r,t,e,i){Ce(r,t,e,i,tt.Store.get("LT:bkColor")||"#fff")}function Te(r,t,e,i,n){i+=r.lineWidth*3;var o=i/2,p=r.lineWidth/10;r.lineWidth<2&&(r.lineWidth=2,p=0),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth+p*5,-e.y),r.moveTo(e.x,e.y+p),r.lineTo(e.x,e.y-p),r.lineTo(e.x-o,e.y-o/2),r.lineTo(e.x-i,e.y-p),r.lineTo(e.x-i,e.y+p),r.lineTo(e.x-o,e.y+o/2),r.closePath(),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function Ve(r,t,e,i){Te(r,t,e,i,tt.Store.get("LT:bkColor")||"#fff")}function Ie(r,t,e,i,n){i+=r.lineWidth*3;var o=i/2;r.lineWidth<2&&(r.lineWidth=2),r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x,-e.y-r.lineWidth/10),r.arc(e.x-o-r.lineWidth/2,e.y,o,0,2*Math.PI),r.stroke(),n?r.fillStyle=n:r.fillStyle=r.strokeStyle,r.fill()}function Ye(r,t,e,i){Ie(r,t,e,i,tt.Store.get("LT:bkColor")||"#fff")}function Xe(r){r.anchors.push(new P(r.rect.x,r.rect.y+r.rect.height/2,A.Left)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y,A.Up)),r.anchors.push(new P(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,A.Right)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,A.Bottom));for(var t=5;t<360;t+=5)if(t%90!=0){var e=Math.round(t/90),i=new P(r.rect.center.x+Math.sin(t/180*Math.PI)*r.rect.width/2,r.rect.center.y+Math.cos(t/180*Math.PI)*r.rect.height/2,e);i.hidden=!0,r.anchors.push(i)}}function Qe(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3),r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3),r.stroke()}function Ge(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),e.x>t.x?(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3)):(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3)),r.stroke()}function Je(r,t,e,i){i+=r.lineWidth*3,r.translate(e.x,e.y),r.rotate(Math.atan2(e.y-t.y,e.x-t.x)),r.translate(-e.x-r.lineWidth/5,-e.y-r.lineWidth/5),e.x<t.x?(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y-i/3)):(r.moveTo(e.x,e.y),r.lineTo(e.x-i,e.y+i/3)),r.stroke()}function Ze(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/2,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*2/5),r.lineTo(t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height),r.lineTo(t.rect.x+t.rect.width/5,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height*2/5),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function $e(r){var t=r.rect.width/2,e=r.rect.height/2;t>e?t=e:e=t;var i=r.rect.height/7;i<10&&(i=10),r.iconRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+i,t,e)}function tr(r){r.textRect=new a(r.rect.x+r.rect.width/5,r.rect.y+r.rect.height*5/7,r.rect.width*3/5,r.rect.height/4);var t=r.rect.width*3/5,e=r.rect.height*3/5;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height/4,t,e)}function er(r){r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y,A.Up)),r.anchors.push(new P(r.rect.x+r.rect.width,r.rect.y+r.rect.height*2/5,A.Right)),r.anchors.push(new P(r.rect.x+r.rect.width*4/5,r.rect.y+r.rect.height,A.Bottom)),r.anchors.push(new P(r.rect.x+r.rect.width/5,r.rect.y+r.rect.height,A.Bottom)),r.anchors.push(new P(r.rect.x,r.rect.y+r.rect.height*2/5,A.Left))}function rr(r,t){r.beginPath();var e=t.rect.width/5;r.moveTo(t.rect.x+e,t.rect.y),r.lineTo(t.rect.x+t.rect.width-e,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2),r.lineTo(t.rect.x+t.rect.width-e,t.rect.y+t.rect.height),r.lineTo(t.rect.x+e,t.rect.y+t.rect.height),r.lineTo(t.rect.x,t.rect.y+t.rect.height/2),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ir(r){r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y,A.Up)),r.anchors.push(new P(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,A.Right)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,A.Bottom)),r.anchors.push(new P(r.rect.x,r.rect.y+r.rect.height/2,A.Left));var t=new P(r.rect.x+r.rect.width/10,r.rect.y+r.rect.height/4,A.Left);t.hidden=!0,r.anchors.push(t);var e=new P(r.rect.x+r.rect.width/10,r.rect.y+r.rect.height*3/4,A.Left);e.hidden=!0,r.anchors.push(e);var i=new P(r.rect.x+r.rect.width*9/10,r.rect.y+r.rect.height/4,A.Right);i.hidden=!0,r.anchors.push(i);var n=new P(r.rect.x+r.rect.width*9/10,r.rect.y+r.rect.height*3/4,A.Right);n.hidden=!0,r.anchors.push(n)}function nr(r){var t=r.rect.width*3/5,e=r.rect.height*3/4;r.iconRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,e-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function or(r){var t=r.rect.width*3/5,e=r.rect.height/4;r.textRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.rect.height-e+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,e),r.fullTextRect=new a(r.rect.x+r.rect.width/5+r.paddingLeftNum,r.rect.y+r.paddingTopNum,t-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function sr(r,t){r.beginPath();for(var e=0;e<5;++e)r.lineTo(Math.cos((18+72*e)/180*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin((18+72*e)/180*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2),r.lineTo(Math.cos((54+72*e)/180*Math.PI)*t.rect.width/4+t.rect.x+t.rect.width/2,-Math.sin((54+72*e)/180*Math.PI)*t.rect.width/4+t.rect.y+t.rect.height/2);r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ar(r){r.anchors.push(new P(Math.cos(18/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin(18/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,A.Right)),r.anchors.push(new P(Math.cos((18+72)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,A.Up)),r.anchors.push(new P(Math.cos((18+72*2)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*2)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,A.Left)),r.anchors.push(new P(Math.cos((18+72*3)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*3)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,A.Bottom)),r.anchors.push(new P(Math.cos((18+72*4)/180*Math.PI)*r.rect.width/2+r.rect.x+r.rect.width/2,-Math.sin((18+72*4)/180*Math.PI)*r.rect.width/2+r.rect.y+r.rect.height/2,A.Bottom))}function hr(r){r.iconRect=new a(0,0,0,0)}function cr(r){var t=r.rect.width*2/5,e=r.rect.height*2/5;r.fullTextRect=new a(r.rect.x+(r.rect.width-t)/2,r.rect.y+(r.rect.height-e)/2,t,e),r.textRect=r.fullTextRect}function lr(r,t){r.beginPath(),r.moveTo(t.rect.x+t.rect.width/5,t.rect.y+t.rect.height*13/16),r.bezierCurveTo(t.rect.x-t.rect.width/15,t.rect.y+t.rect.height*13/16,t.rect.x-t.rect.width/15,t.rect.y+t.rect.height*7/16,t.rect.x+t.rect.width/5,t.rect.y+t.rect.height*7/16),r.bezierCurveTo(t.rect.x+t.rect.width/5,t.rect.y,t.rect.x+t.rect.width*4/5,t.rect.y,t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height*7/16),r.bezierCurveTo(t.rect.x+t.rect.width*16/15,t.rect.y+t.rect.height*7/16,t.rect.x+t.rect.width*16/15,t.rect.y+t.rect.height*13/16,t.rect.x+t.rect.width*4/5,t.rect.y+t.rect.height*13/16),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function ur(r){r.anchors.push(new P(r.rect.x,r.rect.y+r.rect.height*3/5,A.Left)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height/9,A.Up)),r.anchors.push(new P(r.rect.x+r.rect.width,r.rect.y+r.rect.height*3/5,A.Right)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height*4/5,A.Bottom))}function fr(r){r.iconRect=new a(0,0,0,0)}function dr(r){r.textRect=new a(r.rect.x+r.rect.width/4,r.rect.y+r.rect.height/4,r.rect.width/2,r.rect.height*6/11),r.fullTextRect=r.textRect}function pr(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x+t.rect.width*8/16,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x+t.rect.width/4,t.rect.ey),r.lineTo(t.rect.x+t.rect.width*5/16,t.rect.y+t.rect.height*3/4),r.lineTo(t.rect.x,t.rect.y+t.rect.height*3/4),r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function yr(r){r.iconRect=new a(0,0,0,0),r.fullIconRect=r.iconRect}function vr(r){r.textRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height*3/4-r.paddingTopNum-r.paddingBottomNum),r.fullTextRect=r.textRect}function gr(r){r.anchors.push(new P(r.rect.x,r.rect.y+r.rect.height*3/8,A.Left)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y,A.Up)),r.anchors.push(new P(r.rect.x+r.rect.width,r.rect.y+r.rect.height*3/8,A.Right)),r.anchors.push(new P(r.rect.x+r.rect.width/4,r.rect.ey,A.Bottom))}function mr(r,t){r.beginPath();var e=t.rect.width/6;r.moveTo(t.rect.x,t.rect.y),r.lineTo(t.rect.ex-e,t.rect.y),r.lineTo(t.rect.ex,t.rect.y+e),r.lineTo(t.rect.ex,t.rect.ey),r.lineTo(t.rect.x,t.rect.ey),r.closePath(),r.moveTo(t.rect.ex-e,t.rect.y),r.lineTo(t.rect.ex-e,t.rect.y+e),r.lineTo(t.rect.ex,t.rect.y+e),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function wr(r){var t=0,e=0;r.text&&(r.paddingRightNum?t=r.paddingRightNum:e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1)),r.iconRect=new a(r.rect.x,r.rect.y,r.rect.width-t,r.rect.height-e),r.fullIconRect=r.rect}function br(r){if(r.paddingRightNum){var t=r.paddingRightNum-5;r.textRect=new a(r.rect.x+r.rect.width-t,r.rect.y,t,r.rect.height-r.textOffsetY*2)}else{var e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1);r.textRect=new a(r.rect.x,r.rect.y+r.rect.height-e,r.rect.width-r.textOffsetX*2,e)}r.fullTextRect=r.rect}function kr(r){var t=0,e=0;r.text&&(r.paddingRightNum?t=r.paddingRightNum:e=r.paddingBottomNum||r.lineHeight*r.fontSize*(r.textMaxLine||1)),r.anchors.push(new P(r.rect.x,r.rect.y+(r.rect.height-e)/2,A.Left)),r.anchors.push(new P(r.rect.x+(r.rect.width-t)/2,r.rect.y,A.Up)),r.anchors.push(new P(r.rect.x+r.rect.width-t,r.rect.y+(r.rect.height-e)/2,A.Right)),r.anchors.push(new P(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height-e,A.Bottom))}var pe=function(){function r(t,e,i,n,o,p){o===void 0&&(o=""),p===void 0&&(p=""),this.points=[],this.fillStyle="",this.strokeStyle="",this.points.push(t),this.points.push(e),this.points.push(i),this.points.push(n),this.fillStyle=o,this.strokeStyle=p||o}return r.prototype.render=function(t){t.save(),t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.beginPath();for(var e=0;e<this.points.length;++e)e?t.lineTo(this.points[e].x,this.points[e].y):t.moveTo(this.points[e].x,this.points[e].y);t.closePath(),this.fillStyle&&t.fill(),t.stroke(),t.restore()},r}(),Sr=function(){function r(t,e,i,n,o){n===void 0&&(n="#ddd"),o===void 0&&(o="#ccc"),this.surfaces=[];var p=e*Math.sin(45*Math.PI/180),x=new P(t.x,t.y+p),U=new P(t.ex-p,t.y+p),W=new P(t.ex-p,t.ey),it=new P(t.x,t.ey);this.surfaces.push(new pe(x,U,W,it,n,o)),this.surfaces.push(new pe(x,new P(t.x+p,t.y),new P(t.ex,t.y),U,we(.5,n),o)),this.surfaces.push(new pe(U,new P(t.ex,t.y),new P(t.ex,t.ey-p),W,we(.6,n),o))}return r.prototype.render=function(t){for(var e=0,i=this.surfaces;e<i.length;e++){var n=i[e];n.render(t)}},r}();function xr(r,t){new Sr(t.rect,t.z,t.zRotate,t.fillStyle,t.strokeStyle).render(r)}function Cr(r){var t=r.z*Math.sin(45*Math.PI/180);r.anchors.push(new P(r.rect.x,r.rect.ey-(r.rect.height-t)/2,A.Left)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y+t/2,A.Up)),r.anchors.push(new P(r.rect.ex-t/2,r.rect.y+r.rect.height/2,A.Right)),r.anchors.push(new P(r.rect.x+(r.rect.width-t)/2,r.rect.y+r.rect.height,A.Bottom))}function Tr(r){r.fullIconRect=r.fullTextRect,r.iconRect=new a(r.fullIconRect.x,r.fullIconRect.y,r.fullIconRect.width,r.fullIconRect.height*2/3)}function Ir(r){var t=r.z*Math.sin(45*Math.PI/180);r.fullTextRect=new a(r.rect.x,r.rect.y+t,r.rect.width-t,r.rect.height-t),r.textRect=new a(r.fullTextRect.x+10,r.fullTextRect.y+r.fullTextRect.height*2/3,r.fullTextRect.width-20,r.fullTextRect.height/3-5)}function Lr(r,t){r.beginPath();var e=t.rect.width/4,i=t.rect.x+t.rect.width/2;r.arc(i,t.rect.y+e,e,0,Math.PI*2),r.moveTo(t.rect.x,t.rect.y+e*3),r.lineTo(t.rect.ex,t.rect.y+e*3),r.moveTo(i,t.rect.y+e*2),r.lineTo(i,t.rect.y+e*4),r.moveTo(i,t.rect.y+e*4),r.lineTo(t.rect.x,t.rect.ey),r.moveTo(i,t.rect.y+e*4),r.lineTo(t.rect.ex,t.rect.ey),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}function Pr(r){r.iconRect=new a(0,0,0,0)}function Er(r){r.textRect=void 0,r.fullTextRect=r.textRect}function Le(r){r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function Pe(r){var t=r.rect.height-r.paddingTopNum-r.paddingBottomNum;r.textRect=new a(r.rect.x+r.paddingLeftNum+t,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum-t,t),r.fullTextRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t)}function Rr(r,t){!t.points||!t.points[0]||(r.beginPath(),r.moveTo(t.points[0].x,t.points[0].y),t.points.forEach(function(e){r.lineTo(e.x,e.y)}),t.closePath&&!t.doing&&r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke())}function _r(r){if(!(!r.points||!r.points.length)){var t=r.points[0],e=r.points[r.points.length-1];t.x<e.x?(r.anchors.push(new P(t.x,t.y,A.Left)),r.anchors.push(new P(e.x,e.y,A.Right))):(r.anchors.push(new P(t.x,t.y,A.Right)),r.anchors.push(new P(e.x,e.y,A.Left)))}}function Ar(r){for(var t=Nr(r),e=5,i=0;i<e;i++)if(i!==2){var n=r.rect.x+r.rect.width*(i+1)/(e+1),o=r.rect.y;n<r.rect.x+t?o=ue(r.rect.x+t,o+t,n,t,-1):n>r.rect.x+r.rect.width-t&&(o=ue(r.rect.x+r.rect.width-t,o+t,n,t,-1)),r.anchors.push(new P(n,o,A.Up))}for(var p=3,i=0;i<p;i++){var o=r.rect.y+r.rect.height*(i+1)/(p+1),n=r.rect.x+r.rect.width;o<r.rect.y+t?n=le(n-t,r.rect.y+t,o,t):o>r.rect.y+r.rect.height-t&&(n=le(n-t,r.rect.y+r.rect.height-t,o,t)),r.anchors.push(new P(n,o,A.Right))}for(var x=5,i=0;i<x;i++)if(i!==2){var n=r.rect.x+r.rect.width*(i+1)/(x+1),o=r.rect.y+r.rect.height;n<r.rect.x+t?o=ue(r.rect.x+t,o-t,n,t):n>r.rect.x+r.rect.width-t&&(o=ue(r.rect.x+r.rect.width-t,o-t,n,t)),r.anchors.push(new P(n,o,A.Bottom))}for(var U=3,i=0;i<U;i++){var o=r.rect.y+r.rect.height*(i+1)/(U+1),n=r.rect.x;o<r.rect.y+t?n=le(n+t,r.rect.y+t,o,t,-1):o>r.rect.y+r.rect.height-t&&(n=le(n+t,r.rect.y+r.rect.height-t,o,t,-1)),r.anchors.push(new P(n,o,A.Left))}}function Nr(r){var t=r.borderRadius,e=r.borderRadius;r.borderRadius<1&&(t=r.rect.width*r.borderRadius,e=r.rect.height*r.borderRadius);var i=t<e?t:e;return r.rect.width<2*i&&(i=r.rect.width/2),r.rect.height<2*i&&(i=r.rect.height/2),i}function le(r,t,e,i,n){return n===void 0&&(n=1),n*Math.sqrt(Math.pow(i,2)-Math.pow(e-t,2))+r}function ue(r,t,e,i,n){return n===void 0&&(n=1),n*Math.sqrt(Math.pow(i,2)-Math.pow(e-r,2))+t}function Mr(r,t){r.beginPath(),r.moveTo(t.rect.x,t.rect.y+t.rect.height),r.lineTo(t.rect.x+t.rect.width,t.rect.y+t.rect.height),r.closePath(),r.stroke()}function Or(r){r.anchors.push(new P(r.rect.x,r.rect.y+r.rect.height,4)),r.anchors.push(new P(r.rect.x+r.rect.width,r.rect.y+r.rect.height,2))}function Br(r,t){if(!(!t.points||!t.points[1])){r.beginPath(),r.moveTo(t.points[0].x,t.points[0].y);for(var e=1;e<t.points.length;)if(t.points[e].data)if(t.points[e+2])r.bezierCurveTo(t.points[e].x,t.points[e].y,t.points[e+1].x,t.points[e+1].y,t.points[e+2].x,t.points[e+2].y),e+=2;else break;else r.lineTo(t.points[e].x,t.points[e].y),++e;t.closePath&&!t.doing&&r.closePath(),(t.fillStyle||t.bkType)&&r.fill(),r.stroke()}}var Rt={},Ot={},Ft={},zt={},Nt={},qt={};function Dr(){Rt.combine=M,Rt.div=M,Rt.graffiti=Rr,zt.graffiti=_r,Rt.lines=Br,Rt.square=M,Rt.rectangle=M,Ot.rectangle=Le,Ft.rectangle=Pe,Rt.circle=Y,Ot.circle=at,Ft.circle=nt,zt.circle=Xe,Rt.triangle=N,zt.triangle=J,Ot.triangle=st,Ft.triangle=h,Rt.diamond=G,Ot.diamond=f,Ft.diamond=I,Rt.hexagon=rr,Ot.hexagon=nr,Ft.hexagon=or,zt.hexagon=ir,Rt.pentagon=Ze,Ot.pentagon=$e,Ft.pentagon=tr,zt.pentagon=er,Rt.pentagram=sr,Ot.pentagram=hr,Ft.pentagram=cr,zt.pentagram=ar,Rt.leftArrow=et,zt.leftArrow=rt,Ot.leftArrow=B,Ft.leftArrow=X,Rt.rightArrow=F,zt.rightArrow=rt,Ot.rightArrow=Q,Ft.rightArrow=ot,Rt.twowayArrow=S,zt.twowayArrow=rt,Ot.twowayArrow=pt,Ft.twowayArrow=ft,Rt.cloud=lr,zt.cloud=ur,Ot.cloud=fr,Ft.cloud=dr,Rt.message=pr,zt.message=gr,Ot.message=yr,Ft.message=vr,Rt.file=mr,Rt.text=z,Ot.text=xt,Rt.line=H,zt.line=$,Ot.line=xt,Ft.line=Tt,Rt.image=function(r,t){},Ot.image=wr,Ft.image=br,zt.image=kr,Rt.cube=xr,zt.cube=Cr,Ot.cube=Tr,Ft.cube=Ir,Rt.people=Lr,Ot.people=Pr,Ft.people=Er,Rt.mindNode=M,zt.mindNode=Ar,Ot.mindNode=Le,Ft.mindNode=Pe,Rt.mindLine=Mr,zt.mindLine=Or,Nt.line={drawFn:Kt,drawControlPointsFn:Dt,controlPointsFn:Ht,pointIn:Gt},Nt.polyline={drawFn:_t,drawControlPointsFn:Qt,controlPointsFn:oe,dockControlPointFn:fe,pointIn:Gt},Nt.curve={drawFn:be,drawControlPointsFn:ke,controlPointsFn:Ke,pointIn:Se},Nt.mind={drawFn:be,drawControlPointsFn:ke,controlPointsFn:He,pointIn:Se},qt.triangleSolid=Ce,qt.triangle=qe,qt.diamondSolid=Te,qt.diamond=Ve,qt.circleSolid=Ie,qt.circle=Ye,qt.line=Qe,qt.lineUp=Ge,qt.lineDown=Je}Dr();function Ee(r,t,e,i,n,o){return Rt[r]&&o?!1:(Rt[r]=t,zt[r]=e,Ot[r]=i,Ft[r]=n,!0)}function Fr(r,t,e,i,n,o,p,x,U,W){return W===void 0&&(W=!0),Nt[r]&&!W?!1:(Nt[r]={drawFn:t,drawControlPointsFn:e,controlPointsFn:i,dockControlPointFn:n,pointIn:o,getLength:p,getCenter:x,getPointByPos:U},!0)}function bi(r,t,e){return qt[r]&&e?!1:(qt[r]=t,!0)}window.registerTopologyNode=Ee,window.registerTopologyLine=Fr;var zr=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Mt=function(r){zr(t,r);function t(e){var i=r.call(this)||this,n={name:"curve",fromArrow:"",toArrow:"",controlPoints:[],fromArrowSize:5,toArrowSize:5,borderWidth:0,borderColor:"#000000",animateColor:"",animateSpan:1,animateFromSize:0,animateToSize:0,animateDotSize:3,textBackground:"#ffffff"};if(i.fromData(n,e),i.type=g.Line,e.from&&(i.from=new P(e.from.x,e.from.y,e.from.direction,e.from.anchorIndex,e.from.id,e.from.hidden,e.autoAnchor)),e.to&&(i.to=new P(e.to.x,e.to.y,e.to.direction,e.to.anchorIndex,e.to.id,e.to.hidden,e.autoAnchor)),e.name==="mind"&&(!e.controlPoints||e.controlPoints.length>2))e.controlPoints=void 0,i.calcControlPoints(!0);else if(e.controlPoints){i.controlPoints=[];for(var o=0,p=e.controlPoints;o<p.length;o++){var x=p[o];i.controlPoints.push(new P(x.x,x.y,x.direction,x.anchorIndex,x.id))}}return e.children&&(i.children=[],e.children.forEach(function(U){i.children.push(new t(U))})),i}return t.prototype.setFrom=function(e,i){i===void 0&&(i=""),this.from=e,this.fromArrow=i,this.textRect=void 0},t.prototype.setTo=function(e,i){i===void 0&&(i="triangleSolid"),this.to=e,this.toArrow=i,this.textRect=void 0},t.prototype.calcControlPoints=function(e){this.name!=="line"&&this.manualCps&&!e||(this.textRect=void 0,this.from&&this.to&&Nt[this.name]&&Nt[this.name].controlPointsFn(this))},t.prototype.draw=function(e){if(this.animateDot){if(e.fillStyle=e.strokeStyle,this.animateType==="dot"){e.beginPath(),e.arc(this.animateDot.x,this.animateDot.y,this.animateDotSize,0,2*Math.PI,!1),e.fill();return}else if(this.animateType==="comet"){var i=this.getBubbles();e.save();for(var n=0,o=i;n<o.length;n++){var p=o[n];e.globalAlpha=p.a,e.beginPath(),e.arc(p.pos.x,p.pos.y,p.r,0,2*Math.PI,!1),e.fill()}e.restore()}}switch(!this.isAnimate&&this.borderWidth>0&&this.borderColor&&(e.save(),this.lineJoin&&(e.lineJoin=this.lineJoin),e.lineWidth=this.lineWidth+this.borderWidth,e.strokeStyle=this.borderColor,Nt[this.name]&&Nt[this.name].drawFn(e,this),e.restore()),this.strokeType){case 1:this.strokeLinearGradient(e);break}(!this.isAnimate||this.animateType!=="comet")&&Nt[this.name]&&(this.lineJoin&&(e.lineJoin=this.lineJoin),Nt[this.name].drawFn(e,this));var x=tt.Store.get(this.generateStoreKey("LT:scale"))||1;if(this.fromArrow&&qt[this.fromArrow]){e.save(),e.beginPath(),e.lineDashOffset=0,e.setLineDash([]),e.fillStyle=this.fromArrowColor||e.strokeStyle,e.strokeStyle=e.fillStyle;var U=this.to;this.name==="curve"?U=Vt(.95-this.lineWidth/100,this.to,this.controlPoints[1],this.controlPoints[0],this.from):this.name!=="line"&&this.controlPoints.length&&(U=this.controlPoints[0]),qt[this.fromArrow](e,U,this.from,this.fromArrowSize*x),e.restore()}if(this.toArrow&&qt[this.toArrow]){e.save(),e.beginPath(),e.lineDashOffset=0,e.setLineDash([]),e.fillStyle=this.toArrowColor||e.strokeStyle,e.strokeStyle=e.fillStyle;var U=this.from;this.name==="curve"?U=Vt(.95-this.lineWidth/100,this.from,this.controlPoints[0],this.controlPoints[1],this.to):this.name==="mind"?U=Vt(.96-this.lineWidth/100,this.from,this.controlPoints[0],this.controlPoints[1],this.to):this.name!=="line"&&this.controlPoints.length&&(U=this.controlPoints[this.controlPoints.length-1]),qt[this.toArrow](e,U,this.to,this.toArrowSize*x),e.restore()}this.text&&!this.isAnimate&&!this.hiddenText&&(this.textRect||this.calcTextRect(),z(e,this))},t.prototype.pointIn=function(e){return Nt[this.name].pointIn(e,this)},t.prototype.getLen=function(){switch(this.name){case"line":return l(this.from,this.to);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return l(this.from,this.to);for(var e=0,i=this.from,n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];e+=l(i,p),i=p}return e+=l(i,this.to),e|0;case"curve":case"mind":return d(this.from,this.controlPoints[0],this.controlPoints[1],this.to);default:if(Nt[this.name].getLength)return Nt[this.name].getLength(this)}return 0},t.prototype.strokeLinearGradient=function(e){if(!(!this.lineGradientFromColor||!this.lineGradientToColor)){var i=this.from,n=this.to,o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.lineGradientFromColor),o.addColorStop(1,this.lineGradientToColor),e.strokeStyle=o}},t.prototype.calcTextRect=function(){if(!this.from||!this.to){this.textRect=void 0;return}var e=this.getCenter(),i=Math.abs(this.from.x-this.to.x);i<100&&(i=100),this.text&&!this.text.split&&(this.text+="");var n=this.lineHeight*this.fontSize*(this.textMaxLine||this.text&&this.text.split(`
`).length||1);this.textRect=new a(e.x-i/2,e.y-n/2,i,n)},t.prototype.getTextRect=function(){return this.calcTextRect(),this.textRect},t.prototype.getCenter=function(){var e=new P(this.from.x,this.from.y);switch(this.name){case"line":e=this.getLineCenter(this.from,this.to);break;case"polyline":var i=Math.round(this.controlPoints.length/2);e=this.getLineCenter(this.controlPoints[i-1]||this.from,this.controlPoints[i]||this.to);break;case"curve":e=Vt(.5,this.to,this.controlPoints[1],this.controlPoints[0],this.from);break;default:Nt[this.name].getCenter&&(e=Nt[this.name].getCenter(this))}return e},t.prototype.getLineCenter=function(e,i){return new P((e.x+i.x)/2,(e.y+i.y)/2)},t.prototype.getPointByPos=function(e){if(e<=0)return this.from;switch(this.name){case"line":return this.getLinePtByPos(this.from,this.to,e);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return this.getLinePtByPos(this.from,this.to,e);for(var i=[].concat(this.controlPoints,this.to),n=this.from,o=0,p=i;o<p.length;o++){var x=p[o],U=l(n,x);if(e>U)e-=U,n=x;else return this.getLinePtByPos(n,x,e)}return this.to;case"curve":return Vt(e/this.getLen(),this.from,this.controlPoints[0],this.controlPoints[1],this.to);default:if(Nt[this.name].getPointByPos)return Nt[this.name].getPointByPos(e,this)}return null},t.prototype.getPointByReversePos=function(e){if(e<=0)return this.to;switch(this.name){case"line":return this.getLinePtByPos(this.to,this.from,e);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return this.getLinePtByPos(this.to,this.from,e);var i=[];this.controlPoints.forEach(function(W){i.unshift(W)}),i.unshift(this.to);for(var n=this.to,o=0,p=i;o<p.length;o++){var x=p[o],U=l(n,x);if(e>U)e-=U,n=x;else return this.getLinePtByPos(n,x,e)}return this.from;case"curve":return Vt(e/this.getLen(),this.to,this.controlPoints[1],this.controlPoints[0],this.from);default:if(Nt[this.name].getPointByReversePos)return Nt[this.name].getPointByReversePos(e,this)}return null},t.prototype.getLinePtByPos=function(e,i,n){var o=l(e,i);if(n<=0)return e;if(n>=o)return i;var p,x;return p=e.x+(i.x-e.x)*(n/o),x=e.y+(i.y-e.y)*(n/o),new P(p,x)},t.prototype.calcRectInParent=function(e){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum;this.name==="lines"?Array.isArray(this.children)&&this.children.length>0&&(this.rectInParent={x:(this.children[0].from.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.children[0].from.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:0,height:0,rotate:0}):this.rectInParent={x:(this.from.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.from.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:0,height:0,rotate:0}},t.prototype.calcRectByParent=function(e){if(!!this.rectInParent){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum,o=e.rect.x+e.paddingLeftNum+Wt(i,this.rectInParent.x)+Wt(i,this.rectInParent.marginLeft),p=e.rect.y+e.paddingTopNum+Wt(n,this.rectInParent.y)+Wt(i,this.rectInParent.marginTop);if(this.rectInParent.marginLeft===void 0&&this.rectInParent.marginRight&&(o-=Wt(i,this.rectInParent.marginRight)),this.rectInParent.marginTop===void 0&&this.rectInParent.marginBottom&&(p-=Wt(i,this.rectInParent.marginBottom)),this.name==="lines"){if(Array.isArray(this.children)&&this.children.length>0){var x=this.children[0].from.x,U=this.children[0].from.y;this.translate(o-x,p-U)}}else this.translate(o-this.from.x,p-this.from.y)}},t.prototype.initAnimate=function(){this.animateStart=0,this.animateDot=void 0,this.animatePos=0},t.prototype.pauseAnimate=function(){tt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0})},t.prototype.stopAnimate=function(){var e=this;this.pauseAnimate(),this.initAnimate(),setTimeout(function(){tt.Store.set(e.generateStoreKey("LT:render"),{pen:e,stop:!0})},50)},t.prototype.animate=function(e){switch(this.animatePos+=this.animateSpan,this.animateType){case"beads":this.animateReverse?this.lineDashOffset=this.animatePos:this.lineDashOffset=-this.animatePos;var i=this.lineWidth;i<5&&(i=5),this.animateLineDash?this.lineDash=this.animateLineDash:this.lineDash=[i,i*2];break;case"dot":case"comet":this.lineDash=void 0;var n=void 0;this.animateReverse?n=this.getPointByReversePos(this.animatePos+this.animateToSize):n=this.getPointByPos(this.animatePos+this.animateFromSize),this.animateDot=n;break;default:this.animateReverse?this.lineDash=[0,this.length-this.animatePos+1,this.animatePos]:this.lineDash=[this.animatePos,this.length-this.animatePos+1];break}if(this.animatePos>this.length+this.animateSpan-this.animateFromSize-this.animateToSize){if(++this.animateCycleIndex>=this.animateCycle&&this.animateCycle>0){this.animateStart=0,this.initAnimate(),tt.Store.set(this.generateStoreKey("animateEnd"),this);return}this.animatePos=this.animateSpan}},t.prototype.getBubbles=function(){for(var e=[],i=0;i<30&&this.animatePos-i>0;++i)this.animateReverse?e.push({pos:this.getPointByReversePos(this.animatePos-i*2+this.animateToSize),a:1-i*.03,r:this.lineWidth-i*.01}):e.push({pos:this.getPointByPos(this.animatePos-i*2+this.animateFromSize),a:1-i*.03,r:this.lineWidth-i*.01});return e},t.prototype.round=function(){this.from.round(),this.to.round()},t.prototype.translate=function(e,i){if(this.from){this.from.x+=e,this.from.y+=i,this.to.x+=e,this.to.y+=i,this.text&&(this.textRect=void 0);for(var n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];p.x+=e,p.y+=i}}if(this.children)for(var x=0,U=this.children;x<U.length;x++){var W=U[x];W.translate(e,i)}tt.Store.set(this.generateStoreKey("pts-")+this.id,void 0)},t.prototype.scale=function(e,i){if(this.from){this.from.x=i.x-(i.x-this.from.x)*e,this.from.y=i.y-(i.y-this.from.y)*e,this.to.x=i.x-(i.x-this.to.x)*e,this.to.y=i.y-(i.y-this.to.y)*e,this.lineWidth*=e,this.borderWidth*=e,this.fontSize*=e,this.text&&(this.textRect=void 0),this.textOffsetX*=e,this.textOffsetY*=e;for(var n=0,o=this.controlPoints;n<o.length;n++){var p=o[n];p.x=i.x-(i.x-p.x)*e,p.y=i.y-(i.y-p.y)*e}}if(this.children)for(var x=0,U=this.children;x<U.length;x++){var W=U[x];W.scale(e,i)}tt.Store.set(this.generateStoreKey("pts-")+this.id,void 0)},t.prototype.hit=function(e,i){if(i===void 0&&(i=0),this.from.hit(e,i)||this.to.hit(e,i))return this},t.prototype.clone=function(){return new t(this)},t}(O);function Ur(r){r.anchors.push(new P(r.rect.x,r.rect.y+r.rect.height/2,A.Left)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y,A.Up)),r.anchors.push(new P(r.rect.x+r.rect.width,r.rect.y+r.rect.height/2,A.Right)),r.anchors.push(new P(r.rect.x+r.rect.width/2,r.rect.y+r.rect.height,A.Bottom))}function Wr(r){r.image&&r.imageWidth?r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.imageWidth,r.imageHeight):r.icon&&r.iconSize?r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.iconSize,r.iconSize):r.iconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height*3/4-r.paddingTopNum-r.paddingBottomNum),r.fullIconRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,r.rect.height-r.paddingTopNum-r.paddingBottomNum)}function jr(r){var t=r.rect.height-r.paddingTopNum-r.paddingBottomNum;r.textRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum+t*3/4,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t/4),r.fullTextRect=new a(r.rect.x+r.paddingLeftNum,r.rect.y+r.paddingTopNum,r.rect.width-r.paddingLeftNum-r.paddingRightNum,t)}var Kr=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Hr=function(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var i=Array(r),n=0,t=0;t<e;t++)for(var o=arguments[t],p=0,x=o.length;p<x;p++,n++)i[n]=o[p];return i},Re=["TID","events","wheres","text","fontFamily","fontSize","lineHeight","fontStyle","fontWeight","textAlign","textBaseline","textBackground","iconFamily","icon","iconSize"],At=function(r){Kr(t,r);function t(e,i){var n=r.call(this)||this;n.imageRatio=!0,n.points=[],n.anchors=[],n.manualAnchors=[],n.rotatedAnchors=[],n.animateDuration=0,n.animateFrames=[],n.animateFrame=0;var o={zRotate:0,borderRadius:0,imageAlign:"center",gradientAngle:0,gradientRadius:.01,paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,animateFrame:0,children:[]};if(n.fromData(o,e),n.type=g.Node,i||(delete n.elementLoaded,delete n.elementRendered),delete n.animateReady,e.children&&e.children[0]&&e.children[0].parentRect&&(n.paddingLeft=e.children[0].parentRect.offsetX,n.paddingRight=0,n.paddingTop=e.children[0].parentRect.offsetY,n.paddingBottom=0),e.parentRect&&(n.rectInParent={x:e.parentRect.x*100+"%",y:e.parentRect.y*100+"%",width:e.parentRect.width*100+"%",height:e.parentRect.height*100+"%",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,rotate:e.parentRect.rotate},n.paddingTop=e.parentRect.marginY,n.paddingBottom=e.parentRect.marginY,n.paddingLeft=e.parentRect.marginX,n.paddingRight=e.parentRect.marginX),e.points&&(n.points=[],e.points.forEach(function(W){n.points.push(new P(W.x,W.y))})),e.manualAnchors&&(n.manualAnchors=[],e.manualAnchors.forEach(function(W){var it=new P(W.x,W.y);it.id=e.id,n.manualAnchors.push(it)})),i&&(n.animateFrames=void 0),!i&&e.animateFrames&&e.animateFrames.length){for(var p=0,x=e.animateFrames;p<x.length;p++){var U=x[p];U.children=void 0,U.initState&&(U.initState=t.cloneState(U.initState)),U.state=t.cloneState(U.state)}n.animateFrames=e.animateFrames}return n.animateType=e.animateType?e.animateType:e.animateDuration?"custom":"",n.init(i),e.init&&e.img&&!e.image&&(n.img=e.img),e.children&&(n.children=[],e.children.forEach(function(W){var it;switch(W.TID=n.TID,W.type){case g.Line:it=new Mt(W),it.calcRectByParent(n);break;default:t.prototype.calcRectByParent.apply(W,[n]),it=new t(W),it.parentId=n.id,it.init(i);break}n.children.push(it)})),n}return Object.defineProperty(t.prototype,"dockWatchers",{get:function(){return Hr([this.rect.center],this.rect.toPoints())},set:function(i){},enumerable:!0,configurable:!0}),t.cloneState=function(e){var i=new t(e,!0);return Re.forEach(function(n){delete i[n]}),i},t.prototype.restore=function(e){if(!e&&this.animateReady&&(e=t.cloneState(this.animateReady)),!!e){for(var i in this)if(e[i]!==void 0&&i.indexOf("animate")<0&&i.indexOf("Animate")<0){if(Re.includes(i))continue;this[i]=e[i],i==="rect"&&(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height))}this.init(!0)}},t.prototype.checkData=function(){this.rect.width=this.rect.width<0?0:this.rect.width,this.rect.height=this.rect.height<0?0:this.rect.height,this.rect.calcCenter||(this.rect=new a(this.rect.x,this.rect.y,this.rect.width,this.rect.height))},t.prototype.init=function(e){this.checkData(),this.calcAbsPadding(),Ft[this.name]?Ft[this.name](this):jr(this),Ot[this.name]?Ot[this.name](this):Wr(this),this.calcAnchors(),this.elementRendered=!1,e||this.addToDiv()},t.prototype.addToDiv=function(){(this.audio||this.video||this.iframe||this.elementId||this.gif)&&tt.Store.set(this.generateStoreKey("LT:addDiv"),this)},t.prototype.removeFromDiv=function(){tt.Store.set(this.generateStoreKey("LT:removeDiv"),this)},t.prototype.hasGif=function(){if(this.gif)return!0;if(this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];if(n.type===g.Node&&n.hasGif&&n.hasGif())return!0}return!1},t.prototype.calcAbsPadding=function(){this.paddingLeftNum=Wt(this.rect.width,this.paddingLeft),this.paddingRightNum=Wt(this.rect.width,this.paddingRight),this.paddingTopNum=Wt(this.rect.height,this.paddingTop),this.paddingBottomNum=Wt(this.rect.height,this.paddingBottom)},t.prototype.draw=function(e){if(!!Rt[this.name]){switch(this.bkType){case 1:this.drawBkLinearGradient(e);break;case 2:this.drawBkRadialGradient(e);break}switch(this.strokeType){case 1:this.strokeLinearGradient(e);break}Rt[this.name](e,this),this.image||this.img&&this.elementId===""?this.drawImg(e):this.icon&&(e.save(),e.shadowColor="",e.shadowBlur=0,j(e,this),e.restore()),this.name!=="text"&&this.text&&!this.hiddenText&&z(e,this)}},t.prototype.strokeLinearGradient=function(e){if(!(!this.lineGradientFromColor||!this.lineGradientToColor)){var i=new P(this.rect.x,this.rect.center.y),n=new P(this.rect.ex,this.rect.center.y);this.lineGradientAngle%90==0&&this.lineGradientAngle%180?this.lineGradientAngle%270?(i.x=this.rect.center.x,i.y=this.rect.y,n.x=this.rect.center.x,n.y=this.rect.ey):(i.x=this.rect.center.x,i.y=this.rect.ey,n.x=this.rect.center.x,n.y=this.rect.y):this.lineGradientAngle&&(i.rotate(this.lineGradientAngle,this.rect.center),n.rotate(this.lineGradientAngle,this.rect.center));var o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.lineGradientFromColor),o.addColorStop(1,this.lineGradientToColor),e.strokeStyle=o}},t.prototype.drawBkLinearGradient=function(e){if(!(!this.gradientFromColor||!this.gradientToColor)){var i=new P(this.rect.x,this.rect.center.y),n=new P(this.rect.ex,this.rect.center.y);this.gradientAngle%90==0&&this.gradientAngle%180?this.gradientAngle%270?(i.x=this.rect.center.x,i.y=this.rect.y,n.x=this.rect.center.x,n.y=this.rect.ey):(i.x=this.rect.center.x,i.y=this.rect.ey,n.x=this.rect.center.x,n.y=this.rect.y):this.gradientAngle&&(i.rotate(this.gradientAngle,this.rect.center),n.rotate(this.gradientAngle,this.rect.center));var o=e.createLinearGradient(i.x,i.y,n.x,n.y);o.addColorStop(0,this.gradientFromColor),o.addColorStop(1,this.gradientToColor),e.fillStyle=o}},t.prototype.drawBkRadialGradient=function(e){if(!(!this.gradientFromColor||!this.gradientToColor)){var i=this.rect.width;i<this.rect.height&&(i=this.rect.height),i*=.5;var n=e.createRadialGradient(this.rect.center.x,this.rect.center.y,i*this.gradientRadius,this.rect.center.x,this.rect.center.y,i);n.addColorStop(0,this.gradientFromColor),n.addColorStop(1,this.gradientToColor),e.fillStyle=n}},t.prototype.drawImg=function(e){var i=this;this.lastImage!==this.image&&(this.img=void 0,this.lastImage&&this.lastImage.indexOf(".gif")>0&&tt.Store.set(this.generateStoreKey("LT:addDiv"),this));var n=this.image&&this.image.indexOf(".gif")>0;if(n){if(this.img){this.TID&&!this.elementLoaded&&(this.elementLoaded=!0,tt.Store.set(this.generateStoreKey("LT:addDiv"),this));return}}else if(this.img){e.save(),e.shadowColor="",e.shadowBlur=0;var o=this.getIconRect(),p=o.x,x=o.y,U=o.width,W=o.height;switch(this.imageWidth&&(U=this.imageWidth),this.imageHeight&&(W=this.imageHeight),this.imgNaturalWidth&&this.imgNaturalHeight&&this.imageRatio&&(this.imageWidth?W=this.imgNaturalHeight/this.imgNaturalWidth*U:U=this.imgNaturalWidth/this.imgNaturalHeight*W),p+=(o.width-U)/2,x+=(o.height-W)/2,this.imageAlign){case"top":x=o.y;break;case"bottom":x=o.ey-W;break;case"left":p=o.x;break;case"right":p=o.ex-U;break;case"left-top":p=o.x,x=o.y;break;case"right-top":p=o.ex-U,x=o.y;break;case"left-bottom":p=o.x,x=o.ey-W;break;case"right-bottom":p=o.ex-U,x=o.ey-W;break}this.iconRotate&&(e.translate(o.center.x,o.center.y),e.rotate(this.iconRotate*Math.PI/180),e.translate(-o.center.x,-o.center.y)),this.imageHide||e.drawImage(this.img,p,x,U,W),e.restore();return}else if(T[this.image]){this.img=T[this.image].img,this.lastImage=this.image,this.imgNaturalWidth=this.img.naturalWidth,this.imgNaturalHeight=this.img.naturalHeight,this.drawImg(e);return}if(!!this.image){var it=new Image;it.crossOrigin="anonymous",it.src=this.image,it.onload=function(){i.lastImage=i.image,i.imgNaturalWidth=it.naturalWidth,i.imgNaturalHeight=it.naturalHeight,i.img=it,T[i.image]={img:it},tt.Store.set(i.generateStoreKey("LT:imageLoaded"),!0),!i.gif&&n&&(i.gif=!0,i.TID&&(i.elementLoaded=!0,tt.Store.set(i.generateStoreKey("LT:addDiv"),i)))}}},t.prototype.calcAnchors=function(){var e=this;this.anchors=[],zt[this.name]?zt[this.name](this):Ur(this),this.manualAnchors&&this.manualAnchors.forEach(function(i){var n=Math.abs(i.x-e.rect.center.x),o=Math.abs(i.y-e.rect.center.y);n>o?i.x<e.rect.center.x?i.direction=A.Left:i.direction=A.Right:i.y<e.rect.center.y?i.direction=A.Up:i.direction=A.Bottom,e.anchors.push(i)}),this.calcRotateAnchors()},t.prototype.calcRotateAnchors=function(e){e===void 0&&(e=this.rotate),this.rotatedAnchors=[];for(var i=0,n=this.anchors;i<n.length;i++){var o=n[i];this.rotatedAnchors.push(o.clone().rotate(e,this.rect.center))}},t.prototype.getTextRect=function(){var e=this.textRect;return!this.icon&&!this.image&&(e=this.fullTextRect),e},t.prototype.getIconRect=function(){var e=this.iconRect;return this.text||(e=this.fullIconRect||this.fullTextRect||this.rect),e},t.prototype.calcRectByParent=function(e){if(!!this.rectInParent){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum,o=e.rect.x+e.paddingLeftNum+Wt(i,this.rectInParent.x)+Wt(i,this.rectInParent.marginLeft),p=e.rect.y+e.paddingTopNum+Wt(n,this.rectInParent.y)+Wt(i,this.rectInParent.marginTop),x=Wt(i,this.rectInParent.width),U=Wt(n,this.rectInParent.height);this.rectInParent.marginLeft===void 0&&this.rectInParent.marginRight&&(o-=Wt(i,this.rectInParent.marginRight)),this.rectInParent.marginTop===void 0&&this.rectInParent.marginBottom&&(p-=Wt(i,this.rectInParent.marginBottom)),this.rect=new a(o,p,x,U),this.rectInParent.rotate||(this.rectInParent.rotate=0);var W=e.rotate+e.offsetRotate;this.rotate=this.rectInParent.rotate+W,this.rectInParent.rect||(this.rectInParent.rect=this.rect.clone())}},t.prototype.calcChildrenRect=function(){if(!!this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.calcRectByParent(this),n.type===g.Node&&(n.init(),n.calcChildrenRect())}},t.prototype.calcRectInParent=function(e){var i=e.rect.width-e.paddingLeftNum-e.paddingRightNum,n=e.rect.height-e.paddingTopNum-e.paddingBottomNum;this.rectInParent={x:(this.rect.x-e.rect.x-e.paddingLeftNum)*100/i+"%",y:(this.rect.y-e.rect.y-e.paddingTopNum)*100/n+"%",width:this.rect.width*100/i+"%",height:this.rect.height*100/n+"%",rotate:this.rectInParent?this.rectInParent.rotate||0:this.rotate||0,rect:this.rect.clone()}},t.prototype.initAnimate=function(){if(!!this.animateFrames){for(var e=0,i=0;i<this.animateFrames.length;++i)this.animateFrames[i].start=e,e+=this.animateFrames[i].duration,this.animateFrames[i].end=e,this.animateFrames[i].initState=t.cloneState(i?this.animateFrames[i-1].state:this),this.animateFrames[i].offsetRect=new a(this.animateFrames[i].state.rect.x-this.animateFrames[i].initState.rect.x,this.animateFrames[i].state.rect.y-this.animateFrames[i].initState.rect.y,this.animateFrames[i].state.rect.width-this.animateFrames[i].initState.rect.width,this.animateFrames[i].state.rect.height-this.animateFrames[i].initState.rect.height);this.animateDuration=e,this.animateReady=t.cloneState(this),this.animatePos=0,this.animateFrame=0}},t.prototype.pauseAnimate=function(){this.animateFrame=this._animateFrame,this.animatePos=this._animatePos,tt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0})},t.prototype.stopAnimate=function(){this.animateStart=0,tt.Store.set(this.generateStoreKey("LT:AnimatePlay"),{pen:this,stop:!0}),this.restore(),this.initAnimate(),tt.Store.set(this.generateStoreKey("LT:render"),{pen:this,stop:!0})},t.prototype.animate=function(e){var i=this;if(!(this.animateStart<1)){var n=e-this.animateStart;if(this.animateFrame>0&&(this.animateFrames.forEach(function(it,ht){i.animateFrame<ht+1&&(n+=it.duration)}),n+=this.animatePos),n>this.animateDuration){if(this.animatePos=0,this.animateFrame=0,this.restore(),this.animateCycle>0&&++this.animateCycleIndex>=this.animateCycle){this.animateStart=0,this.animateCycleIndex=0,tt.Store.set(this.generateStoreKey("animateEnd"),this),this.animateAlone||tt.Store.set(this.generateStoreKey("LT:rectChanged"),this);return}this.animateStart=e,n=0}for(var o=!1,p=0;p<this.animateFrames.length;++p){var x=this.animateFrames[p];if(n>=x.start&&n<x.end){x.state.dash&&(this.dash=x.state.dash),x.state.strokeStyle&&(this.strokeStyle=x.state.strokeStyle),x.state.fillStyle&&(this.fillStyle=x.state.fillStyle),x.state.text&&(this.text=x.state.text),x.state.fontColor&&(this.fontColor=x.state.fontColor),x.state.fontFamily&&(this.fontFamily=x.state.fontFamily),x.state.fontSize&&(this.fontSize=x.state.fontSize),x.state.lineHeight&&(this.lineHeight=x.state.lineHeight),x.state.fontStyle&&(this.fontStyle=x.state.fontStyle),x.state.fontWeight&&(this.fontWeight=x.state.fontWeight),x.state.textAlign&&(this.textAlign=x.state.textAlign),x.state.textBaseline&&(this.textBaseline=x.state.textBaseline),x.state.textBackground&&(this.textBackground=x.state.textBackground),x.state.iconFamily&&(this.iconFamily=x.state.iconFamily),x.state.icon&&(this.icon=x.state.icon),x.state.iconSize&&(this.iconSize=x.state.iconSize),x.state.iconColor&&(this.iconColor=x.state.iconColor),this.visible=x.state.visible,this._animateFrame=p+1,this._animateFrame>this.animateFrame&&(this.animateFrame=0,this.animatePos=0),this._animatePos=n-x.start;var U=this._animatePos/x.duration;if(x.linear){if(x.state.rect.x!==x.initState.rect.x&&(this.rect.x=x.initState.rect.x+x.offsetRect.x*U,o=!0),x.state.rect.y!==x.initState.rect.y&&(this.rect.y=x.initState.rect.y+x.offsetRect.y*U,o=!0),x.state.rect.width!==x.initState.rect.width&&(this.rect.width=x.initState.rect.width+x.offsetRect.width*U,o=!0),x.state.rect.height!==x.initState.rect.height&&(this.rect.height=x.initState.rect.height+x.offsetRect.height*U,o=!0),this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calcCenter(),x.initState.z!==void 0&&x.state.z!==x.initState.z&&(this.z=x.initState.z+(x.state.z-x.initState.z)*U,o=!0),x.state.borderRadius!==x.initState.borderRadius&&(this.borderRadius=x.initState.borderRadius+(x.state.borderRadius-x.initState.borderRadius)*U),x.state.lineWidth!==x.initState.lineWidth&&(this.lineWidth=x.initState.lineWidth+(x.state.lineWidth-x.initState.lineWidth)*U),x.state.rotate!==x.initState.rotate&&(this.rotate=x.initState.rotate+(x.state.rotate-x.initState.rotate)*U,o=!0),x.state.globalAlpha!==x.initState.globalAlpha&&(this.globalAlpha=x.initState.globalAlpha+(x.state.globalAlpha-x.initState.globalAlpha)*U),x.state.lineDashOffset&&(this.lineDashOffset?this.lineDashOffset+=x.state.lineDashOffset:this.lineDashOffset=x.state.lineDashOffset),x.state.value!==x.initState.value&&(this.value=(x.initState.value||0)+((x.state.value||0)-(x.initState.value||0))*U),x.state.num!==x.initState.num&&(this.num=(x.initState.num||0)+((x.state.num||0)-(x.initState.num||0))*U),x.state.num1!==x.initState.num1&&(this.num1=(x.initState.num1||0)+((x.state.num1||0)-(x.initState.num1||0))*U),x.state.num2!==x.initState.num2&&(this.num2=(x.initState.num2||0)+((x.state.num2||0)-(x.initState.num2||0))*U),x.state.num3!==x.initState.num3&&(this.num3=(x.initState.num3||0)+((x.state.num3||0)-(x.initState.num3||0))*U),x.state.data)for(var W in x.state.data)typeof x.state.data[W]=="number"?this.data[W]=(x.initState.data[W]||0)+((x.state.data[W]||0)-(x.initState.data[W]||0))*U:x.state.data[W]!==void 0&&x.state.data[W]!==void 0&&(this.data[W]=x.state.data[W])}else this.rect=x.state.rect,this.lineWidth=x.state.lineWidth,this.rotate=x.state.rotate,this.globalAlpha=x.state.globalAlpha,this.lineDashOffset=x.state.lineDashOffset}}o&&(this.init(!0),this.animateAlone||tt.Store.set(this.generateStoreKey("LT:rectChanged"),this))}},t.prototype.scale=function(e,i){if(i||(i=this.rect.center),this.oldRect=this.rect.clone(),this.rect.x=i.x-(i.x-this.rect.x)*e,this.rect.y=i.y-(i.y-this.rect.y)*e,this.textOffsetX*=e,this.textOffsetY*=e,this.z*=e,this.rect.width*=e,this.rect.height*=e,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.lineWidth*=e,this.imageWidth&&(this.imageWidth*=e),this.imageHeight&&(this.imageHeight*=e),this.lastImage=void 0,this.fontSize*=e,this.iconSize*=e,typeof this.paddingLeft=="number"&&(this.paddingLeft*=e),typeof this.paddingTop=="number"&&(this.paddingTop*=e),typeof this.paddingRight=="number"&&(this.paddingRight*=e),typeof this.paddingBottom=="number"&&(this.paddingBottom*=e),this.rectInParent&&(typeof this.rectInParent.x=="number"&&(this.rectInParent.x*=e),typeof this.rectInParent.y=="number"&&(this.rectInParent.y*=e),typeof this.rectInParent.width=="number"&&(this.rectInParent.width*=e),typeof this.rectInParent.height=="number"&&(this.rectInParent.height*=e),typeof this.rectInParent.marginLeft=="number"&&(this.rectInParent.marginLeft*=e),typeof this.rectInParent.marginTop=="number"&&(this.rectInParent.marginTop*=e),typeof this.rectInParent.marginRight=="number"&&(this.rectInParent.marginRight*=e),typeof this.rectInParent.marginBottom=="number"&&(this.rectInParent.marginBottom*=e)),this.rect.calcCenter(),this.animateFrames&&this.animateFrames.length)for(var n=0,o=this.animateFrames;n<o.length;n++){var p=o[n];p.initState&&(p.initState.scale||(p.initState=new t(p.initState)),p.initState.scale(e,i)),p.state&&(p.state.scale||(p.state=new t(p.state)),p.state.scale(e,i)),p.initState&&p.state&&(p.state.fontSize=p.initState.fontSize)}if(this.scalePoints(e,e),this.elementRendered=!1,this.init(),this.children)for(var x=0,U=this.children;x<U.length;x++){var p=U[x];p.scale(e,i)}this.animateReady&&this.animateReady.scale&&this.animateReady.scale(e,i)},t.prototype.scalePoints=function(e,i){var n=this;(this.points||this.manualAnchors)&&this.oldRect&&(e||(e=this.rect.width/this.oldRect.width),i||(i=this.rect.height/this.oldRect.height),this.points&&this.points.forEach(function(o){o.x=n.rect.x+(o.x-n.oldRect.x)*e,o.y=n.rect.y+(o.y-n.oldRect.y)*i}),this.manualAnchors&&this.manualAnchors.forEach(function(o){o.x=n.rect.x+(o.x-n.oldRect.x)*e,o.y=n.rect.y+(o.y-n.oldRect.y)*i}))},t.prototype.translate=function(e,i){if(this.rect.x+=e,this.rect.y+=i,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calcCenter(),this.animateReady&&this.animateReady.translate(e,i),this.animateFrames&&this.animateFrames.length)for(var n=0,o=this.animateFrames;n<o.length;n++){var p=o[n],x=p.initState,U=p.state;x&&x.translate&&x.translate(e,i),U&&U.translate&&U.translate(e,i)}if(this.points&&this.points.forEach(function(lt){lt.x+=e,lt.y+=i}),this.manualAnchors&&this.manualAnchors.forEach(function(lt){lt.x+=e,lt.y+=i}),this.init(),this.children)for(var W=0,it=this.children;W<it.length;W++){var ht=it[W];ht.translate(e,i)}},t.prototype.initRect=function(){if(this.rect.init(),this.children){this.calcChildrenRect();for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n instanceof t&&n.initRect()}}},t.prototype.pushPoint=function(e){var i=this;this.points.push(e),this.rect||(this.rect=new a(0,0,0,0)),this.points.forEach(function(n){(!i.rect.x||i.rect.x>n.x)&&(i.rect.x=n.x),(!i.rect.y||i.rect.y>n.y)&&(i.rect.y=n.y),i.rect.ex<n.x&&(i.rect.ex=n.x),i.rect.ey<n.y&&(i.rect.ey=n.y)}),this.rect.width=this.rect.ex-this.rect.x,this.rect.height=this.rect.ey-this.rect.y},t.prototype.nearestAnchor=function(e){for(var i=99999,n=0,o=0;o<this.rotatedAnchors.length;++o){var p=We(e,this.rotatedAnchors[o]);i>p&&(i=p,n=o)}return{index:n,direction:this.rotatedAnchors[n].direction}},t.prototype.hitInSelf=function(e,i){if(i===void 0&&(i=0),this.rotate%360==0)return this.rect.hit(e,i);for(var n=this.rect.toPoints(),o=0,p=n;o<p.length;o++){var x=p[o];x.rotate(this.rotate,this.rect.center)}return c(e,n)},t.prototype.hit=function(e,i){i===void 0&&(i=0);var n;if(this.hitInSelf(e,i)&&(n=this),this.children)for(var o=this.children.length,p=o-1;p>-1;--p){var x=this.children[p],U=x.hit(e,i);if(U){n=U;break}}return n},t.prototype.round=function(){if(this.rect.round(),this.children)for(var e=0,i=this.children;e<i.length;e++){var n=i[e];n.rect.round()}},t.prototype.clone=function(){var e=new t(this);return e.setTID(this.TID),e.elementRendered=!1,e.elementLoaded=!1,this.name!=="div"&&(e.elementId=void 0),e},t}(O),jt;(function(r){r[r.None=0]="None",r[r.Readonly=1]="Readonly",r[r.NoMove=2]="NoMove",r[r.NoEvent=10]="NoEvent"})(jt||(jt={}));var Zt;(function(r){r[r.Default=0]="Default",r[r.In=1]="In",r[r.Out=2]="Out"})(Zt||(Zt={}));function qr(r){var t=document.createElement("div");return t.style.position="absolute",t.style.outline="none",t.style.left="-9999px",t.style.bottom="-9999px",t.style.width=r.rect.width+"px",t.style.height=r.rect.height+"px",r.elementId&&(t.id=r.elementId),t}function ki(r){var t=document.createElement("input");return t.style.position="absolute",t.style.outline="none",t.style.left="-9999px",t.style.bottom="-9999px",t.style.width=r.rect.width+"px",t.style.height=r.rect.height+"px",t.style.border="1px solid #cdcdcd",t.classList.add("set-text-input"),r.elementId&&(t.id=r.elementId),t}function Vr(r,t,e){var i=document.createElement("script");i.type="text/javascript",i.src=r,i.addEventListener("load",function(){t&&t(),e&&tt.Store.set("LT:render",!0)}),document.body.appendChild(i)}function Jt(r){for(var t=[],e=0,i=r;e<i.length;e++){var n=i[e];if(n instanceof At){var o=n.rect.toPoints();if(n.rotate)for(var p=0,x=o;p<x.length;p++){var U=x[p];U.rotate(n.rotate,n.rect.center)}t.push.apply(t,o)}else if(n instanceof Mt){if(n.children)n.children.forEach(function(Et){if(t.push(Et.from),t.push(Et.to),Array.isArray(Et.controlPoints)&&t.push.apply(t,Et.controlPoints),Et.name==="curve")for(var Bt=.01;Bt<1;Bt+=.02)t.push(Vt(Bt,Et.from,Et.controlPoints[0],Et.controlPoints[1],Et.to))});else if(n.from&&(t.push(n.from),t.push(n.to),Array.isArray(n.controlPoints)&&t.push.apply(t,n.controlPoints),n.name==="curve"))for(var W=.01;W<1;W+=.02)t.push(Vt(W,n.from,n.controlPoints[0],n.controlPoints[1],n.to))}}var it=ye(t),ht=it.x1,lt=it.y1,Lt=it.x2,It=it.y2;return new a(ht,lt,Lt-ht,It-lt)}function ye(r){for(var t=Infinity,e=Infinity,i=-Infinity,n=-Infinity,o=0,p=r;o<p.length;o++){var x=p[o],U=x.x,W=x.y;isNaN(U)||isNaN(W)||(t=Math.min(t,U),e=Math.min(e,W),i=Math.max(i,U),n=Math.max(n,W))}return{x1:t,y1:e,x2:i,y2:n}}function Yr(r,t){return!(r.x>t.ex||r.ex<t.x||r.ey<t.y||r.y>t.ey)}function Xr(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=new a(r[0].x,r[0].y,r[0].width,r[0].height),i=1;i<r.length;i++){var n=r[i];n&&(e.x>n.x&&(e.x=n.x),e.y>n.y&&(e.y=n.y),e.ex<n.ex&&(e.ex=n.ex),e.ey<n.ey&&(e.ey=n.ey))}return new a(e.x,e.y,e.ex-e.x,e.ey-e.y)}function Qr(){return/Android|webOS|iPad|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}function Gr(){var r=indexedDB.open("topology-caches");r.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains("caches")&&e.deleteObjectStore("caches"),e.createObjectStore("caches",{keyPath:"dbIndex"})},r.onsuccess=function(t){var e=r.result;if(!!e.objectStoreNames.contains("caches")){var i=e.transaction(["caches"],"readwrite").objectStore("caches");i.clear()}},r.onerror=function(t){console.warn("\u6570\u636E\u5E93\u6253\u5F00\u5931\u8D25"+t)}}function _e(r){var t=indexedDB.open("topology-caches");t.onsuccess=function(e){var i=t.result;if(!!i.objectStoreNames.contains("caches")){var n=i.transaction(["caches"],"readwrite").objectStore("caches");n.delete(IDBKeyRange.lowerBound(r))}},t.onupgradeneeded=function(e){var i=e.target.result;i.objectStoreNames.contains("caches")&&i.deleteObjectStore("caches"),i.createObjectStore("caches",{keyPath:"dbIndex"})}}function Jr(r,t,e){var i=indexedDB.open("topology-caches");i.onsuccess=function(n){var o=i.result;if(!!o.objectStoreNames.contains("caches")){var p=o.transaction(["caches"],"readwrite").objectStore("caches");r.dbIndex=t,p.add(r);var x=p.count();x.onsuccess=function(){x.result>e&&p.delete(t-e)}}},i.onupgradeneeded=function(n){var o=n.target.result;o.objectStoreNames.contains("caches")&&o.deleteObjectStore("caches"),o.createObjectStore("caches",{keyPath:"dbIndex"})}}function Ae(r){return new Promise(function(t,e){var i=indexedDB.open("topology-caches");i.onsuccess=function(n){var o=i.result;if(!o.objectStoreNames.contains("caches")){t(null);return}var p=o.transaction(["caches"]).objectStore("caches"),x=p.get(r);x.onsuccess=function(){t(x.result)}},i.onupgradeneeded=function(n){var o=n.target.result;o.objectStoreNames.contains("caches")&&o.deleteObjectStore("caches"),o.createObjectStore("caches",{keyPath:"dbIndex"})}})}function te(r,t){var e={pens:[],lineName:"curve",fromArrow:"",toArrow:"triangleSolid",scale:1,locked:jt.None,x:0,y:0};if(typeof r=="string"&&(r=JSON.parse(r)),e=Object.assign(e,r),e.pens=[],r){if(r.nodes){for(var i=0,n=r.nodes;i<n.length;i++){var o=n[i];o.TID=t,e.pens.push(new At(o))}for(var p=0,x=r.lines;p<x.length;p++){var o=x[p];o.TID=t,e.pens.push(new Mt(o))}}r.pens&&r.pens.forEach(function(W){t&&(W.TID=t),W.type?e.pens.push(new Mt(W)):e.pens.push(new At(W))}),r.bkImageRect&&(e.bkImageRect=new a(r.bkImageRect.x,r.bkImageRect.y,r.bkImageRect.width,r.bkImageRect.height))}if(e.mqttOptions){var U="";typeof e.mqttOptions=="object"?U=JSON.stringify(e.mqttOptions):U=e.mqttOptions+"",e.mqttOptions=JSON.parse(U)}else e.mqttOptions={clientId:wt()};return t&&tt.Store.set(t+"-topology-data",e),e}var re=function(){function r(t){var e=this;this.TID=t,this.subcribe=tt.Store.subscribe(this.generateStoreKey("topology-data"),function(i){e.data=i})}return r.prototype.generateStoreKey=function(t){return this.TID+"-"+t},r.prototype.destroy=function(){this.subcribe.unsubscribe()},r}(),Zr=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Ne=function(r){Zr(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,n)||this;return o.parentElem=e,o.options=i,o.canvas=document.createElement("canvas"),o.width=0,o.height=0,o.subcribe=tt.Store.subscribe(o.generateStoreKey("topology-data"),function(p){o.data=p}),o.canvas.style.position="absolute",o.canvas.style.left="0",o.canvas.style.top="0",o.canvas.style.outline="none",t.dpiRatio||(!i.extDpiRatio&&i.extDpiRatio!==0&&(window&&window.devicePixelRatio>1?i.extDpiRatio=.25:i.extDpiRatio=0),t.dpiRatio=(window?window.devicePixelRatio:0)+i.extDpiRatio,t.dpiRatio<1&&(t.dpiRatio=1)),o}return t.prototype.resize=function(e){e?(this.width=e.width|0,this.height=e.height|0):(this.options.width&&this.options.width!=="auto"?this.width=+this.options.width:this.width=this.parentElem.clientWidth,this.options.height&&this.options.height!=="auto"?this.height=+this.options.height:this.height=this.parentElem.clientHeight),this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width*t.dpiRatio|0,this.canvas.height=this.height*t.dpiRatio|0,this.canvas.getContext("2d").scale(t.dpiRatio,t.dpiRatio),tt.Store.set(this.generateStoreKey("LT:size"),{width:this.canvas.width,height:this.canvas.height})},t.prototype.render=function(){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.getDpiRatio=function(){return t.dpiRatio},t.prototype.destroy=function(){this.subcribe.unsubscribe()},t.dpiRatio=0,t}(re),$r=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),ti=function(r){$r(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,e,i,n)||this;return o.parentElem=e,o.options=i,o.activeLayer=tt.Store.get(o.generateStoreKey("LT:ActiveLayer")),o.hoverLayer=tt.Store.get(o.generateStoreKey("LT:HoverLayer")),o.animateLayer=tt.Store.get(o.generateStoreKey("LT:AnimateLayer")),tt.Store.set(o.generateStoreKey("LT:offscreen"),o.canvas),o}return t.prototype.render=function(){r.prototype.render.call(this);var e=this.canvas.getContext("2d");e.strokeStyle=this.options.color;for(var i=new a(-this.data.x,-this.data.y,this.width,this.height),n=0,o=this.data.pens;n<o.length;n++){var p=o[n];p.getTID()||p.setTID(this.TID),!(!Yr(p.rect,i)&&p.type===g.Node)&&p.render(e)}this.activeLayer.render(e),this.animateLayer.render(e),this.hoverLayer.render(e)},t}(Ne),ei=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),ri=function(r){ei(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,e,i,n)||this;return o.parentElem=e,o.options=i,o.render=function(){if(o.data&&o.data.bkImage&&!o.bkImg){o.loadBkImg(o.render);return}if(!(!o.width||!o.height||!o.offscreen)){var p=o.canvas.getContext("2d");p.clearRect(0,0,o.canvas.width,o.canvas.height),(o.data.bkColor||o.options.bkColor)&&(p.fillStyle=o.data.bkColor||o.options.bkColor,p.fillRect(0,0,o.width,o.height)),o.bkImg&&o.data.bkImageRect&&p.drawImage(o.bkImg,o.data.bkImageRect.x,o.data.bkImageRect.y,o.data.bkImageRect.width,o.data.bkImageRect.height),(o.data.grid||o.options.grid)&&o.grid(),(o.data.rule||o.options.rule)&&o.rule(),p.drawImage(o.offscreen,0,0,o.width,o.height)}},o.offscreen=tt.Store.get(o.generateStoreKey("LT:offscreen")),o.parentElem.appendChild(o.canvas),o.data=tt.Store.get(o.generateStoreKey("topology-data")),o}return t.prototype.loadBkImg=function(e){var i=this;!this.data.bkImage||(this.bkImg=new Image,this.bkImg.crossOrigin="anonymous",this.bkImg.src=this.data.bkImage,this.bkImg.onload=function(){i.data.bkImageRect||(i.data.bkImageRect=new a(0,0,i.bkImg.naturalWidth,i.bkImg.naturalHeight)),e&&e()})},t.prototype.clearBkImg=function(){this.bkImg=void 0},t.prototype.rule=function(){var e=this.canvas.getContext("2d");e.save(),e.lineWidth=1,e.strokeStyle=$t(.7,this.data.ruleColor||this.options.ruleColor||"#888"),e.beginPath();for(var i=10;i<this.width;i+=10)e.moveTo(i,0),e.lineTo(i,5);for(var i=10;i<this.height;i+=10)e.moveTo(0,i),e.lineTo(5,i);e.stroke(),e.beginPath(),e.strokeStyle=this.data.ruleColor||this.options.ruleColor||"#888",e.fillStyle=e.strokeStyle;for(var i=100;i<this.width;i+=100)e.moveTo(i,0),e.lineTo(i,10),e.fillText(i.toString(),i+4,16);for(var i=100;i<this.height;i+=100)e.moveTo(0,i),e.lineTo(10,i);e.stroke();for(var i=100;i<this.height;i+=100)e.save(),e.beginPath(),e.translate(16,i-4),e.rotate(270*Math.PI/180),e.fillText(i.toString(),0,0),e.restore();e.restore()},t.prototype.grid=function(){var e=this.canvas.getContext("2d");e.save(),e.lineWidth=1,e.strokeStyle=this.data.gridColor||this.options.gridColor||"#f3f3f3",e.beginPath();for(var i=this.data.gridSize||this.options.gridSize,n=i;n<this.width;n+=i)e.moveTo(n,0),e.lineTo(n,this.height);for(var n=i;n<this.height;n+=i)e.moveTo(0,n),e.lineTo(this.width,n);e.stroke(),e.restore()},t}(Ne),ii=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),ni=function(r){ii(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.hoverAnchorIndex=-1,n.dockLineX=0,n.dockLineY=0,tt.Store.set(n.generateStoreKey("LT:HoverLayer"),n),n}return t.prototype.lineTo=function(e,i){i===void 0&&(i="triangleSolid"),!(!this.line||this.line.locked)&&(this.line.setTo(e,i),(this.line.from.id||this.line.to.id)&&this.line.calcControlPoints(),tt.Store.set(this.generateStoreKey("pts-")+this.line.id,void 0),tt.Store.set(this.generateStoreKey("LT:updateLines"),[this.line]))},t.prototype.lineFrom=function(e){this.line.locked||(this.line.setFrom(e,this.line.fromArrow),(this.line.from.id||this.line.to.id)&&this.line.calcControlPoints(),tt.Store.set(this.generateStoreKey("pts-")+this.line.id,void 0),tt.Store.set(this.generateStoreKey("LT:updateLines"),[this.line]))},t.prototype.render=function(e){var i=this;if(!(this.data.locked===jt.NoEvent||this.options.hoverColor==="transparent")){if(e.fillStyle=this.options.hoverColor,e.save(),this.options.alwaysAnchor&&this.data.pens.forEach(function(p){if(p.type!==g.Line&&!p.hideAnchor){for(var x=0,U=p.rotatedAnchors;x<U.length;x++){var W=U[x];W.hidden||(e.beginPath(),e.arc(W.x,W.y,W.radius||i.options.anchorRadius,0,Math.PI*2),e.strokeStyle=W.strokeStyle||i.options.hoverColor,e.fillStyle=W.fillStyle||i.options.anchorFillStyle,e.fill(),e.stroke())}i.options.autoAnchor&&(e.beginPath(),e.arc(p.rect.center.x,p.rect.center.y,p.rect.center.radius||i.options.anchorRadius,0,Math.PI*2),e.strokeStyle=i.options.hoverColor,e.fillStyle=i.options.anchorFillStyle,e.fill(),e.stroke())}}),e.restore(),this.node&&!this.data.locked){if(this.node.getTID()||this.node.setTID(this.TID),this.root=this.getRoot(this.node)||this.node,this.root&&(e.save(),e.strokeStyle=this.options.dragColor,e.globalAlpha=.2,this.root.rotate&&(e.translate(this.root.rect.center.x,this.root.rect.center.y),e.rotate((this.root.rotate+this.root.offsetRotate)*Math.PI/180),e.translate(-this.root.rect.center.x,-this.root.rect.center.y)),e.beginPath(),e.strokeRect(this.root.rect.x,this.root.rect.y,this.root.rect.width,this.root.rect.height),e.restore()),!this.options.hideAnchor)for(var n=0;n<this.node.rotatedAnchors.length;++n)this.node.locked||this.node.hideAnchor||this.node.rotatedAnchors[n].hidden&&this.hoverAnchorIndex!==n||(e.beginPath(),e.arc(this.node.rotatedAnchors[n].x,this.node.rotatedAnchors[n].y,this.node.rotatedAnchors[n].radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.node.rotatedAnchors[n].strokeStyle||this.options.hoverColor,e.fillStyle=this.node.rotatedAnchors[n].fillStyle||this.options.anchorFillStyle,e.fill(),e.stroke());this.options.autoAnchor&&(e.beginPath(),e.arc(this.node.rect.center.x,this.node.rect.center.y,this.node.rect.center.radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.options.hoverColor,e.fillStyle=this.options.anchorFillStyle,e.fill(),e.stroke())}if(this.line&&!this.data.locked&&(this.root=this.getRoot(this.line),this.root&&(e.save(),e.strokeStyle=this.options.dragColor,e.globalAlpha=.2,this.root.rotate&&(e.translate(this.root.rect.center.x,this.root.rect.center.y),e.rotate((this.root.rotate+this.root.offsetRotate)*Math.PI/180),e.translate(-this.root.rect.center.x,-this.root.rect.center.y)),e.beginPath(),e.strokeRect(this.root.rect.x,this.root.rect.y,this.root.rect.width,this.root.rect.height),e.restore())),this.dockAnchor&&(e.save(),e.beginPath(),e.arc(this.dockAnchor.x,this.dockAnchor.y,this.dockAnchor.radius||this.options.anchorRadius,0,Math.PI*2),e.strokeStyle=this.options.dockStrokeStyle,e.fillStyle=this.options.dockFillStyle,e.fill(),e.stroke(),e.restore()),this.hoverLineCP&&(e.beginPath(),e.arc(this.hoverLineCP.x,this.hoverLineCP.y,5,0,Math.PI*2),e.fill()),e.strokeStyle=$t(.5,this.options.hoverColor),e.lineWidth=1,this.dockLineX>0){var o=tt.Store.get(this.generateStoreKey("LT:size"));e.beginPath(),e.moveTo(this.dockLineX,-this.data.y),e.lineTo(this.dockLineX,o.height),e.stroke()}if(this.dockLineY>0){var o=tt.Store.get(this.generateStoreKey("LT:size"));e.beginPath(),e.moveTo(-this.data.x,this.dockLineY),e.lineTo(o.width,this.dockLineY),e.stroke()}this.dragRect&&(e.fillStyle=$t(.2,this.options.dragColor),e.strokeStyle=this.options.dragColor,e.beginPath(),e.strokeRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height),e.fillRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height))}},t.prototype.getRoot=function(e){if(!e.parentId)return null;for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o.id===e.parentId){var p=this.getRoot(o);return p||o}}return null},t.prototype.clear=function(){this.node=void 0,this.line=void 0},t}(re),oi=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),si=function(r){oi(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.rotateCPs=[],n.sizeCPs=[],n.pens=[],n.rotate=0,n.lastOffsetX=0,n.lastOffsetY=0,n.initialSizeCPs=[],n.nodeRects=[],n.childrenRects={},n.childrenRotate={},n.dockWatchers=[],n.rotating=!1,tt.Store.set(n.generateStoreKey("LT:ActiveLayer"),n),n}return t.prototype.calcControlPoints=function(){if(this.pens.length===1&&this.pens[0]instanceof At){if(this.rect=this.pens[0].rect,this.sizeCPs=this.pens[0].rect.toPoints(),this.rotateCPs=[new P(this.pens[0].rect.x+this.pens[0].rect.width/2,this.pens[0].rect.y-35),new P(this.pens[0].rect.x+this.pens[0].rect.width/2,this.pens[0].rect.y)],this.rotate||this.pens[0].rotate){for(var e=0,i=this.sizeCPs;e<i.length;e++){var n=i[e];this.pens[0].rotate&&n.rotate(this.pens[0].rotate,this.pens[0].rect.center),this.rotate&&n.rotate(this.rotate,this.rect.center)}for(var o=0,p=this.rotateCPs;o<p.length;o++){var n=p[o];this.pens[0].rotate&&n.rotate(this.pens[0].rotate,this.pens[0].rect.center),this.rotate&&n.rotate(this.rotate,this.rect.center)}}(this.options.hideRotateCP||this.pens[0].hideRotateCP)&&(this.rotateCPs=[new P(-1e3,-1e3),new P(-1e3,-1e3)]);return}var x=ye(this.getPoints()),U=x.x1,W=x.y1,it=x.x2,ht=x.y2;this.rect=new a(U,W,it-U,ht-W),this.sizeCPs=[new P(U,W),new P(it,W),new P(it,ht),new P(U,ht)],this.rotateCPs=[new P(U+(it-U)/2,W-35),new P(U+(it-U)/2,W)],this.options.hideRotateCP&&(this.rotateCPs=[new P(-1e3,-1e3),new P(-1e3,-1e3)])},t.prototype.locked=function(){for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];if(!n.locked)return!1}return!0},t.prototype.getPoints=function(){for(var e=[],i=0,n=this.pens;i<n.length;i++){var o=n[i];if(o.type===g.Node){var p=o.rect.toPoints();if(o.rotate)for(var x=0,U=p;x<U.length;x++){var W=U[x];W.rotate(o.rotate,o.rect.center)}e.push.apply(e,p)}else if(o instanceof Mt){if(o.children)o.children.forEach(function(ht){if(e.push(ht.from),e.push(ht.to),ht.name==="curve")for(var lt=.01;lt<1;lt+=.02)e.push(Vt(lt,ht.from,ht.controlPoints[0],ht.controlPoints[1],ht.to))});else if(o.from&&(e.push(o.from),e.push(o.to),o.name==="curve"))for(var it=.01;it<1;it+=.02)e.push(Vt(it,o.from,o.controlPoints[0],o.controlPoints[1],o.to))}}return e},t.prototype.clear=function(){this.pens=[],this.sizeCPs=[],this.rotateCPs=[],tt.Store.set(this.generateStoreKey("LT:activeNode"),void 0)},t.prototype.saveNodeRects=function(){this.nodeRects=[],this.childrenRects={};for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];n.type&&n.from?this.nodeRects.push(new a(n.from.x,n.from.y,n.rect.width,n.rect.height)):this.nodeRects.push(new a(n.rect.x,n.rect.y,n.rect.width,n.rect.height)),this.saveChildrenRects(n)}this.initialSizeCPs=[];for(var o=0,p=this.sizeCPs;o<p.length;o++){var n=p[o];this.initialSizeCPs.push(n.clone())}this.getDockWatchers()},t.prototype.saveChildrenRects=function(e){if(!(e.type||!e.children))for(var i=0,n=e.children;i<n.length;i++){var o=n[i];this.childrenRects[o.id]=new a(o.rect.x,o.rect.y,o.rect.width,o.rect.height),this.childrenRotate[o.id]=o.rotate,this.saveChildrenRects(o)}},t.prototype.resize=function(e,i,n){var o=new P(i.x,i.y),p=new P(n.x,n.y);this.pens.length===1&&this.pens[0].rotate%360&&(o.rotate(-this.pens[0].rotate,this.nodeRects[0].center),p.rotate(-this.pens[0].rotate,this.nodeRects[0].center));var x=p.x-o.x,U=p.y-o.y,W=x-this.lastOffsetX,it=U-this.lastOffsetY;this.lastOffsetX=x,this.lastOffsetY=U;var ht=this.activeRect.width,lt=this.activeRect.height;switch(n.shiftKey&&(it=W*lt/ht),e){case 0:if(this.activeRect.width-W<5||this.activeRect.height-it<5)return;n.shiftKey?(W=-W,it=-it,this.activeRect.ex+=W,this.activeRect.ey+=it,this.activeRect.width+=W,this.activeRect.height+=it):(this.activeRect.x+=W,this.activeRect.y+=it,this.activeRect.width-=W,this.activeRect.height-=it);break;case 1:if(this.activeRect.width+W<5||this.activeRect.height-it<5)return;n.shiftKey?(this.activeRect.ex+=W,this.activeRect.ey+=it,this.activeRect.width+=W,this.activeRect.height+=it):(this.activeRect.ex+=W,this.activeRect.y+=it,this.activeRect.width+=W,this.activeRect.height-=it);break;case 2:if(this.activeRect.width+W<5||this.activeRect.height+it<5)return;this.activeRect.ex+=W,this.activeRect.ey+=it,this.activeRect.width+=W,this.activeRect.height+=it;break;case 3:if(this.activeRect.width-W<5||this.activeRect.height+it<5)return;n.shiftKey?(W=-W,it=-it,this.activeRect.ex+=W,this.activeRect.ey+=it,this.activeRect.width+=W,this.activeRect.height+=it):(this.activeRect.x+=W,this.activeRect.ey+=it,this.activeRect.width-=W,this.activeRect.height+=it);break}for(var Lt=this.activeRect.width/ht,It=this.activeRect.height/lt,Et=0,Bt=this.pens;Et<Bt.length;Et++){var yt=Bt[Et];if(!yt.locked){switch(yt.type){case g.Line:break;default:switch(yt.oldRect=yt.rect.clone(),!this.options.disableSizeX&&!n.ctrlKey&&!yt.disableSizeX&&(yt.rect.width*=Lt,yt.imageWidth&&(yt.imageWidth*=Lt)),!this.options.disableSizeY&&!n.altKey&&!yt.disableSizeY&&(yt.rect.height*=It,yt.imageHeight&&(yt.imageHeight*=It)),(!this.options.disableSizeX&&n.shiftKey&&!yt.disableSizeX||!this.options.disableSizeY&&n.shiftKey&&!yt.disableSizeY)&&(yt.rect.width*=Lt,yt.rect.height*=It,yt.imageWidth&&(yt.imageWidth*=Lt),yt.imageHeight&&(yt.imageHeight*=It)),e){case 0:yt.rect.x=yt.rect.ex-yt.rect.width,yt.rect.y=yt.rect.ey-yt.rect.height;break;case 1:yt.rect.ex=yt.rect.x+yt.rect.width,yt.rect.y=yt.rect.ey-yt.rect.height;break;case 2:yt.rect.ex=yt.rect.x+yt.rect.width,yt.rect.ey=yt.rect.y+yt.rect.height;break;case 3:yt.rect.x=yt.rect.ex-yt.rect.width,yt.rect.ey=yt.rect.y+yt.rect.height;break}yt.scalePoints(),yt.rect.calcCenter(),yt.init(),yt.calcChildrenRect();break}if(yt.parentId)for(var Xt=void 0,Yt=0,ie=this.data.pens;Yt<ie.length;Yt++){var ne=ie[Yt];if(ne.id===yt.parentId){Xt=ne,yt.calcRectInParent(Xt);break}}}}this.updateLines()},t.prototype.move=function(e,i){if(this.nodeRects.length===this.pens.length){for(var n=0,o=function(ht){if(ht.locked)return"continue";if(ht instanceof At){var lt=p.nodeRects[n].x+e-ht.rect.x,Lt=p.nodeRects[n].y+i-ht.rect.y;ht.translate(lt,Lt);for(var It=p.getLinesOfNode(ht),Et=0,Bt=It;Et<Bt.length;Et++){var yt=Bt[Et];yt.translate(lt,Lt)}if(ht.calcChildrenRect(),ht.parentId&&!ht.locked)for(var Xt=void 0,Yt=0,ie=p.data.pens;Yt<ie.length;Yt++){var ne=ie[Yt];if(ne.id===ht.parentId){Xt=ne,ht.calcRectInParent(Xt);break}}}if(ht instanceof Mt&&ht.from){var Oe=p.nodeRects[n].x+e-ht.from.x,Be=p.nodeRects[n].y+i-ht.from.y;if(ht.parentId){var mi=b(ht.parentId,p.data.pens);mi.forEach(function(wi){wi.translate(Oe,Be)})}else ht.translate(Oe,Be)}++n},p=this,x=0,U=this.pens;x<U.length;x++){var W=U[x];o(W)}this.updateLines(),this.topology.dispatch("move",this.pens)}},t.prototype.getLinesOfNode=function(e){for(var i=[],n=L([e]),o=0,p=this.data.pens;o<p.length;o++){var x=p[o];if(x instanceof Mt){for(var U=x,W=!1,it=!1,ht=0,lt=n.nodes;ht<lt.length;ht++){var Lt=lt[ht];U.from&&U.from.id===Lt.id&&(W=!0),U.to&&U.to.id===Lt.id&&(it=!0)}W&&it&&i.push(U)}}return i},t.prototype.updateLines=function(e){e||(e=this.pens);var i=L(this.data.pens),n=i.lines,o=i.nodes;this.options.autoAnchor||(o=L(e).nodes);for(var p=[],x=0,U=n;x<U.length;x++)for(var W=U[x],it=0,ht=o;it<ht.length;it++){var lt=ht[it],Lt=0;if(W.from&&W.from.id===lt.id){if(W.from.autoAnchor){var It=lt.nearestAnchor(W.to);It.index>-1&&(W.from.anchorIndex=It.index,W.from.direction=It.direction)}W.from.anchorIndex>=0&&(W.from.x=lt.rotatedAnchors[W.from.anchorIndex].x,W.from.y=lt.rotatedAnchors[W.from.anchorIndex].y,++Lt)}if(W.to&&W.to.id===lt.id){if(W.to.autoAnchor){var It=lt.nearestAnchor(W.from);It.index>-1&&(W.to.anchorIndex=It.index,W.to.direction=It.direction)}W.to.anchorIndex>=0&&(W.to.x=lt.rotatedAnchors[W.to.anchorIndex].x,W.to.y=lt.rotatedAnchors[W.to.anchorIndex].y,++Lt)}Lt&&!this.data.manualCps&&W.calcControlPoints(),W.textRect=void 0,tt.Store.set(this.generateStoreKey("pts-")+W.id,void 0),p.push(W)}tt.Store.set(this.generateStoreKey("LT:updateLines"),p)},t.prototype.offsetRotate=function(e){this.rotating=!0;for(var i=0,n=0,o=this.pens;n<o.length;n++){var p=o[n];if(p instanceof At){var x=this.nodeRects[i].center.clone();this.pens.length>1&&x.rotate(e,this.rect.center),p.rect.x=x.x-p.rect.width/2,p.rect.y=x.y-p.rect.height/2,p.rect.ex=p.rect.x+p.rect.width,p.rect.ey=p.rect.y+p.rect.height,p.rect.calcCenter(),p.init(),p.offsetRotate=e,p.calcRotateAnchors(p.rotate+p.offsetRotate),this.rotateChildren(p),++i}}this.rotate=e,this.topology.dispatch("rotated",this.pens)},t.prototype.rotateChildren=function(e){if(!(e.type!==g.Node||!e.children))for(var i=0,n=e.children;i<n.length;i++){var o=n[i];if(o.type===g.Node){var p=this.childrenRects[o.id].center.clone(),x=this.childrenRects[o.id].center.clone().rotate(this.rotate,this.rect.center),U=this.childrenRects[o.id].clone();U.translate(x.x-p.x,x.y-p.y),o.rect=U,o.rotate=this.childrenRotate[o.id]+this.rotate,o.init(),this.rotateChildren(o)}}},t.prototype.updateRotate=function(){for(var e=0,i=this.pens;e<i.length;e++){var n=i[e];n.rotate+=n.offsetRotate,n.type===g.Node&&n.rectInParent&&(n.rectInParent.rotate+=n.offsetRotate),n.offsetRotate=0}this.rotate=0,this.rotating=!1},t.prototype.add=function(e){this.has(e)||(this.pens.push(e),e instanceof At&&tt.Store.set(this.generateStoreKey("LT:activeNode"),e))},t.prototype.setPens=function(e){this.pens=e,this.pens.length===1&&this.pens[0]instanceof At&&tt.Store.set(this.generateStoreKey("LT:activeNode"),this.pens[0])},t.prototype.has=function(e){for(var i=0,n=this.pens;i<n.length;i++){var o=n[i];if(o.id===e.id)return!0}return!1},t.prototype.hasInAll=function(e,i){i||(i=this.pens);for(var n=0,o=i;n<o.length;n++){var p=o[n];if(p.id===e.id)return!0;if(p.children){var x=this.hasInAll(e,p.children);if(x)return!0}}return!1},t.prototype.render=function(e){var i=this;if(!(this.data.locked>jt.Readonly||this.options.activeColor==="transparent")&&!!this.pens.length){this.pens.forEach(function(lt){lt.getTID()||lt.setTID(i.TID)}),(this.pens.length===1||!this.rotating)&&this.calcControlPoints(),e.save(),e.strokeStyle=this.options.activeColor,e.fillStyle="#fff",e.lineWidth=1;for(var n=this.TID,o=tt.Store.get(this.generateStoreKey("LT:scale"))||1,p=0,x=this.pens;p<x.length;p++){var U=x[p];if(this.data.locked&&U instanceof At){var W=new At(U);W.setTID(n),W.data=void 0,W.fillStyle=void 0,W.bkType=0,W.icon="",W.image="",W.text="",W.strokeStyle!=="transparent"&&(W.strokeStyle="#ffffff",W.lineWidth+=2,W.render(e),W.strokeStyle=this.options.activeColor,W.lineWidth-=2),W.render(e)}if(U instanceof Mt){var W=new Mt(U);W.lineWidth*=2,W.toArrowSize=(W.toArrowSize*o-1.5*W.lineWidth)/o,W.fromArrowSize=(W.fromArrowSize*o-1.5*W.lineWidth)/o,W.setTID(n),W.strokeStyle=$t(.2,this.options.activeColor),W.borderWidth=4,W.borderColor=$t(.1,this.options.activeColor),W.fromArrowColor=this.options.activeColor,W.toArrowColor=this.options.activeColor,W.render(e),!this.data.locked&&!U.locked&&Nt[U.name]&&Nt[U.name].drawControlPointsFn(e,U)}}if(this.pens.length===1&&this.pens[0].type===g.Line){e.restore();return}if(this.rotate&&this.pens.length>1&&(e.translate(this.rect.center.x,this.rect.center.y),e.rotate(this.rotate*Math.PI/180),e.translate(-this.rect.center.x,-this.rect.center.y)),this.data.locked||this.locked()){e.restore();return}if(e.save(),e.globalAlpha=.3,e.translate(.5,.5),e.beginPath(),e.moveTo(this.sizeCPs[0].x,this.sizeCPs[0].y),e.lineTo(this.sizeCPs[1].x,this.sizeCPs[1].y),e.lineTo(this.sizeCPs[2].x,this.sizeCPs[2].y),e.lineTo(this.sizeCPs[3].x,this.sizeCPs[3].y),e.closePath(),e.stroke(),e.restore(),e.beginPath(),e.moveTo(this.rotateCPs[0].x,this.rotateCPs[0].y),e.lineTo(this.rotateCPs[1].x,this.rotateCPs[1].y),e.stroke(),e.beginPath(),e.arc(this.rotateCPs[0].x,this.rotateCPs[0].y,5,0,Math.PI*2),e.fill(),e.stroke(),!this.options.hideSizeCP&&(this.pens.length>1||!this.pens[0].hideSizeCP)){e.lineWidth=1;for(var it=0,ht=this.sizeCPs;it<ht.length;it++){var U=ht[it];e.save(),e.beginPath(),this.pens.length===1&&(this.pens[0].rotate||this.rotate)&&(e.translate(U.x,U.y),e.rotate((this.pens[0].rotate+this.rotate)*Math.PI/180),e.translate(-U.x,-U.y)),e.fillRect(U.x-4.5,U.y-4.5,8,8),e.strokeRect(U.x-5.5,U.y-5.5,10,10),e.restore()}}e.restore()}},t.prototype.calcActiveRect=function(){this.pens.length===1?(this.pens[0].rect.height===0&&(this.pens[0].rect.height=1),this.activeRect=m(this.pens[0].rect)):this.activeRect=Jt(this.pens)},t.prototype.getDockWatchers=function(){if(this.pens.length===1){this.dockWatchers=this.nodeRects[0].toPoints(),this.dockWatchers.unshift(this.nodeRects[0].center);return}!this.rect||(this.dockWatchers=this.rect.toPoints(),this.dockWatchers.unshift(this.rect.center))},t}(re),ai=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),hi=function(r){ai(t,r);function t(e,i){e===void 0&&(e={});var n=r.call(this,i)||this;return n.options=e,n.pens=new Map,n.lastNow=0,tt.Store.set(n.generateStoreKey("LT:AnimateLayer"),n),n.options.animateColor||(n.options.animateColor="#ff6600"),n.subscribeUpdate=tt.Store.subscribe(n.generateStoreKey("LT:updateLines"),function(o){n.updateLines(o)}),n.subscribePlay=tt.Store.subscribe(n.generateStoreKey("LT:AnimatePlay"),function(o){if(o.stop){if(o.tag){var p=b(o.tag,n.data.pens);p.forEach(function(x){n.pens.has(x.id)&&(n.pens.get(x.id).animateStart=0)})}o.pen&&n.pens.has(o.pen.id)&&(n.pens.get(o.pen.id).animateStart=0)}else o.pen&&(n.pens.has(o.pen.id)?n.pens.get(o.pen.id).animateStart=Date.now():o.pen.type?n.pens.set(o.pen.id,n.getAnimateLine(o.pen)):n.pens.set(o.pen.id,o.pen)),o.tag&&n.readyPlay(o.tag,!1);n.animate()}),n}return t.prototype.getAnimateLine=function(e){var i=new Mt(e);return i.data=i.id,i.id=wt(),i.setTID(this.TID),i.isAnimate=!0,i.toArrow="",i.fromArrow&&i.fromArrow.indexOf("line")<0&&(i.animateFromSize=i.fromArrowSize+i.lineWidth*5),i.toArrow&&i.toArrow.indexOf("line")<0&&(i.animateToSize=i.toArrowSize+i.lineWidth*5),i.animateStart=e.animateStart,i.lineCap="round",i.fillStyle="#fff",i.strokeStyle=i.animateColor||this.options.animateColor,i.length=i.getLen(),i.fromArrowColor||(i.fromArrowColor=i.strokeStyle||tt.Store.get(this.generateStoreKey("LT:color"))),i.toArrowColor||(i.toArrowColor=i.strokeStyle||tt.Store.get(this.generateStoreKey("LT:color"))),i},t.prototype.findLine=function(e){for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o.id===e.data)return o}},t.prototype.readyPlay=function(e,i,n){var o=this,p=new Map;n||(n=this.data.pens),n.forEach(function(x){x.setTID(o.TID),!(!x.visible||p.get(x.id))&&((i&&x.animatePlay||e&&x.tags.indexOf(e)>-1)&&(!x.animateStart||x.animateStart<1)&&(x.animateStart=Date.now()),x instanceof At?(x.animateStart>0&&(x.animateReady||x.initAnimate(),p.set(x.id,x)),x.children&&x.children.length&&o.readyPlay(e,i,x.children)):x.animateStart>0?p.set(x.id,o.getAnimateLine(x)):o.pens.has(x.id)&&(o.pens.get(x.id).animateStart=0))}),p.forEach(function(x){x.type?o.pens.set(x.data,x):o.pens.set(x.id,x)})},t.prototype.animate=function(){var e=this;this.timer&&cancelAnimationFrame(this.timer),this.timer=requestAnimationFrame(function(){var i=Date.now();if(i-e.lastNow<e.options.refresh){e.animate();return}e.lastNow=i;var n=!1;e.pens.forEach(function(o){if(!o.animateStart||o.animateStart<1){if(o.type){e.pens.delete(o.data);var p=e.findLine(o);p&&(p.animateStart=0,p.animatePos=o.animatePos)}else e.pens.delete(o.id);return}if(!(o.animateStart>i)){if(o.animateFn?typeof o.animateFn=="function"?o.animateFn():window&&window[o.animateFn]&&window[o.animateFn]():o.animate(i),o.animateStart<1){if(o.type?e.pens.delete(o.data):e.pens.delete(o.id),o.type===g.Line){var p=e.findLine(o);p&&(p.animateStart=0,p.animatePos=o.animatePos)}o.nextAnimate&&e.readyPlay(o.nextAnimate,!1)}n=!0}}),n&&(tt.Store.set(e.generateStoreKey("LT:render"),!0),e.animate())})},t.prototype.updateLines=function(e){this.pens.forEach(function(i,n){if(i instanceof Mt)for(var o=0,p=e;o<p.length;o++){var x=p[o];i.data===x.id&&(i.from=x.from,i.to=x.to,i.controlPoints=x.controlPoints,i.length=i.getLen())}})},t.prototype.render=function(e){var i=this;this.pens.forEach(function(n,o){n.visible&&n instanceof Mt&&(n.getTID()||n.setTID(i.TID),n.render(e))})},t.prototype.stop=function(){this.pens.clear(),this.timer&&(cancelAnimationFrame(this.timer),this.timer=null)},t.prototype.destroy=function(){this.stop(),this.subscribeUpdate.unsubscribe(),this.subscribePlay.unsubscribe()},t}(re),ci=function(){var r=function(e,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var p in o)o.hasOwnProperty(p)&&(n[p]=o[p])},r(e,i)};return function(t,e){r(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Ut={},li=function(r){ci(t,r);function t(e,i,n){i===void 0&&(i={});var o=r.call(this,n)||this;return o.parentElem=e,o.options=i,o.canvas=document.createElement("div"),o.player=document.createElement("div"),o.audios={},o.iframes={},o.elements={},o.gifs={},o.addDiv=function(p){if(p.audio&&(o.audios[p.id]&&o.audios[p.id].media.src!==p.audio&&(o.audios[p.id].media.src=p.audio),setTimeout(function(){o.setElemPosition(p,o.audios[p.id]&&o.audios[p.id].player||o.addMedia(p,"audio"))})),p.video&&(Ut[p.id]&&Ut[p.id].media.src!==p.video&&(Ut[p.id].media.src=p.video),setTimeout(function(){o.setElemPosition(p,Ut[p.id]&&Ut[p.id].player||o.addMedia(p,"video"))})),p.iframe&&(o.iframes[p.id]?(o.iframes[p.id].src!==p.iframe&&(o.iframes[p.id].src=p.iframe),o.setElemPosition(p,o.iframes[p.id])):(o.addIframe(p),setTimeout(function(){o.addDiv(p)}))),p.elementId&&(o.elements[p.id]||(o.elements[p.id]=document.getElementById(p.elementId),o.elements[p.id]&&o.canvas.appendChild(o.elements[p.id])),o.setElemPosition(p,o.elements[p.id])),p.gif&&(p.image.indexOf(".gif")<0?(p.gif=!1,o.canvas.removeChild(o.gifs[p.id]),o.gifs[p.id]=void 0):p.img&&(o.gifs[p.id]&&o.gifs[p.id].src!==p.image&&(o.gifs[p.id].src=p.image),o.setElemPosition(p,o.gifs[p.id]||o.addGif(p)))),p.children)for(var x=0,U=p.children;x<U.length;x++){var W=U[x];W.type!==g.Line&&o.addDiv(W)}},o.createPlayer=function(){o.player.style.position="fixed",o.player.style.outline="none",o.player.style.top="-99999px",o.player.style.height="40px",o.player.style.padding="10px 15px",o.player.style.background="rgba(200,200,200,.1)",o.player.style.display="flex",o.player.style.alignItems="center",o.player.style.userSelect="initial",o.player.style.pointerEvents="initial",o.player.style.zIndex="1",o.playBtn=document.createElement("i"),o.currentTime=document.createElement("span"),o.progress=document.createElement("div"),o.progressCurrent=document.createElement("div"),o.loop=document.createElement("i");var p=document.createElement("i");o.playBtn.className=o.options.playIcon,o.playBtn.style.fontSize="18px",o.playBtn.style.lineHeight="20px",o.playBtn.style.cursor="pointer",o.currentTime.style.padding="0 10px",o.currentTime.innerText="0 / 0",o.progress.style.position="relative",o.progress.style.flexGrow="1",o.progress.style.top="0",o.progress.style.height="4px",o.progress.style.background="#ccc",o.progress.style.borderRadius="2px",o.progress.style.overflow="hidden",o.progress.style.cursor="pointer",o.progressCurrent.style.position="absolute",o.progressCurrent.style.left="0",o.progressCurrent.style.top="0",o.progressCurrent.style.bottom="0",o.progressCurrent.style.width="0",o.progressCurrent.style.background="#52c41a",o.loop.style.margin="0 10px",o.loop.style.padding="2px 5px",o.loop.style.borderRadius="2px",o.loop.className=o.options.loopIcon,o.loop.style.fontSize="18px",o.loop.style.lineHeight="20px",o.loop.style.cursor="pointer",p.className=o.options.fullScreenIcon,p.style.fontSize="17px",p.style.lineHeight="20px",p.style.cursor="pointer",o.player.appendChild(o.playBtn),o.player.appendChild(o.currentTime),o.player.appendChild(o.progress),o.progress.appendChild(o.progressCurrent),o.player.appendChild(o.loop),o.player.appendChild(p),o.playBtn.onclick=function(){o.media.paused?(o.media.play(),o.playBtn.className=o.options.pauseIcon):(o.media.pause(),o.playBtn.className=o.options.playIcon)},o.progress.onclick=function(x){o.media.currentTime=x.offsetX/o.progress.clientWidth*o.media.duration},o.loop.onclick=function(){o.media.loop=!o.media.loop,o.curNode.playLoop=o.media.loop,o.media.loop?o.loop.style.background="#ddd":o.loop.style.background="none"},p.onclick=function(){o.media.requestFullscreen()}},o.getMediaCurrent=function(){!o.media||(o.currentTime.innerText=o.formatSeconds(o.media.currentTime)+" / "+o.formatSeconds(o.media.duration),o.progressCurrent.style.width=o.media.currentTime/o.media.duration*o.progress.clientWidth+"px")},o.addMedia=function(p,x){var U=document.createElement("div"),W=document.createElement("div"),it=document.createElement(x);return U.id=p.id,W.style.position="absolute",W.style.outline="none",W.style.left="0",W.style.bottom="0",W.style.height="2px",W.style.background="#52c41a",it.style.position="absolute",it.style.outline="none",it.style.left="0",it.style.right="0",it.style.top="0",it.style.bottom="0",x==="video"&&(it.style.width=p.rect.width+"px",it.style.height=p.rect.height+"px"),U.style.background="transparent",p.playType===1&&(it.autoplay=!0),it.loop=p.playLoop,it.ontimeupdate=function(){W.style.width=it.currentTime/it.duration*p.rect.width+"px",o.getMediaCurrent(),o.media===it&&(p.playLoop?(it.loop=!0,o.loop.style.background="#ddd"):(it.loop=!1,o.loop.style.background="none"))},it.onended=function(){tt.Store.set(o.generateStoreKey("mediaEnd"),p),o.media===it&&(o.playBtn.className=o.options.playIcon),o.play(p.nextPlay)},it.onloadedmetadata=function(){o.getMediaCurrent()},it.src=p[x],U.appendChild(it),U.appendChild(W),x==="video"?Ut[p.id]={player:U,current:W,media:it}:o.audios[p.id]={player:U,current:W,media:it},o.canvas.appendChild(U),U},o.setElemPosition=function(p,x){!x||(x.style.position="absolute",x.style.outline="none",x.style.left=p.rect.x+o.data.x+"px",x.style.top=p.rect.y+o.data.y+"px",x.style.width=p.rect.width+"px",x.style.height=p.rect.height+"px",x.style.display=p.visible?"inline":"none",(p.rotate!=null||p.offsetRotate!=null)&&(x.style.transform="rotate("+(p.rotate+p.offsetRotate)+"deg)"),p.video&&Ut[p.id]&&Ut[p.id].media&&(Ut[p.id].media.style.width="100%",Ut[p.id].media.style.height="100%"),o.data.locked>jt.None||p.locked>jt.None?(x.style.userSelect="initial",x.style.pointerEvents="initial"):(x.style.userSelect="none",x.style.pointerEvents="none"),p.globalAlpha<=1&&(x.style.opacity=String(p.globalAlpha)))},o.removeDiv=function(p){if(o.curNode&&p.id===o.curNode.id&&(o.curNode=void 0,o.media=void 0,o.player.style.top="-99999px"),p.audio&&(o.canvas.removeChild(o.audios[p.id].player),o.audios[p.id]=void 0),p.video&&(o.canvas.removeChild(Ut[p.id].player),Ut[p.id]=void 0),p.iframe&&(o.canvas.removeChild(o.iframes[p.id]),o.iframes[p.id]=void 0),p.elementId&&(o.canvas.removeChild(o.elements[p.id]),o.elements[p.id]=void 0,p.elementId=""),p.gif&&(o.canvas.removeChild(o.gifs[p.id]),o.gifs[p.id]=void 0),p.children)for(var x=0,U=p.children;x<U.length;x++){var W=U[x];W.type!==g.Line&&o.removeDiv(W)}},o.options.playIcon||(o.options.playIcon="t-icon t-play"),o.options.pauseIcon||(o.options.pauseIcon="t-icon t-pause"),o.options.fullScreenIcon||(o.options.fullScreenIcon="t-icon t-full-screen"),o.options.loopIcon||(o.options.loopIcon="t-icon t-loop"),o.canvas.style.position="absolute",o.canvas.style.left="0",o.canvas.style.top="0",o.canvas.style.outline="none",o.canvas.style.background="transparent",e.appendChild(o.canvas),e.appendChild(o.player),o.createPlayer(),o.subcribeDiv=tt.Store.subscribe(o.generateStoreKey("LT:addDiv"),o.addDiv),o.subcribeDiv=tt.Store.subscribe(o.generateStoreKey("LT:removeDiv"),o.removeDiv),o.subcribePlay=tt.Store.subscribe(o.generateStoreKey("LT:play"),function(p){o.playOne(p.pen,p.pause)}),o.subcribeNode=tt.Store.subscribe(o.generateStoreKey("LT:activeNode"),function(p){if(!p||!p.video&&!p.audio){o.player.style.top="-99999px";return}if(p.audio&&o.audios[p.id])o.media=o.audios[p.id].media;else if(p.video&&Ut[p.id])o.media=Ut[p.id].media;else return;o.curNode=p;var x=o.parentElem.getBoundingClientRect();o.player.style.top=x.top+o.parentElem.clientHeight-40+"px",o.player.style.left=x.left+"px",o.player.style.width=o.parentElem.clientWidth+"px",o.getMediaCurrent(),o.media.paused?o.playBtn.className=o.options.playIcon:o.playBtn.className=o.options.pauseIcon}),document.addEventListener("fullscreenchange",function(p){!o.media||(document.fullscreen?(o.media.controls=!0,o.media.style.userSelect="initial",o.media.style.pointerEvents="initial"):(o.media.style.userSelect="none",o.media.style.pointerEvents="none",o.media.controls=!1))}),o}return t.prototype.play=function(e,i){var n=this;if(!!e){var o=b(e,this.data.pens);o.forEach(function(p){n.playOne(p,i)})}},t.prototype.playOne=function(e,i){e.audio&&this.audios[e.id]&&this.audios[e.id].media?i?this.audios[e.id].media.pause():this.audios[e.id].media.paused&&this.audios[e.id].media.play():e.video&&Ut[e.id].media&&(i?Ut[e.id].media.pause():Ut[e.id].media.paused&&Ut[e.id].media.play())},t.prototype.addIframe=function(e){var i=document.createElement("iframe");return i.scrolling="no",i.frameBorder="0",i.src=e.iframe,this.iframes[e.id]=i,this.canvas.appendChild(i),i},t.prototype.addGif=function(e){return this.gifs[e.id]=e.img,this.canvas.appendChild(e.img),e.img},t.prototype.clear=function(e){if(this.canvas.innerHTML="",this.audios={},Ut={},this.iframes={},this.elements={},this.gifs={},!e)for(var i in T)delete T[i];this.player.style.top="-99999px"},t.prototype.formatSeconds=function(e){var i=Math.floor(e/3600),n=Math.floor(e/60)%60,o=Math.floor(e%60),p=o+"";return n?p=n+":"+o:p="0:"+o,i&&(p=i+":"+n+":"+o),p},t.prototype.resize=function(e){e?(this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px"):(this.options.width&&this.options.width!=="auto"?this.canvas.style.width=this.options.width+"px":this.canvas.style.width=this.parentElem.clientWidth+"px",this.options.height&&this.options.height!=="auto"?this.canvas.style.height=this.options.height+"px":this.canvas.style.height=this.parentElem.clientHeight-8+"px")},t.prototype.render=function(){for(var e=0,i=this.data.pens;e<i.length;e++){var n=i[e];n.getTID()||n.setTID(this.TID),this.addDiv(n)}},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.clear(),this.subcribeDiv.unsubscribe(),this.subcribeNode.unsubscribe(),this.subcribePlay.unsubscribe()},t}(re),ve=function(t){var e=0,i=0,n=0,o=0;if(typeof t=="number")e=i=n=o=t;else if(typeof t=="string"){var p=parseInt(t,10);e=i=n=o=p}else Array.isArray(t)&&(e=t[0],n=ge(t[1])?t[0]:t[1],o=ge(t[2])?t[0]:t[2],i=ge(t[3])?n:t[3]);return[e,n,o,i]};function ge(r){return r==null}var ui=function(){function r(t,e){this.url=t,this.cb=e,this.fns={},this.init()}return r.prototype.init=function(){var t=this;this.socket=new WebSocket(this.url),this.socket.onmessage=this.cb,this.socket.onclose=function(){console.info("Canvas websocket closed and reconneting..."),t.init()}},r.prototype.close=function(){this.socket.onclose=void 0,this.socket.close()},r}(),fi=ct(99053),di=function(){function r(t,e,i,n){this.url=t,this.options=e,this.topics=i,this.cb=n,this.fns={},this.init()}return r.prototype.init=function(){this.client=fi.connect(this.url,this.options),this.client.on("message",this.cb),this.topics&&this.client.subscribe(this.topics.split(","))},r.prototype.publish=function(t,e){this.client.publish(t,e)},r.prototype.close=function(){this.client.end()},r}(),pi={i8:"0.5.36"},yi=function(){function r(t){var e=this;this.parent=t,this.onMouseDownH=function(p){p.preventDefault(),p.stopPropagation(),e.isDownH=p.x,e.x=e.parent.data.x||0,e.lastScrollX=e.scrollX},this.onMouseDownV=function(p){p.preventDefault(),p.stopPropagation(),e.isDownV=p.y,e.y=e.parent.data.y||0,e.lastScrollY=e.scrollY},this.onMouseMove=function(p){if(e.isDownH){var x=p.x-e.isDownH;e.scrollX=e.lastScrollX+x,e.h.style.left=e.scrollX+"px",e.parent.data.x=e.x-x*e.rect.width/e.parent.parentElem.clientWidth}if(e.isDownV){var U=p.y-e.isDownV;e.scrollY=e.lastScrollY+U,e.v.style.top=e.scrollY+"px",e.parent.data.y=e.y-U*e.rect.height/e.parent.parentElem.clientHeight}(e.isDownH||e.isDownV)&&(e.parent.render(),e.parent.divLayer.render())},this.onMouseUp=function(p){!e.isDownH&&!e.isDownV||(e.isDownH=void 0,e.isDownV=void 0,e.scrollX<20?(e.scrollX=20,e.h.style.left=e.scrollX+"px"):e.scrollX>e.parent.parentElem.clientWidth-e.hSize-20&&(e.scrollX=e.parent.parentElem.clientWidth-e.hSize-20,e.h.style.left=e.scrollX+"px"),e.scrollY<20?(e.scrollY=20,e.v.style.top=e.scrollY+"px"):e.scrollY>e.parent.parentElem.clientHeight-e.vSize-20&&(e.scrollY=e.parent.parentElem.clientHeight-e.vSize-20,e.v.style.top=e.scrollY+"px"),e.resize())},this.h=document.createElement("div"),this.v=document.createElement("div"),this.parent.parentElem.appendChild(this.h),this.parent.parentElem.appendChild(this.v),this.h.className="topology-scroll h",this.h.onmousedown=this.onMouseDownH,this.v.className="topology-scroll v",this.v.onmousedown=this.onMouseDownV,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp);for(var i,n=0;n<document.styleSheets.length;n++)document.styleSheets[n].title==="le5le/scroll"&&(i=document.styleSheets[n]);if(!i){var o=document.createElement("style");o.type="text/css",o.title="le5le.com/scroll",document.head.appendChild(o),o=document.createElement("style"),o.type="text/css",document.head.appendChild(o),i=o.sheet,i.insertRule(".topology-scroll{position:absolute;width:8px;height:200px;background:#dddddd;border-radius:10px;z-index:20;cursor:default;}"),i.insertRule(".topology-scroll:hover{background:#cccccc;cursor:pointer}"),i.insertRule(".topology-scroll.v{right:0;top:calc(50% - 100px);}"),i.insertRule(".topology-scroll.h{bottom:2px;left:calc(50% - 100px);width:200px;height:8px;}")}this.init()}return r.prototype.init=function(){this.resize(),this.initPos()},r.prototype.initPos=function(){this.scrollX=(this.parent.parentElem.clientWidth-this.hSize)/2,this.scrollY=(this.parent.parentElem.clientHeight-this.vSize)/2,this.h.style.left=this.scrollX+"px",this.v.style.top=this.scrollY+"px"},r.prototype.resize=function(){this.rect=Jt(this.parent.data.pens),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.parent.data.x>0?this.rect.width+=this.parent.data.x+(this.rect.x>0?0:this.rect.x):this.rect.width-=this.parent.data.x+(this.rect.x>0?0:this.rect.x),this.parent.data.y>0?this.rect.height+=this.parent.data.y+(this.rect.y>0?0:this.rect.y):this.rect.height-=this.parent.data.y+(this.rect.y>0?0:this.rect.y),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.hSize=1e3*this.parent.parentElem.clientWidth/this.rect.width/3,this.vSize=1e3*this.parent.parentElem.clientHeight/this.rect.height/3,this.h.style.width=this.hSize+"px",this.v.style.height=this.vSize+"px"},r.prototype.show=function(){this.isShow=!0,this.h.style.display="block",this.v.style.display="block",document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},r.prototype.hide=function(){this.isShow=!1,this.h.style.display="none",this.v.style.display="none",this.destroy()},r.prototype.translate=function(t,e){t&&(this.scrollX-=t*this.parent.parentElem.clientWidth/this.rect.width,this.h.style.left=this.scrollX+"px"),e&&(this.scrollY-=e*this.parent.parentElem.clientHeight/this.rect.height,this.v.style.top=this.scrollY+"px")},r.prototype.wheel=function(t){var e=10;t&&(e=-10),this.scrollY+=e,this.v.style.top=this.scrollY+"px",this.parent.data.y-=e*this.rect.height/this.parent.parentElem.clientHeight,this.parent.render(),this.parent.divLayer.render()},r.prototype.destroy=function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},r}(),ee=function(){return ee=Object.assign||function(r){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},ee.apply(this,arguments)},vi=["nw-resize","ne-resize","se-resize","sw-resize"],kt;(function(r){r[r.None=0]="None",r[r.Line=1]="Line",r[r.LineFrom=2]="LineFrom",r[r.LineTo=3]="LineTo",r[r.LineControlPoint=4]="LineControlPoint",r[r.Nodes=5]="Nodes",r[r.ResizeCP=6]="ResizeCP",r[r.HoverAnchors=7]="HoverAnchors",r[r.AutoAnchor=8]="AutoAnchor",r[r.Rotate=9]="Rotate",r[r.GraffitiReady=10]="GraffitiReady",r[r.Graffiti=11]="Graffiti",r[r.LinesReady=12]="LinesReady",r[r.Lines=13]="Lines"})(kt||(kt={}));var Me=10,gi=function(){function r(t,e){var i=this;e===void 0&&(e={}),this.VERSION=pi.i8,this.id=wt(),this.data=te(void 0,this.id),this.caches={index:0,dbIndex:0,list:[]},this.touchStart=0,this.input=document.createElement("textarea"),this.lastTranlated={x:0,y:0},this.moveIn={type:kt.None,activeAnchorIndex:0,hoverAnchorIndex:0,hoverNode:void 0,hoverLine:void 0,activeNode:void 0,lineControlPoint:void 0},this.needCache=!1,this.tip="",this.scheduledAnimationFrame=!1,this.scrolling=!1,this.rendering=!1,this.alreadyCopy=!1,this.onScroll=function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},this.preventDefault=function(n){n.preventDefault()},this.winResize=function(){var n;n&&clearTimeout(n),n=setTimeout(function(){i.resize()},100)},this.calibrateMouse=function(n){return n.x-=i.data.x,n.y-=i.data.y,n},this.subscribeSocket=function(){if(!i.data.socketFn)return!1;i.data.socketEvent||(i.data.socketEvent=!0);try{var n=new Function("e",i.data.socketFn);i.socketFn&&(i.off("websocket",i.socketFn),i.off("mqtt",i.socketFn)),i.on("websocket",n),i.on("mqtt",n),i.socketFn=n}catch(o){return console.error("Create the function for socket:",o),!1}return!0},this.onMouseMove=function(n){var o;if(!(i.scheduledAnimationFrame||((o=i.data)===null||o===void 0?void 0:o.locked)===jt.NoEvent)){if(i.mouseDown&&!i.mouseDown.restore&&n.buttons!==1&&n.buttons!==2){i.onmouseup(n);return}if(i.mouseDown&&(i.data.locked||i.spaceDown||!i.moveIn.type)){var p=!!i.data.locked;switch(i.options.translateKey){case dt.Right:n.buttons==2&&(p=!0);break;case dt.Any:p=!0;break;case dt.Ctrl:n.ctrlKey&&(p=!0);break;case dt.Shift:n.shiftKey&&(p=!0);break;case dt.Alt:n.altKey&&(p=!0);break;default:(n.ctrlKey||n.altKey||n.buttons==2)&&(p=!0)}if(i.spaceDown||!i.options.disableTranslate&&p&&i.data.locked<jt.NoMove)return i.translate(n.x,n.y,!0),!1}i.data.locked&&i.mouseDown||(i.scheduledAnimationFrame=!0,i.raf&&cancelAnimationFrame(i.raf),i.raf=requestAnimationFrame(function(){i.raf=void 0;var x=i.calibrateMouse({x:n.x,y:n.y});if(i.moveIn.type===kt.Lines){i.hoverLayer.line&&(i.hoverLayer.lineTo(new P(x.x,x.y),""),n.shiftKey||n.ctrlKey||n.altKey||n.buttons==2?(i.hoverLayer.line.name="curve",i.hoverLayer.line.calcControlPoints()):i.hoverLayer.line.name="line",i.render()),i.scheduledAnimationFrame=!1;return}if(!i.mouseDown){i.getMoveIn(x),i.moveIn.hoverNode!==i.lastHoverNode&&(i.lastHoverNode&&(i.lastHoverNode.moveOut(),i.dispatch("moveOutNode",i.lastHoverNode),i.hideTip(),i.hoverLayer.node=void 0),i.moveIn.hoverNode&&(i.hoverLayer.node=i.moveIn.hoverNode,i.moveIn.hoverNode.moveIn(),i.dispatch("moveInNode",Object.assign(i.moveIn.hoverNode,{evs:{x:n.pageX,y:n.pageY}})),i.showTip(i.moveIn.hoverNode,x))),i.moveIn.hoverLine!==i.lastHoverLine&&!i.moveIn.hoverNode&&(i.lastHoverLine&&(i.lastHoverLine.moveOut(),i.dispatch("moveOutLine",i.lastHoverLine),i.hideTip()),i.moveIn.hoverLine&&(i.hoverLayer.line=i.moveIn.hoverLine,i.moveIn.hoverLine.moveIn(),i.dispatch("moveInLine",Object.assign(i.moveIn.hoverLine,{evs:{x:n.pageX,y:n.pageY}})),i.showTip(i.moveIn.hoverLine,x))),i.moveIn.type===kt.LineControlPoint?i.hoverLayer.hoverLineCP=i.moveIn.lineControlPoint:i.hoverLayer.hoverLineCP&&(i.hoverLayer.hoverLineCP=void 0),(i.moveIn.hoverNode!==i.lastHoverNode||i.moveIn.type===kt.HoverAnchors||i.hoverLayer.lasthoverLineCP!==i.hoverLayer.hoverLineCP)&&(i.hoverLayer.lasthoverLineCP=i.hoverLayer.hoverLineCP,i.render()),i.scheduledAnimationFrame=!1;return}var U=n.x+50>i.parentElem.clientWidth+i.parentElem.scrollLeft,W=n.y+50>i.parentElem.clientHeight+i.parentElem.scrollTop;if(!i.options.disableMoveOutParent&&(U||W)){i.dispatch("moveOutParent",n);var it=0,ht=0;n.x+50>i.divLayer.canvas.clientWidth&&(it=-5),n.y+50>i.divLayer.canvas.clientHeight&&(ht=-5),i.translate(it,ht,!1)}switch(i.hideTip(),i.moveIn.type){case kt.None:i.hoverLayer.dragRect=new a(i.mouseDown.x-i.data.x,i.mouseDown.y-i.data.y,n.x-i.mouseDown.x,n.y-i.mouseDown.y);break;case kt.Nodes:if(i.activeLayer.locked()||i.data.locked)break;if(n.ctrlKey&&!i.alreadyCopy)i.alreadyCopy=!0,i.copy(),i.paste(),i.needCache=!0;else{var it=n.x-i.mouseDown.x,ht=n.y-i.mouseDown.y;if(it||ht){var lt=i.getDockPos(it,ht,n.ctrlKey||n.shiftKey||n.altKey);i.activeLayer.move(lt.x?lt.x:it,lt.y?lt.y:ht),i.needCache=!0}}break;case kt.ResizeCP:{var it=n.x-i.mouseDown.x,ht=n.y-i.mouseDown.y;if(it||ht){var lt=i.getDockPos(it,ht,n.ctrlKey||n.shiftKey||n.altKey),Lt=Object.assign({},n);lt.x&&(Lt.x=lt.x+i.mouseDown.x),lt.y&&(Lt.y=lt.y+i.mouseDown.y),i.activeLayer.resize(i.moveIn.activeAnchorIndex,i.mouseDown,Lt),i.dispatch("resizePens",i.activeLayer.pens),i.needCache=!0}break}case kt.LineTo:case kt.HoverAnchors:case kt.AutoAnchor:if(i.hoverLayer.dockAnchor&&i.hoverLayer.dockAnchor.hit(n,10))break;var It=i.data.toArrow;i.moveIn.hoverLine&&(It=i.moveIn.hoverLine.toArrow),i.hoverLayer.line&&(It=i.hoverLayer.line.toArrow),i.hoverLayer.line&&(i.activeLayer.pens=[i.hoverLayer.line]);var Et=i.hoverLayer.line.to.id;if(n.ctrlKey||n.shiftKey||n.altKey)i.hoverLayer.lineTo(new P(x.x,x.y),It);else{var Bt=i.getLineDock(new P(x.x,x.y),Zt.In);Et=Bt.id,i.hoverLayer.lineTo(Bt,It)}if(i.hoverLayer.line.to.id=Et,i.hoverLayer.line.parentId){var yt=i.find(Et);yt&&yt.from&&(yt.from.x=i.hoverLayer.line.to.x,yt.from.y=i.hoverLayer.line.to.y)}i.needCache=!0;break;case kt.LineFrom:var Xt=i.hoverLayer.line.from.id;if(n.ctrlKey||n.shiftKey||n.altKey)i.hoverLayer.lineFrom(new P(x.x,x.y));else{var Yt=i.getLineDock(new P(x.x,x.y),Zt.Out);Xt=Yt.id,i.hoverLayer.lineFrom(Yt)}if(i.hoverLayer.line.from.id=Xt,i.hoverLayer.line.parentId){var yt=i.find(Xt);yt&&yt.to&&(yt.to.x=i.hoverLayer.line.from.x,yt.to.y=i.hoverLayer.line.from.y)}i.needCache=!0;break;case kt.Line:{var it=n.x-i.mouseDown.x,ht=n.y-i.mouseDown.y;(it||ht)&&(i.activeLayer.move(it,ht),i.hoverLayer.line.children?i.animateLayer.updateLines(i.hoverLayer.line.children):i.animateLayer.updateLines([i.hoverLayer.line]),i.needCache=!0)}break;case kt.LineControlPoint:i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id].x=x.x,i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id].y=x.y,i.moveIn.hoverLine.textRect=void 0,Nt[i.moveIn.hoverLine.name]&&Nt[i.moveIn.hoverLine.name].dockControlPointFn&&Nt[i.moveIn.hoverLine.name].dockControlPointFn(i.moveIn.hoverLine.controlPoints[i.moveIn.lineControlPoint.id],i.moveIn.hoverLine),i.needCache=!0,tt.Store.set(i.generateStoreKey("LT:updateLines"),[i.moveIn.hoverLine]);break;case kt.Rotate:i.activeLayer.pens.length&&(i.activeLayer.offsetRotate(i.getAngle(x)),i.activeLayer.updateLines()),i.needCache=!0;break;case kt.Graffiti:i.moveIn.hoverNode.pushPoint(new P(x.x,x.y));break}i.render(),i.scheduledAnimationFrame=!1}))}},this.onmousedown=function(n){if(!(n.button!==0&&n.button!==2)){switch(i.mouseDown=n,n.altKey&&(i.divLayer.canvas.style.cursor="move"),i.inputObj&&i.setNodeText(),i.moveIn.type){case kt.None:i.activeLayer.clear(),i.hoverLayer.clear(),i.dispatch("space",i.mouseDown);break;case kt.Line:case kt.LineControlPoint:n.ctrlKey||n.shiftKey?(i.activeLayer.add(i.moveIn.hoverLine),i.dispatch("multi",i.activeLayer.pens)):(i.activeLayer.pens=[i.moveIn.hoverLine],i.dispatch("line"+(n.button===2?"RightClick":""),Object.assign(i.moveIn.hoverLine,{evs:{x:n.pageX,y:n.pageY}}))),i.hoverLayer.line=i.moveIn.hoverLine,i.hoverLayer.initLine=new Mt(i.moveIn.hoverLine),(i.data.locked||i.moveIn.hoverLine.locked)&&i.moveIn.hoverLine.click();break;case kt.LineFrom:case kt.LineTo:i.activeLayer.pens=[i.moveIn.hoverLine],i.dispatch("line",i.moveIn.hoverLine),i.hoverLayer.line=i.moveIn.hoverLine;break;case kt.HoverAnchors:i.hoverLayer.line=i.addLine({name:i.data.lineName,from:new P(i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].x,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].y,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].direction,i.moveIn.hoverAnchorIndex,i.moveIn.hoverNode.id),fromArrow:i.data.fromArrow,to:new P(i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].x,i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex].y),toArrow:i.data.toArrow,strokeStyle:i.options.color,lineWidth:i.data.lineWidth}),i.dispatch("anchor",{anchor:i.moveIn.hoverNode.rotatedAnchors[i.moveIn.hoverAnchorIndex],anchorIndex:i.moveIn.hoverAnchorIndex,node:i.moveIn.hoverNode,line:i.hoverLayer.line});break;case kt.AutoAnchor:i.hoverLayer.line=i.addLine({name:i.data.lineName,from:new P(i.moveIn.hoverNode.rect.center.x,i.moveIn.hoverNode.rect.center.y,A.None,0,i.moveIn.hoverNode.id),fromArrow:i.data.fromArrow,to:new P(i.moveIn.hoverNode.rect.center.x,i.moveIn.hoverNode.rect.center.y),toArrow:i.data.toArrow,strokeStyle:i.options.color,lineWidth:i.data.lineWidth}),i.hoverLayer.line.from.autoAnchor=!0,i.dispatch("nodeCenter",i.moveIn.hoverNode);break;case kt.Nodes:if(!i.moveIn.activeNode)break;n.ctrlKey||n.shiftKey?i.moveIn.hoverNode&&i.activeLayer.hasInAll(i.moveIn.hoverNode)?(i.activeLayer.setPens([i.moveIn.hoverNode]),i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.hoverNode)):i.activeLayer.has(i.moveIn.activeNode)||(i.activeLayer.add(i.moveIn.activeNode),i.activeLayer.pens.length>1?i.dispatch("multi",i.activeLayer.pens):i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.activeNode)):n.altKey?i.moveIn.hoverNode?(i.activeLayer.setPens([i.moveIn.hoverNode]),i.dispatch("node"+(n.button===2?"RightClick":""),i.moveIn.hoverNode)):i.moveIn.hoverLine&&(i.activeLayer.setPens([i.moveIn.hoverLine]),i.dispatch("line",i.moveIn.hoverLine)):i.activeLayer.pens.length<2&&(i.activeLayer.setPens([i.moveIn.activeNode]),i.dispatch("node"+(n.button===2?"RightClick":""),Object.assign(i.moveIn.activeNode,{evs:{x:n.pageX,y:n.pageY}}))),(i.data.locked||i.moveIn.activeNode.locked)&&i.moveIn.activeNode.click(),i.activeLayer.calcActiveRect();break;case kt.Graffiti:var o=i.calibrateMouse({x:n.x,y:n.y});i.moveIn.hoverNode.pushPoint(new P(o.x,o.y));break}i.activeLayer.pens.length&&i.activeLayer.saveNodeRects(),i.render()}},this.onmouseup=function(n){if(!!i.mouseDown){if(i.mouseDown=void 0,i.lastTranlated.x=0,i.lastTranlated.y=0,i.hoverLayer.dockAnchor=void 0,i.hoverLayer.dockLineX=0,i.hoverLayer.dockLineY=0,i.divLayer.canvas.style.cursor="default",i.alreadyCopy=!1,i.hoverLayer.dragRect)i.getPensInRect(i.hoverLayer.dragRect),i.activeLayer.pens&&i.activeLayer.pens.length>1?i.dispatch("multi",i.activeLayer.pens):i.activeLayer.pens&&i.activeLayer.pens[0]&&i.activeLayer.pens[0].type===g.Line?i.dispatch("line"+(n.button===2?"RightClick":""),i.activeLayer.pens[0]):i.activeLayer.pens&&i.activeLayer.pens[0]&&i.activeLayer.pens[0].type===g.Node&&i.dispatch("node"+(n.button===2?"RightClick":""),i.activeLayer.pens[0]),i.activeLayer.calcActiveRect();else{var o=i.calibrateMouse({x:n.x,y:n.y});switch(i.moveIn.type){case kt.Nodes:if(n.ctrlKey&&n.shiftKey&&n.altKey){i.moveIn.hoverNode.manualAnchors||(i.moveIn.hoverNode.manualAnchors=[]);var p=new P(o.x,o.y);p.id=i.moveIn.hoverNode.id,i.moveIn.hoverNode.manualAnchors.push(p),i.moveIn.hoverNode.calcAnchors(),i.needCache=!0}(i.data.locked||i.moveIn.activeNode.locked)&&i.moveIn.activeNode.mouseUp();break;case kt.Line:case kt.LineControlPoint:(i.data.locked||i.moveIn.hoverLine.locked)&&i.moveIn.hoverLine.mouseUp();break;case kt.HoverAnchors:if(i.hoverLayer.line){var x=void 0,U=i.hoverLayer.line,W=U.from,it=U.to;if(i.hoverLayer.line.to.id){if(!i.options.disableRepeatLine)x=!0;else{var ht=i.data.pens.filter(function(It){return It.type===g.Line&&It.from.isSameAs(i.hoverLayer.line.from)&&It.to.isSameAs(i.hoverLayer.line.to)});x=ht.length<=1}W.id===it.id&&W.anchorIndex===it.anchorIndex&&(x=!1)}else x=!i.options.disableEmptyLine&&!i.hoverLayer.line.disableEmptyLine,x=x&&Math.pow(W.x-it.x,2)+Math.pow(W.y-it.y,2)>25;x?(i.activeLayer.pens=[i.hoverLayer.line],i.dispatch("addLine",i.hoverLayer.line)):(i.data.pens.pop(),i.activeLayer.clear())}i.offscreen.render(),i.hoverLayer.line=void 0;break;case kt.AutoAnchor:(i.hoverLayer.line.disableEmptyLine||i.options.disableEmptyLine)&&(!i.hoverLayer.line.from.id||!i.hoverLayer.line.to.id)?(i.needCache=!0,i.activeLayer.clear(),i.data.pens.splice(i.findIndex(i.hoverLayer.line),1)):(i.activeLayer.updateLines(),i.dispatch("addLine",i.hoverLayer.line));break;case kt.Rotate:i.activeLayer.updateRotate();break;case kt.LineControlPoint:tt.Store.set(i.generateStoreKey("pts-")+i.moveIn.hoverLine.id,void 0);break;case kt.LineFrom:case kt.LineTo:(i.hoverLayer.line.disableEmptyLine||i.options.disableEmptyLine)&&(!i.hoverLayer.line.from.id||!i.hoverLayer.line.to.id)&&(i.needCache=!0,i.activeLayer.clear(),i.data.pens.splice(i.findIndex(i.hoverLayer.line),1)),i.hoverLayer.line.from.id&&i.hoverLayer.line.to.id&&i.dispatch("lineOn",Object.assign(i.hoverLayer.line,{lineOnDirection:i.moveIn.type}));break;case kt.Graffiti:!i.moveIn.hoverNode.points||i.moveIn.hoverNode.points.length<2?(i.moveIn.type=kt.None,i.data.pens.pop()):(i.moveIn.type=kt.Nodes,i.moveIn.hoverNode.doing=void 0,i.moveIn.hoverNode.calcAnchors(),i.activeLayer.setPens([i.moveIn.hoverNode]),i.hoverLayer.node=i.moveIn.hoverNode,i.needCache=!0);break;case kt.Lines:var lt=void 0;i.moveIn.hoverLine.children&&i.moveIn.hoverLine.children.length&&(lt=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1]),lt||(i.moveIn.hoverLine.children=[]);var Lt=new Mt({parentId:i.moveIn.hoverLine.id,name:"line",from:new P(o.x,o.y),fromArrow:lt?"":i.data.fromArrow,to:new P(o.x,o.y),toArrow:"",strokeStyle:i.options.color,lineWidth:i.data.lineWidth});lt&&(Lt.from.id=lt.id,Lt.from.x=lt.to.x,Lt.from.y=lt.to.y,lt.to.id=Lt.id),i.moveIn.hoverLine.children.push(Lt),i.hoverLayer.line=Lt,i.dispatch("addLineInLines",{previous:lt,line:Lt})}}i.hoverLayer.dragRect=void 0,i.activeLayer.lastOffsetX=0,i.activeLayer.lastOffsetY=0,i.render(),i.needCache&&i.cache(),i.needCache=!1}},this.ondblclick=function(){i.moveIn.hoverNode?(i.dispatch("dblclick",i.moveIn.hoverNode),i.data.locked||i.moveIn.hoverNode.locked||i.moveIn.hoverNode.hideInput||i.options.hideInput||i.showInput(i.moveIn.hoverNode),i.moveIn.hoverNode.dblclick()):i.moveIn.hoverLine&&(i.dispatch("dblclick",i.moveIn.hoverLine),i.data.locked||i.moveIn.hoverLine.locked||i.moveIn.hoverLine.hideInput||i.options.hideInput||i.showInput(i.moveIn.hoverLine),i.moveIn.hoverLine.dblclick())},this.onkeydown=function(n){if(!(i.data.locked||n.target.tagName==="INPUT"||n.target.tagName==="TEXTAREA")){var o=!1,p=0,x=0;switch(n.key){case" ":i.spaceDown=!0;break;case"a":case"A":i.activeLayer.setPens(i.data.pens),o=!0;break;case"Delete":case"Backspace":n.ctrlKey||n.metaKey?i.deleteAnchors():i.delete();break;case"ArrowLeft":p=-5,(n.ctrlKey||n.metaKey)&&(p=-1),o=!0;break;case"ArrowUp":x=-5,(n.ctrlKey||n.metaKey)&&(x=-1),o=!0;break;case"ArrowRight":p=5,(n.ctrlKey||n.metaKey)&&(p=1),o=!0;break;case"ArrowDown":x=5,(n.ctrlKey||n.metaKey)&&(x=1),o=!0;break;case"x":case"X":i.cut();break;case"c":case"C":i.copy();break;case"v":case"V":i.paste();break;case"y":case"Y":(n.ctrlKey||n.metaKey)&&i.redo();break;case"z":case"Z":n.shiftKey?i.redo():(n.ctrlKey||n.metaKey)&&i.undo();break;case"Enter":if(i.moveIn.type===kt.Lines){if(i.moveIn.type=kt.None,i.moveIn.hoverLine.doing="",i.hoverLayer.line.getLen()<10&&(i.moveIn.hoverLine.children.pop(),i.hoverLayer.line=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1]),i.moveIn.hoverLine.isNode){var U=[];i.moveIn.hoverLine.children.forEach(function(Et){U.push(Et.from),Et.controlPoints&&Et.controlPoints.forEach(function(Bt){Bt.data=!0,U.push(Bt)}),U.push(Et.to)});var W=ye(U),it=W.x1,ht=W.y1,lt=W.x2,Lt=W.y2,It=new At({name:"lines",rect:new a(it,ht,lt-it,Lt-ht),points:U,closePath:i.moveIn.hoverLine.closePath});i.activeLayer.add(It),i.data.pens.pop(),i.data.pens.push(It)}else i.hoverLayer.line.toArrow=i.data.toArrow,i.activeLayer.add(i.moveIn.hoverLine);i.moveIn.hoverLine=void 0}o=!0;break;case"Escape":i.moveIn.type===kt.Lines&&(i.moveIn.type=kt.None,i.moveIn.hoverLine.children.pop(),i.hoverLayer.line=i.moveIn.hoverLine.children[i.moveIn.hoverLine.children.length-1],i.hoverLayer.line.toArrow=i.data.toArrow,i.moveIn.hoverLine.doing="",i.moveIn.hoverLine=void 0),o=!0;break}!o||(n.preventDefault(),n.stopPropagation(),(p||x)&&(i.activeLayer.saveNodeRects(),i.activeLayer.move(p,x),i.animateLayer.animate()),i.render(),i.cache())}},this._emitter=vt(),this.options=Object.assign({},ut,e),tt.Store.set(this.generateStoreKey("LT:color"),this.options.color||"#222222"),tt.Store.set(this.generateStoreKey("LT:fontColor"),this.options.fontColor||"#222222"),this.setupDom(t),this.setupSubscribe(),this.setupMouseEvent(),setTimeout(function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},500),setTimeout(function(){i.canvasPos=i.divLayer.canvas.getBoundingClientRect()},1e3),this.cache(),window.topology=this,this.dispatch("loaded")}return Object.defineProperty(r.prototype,"ramCaches",{get:function(){return 5},enumerable:!0,configurable:!0}),r.prototype.setupDom=function(t){typeof t=="string"?this.parentElem=document.getElementById(t):this.parentElem=t,this.parentElem.style.position="relative",this.parentElem.style.overflow="auto",this.parentElem.onresize=this.winResize,window.addEventListener("resize",this.winResize);var e=this.id;this.activeLayer=new si(this.options,e),this.activeLayer.topology=this,this.hoverLayer=new ni(this.options,e),this.animateLayer=new hi(this.options,e),this.offscreen=new ti(this.parentElem,this.options,e),this.canvas=new ri(this.parentElem,this.options,e),this.divLayer=new li(this.parentElem,this.options,e),this.options.scroll&&(this.scrollDom=new yi(this)),this.input.style.position="absolute",this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.input.style.height="0",this.input.style.outline="none",this.input.style.border="1px solid #cdcdcd",this.input.style.resize="none",this.parentElem.appendChild(this.input),this.createMarkdownTip(),this.resize()},r.prototype.setupSubscribe=function(){var t=this;this.subcribe=tt.Store.subscribe(this.generateStoreKey("LT:render"),function(){t.render()}),this.subcribeRender=tt.Store.subscribe("LT:render",function(){t.render()}),this.subcribeImage=tt.Store.subscribe(this.generateStoreKey("LT:imageLoaded"),function(){t.imageTimer&&clearTimeout(t.imageTimer),t.imageTimer=setTimeout(function(){t.render()},100)}),this.subcribeAnimateMoved=tt.Store.subscribe(this.generateStoreKey("LT:rectChanged"),function(e){t.activeLayer.updateLines([e])}),this.subcribeMediaEnd=tt.Store.subscribe(this.generateStoreKey("mediaEnd"),function(e){e.nextPlay&&(t.animateLayer.readyPlay(e.nextPlay),t.animateLayer.animate()),t.dispatch("mediaEnd",e)}),this.subcribeAnimateEnd=tt.Store.subscribe(this.generateStoreKey("animateEnd"),function(e){if(!!e){switch(e.type){case g.Node:t.offscreen.render();break}t.dispatch("animateEnd",e)}}),this.subcribeEmit=tt.Store.subscribe(this.generateStoreKey("LT:emit"),function(e){t.emit(e.event,e)})},r.prototype.setupMouseEvent=function(){var t=this;switch(this.canvasPos=this.divLayer.canvas.getBoundingClientRect(),this.parentElem.addEventListener("scroll",this.onScroll),window.addEventListener("scroll",this.onScroll),this.divLayer.canvas.ondragover=function(e){return e.preventDefault()},this.divLayer.canvas.ondrop=function(e){if(!t.data.locked)try{var i=e.dataTransfer.getData("Topology")||e.dataTransfer.getData("Text");if(!i)return;var n=JSON.parse(i);e.preventDefault();var o=t.calibrateMouse({x:e.offsetX,y:e.offsetY});t.dropNodes(Array.isArray(n)?n:[n],o.x,o.y),t.activeLayer.calcActiveRect()}catch(p){}},Qr()?(this.options.refresh=50,document.addEventListener("gesturestart",this.preventDefault),this.divLayer.canvas.ontouchstart=function(e){t.touchStart=Date.now();var i=new P(e.changedTouches[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.changedTouches[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));if(e.touches.length>1){t.touches=e.touches,t.touchScale=t.data.scale,t.lastTranlated.x=i.x,t.lastTranlated.y=i.y;return}var n=t.calibrateMouse({x:i.x,y:i.y});t.getMoveIn(n),t.hoverLayer.node=t.moveIn.hoverNode,t.hoverLayer.line=t.moveIn.hoverLine,t.lastTranlated.x=i.x,t.lastTranlated.y=i.y,t.onmousedown({x:i.x,y:i.y,ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:0})},this.divLayer.canvas.ontouchmove=function(e){e.stopPropagation();var i=e.touches,n=i.length;!t.touchCenter&&n>1&&(t.touchCenter={x:i[0].pageX+(i[1].pageX-i[0].pageX)/2,y:i[0].pageY+(i[1].pageY-i[0].pageY)/2},t.calibrateMouse(t.touchCenter));var o=Date.now();if(!(o-t.touchStart<50)){if(n>1){if(n===2){var p=e.scale||Math.hypot(i[0].pageX-i[1].pageX,i[0].pageY-i[1].pageY)/Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY);e.preventDefault(),t.scaleTo(p*t.touchScale,t.touchCenter)}else if(n===3){var x=new P(i[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),i[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.translate(x.x,x.y,!0)}return}e.preventDefault();var U=new P(e.touches[0].pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.touches[0].pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.onMouseMove({x:U.x,y:U.y,ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,buttons:1})}},this.divLayer.canvas.ontouchend=function(e){t.touches=void 0,t.touchCenter=void 0,t.ontouchend(e)}):(this.divLayer.canvas.onmousedown=function(e){if(!(e.target.nodeName==="INPUT"&&e.target.type==="range"&&t.data.locked)){t.touchedNode&&(t.touchedNode.name==="graffiti"?(t.touchedNode.rect=new a(0,0,0,0),t.addNode(t.touchedNode),t.touchedNode=void 0):t.touchedNode.name==="lines"&&(t.addLine(t.touchedNode),t.touchedNode=void 0));var i={x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:e.button,pageX:e.pageX,pageY:e.pageY};t.lastTranlated.x=i.x,t.lastTranlated.y=i.y,t.onmousedown(i)}},this.divLayer.canvas.onmousemove=function(e){t.onMouseMove({x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,buttons:e.buttons,pageX:e.pageX,pageY:e.pageY})},this.divLayer.canvas.onmouseup=function(e){var i={x:e.pageX-window.scrollX-(t.canvasPos.left||t.canvasPos.x),y:e.pageY-window.scrollY-(t.canvasPos.top||t.canvasPos.y),ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,button:e.button},n=t.hoverLayer.dragRect;if(t.onmouseup(i),!(!t.touchedNode||t.data.locked)){if(n)t.touchedNode=ee(ee({},t.touchedNode),{rect:n});else{var o=t.data,p=o.x,x=o.y;t.touchedNode.rect.x=e.pageX-window.scrollX-t.canvasPos.x-t.touchedNode.rect.width/2-p,t.touchedNode.rect.y=e.pageY-window.scrollY-t.canvasPos.y-t.touchedNode.rect.height/2-x}var U=new At(t.touchedNode);t.addNode(U,!0),t.activeLayer.calcActiveRect(),t.touchedNode=void 0}}),this.divLayer.canvas.ondblclick=this.ondblclick,this.divLayer.canvas.tabIndex=0,this.divLayer.canvas.onblur=function(){t.mouseDown=void 0},this.divLayer.canvas.onwheel=function(e){if(t.options.scroll&&!e.ctrlKey&&t.scrollDom){t.scrollDom.wheel(e.deltaY<0);return}if(t.data.locked!==jt.NoEvent){var i=new Date().getTime();if(i-t.touchStart<20){e.preventDefault(),e.stopPropagation();return}if(t.touchStart=new Date().getTime(),!t.options.disableScale){switch(t.options.scaleKey){case dt.Ctrl:if(!e.ctrlKey&&!e.metaKey)return;break;case dt.Shift:if(!e.shiftKey)return;break;case dt.Alt:if(!e.altKey)return;break}e.preventDefault(),e.stopPropagation();var n=new P(e.x-window.scrollX-(t.canvasPos.left||t.canvasPos.x),e.y-window.scrollY-(t.canvasPos.top||t.canvasPos.y));t.calibrateMouse(n);var o=t.data.scale;return e.deltaY<0?o+=.1:o-=.1,t.scaleTo(o,n),t.divLayer.canvas.focus(),!1}}},this.options.keydown){case St.Document:document.addEventListener("keydown",this.onkeydown),document.addEventListener("keyup",function(){t.spaceDown=!1});break;case St.Canvas:this.divLayer.canvas.addEventListener("keydown",this.onkeydown),this.divLayer.canvas.addEventListener("keyup",function(){t.spaceDown=!1});break}},r.prototype.ontouchend=function(t){var e=new P(t.changedTouches[0].pageX-window.scrollX-(this.canvasPos.left||this.canvasPos.x),t.changedTouches[0].pageY-window.scrollY-(this.canvasPos.top||this.canvasPos.y)),i=this.hoverLayer.dragRect;if(this.onmouseup({x:e.x,y:e.y,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,button:0}),!(!this.touchedNode||this.data.locked)){if(i)this.touchedNode=ee(ee({},this.touchedNode),{rect:i});else{var n=this.data,o=n.x,p=n.y;this.touchedNode.rect.x=t.changedTouches[0].pageX-window.scrollX-this.canvasPos.x-this.touchedNode.rect.width/2-o,this.touchedNode.rect.y=t.changedTouches[0].pageY-window.scrollY-this.canvasPos.y-this.touchedNode.rect.height/2-p}var x=new At(this.touchedNode);this.addNode(x,!0),this.activeLayer.calcActiveRect(),this.touchedNode=void 0}},r.prototype.resize=function(t){this.canvas.resize(t),this.offscreen.resize(t),this.divLayer.resize(t),this.render(),this.dispatch("resize",t),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.init()},r.prototype.dropNodes=function(t,e,i){var n=this,o=0,p=0;if(t.length&&t[0].rect){var x=t[0].rect;o=x.x,p=x.y}var U;t.forEach(function(W){if(W.id=wt(),W.name==="graffiti"){W.rect=new a(0,0,0,0),n.addNode(W);return}else if(W.name==="lines"){n.addLine(W),n.mouseDown={x:e,y:i},n.onmouseup(n.mouseDown);return}if(!U)W.rect.x=e-W.rect.width/2<<0,W.rect.y=i-W.rect.height/2<<0,U=W;else{var it=W.rect,ht=it.x-o,lt=it.y-p;W.rect.x=U.rect.x+ht,W.rect.y=U.rect.y+lt}W.type===g.Line?n.addLine(Object.assign({name:"line",from:new P(W.rect.x,W.rect.y),fromArrow:n.data.fromArrow,to:new P(W.rect.x+W.rect.width,W.rect.y+W.rect.height),toArrow:n.data.toArrow,strokeStyle:n.options.color},W),!0):n.addNode(W,!0)}),this.divLayer.canvas.focus()},r.prototype.addNode=function(t,e){var i=this;return e===void 0&&(e=!1),Rt[t.name]?(t.TID=this.id,t.init||(t=new At(t)),!t.strokeStyle&&this.options.color&&(t.strokeStyle=this.options.color),gt.forEach(function(n){t[n]||(t[n]=i.options[n])}),this.data.scale!==1&&t.scale(this.data.scale),this.data.pens.push(t),e&&(t.name==="echarts"?setTimeout(function(){i.activeLayer.pens=[t],i.render()},50):this.activeLayer.pens=[t]),t.name!=="graffiti"||!t.doing?(this.render(),this.animate(!0),this.cache()):(this.moveIn.type=kt.Graffiti,this.moveIn.hoverNode=t),this.dispatch("addNode",t),t):null},r.prototype.addLine=function(t,e){return e===void 0&&(e=!1),t.type===g.Node&&(t.isNode=!0),t.TID=this.id,t.clone||(t=new Mt(t),t.calcControlPoints(!0)),this.data.scale!==1&&(t.name!=="lines"?t.scale(this.data.scale,t.getCenter()):t.fontSize*=this.data.scale),this.data.pens.push(t),t.name!=="lines"||!t.doing?e&&(this.activeLayer.setPens([t]),this.render(),this.animate(!0),this.cache(),this.dispatch("addLine",t)):(this.activeLayer.clear(),this.hoverLayer.line=void 0,this.moveIn.type=kt.Lines,this.moveIn.hoverLine=t),t},r.prototype.render=function(t){if(t&&(this.activeLayer.pens=[],this.hoverLayer.node=void 0,this.hoverLayer.line=void 0),this.rendering)return this;this.rendering=!0;var e=this.offscreen.canvas.getContext("2d");e.clearRect(0,0,this.offscreen.canvas.width,this.offscreen.canvas.height),e.save(),e.translate(this.data.x,this.data.y),this.offscreen.render(),e.restore(),this.canvas.render(),this.rendering=!1},r.prototype.open=function(t){typeof t!="string"&&t&&t.mqttOptions&&!t.mqttOptions.customClientId&&(t.mqttOptions.clientId=wt()),this.canvas.clearBkImg(),this.data=te(t,this.id),this.subscribeSocket(),tt.Store.set(this.generateStoreKey("LT:scale"),this.data.scale),this.dispatch("scale",this.data.scale),tt.Store.set("LT:bkColor",this.data.bkColor),this.lock(this.data.locked),this.caches.list=[],Gr(),this.caches.dbIndex=-1,this.cache(),this.divLayer.clear(),this.animateLayer.stop(),this.render(!0),this.parentElem.scrollLeft=0,this.parentElem.scrollTop=0,this.animate(!0),this.openSocket(),this.openMqtt(),this.doInitJS(),this.dispatch("opened"),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.init()},r.prototype.doInitJS=function(){if(this.data.initJS&&this.data.initJS.trim()){var t=new Function(this.data.initJS);t()}},r.prototype.openSocket=function(t){var e=this;this.closeSocket(),(t||this.data.websocket)&&(this.socket=new ui(t||this.data.websocket,function(i){e.data.socketEvent!==1&&e.doSocket(i.data),e.data.socketEvent&&e.dispatch("websocket",i.data)}))},r.prototype.closeSocket=function(){this.socket&&this.socket.close()},r.prototype.openMqtt=function(t,e){var i=this;this.closeMqtt(),(t||this.data.mqttUrl)&&(this.mqtt=new di(t||this.data.mqttUrl,e||this.data.mqttOptions,this.data.mqttTopics,function(n,o){i.data.socketEvent!==1&&i.doSocket(o.toString(),u.Mqtt),i.data.socketEvent&&i.dispatch("mqtt",{topic:n,message:o})}))},r.prototype.closeMqtt=function(){this.mqtt&&this.mqtt.close()},r.prototype.doSocket=function(t,e){var i=this;e===void 0&&(e=u.WebSocket);try{t=JSON.parse(t),Array.isArray(t)||(t=[t]),t.forEach(function(n){var o=[];n.actions&&(o=n.actions,delete n.actions);var p=b(n.id||n.tag,i.data.pens);p.forEach(function(x){(x.id===n.id||x.tags&&x.tags.indexOf(n.tag)>-1)&&(x.fromData(x,n),x.doWheres(),x.events&&x.events.forEach(function(U){U.type===e&&(U.params=n,o.push(U))}),o&&o.forEach(function(U){x.doAction(U)}))}),i.willRender()})}catch(n){console.warn(n)}},r.prototype.overflow=function(t){t===void 0&&(t=50);var e=this.getRect(),i=e.width,n=e.height;i<e.ex&&(i=e.ex+t),i<this.canvas.width&&(i=this.canvas.width),n<e.ey&&(n=e.ey+t),n<this.canvas.height&&(n=this.canvas.height);var o={width:i,height:n};return this.resize(o),o},r.prototype.setNodeText=function(){this.inputObj.text=this.input.value,this.inputObj.name==="image"&&this.inputObj.init(),this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.cache(),this.offscreen.render(),this.dispatch("setText",this.inputObj),this.inputObj=void 0},r.prototype.getMoveIn=function(t){if(!(this.moveIn.type>=kt.Graffiti)){if(this.lastHoverNode=this.moveIn.hoverNode,this.lastHoverLine=this.moveIn.hoverLine,this.moveIn.type=kt.None,this.moveIn.hoverNode=void 0,this.moveIn.lineControlPoint=void 0,this.moveIn.hoverLine=void 0,this.hoverLayer.hoverAnchorIndex=-1,!this.data.locked&&!(this.activeLayer.pens.length===1&&this.activeLayer.pens[0].type)&&!this.activeLayer.locked()&&this.activeLayer.rotateCPs[0]&&this.activeLayer.rotateCPs[0].hit(t,15)){this.moveIn.type=kt.Rotate;var e=this.options.rotateCursor;this.divLayer.canvas.style.cursor=e.includes("/")?'url("'+e+'"), auto':e;return}if(this.activeLayer.pens.length>1&&c(t,this.activeLayer.sizeCPs)&&(this.moveIn.type=kt.Nodes),!this.data.locked&&!this.activeLayer.locked()&&!this.options.hideSizeCP&&(this.activeLayer.pens.length>1||!this.activeLayer.pens[0].type&&!this.activeLayer.pens[0].hideSizeCP)){for(var i=0;i<this.activeLayer.sizeCPs.length;++i)if(this.activeLayer.sizeCPs[i].hit(t,10)){this.moveIn.type=kt.ResizeCP,this.moveIn.activeAnchorIndex=i,this.divLayer.canvas.style.cursor=vi[i];return}}if(!this.data.locked)for(var n=0,o=this.activeLayer.pens;n<o.length;n++){var p=o[n];if(p instanceof Mt&&!p.locked){for(var i=0;i<p.controlPoints.length;++i)if(!p.locked&&p.controlPoints[i].hit(t,10)){p.controlPoints[i].id=i,this.moveIn.type=kt.LineControlPoint,this.moveIn.lineControlPoint=p.controlPoints[i],this.moveIn.hoverLine=p,this.divLayer.canvas.style.cursor="pointer";return}if(this.inLine(t,p))return}}this.divLayer.canvas.style.cursor="default";for(var x=this.data.pens.length,U,i=x-1;i>-1;--i)if(this.data.pens[i].type===g.Node&&this.inNode(t,this.data.pens[i])){U&&this.moveIn.type!==kt.HoverAnchors&&this.inLine(t,U);return}else this.data.pens[i].type===g.Line&&this.inLine(t,this.data.pens[i])&&(U=this.data.pens[i])}},r.prototype.inChildNode=function(t,e){if(!e)return null;for(var i=e.length,n=i-1;n>-1;--n){var o=e[n];if(!(!o.visible||o.locked===jt.NoEvent)){if(o.type===g.Line){if(this.inLine(t,o))return o;continue}var p=this.inChildNode(t,o.children);if(p||(p=this.inNode(t,o,!0),p))return p}}return null},r.prototype.inNode=function(t,e,i){if(i===void 0&&(i=!1),this.data.locked===jt.NoEvent||!e.visible||e.locked===jt.NoEvent)return null;var n=this.inChildNode(t,e.children);if(n)return this.moveIn.type<kt.HoverAnchors&&(this.moveIn.type=kt.Nodes,n.stand?this.moveIn.activeNode=n:this.moveIn.activeNode=e),n;if(e.hitInSelf(t)){if(this.moveIn.hoverNode=e,this.moveIn.type=kt.Nodes,!this.data.locked&&!e.locked?this.divLayer.canvas.style.cursor="move":this.divLayer.canvas.style.cursor=this.options.hoverCursor,!this.data.locked&&!e.locked&&!(this.options.hideAnchor||e.hideAnchor||e.rect.width<20||e.rect.height<20)){for(var o=0;o<e.rotatedAnchors.length;++o)if(e.rotatedAnchors[o].hit(t,this.options.anchorSize)){if(!this.mouseDown&&e.rotatedAnchors[o].mode===Zt.In)continue;this.moveIn.type=kt.HoverAnchors,this.moveIn.hoverAnchorIndex=o,this.hoverLayer.hoverAnchorIndex=o,this.divLayer.canvas.style.cursor="crosshair";break}this.options.autoAnchor&&e.rect.center.hit(t,this.options.anchorSize)&&(this.moveIn.hoverNode=e,this.moveIn.type=kt.AutoAnchor,this.divLayer.canvas.style.cursor="crosshair")}return i||(this.moveIn.activeNode=this.moveIn.hoverNode),e}if(this.options.hideAnchor||e.hideAnchor||this.data.locked||e.locked)return null;if(e.hitInSelf(t,this.options.anchorSize)){for(var o=0;o<e.rotatedAnchors.length;++o)if(e.rotatedAnchors[o].hit(t,this.options.anchorSize)){if(!this.mouseDown&&e.rotatedAnchors[o].mode===Zt.In)continue;return this.moveIn.hoverNode=e,this.moveIn.type=kt.HoverAnchors,this.moveIn.hoverAnchorIndex=o,this.hoverLayer.hoverAnchorIndex=o,this.divLayer.canvas.style.cursor="crosshair",i||(this.moveIn.activeNode=e),e}}return null},r.prototype.inLine=function(t,e){if(this.data.locked===jt.NoEvent||!e.visible||e.locked===jt.NoEvent)return null;if(e.children)for(var i=0,n=e.children;i<n.length;i++){var o=n[i],p=this.inLine(t,o);if(p)return p}if(e.from){if(e.from.hit(t,this.options.anchorSize))return this.moveIn.type=kt.LineFrom,this.moveIn.hoverLine=e,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",e;if(e.to.hit(t,this.options.anchorSize))return this.moveIn.type=kt.LineTo,this.moveIn.hoverLine=e,this.data.locked||e.locked?this.divLayer.canvas.style.cursor=this.options.hoverCursor:this.divLayer.canvas.style.cursor="move",e;if(e.pointIn(t))return this.moveIn.type=kt.Line,this.moveIn.hoverLine=e,this.divLayer.canvas.style.cursor=this.options.hoverCursor,e}return null},r.prototype.getLineDock=function(t,e){e===void 0&&(e=Zt.Default),this.hoverLayer.dockAnchor=void 0;for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];if(o instanceof At){var p=o.hit(t,10);if(!p)continue;if(p.type===g.Line){if(p.from.hit(t,10)){t.x=p.from.x,t.y=p.from.y,this.hoverLayer.dockAnchor=p.from;break}if(p.to.hit(t,10)){t.x=p.to.x,t.y=p.to.y,this.hoverLayer.dockAnchor=p.to;break}break}this.hoverLayer.node=p,this.options.autoAnchor&&p.rect.center.hit(t,10)&&(t.id=p.id,t.autoAnchor=!0,t.x=p.rect.center.x,t.y=p.rect.center.y,this.hoverLayer.dockAnchor=p.rect.center);for(var x=0;x<p.rotatedAnchors.length;++x)if(!(p.rotatedAnchors[x].mode&&p.rotatedAnchors[x].mode!==e)&&p.rotatedAnchors[x].hit(t,10)){t.id=p.id,t.anchorIndex=x,t.autoAnchor=!1,t.direction=p.rotatedAnchors[x].direction,t.x=p.rotatedAnchors[x].x,t.y=p.rotatedAnchors[x].y,this.hoverLayer.dockAnchor=p.rotatedAnchors[x];break}if(this.hoverLayer.dockAnchor)break}else if(o instanceof Mt){if(o.id===this.hoverLayer.line.id)continue;if(o.children){for(var U=!1,W=0,it=o.children;W<it.length;W++){var ht=it[W];if(ht.from.hit(t,10)){t.x=ht.from.x,t.y=ht.from.y,this.hoverLayer.dockAnchor=ht.from,U=!0;break}if(ht.to.hit(t,10)){t.x=ht.to.x,t.y=ht.to.y,this.hoverLayer.dockAnchor=ht.to,U=!0;break}if(ht.controlPoints)for(var lt=0,Lt=ht.controlPoints;lt<Lt.length;lt++){var It=Lt[lt];if(It.hit(t,10)){t.x=It.x,t.y=It.y,this.hoverLayer.dockAnchor=It,U=!0;break}}}if(U)continue}else{if(o.from.hit(t,10)){t.x=o.from.x,t.y=o.from.y,this.hoverLayer.dockAnchor=o.from;continue}if(o.to.hit(t,10)){t.x=o.to.x,t.y=o.to.y,this.hoverLayer.dockAnchor=o.to;continue}if(o.controlPoints)for(var Et=0,Bt=o.controlPoints;Et<Bt.length;Et++){var It=Bt[Et];if(It.hit(t,10)){t.x=It.x,t.y=It.y,this.hoverLayer.dockAnchor=It;break}}}}}return t},r.prototype.getPensInRect=function(t){var e=this;t.width<0&&(t.width=-t.width,t.x=t.ex,t.ex=t.x+t.width),t.height<0&&(t.height=-t.height,t.y=t.ey,t.ey=t.y+t.height),this.activeLayer.pens=[];for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];o.locked!==jt.NoEvent&&(o instanceof At&&t.hitByRect(o.rect)&&this.activeLayer.add(o),o instanceof Mt&&(o.children?o.children.forEach(function(p){t.hit(p.from)&&t.hit(p.to)&&e.activeLayer.add(p)}):t.hit(o.from)&&t.hit(o.to)&&this.activeLayer.add(o)))}},r.prototype.getAngle=function(t){if(t.x===this.activeLayer.rect.center.x)return t.y<=this.activeLayer.rect.center.y?0:180;if(t.y===this.activeLayer.rect.center.y)return t.x<this.activeLayer.rect.center.x?270:90;var e=t.x-this.activeLayer.rect.center.x,i=t.y-this.activeLayer.rect.center.y,n=Math.atan(Math.abs(e/i))/(2*Math.PI)*360;return e>0&&i>0?n=180-n:e<0&&i>0?n+=180:e<0&&i<0&&(n=360-n),this.activeLayer.pens.length===1?n-this.activeLayer.pens[0].rotate:n},r.prototype.showInput=function(t){this.inputObj=t;var e=t.getTextRect();!e||(this.input.value=t.text||"",this.input.style.left=e.x+this.data.x+"px",this.input.style.top=e.y+this.data.y+"px",this.input.style.width=e.width+"px",this.input.style.height=e.height+"px",this.input.style.zIndex="1000",t.rotate/360?this.input.style.transform="rotate("+t.rotate+"deg)":this.input.style.transform=void 0,this.input.classList.add("set-text-input"),this.input.focus())},r.prototype.getRect=function(t){t||(t=this.data.pens);var e=Jt(t);return new a(e.x+this.data.x,e.y+this.data.y,e.width,e.height)},r.prototype.getDockPos=function(t,e,i){this.hoverLayer.dockLineX=0,this.hoverLayer.dockLineY=0;var n={x:0,y:0};if(i||this.options.disableDockLine)return n;for(var o=0,p=0,x=Me,U=Me,W=0,it=this.activeLayer.dockWatchers;W<it.length;W++)for(var ht=it[W],lt=0,Lt=this.data.pens;lt<Lt.length;lt++){var It=Lt[lt];if(!(!(It instanceof At)||this.activeLayer.has(It)||It.name==="text"))for(var Et=0,Bt=It.dockWatchers;Et<Bt.length;Et++){var yt=Bt[Et];o=Math.abs(yt.x-ht.x-t),o<x&&(x=-99999,n.x=yt.x-ht.x,this.hoverLayer.dockLineX=yt.x|0),p=Math.abs(yt.y-ht.y-e),p<U&&(U=-99999,n.y=yt.y-ht.y,this.hoverLayer.dockLineY=yt.y|0)}}return n},r.prototype.cache=function(){if(!(this.options.cacheLen==0||this.data.locked)){this.caches.index<this.caches.list.length-1&&(this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1),_e(this.caches.dbIndex+1));var t=this.pureData();this.caches.list.push(t),Jr(t,this.caches.dbIndex+1,this.options.cacheLen),this.caches.list.length>this.ramCaches&&this.caches.list.shift(),this.caches.index=this.caches.list.length-1,this.caches.dbIndex++}},r.prototype.cacheReplace=function(t){if(this.options.cacheLen!=0&&t&&t.length){for(var e={},i=0,n=t.length;i<n;i++){var o=t[i],p=o.id;o instanceof At?e[p]=new At(o):o instanceof Mt&&(e[p]=new Mt(o))}var x=this.caches.list[0];if(!x)return;for(var i=0,n=x.pens.length;i<n;i++){var p=x.pens[i].id;e[p]&&(x.pens[i]=e[p])}}},r.prototype.undo=function(t,e){var i=this;if(t===void 0&&(t=!1),this.options.cacheLen!=0&&!(!e&&this.data.locked||this.caches.index<1)){if(this.divLayer.clear(!0),this.animateLayer.stop(),this.caches.dbIndex--,this.data=te(this.caches.list[--this.caches.index],this.id),this.render(!0),this.divLayer.render(),t&&(this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1),_e(this.caches.dbIndex)),this.caches.index<=this.caches.list.length/2-1){var n=this.caches.index-0+1;Ae(this.caches.dbIndex-n).then(function(o){o&&(i.caches.list.pop(),i.caches.list.unshift(o),i.caches.index++)})}this.dispatch("undo",this.data)}},r.prototype.redo=function(t){var e=this;if(this.options.cacheLen!=0&&!(!t&&this.data.locked||this.caches.index>this.caches.list.length-2)){if(this.divLayer.clear(!0),this.caches.dbIndex++,this.data=te(this.caches.list[++this.caches.index],this.id),this.render(!0),this.divLayer.render(),this.caches.index>=this.caches.list.length/2){var i=this.caches.list.length-this.caches.index;Ae(this.caches.dbIndex+i).then(function(n){n&&(e.caches.list.shift(),e.caches.list.push(n),e.caches.index--)})}this.dispatch("redo",this.data)}},r.prototype.toImage=function(t,e){t===void 0&&(t=0),e===void 0&&(e=void 0);var i;this.data.bkImageRect&&(i=new a(this.data.bkImageRect.x-this.data.x,this.data.bkImageRect.y-this.data.y,this.data.bkImageRect.width,this.data.bkImageRect.height));var n=Xr(Jt(this.data.pens),i),o=ve(t||0);n.x-=o[3],n.y-=o[0],n.width+=o[3]+o[1],n.height+=o[0]+o[2],n.init();var p=this.offscreen.getDpiRatio();n.scale(p),i&&i.scale(p,n.center);var x=document.createElement("canvas");x.width=n.width,x.height=n.height;var U=x.getContext("2d");(this.data.bkColor||this.options.bkColor)&&(U.fillStyle=this.data.bkColor||this.options.bkColor,U.fillRect(0,0,x.width,x.height)),this.data.bkImage&&i&&U.drawImage(this.canvas.bkImg,i.x-n.x,i.y-n.y,i.width,i.height);for(var W=0,it=this.data.pens;W<it.length;W++){var ht=it[W],lt=void 0;ht.type?lt=new Mt(ht):(lt=new At(ht,!0),lt.animateFrames=[],lt.img=ht.img,lt.elementId="",lt.elementLoaded=!0,lt.elementRendered=!0),lt.scale(p,n.center),lt.translate(-n.x,-n.y,!0),lt.render(U)}return U.scale(1/p,1/p),e&&x.toBlob(e),x.toDataURL("image/png",1)},r.prototype.saveAsImage=function(t,e){e===void 0&&(e=0);var i=document.createElement("a");i.setAttribute("download",t||"le5le.topology.png"),i.setAttribute("href",this.toImage(e));var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),i.dispatchEvent(n)},r.prototype.delete=function(t,e){if(!(this.data.locked&&!e)){var i=[];if(typeof t=="string")i=w(t,this.data.pens);else for(var n=t||this.activeLayer.pens,o=0;o<n.length;o++){var p=n[o];if(p.type===g.Line&&p.parentId){var x=b(p.parentId,this.data.pens)[0];x&&x.name==="lines"&&(p=x)}w(p.id,this.data.pens).length&&(i.push(p),--o,p.type===g.Node&&this.divLayer.removeDiv(p),this.options.disableEmptyLine&&this.delEmptyLines(p.id),this.animateLayer.pens.delete(p.id))}i.length&&(this.render(!0),this.cache(),this.dispatch("delete",i))}},r.prototype.deleteAnchors=function(t,e){if(!(this.data.locked&&!e)){var i=t||this.activeLayer.pens;i.forEach(function(n){n.type===g.Node&&(n.manualAnchors=void 0,n.calcAnchors())})}},r.prototype.delEmptyLines=function(t){for(var e=0;e<this.data.pens.length;e++)if(this.data.pens[e].type===g.Line){var i=this.data.pens[e];(!i.from.id||!i.to.id||i.from.id===t||i.to.id===t)&&(this.data.pens.splice(e,1),this.animateLayer.pens.delete(i.id),--e)}},r.prototype.cut=function(){if(!this.data.locked){this.clipboard=te({pens:[]});for(var t=0;t<this.activeLayer.pens.length;t++){var e=this.activeLayer.pens[t];this.clipboard.pens.push(e.clone());var i=this.findIndex(e);i>-1&&(e.type===g.Node&&this.divLayer.removeDiv(this.data.pens[i]),this.data.pens.splice(i,1))}this.cache(),this.activeLayer.clear(),this.hoverLayer.node=void 0,this.moveIn.hoverLine=void 0,this.moveIn.hoverNode=void 0,this.render(),this.dispatch("delete",this.clipboard.pens)}},r.prototype.copy=function(){this.clipboard=te({pens:[]});for(var t=0,e=this.activeLayer.pens;t<e.length;t++){var i=e[t];this.clipboard.pens.push(i.clone()),i.parentId=null}this.dispatch("copy",this.clipboard)},r.prototype.paste=function(){if(!(!this.clipboard||this.data.locked)){this.hoverLayer.node=void 0,this.hoverLayer.line=void 0,this.activeLayer.pens=[];for(var t={},e=0,i=this.clipboard.pens;e<i.length;e++){var n=i[e];n.type||(this.pastePen(n,t,20),this.data.pens.push(n),this.activeLayer.add(n))}for(var o=0,p=this.clipboard.pens;o<p.length;o++){var n=p[o];n.type&&(this.pastePen(n,t,20),this.data.pens.push(n),this.activeLayer.add(n))}this.render(),this.animate(!0),this.cache(),this.copy(),this.dispatch("paste",this.clipboard.pens)}},r.prototype.pastePen=function(t,e,i,n){if(e===void 0&&(e={}),i===void 0&&(i=0),t.type){if(t instanceof Mt){t.id=wt(),n&&(t.parentId=n),t.from=new P(t.from.x+i,t.from.y+i,t.from.direction,t.from.anchorIndex,e[t.from.id]),t.to=new P(t.to.x+i,t.to.y+i,t.to.direction,t.to.anchorIndex,e[t.to.id]);for(var p=[],x=0,U=t.controlPoints;x<U.length;x++){var W=U[x];p.push(new P(W.x+i,W.y+i))}t.controlPoints=p}}else{var o=t.id;t.id=wt(),e[o]=t.id,n&&(t.parentId=n),t.rect.x+=i,t.rect.ex+=i,t.rect.y+=i,t.rect.ey+=i,t.manualAnchors&&t.manualAnchors.forEach(function(Lt){Lt.x+=i,Lt.y+=i}),t.points&&t.points.forEach(function(Lt){Lt.x+=i,Lt.y+=i}),t.init()}if(t.children)for(var it=0,ht=t.children;it<ht.length;it++){var lt=ht[it];this.pastePen(lt,e,i,t.id)}},r.prototype.animate=function(t){t===void 0&&(t=!1),this.animateLayer.readyPlay(void 0,t),this.animateLayer.animate()},r.prototype.updateProps=function(t,e){t===void 0&&(t=!0),e||(e=this.activeLayer.pens);for(var i=0,n=e;i<n.length;i++){var o=n[i];if(o instanceof At){if(o.autoRect){var p=this.canvas.canvas.getContext("2d"),x=q(p,o);o.rect.width=x.width+o.lineWidth*2,o.rect.height=x.height}o.init(),o.initRect()}}this.activeLayer.updateLines(e),this.activeLayer.calcControlPoints(),this.activeLayer.saveNodeRects(),this.render(),t&&this.cache()},r.prototype.lock=function(t){this.data.locked=t;for(var e=0,i=this.data.pens;e<i.length;e++){var n=i[e];n.addToDiv&&n.addToDiv()}this.dispatch("locked",this.data.locked)},r.prototype.lockPens=function(t,e){for(var i=0,n=this.data.pens;i<n.length;i++)for(var o=n[i],p=0,x=t;p<x.length;p++){var U=x[p];if(o.id===U.id){o.locked=e,o.addToDiv&&o.addToDiv();break}}this.dispatch("lockPens",{pens:t,lock:e})},r.prototype.up=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1&&i!==e.length-1)e.splice(i+2,0,e[i]),e.splice(i,1);else{var n=C(e,t);if(!n)return;this.up(t,n.children)}},r.prototype.top=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1)e.push(e[i]),e.splice(i,1);else{var n=C(e,t);if(!n)return;this.top(t,n.children)}},r.prototype.down=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1&&i!==0)e.splice(i-1,0,e[i]),e.splice(i+1,1);else{var n=C(e,t);if(!n)return;this.down(t,n.children)}},r.prototype.bottom=function(t,e){e||(e=this.data.pens);var i=this.findIndex(t,e);if(i>-1)e.unshift(e[i]),e.splice(i+1,1);else{var n=C(e,t);if(!n)return;this.bottom(t,n.children)}},r.prototype.getParent=function(t){return C(this.data.pens,t)},r.prototype.combine=function(t,e){e===void 0&&(e=!1),t||(t=this.activeLayer.pens);for(var i=Jt(t),n=0,o=t;n<o.length;n++){var p=o[n],x=this.findIndex(p);x>-1&&this.data.pens.splice(x,1)}for(var U=new At({name:"combine",rect:new a(i.x,i.y,i.width,i.height),text:"",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,strokeStyle:"transparent",children:[]}),x=0;x<t.length;++x)if(t[x].type===g.Node&&i.width===t[x].rect.width&&i.height===t[x].rect.height){U=t[x],U.children||(U.children=[]),t.splice(x,1);break}for(var W=0,it=t;W<it.length;W++){var p=it[W];p.stand=e,p.parentId=U.id,p.calcRectInParent(U),U.children.push(p)}this.data.pens.push(U),this.activeLayer.setPens([U]),this.dispatch("combine",U),this.cache()},r.prototype.uncombine=function(t){if(t||(t=this.activeLayer.pens[0]),t instanceof At){for(var e=0,i=t.children;e<i.length;e++){var n=i[e];n.parentId=void 0,n.rectInParent=void 0,n.locked=jt.None,this.data.pens.push(n)}var o=this.findIndex(t);o>-1&&t.name==="combine"?this.data.pens.splice(o,1):t.children=void 0,this.cache(),this.activeLayer.clear(),this.hoverLayer.clear(),this.dispatch("uncombine",t)}},r.prototype.find=function(t,e,i){var n;Array.isArray(e)?n=e:(n=this.data.pens,i=e);var o=b(t,n);return i?o:o.length===0?null:o.length===1?o[0]:o},r.prototype.findIndex=function(t,e){return e||(e=this.data.pens),e.findIndex(function(i){return i.id===t.id})},r.prototype.play=function(t,e){this.divLayer.play(t,e)},r.prototype.translate=function(t,e,i,n){var o=this;i||(this.lastTranlated.x=0,this.lastTranlated.y=0);var p=t-this.lastTranlated.x,x=e-this.lastTranlated.y;this.data.x+=p,this.data.y+=x,this.data.bkImageRect&&!this.data.bkImageStatic&&this.data.bkImageRect.translate(p,x),tt.Store.set(this.generateStoreKey("LT:updateLines"),this.data.pens),this.lastTranlated.x=t,this.lastTranlated.y=e,this.render(),this.divLayer.render(),this.animateLayer.stop(),this.cacheTimer&&clearTimeout(this.cacheTimer),this.cacheTimer=setTimeout(function(){var U;o.animateLayer.readyPlay(void 0,!0),o.animateLayer.animate(),(U=o.cache)===null||U===void 0||U.call(o)},300),n||this.dispatch("translate",{x:t,y:e}),this.scrollDom&&this.scrollDom.isShow&&this.scrollDom.translate(t,e)},r.prototype.scale=function(t,e){this.data.scale*t<this.options.minScale?(t=this.options.minScale/this.data.scale,this.data.scale=this.options.minScale):this.data.scale*t>this.options.maxScale?(t=this.options.maxScale/this.data.scale,this.data.scale=this.options.maxScale):this.data.scale=Math.round(this.data.scale*t*100)/100,!e&&(e=Jt(this.data.pens).center);for(var i=0,n=this.data.pens;i<n.length;i++){var o=n[i];o.scale(t,e)}if(this.data.bkImageRect&&!this.data.bkImageStatic){var p=new P(e.x+this.data.x,e.y+this.data.y);this.data.bkImageRect.scale(t,p)}tt.Store.set(this.generateStoreKey("LT:updateLines"),this.data.pens),tt.Store.set(this.generateStoreKey("LT:scale"),this.data.scale),this.render(),this.cache(),this.dispatch("scale",this.data.scale)},r.prototype.scaleTo=function(t,e){this.scale(t/this.data.scale,e)},r.prototype.round=function(){for(var t=0,e=this.data.pens;t<e.length;t++){var i=e[t];i instanceof At&&i.round()}},r.prototype.centerView=function(t){if(!!this.hasView()){var e=this.getRect(),i=this.getViewCenter(t),n=e.center;this.translate(i.x-n.x,i.y-n.y);var o=this.canvas.parentElem,p=(o.scrollWidth-o.offsetWidth)/2,x=(o.scrollHeight-o.offsetHeight)/2;return o.scrollTo(p,x),!0}},r.prototype.fitView=function(t){if(!!this.hasView()){var e=this.canvas.parentElem,i=e.offsetWidth,n=e.offsetHeight;this.resize({width:i,height:n});var o=ve(t||this.options.viewPadding),p=this.getRect(),x=(i-o[1]-o[3])/p.width,U=(n-o[0]-o[2])/p.height,W=x;x>U&&(W=U),this.scale(W),this.centerView(t)}},r.prototype.hasView=function(){return!!this.data.pens.length},r.prototype.getViewCenter=function(t){var e=ve(t||this.options.viewPadding),i=this.canvas,n=i.width,o=i.height;return{x:(n-e[1]-e[3])/2+e[3],y:(o-e[0]-e[2])/2+e[0]}},r.prototype.generateStoreKey=function(t){return this.id+"-"+t},r.prototype.createMarkdownTip=function(){this.tipMarkdown=document.createElement("div"),this.tipMarkdown.className="topology-markdown",this.tipMarkdown.style.position="fixed",this.tipMarkdown.style.zIndex="-1",this.tipMarkdown.style.left="-9999px",this.tipMarkdown.style.padding="8px 0",this.tipMarkdownContent=document.createElement("div"),this.tipMarkdownContent.style.maxWidth="320px",this.tipMarkdownContent.style.outline="none",this.tipMarkdownContent.style.borderRadius="4px",this.tipMarkdownContent.style.backgroundColor="rgba(0,0,0,.6)",this.tipMarkdownContent.style.color="#fff",this.tipMarkdownContent.style.padding="8px 16px",this.tipMarkdownContent.style.lineHeight="1.8",this.tipMarkdownContent.style.overflowY="auto",this.tipMarkdownContent.style.minHeight="30px",this.tipMarkdownContent.style.maxHeight="400px",this.tipMarkdown.appendChild(this.tipMarkdownContent),this.tipMarkdownArrowUp=document.createElement("div"),this.tipMarkdownArrowUp.className="arrow",this.tipMarkdownArrowUp.style.position="absolute",this.tipMarkdownArrowUp.style.border="6px solid transparent",this.tipMarkdownArrowUp.style.backgroundColor="transparent",this.tipMarkdownArrowUp.style.left="50%",this.tipMarkdownArrowUp.style.transform="translateX(-50%)",this.tipMarkdownArrowUp.style.top="-4px",this.tipMarkdown.appendChild(this.tipMarkdownArrowUp),this.tipMarkdownArrowDown=document.createElement("div"),this.tipMarkdownArrowDown.className="arrow",this.tipMarkdownArrowDown.style.position="absolute",this.tipMarkdownArrowDown.style.border="6px solid transparent",this.tipMarkdownArrowDown.style.left="50%",this.tipMarkdownArrowDown.style.transform="translateX(-50%)",this.tipMarkdownArrowDown.style.backgroundColor="transparent",this.tipMarkdownArrowDown.style.bottom="-4px",this.tipMarkdown.appendChild(this.tipMarkdownArrowDown),document.body.appendChild(this.tipMarkdown)},r.prototype.showTip=function(t,e){if(!(!t||t.id===this.tip||this.data.tooltip===!1||this.data.tooltip===0)){if(t.title){this.divLayer.canvas.title=t.title,this.tip=t.id;return}t.tipId&&(this.tipElem=document.getElementById(t.tipId));var i=this.tipElem;if(t.markdown){i=this.tipMarkdown;var n=window.marked;n?this.tipMarkdownContent.innerHTML=n(t.markdown):this.tipMarkdownContent.innerHTML=t.markdown;for(var o=this.tipMarkdownContent.getElementsByTagName("A"),p=0;p<o.length;++p)o[p].setAttribute("target","_blank")}if(!!i){var x=this.parentElem.getBoundingClientRect(),U=i.getBoundingClientRect(),W=(x.left||x.x)-(U.width-t.rect.width)/2+this.data.x,it=(x.top||x.y)-U.height-t.rect.height+this.data.y;W+=t.type?e.x:t.rect.x,it+=t.type?e.y:t.rect.ey,it>0?(this.tipMarkdownArrowUp.style.borderBottomColor="transparent",this.tipMarkdownArrowDown.style.borderTopColor="rgba(0,0,0,.6)"):(it+=U.height+t.rect.height,this.tipMarkdownArrowUp.style.borderBottomColor="rgba(0,0,0,.6)",this.tipMarkdownArrowDown.style.borderTopColor="transparent"),i.style.display="block",i.style.position="fixed",i.style.left=W+"px",i.style.top=it+"px",i.style.zIndex="100",this.tip=t.id,this.dispatch("tip",i)}}},r.prototype.hideTip=function(){!this.tip||(this.tipMarkdown.style.left="-9999px",this.tipMarkdown.style.zIndex="-1",this.tipElem&&(this.tipElem.style.left="-9999px",this.tipElem.style.zIndex="-1",this.tipElem=void 0),this.divLayer.canvas.title="",this.tip="")},r.prototype.scroll=function(t,e){var i=this;this.scrolling||(this.scrolling=!0,this.parentElem.scrollLeft+=t,this.parentElem.scrollTop+=e,setTimeout(function(){i.scrolling=!1},700))},r.prototype.toComponent=function(t){t||(t=this.data.pens);for(var e=Jt(t),i=new At({name:"combine",rect:new a(e.x,e.y,e.width,e.height),text:"",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,strokeStyle:"transparent",children:[]}),n=0,o=t;n<o.length;n++){var p=o[n];if(p.type===g.Node&&e.width===p.rect.width&&e.height===p.rect.height){i=p,i.children||(i.children=[]);break}}for(var x=0,U=t;x<U.length;x++){var p=U[x];p!==i&&(p.parentId=i.id,p.calcRectInParent(i),i.children.push(p))}return i},r.prototype.clearBkImg=function(){this.canvas.clearBkImg()},r.prototype.dispatch=function(t,e){return this.options.on&&this.options.on(t,e),this.emit(t,e),this},r.prototype.on=function(t,e){return this._emitter.on(t,e),this},r.prototype.off=function(t,e){return this._emitter.off(t,e),this},r.prototype.emit=function(t,e){return this._emitter.emit(t,e),this},r.prototype.getValue=function(t,e){e===void 0&&(e="text");var i=this.find(t);if(!!i&&(Array.isArray(i)&&(i=i[0]),!!i))return i[e]},r.prototype.setValue=function(t,e,i){i===void 0&&(i="text"),typeof t=="object"&&(e=t,t=t.id||t.tag);var n=b(t,this.data.pens);n.forEach(function(o){(o.id===t||o.tags&&o.tags.indexOf(t)>-1)&&(typeof e=="object"?o.fromData(o,e):o[i]=e,o.doWheres(),o.type===g.Node&&(o.animateReady=At.cloneState(o)))}),this.willRender()},r.prototype.willRender=function(){var t=this;this.actionTimer||(this.actionTimer=setTimeout(function(){t.render(),t.actionTimer=void 0},100))},r.prototype.setLineName=function(t,e){e===void 0&&(e=!0),this.data.pens.forEach(function(i){i.type&&(i.name=t,i.calcControlPoints())}),e&&this.render()},r.prototype.setColor=function(t){this.options.color=t,tt.Store.set(this.generateStoreKey("LT:color"),t),this.options.fontColor=t,tt.Store.set(this.generateStoreKey("LT:fontColor"),t)},r.prototype.setFontColor=function(t){this.options.fontColor=t,tt.Store.set(this.generateStoreKey("LT:fontColor"),t)},r.prototype.setIconColor=function(t){tt.Store.set(this.generateStoreKey("LT:iconColor"),t)},r.prototype.setBkColor=function(t){this.data.bkColor=t,tt.Store.set("LT:bkColor",t)},r.prototype.pureData=function(){var t=this,e=JSON.parse(JSON.stringify(this.data));return e.pens.forEach(function(i){for(var n in i)(i[n]===void 0||i[n]===void 0)&&delete i[n];if(delete i.TID,delete i.animateCycleIndex,delete i.img,delete i.lastImage,delete i.fillImg,delete i.strokeImg,delete i.lastFillImage,delete i.lastStrokeImage,delete i.imgNaturalWidth,delete i.imgNaturalHeight,delete i.anchors,delete i.rotatedAnchors,delete i.dockWatchers,delete i.elementLoaded,delete i.elementRendered,delete i.animateReady,i.animateFrames&&i.animateFrames.length)for(var o=0,p=i.animateFrames;o<p.length;o++){var x=p[o];x.initState&&(delete x.initState.TID,delete x.initState.animateCycleIndex,delete x.initState.img,delete x.initState.lastImage,delete x.initState.imgNaturalWidth,delete x.initState.imgNaturalHeight,delete x.initState.anchors,delete x.initState.rotatedAnchors,delete x.initState.dockWatchers,delete x.initState.elementLoaded,delete x.initState.elementRendered,delete x.initState.fillImg,delete x.initState.strokeImg,delete x.initState.lastFillImage,delete x.initState.lastStrokeImage),x.state&&(delete x.state.TID,delete x.state.animateCycleIndex,delete x.state.img,delete x.state.lastImage,delete x.state.imgNaturalWidth,delete x.state.imgNaturalHeight,delete x.state.anchors,delete x.state.rotatedAnchors,delete x.state.dockWatchers,delete x.state.elementLoaded,delete x.state.elementRendered,delete x.state.fillImg,delete x.state.strokeImg,delete x.state.lastFillImage,delete x.state.lastStrokeImage)}t.pureDataChildren(i)}),e},r.prototype.pureDataChildren=function(t){var e=this;!t.children||t.children.forEach(function(i){for(var n in i)(i[n]===void 0||i[n]===void 0||i[n]==="")&&delete i[n];delete i.TID,delete i.animateCycleIndex,delete i.img,delete i.lastImage,delete i.imgNaturalWidth,delete i.imgNaturalHeight,delete i.anchors,delete i.rotatedAnchors,delete i.dockWatchers,delete i.elementLoaded,delete i.elementRendered,delete i.animateReady,e.pureDataChildren(i)})},r.prototype.destroy=function(){switch(this.scrollDom&&this.scrollDom.destroy(),this.subcribe.unsubscribe(),this.subcribeRender.unsubscribe(),this.subcribeImage.unsubscribe(),this.subcribeAnimateEnd.unsubscribe(),this.subcribeAnimateMoved.unsubscribe(),this.subcribeMediaEnd.unsubscribe(),this.subcribeEmit.unsubscribe(),this.animateLayer.destroy(),this.divLayer.destroy(),this.canvas.destroy(),this.activeLayer.destroy(),this.hoverLayer.destroy(),this.offscreen.destroy(),document.body.removeChild(this.tipMarkdown),window.removeEventListener("resize",this.winResize),this.parentElem.removeEventListener("scroll",this.onScroll),window.removeEventListener("scroll",this.onScroll),document.removeEventListener("gesturestart",this.preventDefault),this.options.keydown){case St.Document:document.removeEventListener("keydown",this.onkeydown);break;case St.Canvas:this.divLayer.canvas.removeEventListener("keydown",this.onkeydown);break}this.closeSocket(),this.closeMqtt(),this.socketFn&&(this.off("websocket",this.socketFn),this.off("mqtt",this.socketFn)),this.cache=void 0,this.data=void 0,window.topology=void 0},r}()},7308:function(Pt,mt,ct){"use strict";ct.d(mt,{bK:function(){return St}});var tt=ct(16220);function vt(gt,ut,Ct){for(var wt=0,D=gt;wt<D.length;wt++){var V=D[wt];if(V instanceof tt.NB){switch(Ct){case"left":V.rect.x=ut.x;break;case"right":V.rect.x=ut.ex-V.rect.width;break;case"top":V.rect.y=ut.y;break;case"bottom":V.rect.y=ut.ey-V.rect.height;break;case"center":V.rect.x=ut.center.x-V.rect.width/2;break;case"middle":V.rect.y=ut.center.y-V.rect.height/2;break}V.rect.floor(),V.rect.calcCenter(),V.init(),V.calcChildrenRect()}}}function dt(gt,ut){for(var Ct=0,wt=0,D=0,V=gt;D<V.length;D++){var P=V[D];P instanceof tt.NB&&(Ct+=P.rect.width,++wt)}Ct=(ut-Ct)/(wt-1);for(var L=0,b=0,w=gt;b<w.length;b++){var P=w[b];P instanceof tt.NB&&(L||(L=P.rect.x),P.rect.x=L,L+=P.rect.width+Ct,P.rect.floor(),P.rect.calcCenter(),P.init(),P.calcChildrenRect())}}function St(gt,ut){for(var Ct=ut.spaceWidth||30,wt=ut.spaceHeight||30,D=(0,tt.Dz)(gt),V=D.x,P=D.y,L=[],b=[],w=0,C=0,c=gt;C<c.length;C++){var s=c[C];s.type!==tt.aH.Line&&(ut.nodeWidth>0&&(s.rect.width=ut.nodeWidth),ut.nodeHeight>0&&(s.rect.height=ut.nodeHeight),s.rect.height>w&&(w=s.rect.height),s.rect.x=V,s.rect.y=P,s.rect.init(),b.push(s),V+=s.rect.width+Ct,(V>ut.maxWidth||ut.maxCount>0&&b.length>=ut.maxCount)&&(L.push(b),b=[],V=D.x,P+=w+wt,w=0))}L.push(b);for(var l=0,d=L;l<d.length;l++){var s=d[l],a=(0,tt.Dz)(s);a.width=ut.maxWidth,vt(s,a,"middle"),ut.maxCount>0&&dt(s,ut.maxWidth)}}},97406:function(Pt,mt,ct){"use strict";ct.d(mt,{Z:function(){return vt}});var tt=ct(40275);function vt(dt,St){var gt;if(typeof Symbol=="undefined"||dt[Symbol.iterator]==null){if(Array.isArray(dt)||(gt=(0,tt.Z)(dt))||St&&dt&&typeof dt.length=="number"){gt&&(dt=gt);var ut=0,Ct=function(){};return{s:Ct,n:function(){return ut>=dt.length?{done:!0}:{done:!1,value:dt[ut++]}},e:function(L){throw L},f:Ct}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var wt=!0,D=!1,V;return{s:function(){gt=dt[Symbol.iterator]()},n:function(){var L=gt.next();return wt=L.done,L},e:function(L){D=!0,V=L},f:function(){try{!wt&&gt.return!=null&&gt.return()}finally{if(D)throw V}}}}},49826:function(Pt,mt,ct){"use strict";var tt=ct(93666),vt=ct.n(tt),dt=ct(25835),St=ct.n(dt)},48405:function(Pt,mt,ct){"use strict";var tt=ct(20324),vt=function(){return(0,tt.Z)(!1,"Icon","Empty Icon"),null};mt.Z=vt},33827:function(Pt,mt,ct){"use strict";var tt=ct(93666),vt=ct.n(tt),dt=ct(66273),St=ct.n(dt)},95921:function(Pt,mt,ct){var tt,vt,dt;(function(St,gt){vt=[],tt=gt,dt=typeof tt=="function"?tt.apply(mt,vt):tt,dt!==void 0&&(Pt.exports=dt)})(this,function(){"use strict";function St(P,L){return typeof L=="undefined"?L={autoBom:!1}:typeof L!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),L={autoBom:!L}),L.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(P.type)?new Blob(["\uFEFF",P],{type:P.type}):P}function gt(P,L,b){var w=new XMLHttpRequest;w.open("GET",P),w.responseType="blob",w.onload=function(){V(w.response,L,b)},w.onerror=function(){console.error("could not download file")},w.send()}function ut(P){var L=new XMLHttpRequest;L.open("HEAD",P,!1);try{L.send()}catch(b){}return 200<=L.status&&299>=L.status}function Ct(P){try{P.dispatchEvent(new MouseEvent("click"))}catch(b){var L=document.createEvent("MouseEvents");L.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),P.dispatchEvent(L)}}var wt=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ct.g=="object"&&ct.g.global===ct.g?ct.g:void 0,D=wt.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),V=wt.saveAs||(typeof window!="object"||window!==wt?function(){}:"download"in HTMLAnchorElement.prototype&&!D?function(P,L,b){var w=wt.URL||wt.webkitURL,C=document.createElement("a");L=L||P.name||"download",C.download=L,C.rel="noopener",typeof P=="string"?(C.href=P,C.origin===location.origin?Ct(C):ut(C.href)?gt(P,L,b):Ct(C,C.target="_blank")):(C.href=w.createObjectURL(P),setTimeout(function(){w.revokeObjectURL(C.href)},4e4),setTimeout(function(){Ct(C)},0))}:"msSaveOrOpenBlob"in navigator?function(P,L,b){if(L=L||P.name||"download",typeof P!="string")navigator.msSaveOrOpenBlob(St(P,b),L);else if(ut(P))gt(P,L,b);else{var w=document.createElement("a");w.href=P,w.target="_blank",setTimeout(function(){Ct(w)})}}:function(P,L,b,w){if(w=w||open("","_blank"),w&&(w.document.title=w.document.body.innerText="downloading..."),typeof P=="string")return gt(P,L,b);var C=P.type==="application/octet-stream",c=/constructor/i.test(wt.HTMLElement)||wt.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||C&&c||D)&&typeof FileReader!="undefined"){var l=new FileReader;l.onloadend=function(){var u=l.result;u=s?u:u.replace(/^data:[^;]*;/,"data:attachment/file;"),w?w.location.href=u:location=u,w=null},l.readAsDataURL(P)}else{var d=wt.URL||wt.webkitURL,a=d.createObjectURL(P);w?w.location=a:location.href=a,w=null,setTimeout(function(){d.revokeObjectURL(a)},4e4)}});wt.saveAs=V.saveAs=V,Pt.exports=V})},19720:function(Pt,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var ct=function(){function tt(){}return tt.get=function(vt){var dt,St=new RegExp("(^| )"+vt+"=([^;]*)(;|$)");return(dt=document.cookie.match(St))?decodeURIComponent(dt[2]):""},tt.set=function(vt,dt,St){var gt=window,ut=gt.escape(vt)+"="+gt.escape(dt)+";";if(St||(St={}),St.expires){var Ct=new Date(new Date().getTime()+St.expires*1e3*60*60*24);ut+="expires="+Ct.toUTCString()+";"}St.path&&(ut+="path="+St.path+";"),St.domain&&(ut+="domain="+St.domain+";"),document.cookie=ut},tt.delete=function(vt,dt){tt.get(vt)&&(dt||(dt={}),dt.expires=-1,tt.set(vt,"",dt))},tt}();mt.Cookie=ct},32362:function(Pt,mt,ct){"use strict";function tt(vt){for(var dt in vt)mt.hasOwnProperty(dt)||(mt[dt]=vt[dt])}Object.defineProperty(mt,"__esModule",{value:!0}),tt(ct(19720)),tt(ct(52960)),tt(ct(37763))},17346:function(Pt,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0}),mt.data={},mt.observers={}},37763:function(Pt,mt,ct){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var tt=ct(17346),vt=function(){function dt(St,gt,ut){this.key="",this.id=St,this.key=gt,this.fn=ut}return dt.prototype.unsubscribe=function(){delete tt.observers[this.id]},dt}();mt.Observer=vt},52960:function(Pt,mt,ct){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var tt=ct(17346),vt=ct(37763),dt=ct(32904),St=function(){function gt(){this.data={},this.observers={}}return gt.prototype.get=function(ut){return gt.get(ut,this.data)},gt.prototype.set=function(ut,Ct){gt.set(ut,Ct,this.data,this.observers)},gt.prototype.updated=function(ut){gt.updated(ut,this.data,this.observers)},gt.prototype.subscribe=function(ut,Ct){return gt.subscribe(ut,Ct,this.data,this.observers)},gt.get=function(ut,Ct){if(Ct||(Ct=tt.data),ut===void 0)return Ct;for(var wt=ut.split("."),D=0,V=wt;D<V.length;D++){var P=V[D];if(Ct=Ct[P],Ct===void 0)break}return Ct},gt.set=function(ut,Ct,wt,D){wt||(wt=tt.data),D||(D=tt.observers);for(var V=ut.split("."),P=wt,L=0;L<V.length-1;++L)P[V[L]]||(P[V[L]]={}),P=P[V[L]];P[V[V.length-1]]=Ct;for(var b in D)ut.indexOf(D[b].key)===0&&D[b].fn(gt.get(D[b].key,wt))},gt.updated=function(ut,Ct,wt){wt||(wt=tt.observers);for(var D in wt)ut.indexOf(wt[D].key)===0&&wt[D].fn(gt.get(wt[D].key,Ct))},gt.subscribe=function(ut,Ct,wt,D){D||(D=tt.observers);var V=dt.s8(),P=new vt.Observer(V,ut,Ct);D[V]=P;var L=gt.get(ut,wt);return L!==void 0&&Ct(L),P},gt}();mt.Store=St},32904:function(Pt,mt){"use strict";Object.defineProperty(mt,"__esModule",{value:!0});function ct(){return((1+Math.random())*65536|0).toString(16).substring(1)}mt.s4=ct;function tt(){return ct()+ct()}mt.s8=tt},99053:function(Pt,mt,ct){var tt=ct(94043),vt=ct(79764),dt=ct(25102),St=ct(21364),gt=ct(46507),ut=ct(30352),Ct=ct(37306),wt=ct(93450);(function(D){Pt.exports=D()})(function(){return function(){return function D(V,P,L){function b(c,s){if(!P[c]){if(!V[c]){var l=void 0;if(!s&&l)return require(c,!0);if(w)return w(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var a=P[c]={exports:{}};V[c][0].call(a.exports,function(u){return b(V[c][1][u]||u)},a,a.exports,D,V,P,L)}return P[c].exports}for(var w=void 0,C=0;C<L.length;C++)b(L[C]);return b}}()({1:[function(D,V,P){(function(L,b){(function(){"use strict";var w=D("events").EventEmitter,C=D("./store"),c=D("./topic-alias-recv"),s=D("./topic-alias-send"),l=D("mqtt-packet"),d=D("./default-message-id-provider"),a=D("readable-stream").Writable,u=D("inherits"),v=D("reinterval"),m=D("rfdc/default"),g=D("./validations"),k=D("xtend"),y=D("debug")("mqttjs:client"),T=L?L.nextTick:function(E){setTimeout(E,0)},O=b.setImmediate||function(E){T(E)},M={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},Y=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],N={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function G(E,R){var q;R.properties&&(q=R.properties.topicAlias);var Z=R.topic.toString();if(Z.length===0){if(q===void 0)return new Error("Unregistered Topic Alias");if((Z=E.topicAliasSend.getTopicByAlias(q))===void 0)return new Error("Unregistered Topic Alias");R.topic=Z}q&&delete R.properties.topicAlias}function et(E,R,q){y("sendPacket :: packet: %O",R),y("sendPacket :: emitting `packetsend`"),E.emit("packetsend",R),y("sendPacket :: writing to stream");var Z=l.writeToStream(R,E.stream,E.options);y("sendPacket :: writeToStream result %s",Z),!Z&&q&&q!==S?(y("sendPacket :: handle events on `drain` once through callback."),E.stream.once("drain",q)):q&&(y("sendPacket :: invoking cb"),q())}function F(E,R,q,Z){y("storeAndSend :: store packet with cmd %s to outgoingStore",R.cmd);var K,z=R;if(z.cmd==="publish"&&(z=m(R),K=G(E,z)))return q&&q(K);E.outgoingStore.put(z,function(j){if(j)return q&&q(j);Z(),et(E,R,q)})}function S(E){y("nop ::",E)}function _(E,R){var q,Z=this;if(!(this instanceof _))return new _(E,R);for(q in this.options=R||{},M)this.options[q]===void 0?this.options[q]=M[q]:this.options[q]=R[q];y("MqttClient :: options.protocol",R.protocol),y("MqttClient :: options.protocolVersion",R.protocolVersion),y("MqttClient :: options.username",R.username),y("MqttClient :: options.keepalive",R.keepalive),y("MqttClient :: options.reconnectPeriod",R.reconnectPeriod),y("MqttClient :: options.rejectUnauthorized",R.rejectUnauthorized),y("MqttClient :: options.topicAliasMaximum",R.topicAliasMaximum),this.options.clientId=typeof R.clientId=="string"?R.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),y("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=R.protocolVersion===5&&R.customHandleAcks?R.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=E,this.messageIdProvider=this.options.messageIdProvider===void 0?new d:this.options.messageIdProvider,this.outgoingStore=R.outgoingStore||new C,this.incomingStore=R.incomingStore||new C,this.queueQoSZero=R.queueQoSZero===void 0||R.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,R.topicAliasMaximum>0&&(R.topicAliasMaximum>65535?y("MqttClient :: options.topicAliasMaximum is out of range"):this.topicAliasRecv=new c(R.topicAliasMaximum)),this.on("connect",function(){var K=this.queue;y("connect :: sending queued packets"),function z(){var j=K.shift();y("deliver :: entry %o",j);var H=null;if(!j)return void Z._resubscribe();H=j.packet,y("deliver :: call _sendPacket for %o",H);var A=!0;H.messageId&&H.messageId!==0&&(Z.messageIdProvider.register(H.messageId)||(A=!1)),A?Z._sendPacket(H,function(J){j.cb&&j.cb(J),z()}):(y("messageId: %d has already used. The message is skipped and removed.",H.messageId),z())}()}),this.on("close",function(){y("close :: connected set to `false`"),this.connected=!1,y("close :: clearing connackTimer"),clearTimeout(this.connackTimer),y("close :: clearing ping timer"),Z.pingTimer!==null&&(Z.pingTimer.clear(),Z.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),y("close :: calling _setupReconnect"),this._setupReconnect()}),w.call(this),y("MqttClient :: setting up stream"),this._setupStream()}u(_,w),_.prototype._setupStream=function(){var E=this,R=this,q=new a,Z=l.parser(this.options),K=null,z=[];function j(){if(z.length)T(H);else{var J=K;K=null,J()}}function H(){y("work :: getting next packet in queue");var J=z.shift();if(J)y("work :: packet pulled from queue"),R._handlePacket(J,j);else{y("work :: no packets in queue");var rt=K;K=null,y("work :: done flag is %s",!!rt),rt&&rt()}}y("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),y("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),Z.on("packet",function(J){y("parser :: on packet push to packets array."),z.push(J)}),q._write=function(J,rt,$){K=$,y("writable stream :: parsing buffer"),Z.parse(J),H()},y("_setupStream :: pipe stream to writable stream"),this.stream.pipe(q),this.stream.on("error",function(J){y("streamErrorHandler :: error",J.message),Y.includes(J.code)?(y("streamErrorHandler :: emitting error"),R.emit("error",J)):S(J)}),this.stream.on("close",function(){var J;y("(%s)stream :: on close",R.options.clientId),(J=R.outgoing)&&(y("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(J).forEach(function(rt){J[rt].volatile&&typeof J[rt].cb=="function"&&(J[rt].cb(new Error("Connection closed")),delete J[rt])})),y("stream: emit close to MqttClient"),R.emit("close")}),y("_setupStream: sending packet `connect`");var A=Object.create(this.options);if(A.cmd="connect",this.topicAliasRecv&&(A.properties||(A.properties={}),this.topicAliasRecv&&(A.properties.topicAliasMaximum=this.topicAliasRecv.max)),et(this,A),Z.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return R.end(function(){return E.emit("error",new Error("Packet has no Authentication Method"))}),this;this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"&&et(this,k({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){y("!!connectTimeout hit!! Calling _cleanUp with force `true`"),R._cleanUp(!0)},this.options.connectTimeout)},_.prototype._handlePacket=function(E,R){var q=this.options;if(q.protocolVersion===5&&q.properties&&q.properties.maximumPacketSize&&q.properties.maximumPacketSize<E.length)return this.emit("error",new Error("exceeding packets size "+E.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(y("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",E),E.cmd){case"publish":this._handlePublish(E,R);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(E),R();break;case"pubrel":this._handlePubrel(E,R);break;case"connack":this._handleConnack(E),R();break;case"auth":this._handleAuth(E),R();break;case"pingresp":this._handlePingresp(E),R();break;case"disconnect":this._handleDisconnect(E),R()}},_.prototype._checkDisconnecting=function(E){return this.disconnecting&&(E&&E!==S?E(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},_.prototype.publish=function(E,R,q,Z){y("publish :: message `%s` to topic `%s`",R,E);var K=this.options;if(typeof q=="function"&&(Z=q,q=null),q=k({qos:0,retain:!1,dup:!1},q),this._checkDisconnecting(Z))return this;var z=this,j=function(){var A=0;if((q.qos===1||q.qos===2)&&(A=z._nextId())===null)return y("No messageId left"),!1;var J={cmd:"publish",topic:E,payload:R,qos:q.qos,retain:q.retain,messageId:A,dup:q.dup};switch(K.protocolVersion===5&&(J.properties=q.properties),y("publish :: qos",q.qos),q.qos){case 1:case 2:z.outgoing[J.messageId]={volatile:!1,cb:Z||S},y("MqttClient:publish: packet cmd: %s",J.cmd),z._sendPacket(J,void 0,q.cbStorePut);break;default:y("MqttClient:publish: packet cmd: %s",J.cmd),z._sendPacket(J,Z,q.cbStorePut)}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!j())&&this._storeProcessingQueue.push({invoke:j,cbStorePut:q.cbStorePut,callback:Z}),this},_.prototype.subscribe=function(){for(var E=this,R=new Array(arguments.length),q=0;q<arguments.length;q++)R[q]=arguments[q];var Z=[],K=R.shift(),z=K.resubscribe,j=R.pop()||S,H=R.pop(),A=this.options.protocolVersion;delete K.resubscribe,typeof K=="string"&&(K=[K]),typeof j!="function"&&(H=j,j=S);var J=g.validateTopics(K);if(J!==null)return O(j,new Error("Invalid topic "+J)),this;if(this._checkDisconnecting(j))return y("subscribe: discconecting true"),this;var rt={qos:0};if(A===5&&(rt.nl=!1,rt.rap=!1,rt.rh=0),H=k(rt,H),Array.isArray(K)?K.forEach(function(at){if(y("subscribe: array topic %s",at),!Object.prototype.hasOwnProperty.call(E._resubscribeTopics,at)||E._resubscribeTopics[at].qos<H.qos||z){var nt={topic:at,qos:H.qos};A===5&&(nt.nl=H.nl,nt.rap=H.rap,nt.rh=H.rh,nt.properties=H.properties),y("subscribe: pushing topic `%s` and qos `%s` to subs list",nt.topic,nt.qos),Z.push(nt)}}):Object.keys(K).forEach(function(at){if(y("subscribe: object topic %s",at),!Object.prototype.hasOwnProperty.call(E._resubscribeTopics,at)||E._resubscribeTopics[at].qos<K[at].qos||z){var nt={topic:at,qos:K[at].qos};A===5&&(nt.nl=K[at].nl,nt.rap=K[at].rap,nt.rh=K[at].rh,nt.properties=H.properties),y("subscribe: pushing `%s` to subs list",nt),Z.push(nt)}}),!Z.length)return j(null,[]),this;var $=function(){var nt=E._nextId();if(nt===null)return y("No messageId left"),!1;var st={cmd:"subscribe",subscriptions:Z,qos:1,retain:!1,dup:!1,messageId:nt};if(H.properties&&(st.properties=H.properties),E.options.resubscribe){y("subscribe :: resubscribe true");var h=[];Z.forEach(function(f){if(E.options.reconnectPeriod>0){var I={qos:f.qos};A===5&&(I.nl=f.nl||!1,I.rap=f.rap||!1,I.rh=f.rh||0,I.properties=f.properties),E._resubscribeTopics[f.topic]=I,h.push(f.topic)}}),E.messageIdToTopic[st.messageId]=h}return E.outgoing[st.messageId]={volatile:!0,cb:function(I,B){if(!I)for(var X=B.granted,Q=0;Q<X.length;Q+=1)Z[Q].qos=X[Q];j(I,Z)}},y("subscribe :: call _sendPacket"),E._sendPacket(st),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!$())&&this._storeProcessingQueue.push({invoke:$,callback:j}),this},_.prototype.unsubscribe=function(){for(var E=this,R=new Array(arguments.length),q=0;q<arguments.length;q++)R[q]=arguments[q];var Z=R.shift(),K=R.pop()||S,z=R.pop();typeof Z=="string"&&(Z=[Z]),typeof K!="function"&&(z=K,K=S);var j=g.validateTopics(Z);if(j!==null)return O(K,new Error("Invalid topic "+j)),this;if(E._checkDisconnecting(K))return this;var H=function(){var J=E._nextId();if(J===null)return y("No messageId left"),!1;var rt={cmd:"unsubscribe",qos:1,messageId:J};return typeof Z=="string"?rt.unsubscriptions=[Z]:Array.isArray(Z)&&(rt.unsubscriptions=Z),E.options.resubscribe&&rt.unsubscriptions.forEach(function($){delete E._resubscribeTopics[$]}),typeof z=="object"&&z.properties&&(rt.properties=z.properties),E.outgoing[rt.messageId]={volatile:!0,cb:K},y("unsubscribe: call _sendPacket"),E._sendPacket(rt),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!H())&&this._storeProcessingQueue.push({invoke:H,callback:K}),this},_.prototype.end=function(E,R,q){var Z=this;function K(){y("end :: (%s) :: finish :: calling _cleanUp with force %s",Z.options.clientId,E),Z._cleanUp(E,function(){y("end :: finish :: calling process.nextTick on closeStores"),T(function(){y("end :: closeStores: closing incoming and outgoing stores"),Z.disconnected=!0,Z.incomingStore.close(function(z){Z.outgoingStore.close(function(j){if(y("end :: closeStores: emitting end"),Z.emit("end"),q){var H=z||j;y("end :: closeStores: invoking callback with args"),q(H)}})}),Z._deferredReconnect&&Z._deferredReconnect()}.bind(Z))},R)}return y("end :: (%s)",this.options.clientId),E!=null&&typeof E=="boolean"||(q=R||S,R=E,E=!1,typeof R!="object"&&(q=R,R=null,typeof q!="function"&&(q=S))),typeof R!="object"&&(q=R,R=null),y("end :: cb? %s",!!q),q=q||S,this.disconnecting?(q(),this):(this._clearReconnect(),this.disconnecting=!0,!E&&Object.keys(this.outgoing).length>0?(y("end :: (%s) :: calling finish in 10ms once outgoing is empty",Z.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,K,10))):(y("end :: (%s) :: immediately calling finish",Z.options.clientId),K()),this)},_.prototype.removeOutgoingMessage=function(E){var R=this.outgoing[E]?this.outgoing[E].cb:null;return delete this.outgoing[E],this.outgoingStore.del({messageId:E},function(){R(new Error("Message removed"))}),this},_.prototype.reconnect=function(E){y("client reconnect");var R=this,q=function(){E?(R.options.incomingStore=E.incomingStore,R.options.outgoingStore=E.outgoingStore):(R.options.incomingStore=null,R.options.outgoingStore=null),R.incomingStore=R.options.incomingStore||new C,R.outgoingStore=R.options.outgoingStore||new C,R.disconnecting=!1,R.disconnected=!1,R._deferredReconnect=null,R._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=q:q(),this},_.prototype._reconnect=function(){var E=this;y("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(function(){E._setupStream()}),y("client already connected. disconnecting first.")):(y("_reconnect: calling _setupStream"),this._setupStream())},_.prototype._setupReconnect=function(){var E=this;!E.disconnecting&&!E.reconnectTimer&&E.options.reconnectPeriod>0?(this.reconnecting||(y("_setupReconnect :: emit `offline` state"),this.emit("offline"),y("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),y("_setupReconnect :: setting reconnectTimer for %d ms",E.options.reconnectPeriod),E.reconnectTimer=setInterval(function(){y("reconnectTimer :: reconnect triggered!"),E._reconnect()},E.options.reconnectPeriod)):y("_setupReconnect :: doing nothing...")},_.prototype._clearReconnect=function(){y("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},_.prototype._cleanUp=function(E,R){var q=arguments[2];if(R&&(y("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",R)),y("_cleanUp :: forced? %s",E),E)this.options.reconnectPeriod===0&&this.options.clean&&(K=this.outgoing)&&(y("flush: queue exists? %b",!!K),Object.keys(K).forEach(function(z){typeof K[z].cb=="function"&&(K[z].cb(new Error("Connection closed")),delete K[z])})),y("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{var Z=k({cmd:"disconnect"},q);y("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(Z,O.bind(null,this.stream.end.bind(this.stream)))}var K;this.disconnecting||(y("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer!==null&&(y("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),R&&!this.connected&&(y("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",R),R())},_.prototype._sendPacket=function(E,R,q){y("_sendPacket :: (%s) ::  start",this.options.clientId),q=q||S,R=R||S;var Z=function(K,z){if(K.options.protocolVersion===5&&z.cmd==="publish"){var j;z.properties&&(j=z.properties.topicAlias);var H=z.topic.toString();if(K.topicAliasSend)if(j){if(H.length!==0&&(y("applyTopicAlias :: register topic: %s - alias: %d",H,j),!K.topicAliasSend.put(H,j)))return y("applyTopicAlias :: error out of range. topic: %s - alias: %d",H,j),new Error("Sending Topic Alias out of range")}else H.length!==0&&(K.options.autoAssignTopicAlias?(j=K.topicAliasSend.getAliasByTopic(H))?(z.topic="",z.properties=wt(wt({},z.properties),{},{topicAlias:j}),y("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",H,j)):(j=K.topicAliasSend.getLruAlias(),K.topicAliasSend.put(H,j),z.properties=wt(wt({},z.properties),{},{topicAlias:j}),y("applyTopicAlias :: auto assign topic: %s - alias: %d",H,j)):K.options.autoUseTopicAlias&&(j=K.topicAliasSend.getAliasByTopic(H))&&(z.topic="",z.properties=wt(wt({},z.properties),{},{topicAlias:j}),y("applyTopicAlias :: auto use topic: %s - alias: %d",H,j)));else if(j)return y("applyTopicAlias :: error out of range. topic: %s - alias: %d",H,j),new Error("Sending Topic Alias out of range")}}(this,E);if(Z)R(Z);else{if(!this.connected)return E.cmd==="auth"?(this._shiftPingInterval(),void et(this,E,R)):(y("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(E,R,q));switch(this._shiftPingInterval(),E.cmd){case"publish":break;case"pubrel":return void F(this,E,R,q);default:return void et(this,E,R)}switch(E.qos){case 2:case 1:F(this,E,R,q);break;case 0:default:et(this,E,R)}y("_sendPacket :: (%s) ::  end",this.options.clientId)}},_.prototype._storePacket=function(E,R,q){y("_storePacket :: packet: %o",E),y("_storePacket :: cb? %s",!!R),q=q||S;var Z=E;if(Z.cmd==="publish"){var K=G(this,Z=m(E));if(K)return R&&R(K)}(Z.qos||0)===0&&this.queueQoSZero||Z.cmd!=="publish"?this.queue.push({packet:Z,cb:R}):Z.qos>0?(R=this.outgoing[Z.messageId]?this.outgoing[Z.messageId].cb:null,this.outgoingStore.put(Z,function(z){if(z)return R&&R(z);q()})):R&&R(new Error("No connection to broker"))},_.prototype._setupPingTimer=function(){y("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);var E=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=v(function(){E._checkPing()},1e3*this.options.keepalive))},_.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},_.prototype._checkPing=function(){y("_checkPing :: checking ping..."),this.pingResp?(y("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(y("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))},_.prototype._handlePingresp=function(){this.pingResp=!0},_.prototype._handleConnack=function(E){y("_handleConnack");var R=this.options,q=R.protocolVersion===5?E.reasonCode:E.returnCode;if(clearTimeout(this.connackTimer),delete this.topicAliasSend,E.properties){if(E.properties.topicAliasMaximum){if(E.properties.topicAliasMaximum>65535)return void this.emit("error",new Error("topicAliasMaximum from broker is out of range"));E.properties.topicAliasMaximum>0&&(this.topicAliasSend=new s(E.properties.topicAliasMaximum))}E.properties.serverKeepAlive&&R.keepalive&&(R.keepalive=E.properties.serverKeepAlive,this._shiftPingInterval()),E.properties.maximumPacketSize&&(R.properties||(R.properties={}),R.properties.maximumPacketSize=E.properties.maximumPacketSize)}if(q===0)this.reconnecting=!1,this._onConnect(E);else if(q>0){var Z=new Error("Connection refused: "+N[q]);Z.code=q,this.emit("error",Z)}},_.prototype._handleAuth=function(E){var R=this.options.protocolVersion,q=R===5?E.reasonCode:E.returnCode;if(R!==5){var Z=new Error("Protocol error: Auth packets are only supported in MQTT 5. Your version:"+R);return Z.code=q,void this.emit("error",Z)}var K=this;this.handleAuth(E,function(z,j){if(z)K.emit("error",z);else if(q===24)K.reconnecting=!1,K._sendPacket(j);else{var H=new Error("Connection refused: "+N[q]);z.code=q,K.emit("error",H)}})},_.prototype.handleAuth=function(E,R){R()},_.prototype._handlePublish=function(E,R){y("_handlePublish: packet %o",E),R=R!==void 0?R:S;var q=E.topic.toString(),Z=E.payload,K=E.qos,z=E.messageId,j=this,H=this.options,A=[0,16,128,131,135,144,145,151,153];if(this.options.protocolVersion===5){var J;if(E.properties&&(J=E.properties.topicAlias),J!==void 0)if(q.length===0){if(!(J>0&&J<=65535))return y("_handlePublish :: topic alias out of range. alias: %d",J),void this.emit("error",new Error("Received Topic Alias is out of range"));{var rt=this.topicAliasRecv.getTopicByAlias(J);if(!rt)return y("_handlePublish :: unregistered topic alias. alias: %d",J),void this.emit("error",new Error("Received unregistered Topic Alias"));y("_handlePublish :: topic complemented by alias. topic: %s - alias: %d",q=rt,J)}}else{if(!this.topicAliasRecv.put(q,J))return y("_handlePublish :: topic alias out of range. alias: %d",J),void this.emit("error",new Error("Received Topic Alias is out of range"));y("_handlePublish :: registered topic: %s - alias: %d",q,J)}}switch(y("_handlePublish: qos %d",K),K){case 2:H.customHandleAcks(q,Z,E,function($,at){return $ instanceof Error||(at=$,$=null),$?j.emit("error",$):A.indexOf(at)===-1?j.emit("error",new Error("Wrong reason code for pubrec")):void(at?j._sendPacket({cmd:"pubrec",messageId:z,reasonCode:at},R):j.incomingStore.put(E,function(){j._sendPacket({cmd:"pubrec",messageId:z},R)}))});break;case 1:H.customHandleAcks(q,Z,E,function($,at){return $ instanceof Error||(at=$,$=null),$?j.emit("error",$):A.indexOf(at)===-1?j.emit("error",new Error("Wrong reason code for puback")):(at||j.emit("message",q,Z,E),void j.handleMessage(E,function(nt){if(nt)return R&&R(nt);j._sendPacket({cmd:"puback",messageId:z,reasonCode:at},R)}))});break;case 0:this.emit("message",q,Z,E),this.handleMessage(E,R);break;default:y("_handlePublish: unknown QoS. Doing nothing.")}},_.prototype.handleMessage=function(E,R){R()},_.prototype._handleAck=function(E){var R=E.messageId,q=E.cmd,Z=null,K=this.outgoing[R]?this.outgoing[R].cb:null,z=this,j;if(K){switch(y("_handleAck :: packet type",q),q){case"pubcomp":case"puback":{var H=E.reasonCode;H&&H>0&&H!==16&&((j=new Error("Publish error: "+N[H])).code=H,K(j,E)),delete this.outgoing[R],this.outgoingStore.del(E,K),this.messageIdProvider.deallocate(R),this._invokeStoreProcessingQueue();break}case"pubrec":{Z={cmd:"pubrel",qos:2,messageId:R};var A=E.reasonCode;A&&A>0&&A!==16?((j=new Error("Publish error: "+N[A])).code=A,K(j,E)):this._sendPacket(Z);break}case"suback":delete this.outgoing[R],this.messageIdProvider.deallocate(R);for(var J=0;J<E.granted.length;J++)if((128&E.granted[J])!=0){var rt=this.messageIdToTopic[R];rt&&rt.forEach(function($){delete z._resubscribeTopics[$]})}this._invokeStoreProcessingQueue(),K(null,E);break;case"unsuback":delete this.outgoing[R],this.messageIdProvider.deallocate(R),this._invokeStoreProcessingQueue(),K(null);break;default:z.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&Object.keys(this.outgoing).length===0&&this.emit("outgoingEmpty")}else y("_handleAck :: Server sent an ack in error. Ignoring.")},_.prototype._handlePubrel=function(E,R){y("handling pubrel packet"),R=R!==void 0?R:S;var q=this,Z={cmd:"pubcomp",messageId:E.messageId};q.incomingStore.get(E,function(K,z){K?q._sendPacket(Z,R):(q.emit("message",z.topic,z.payload,z),q.handleMessage(z,function(j){if(j)return R(j);q.incomingStore.del(z,S),q._sendPacket(Z,R)}))})},_.prototype._handleDisconnect=function(E){this.emit("disconnect",E)},_.prototype._nextId=function(){return this.messageIdProvider.allocate()},_.prototype.getLastMessageId=function(){return this.messageIdProvider.getLastAllocated()},_.prototype._resubscribe=function(){y("_resubscribe");var E=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion===5&&!this.connackPacket.sessionPresent)&&E.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){y("_resubscribe: protocolVersion 5");for(var R=0;R<E.length;R++){var q={};q[E[R]]=this._resubscribeTopics[E[R]],q.resubscribe=!0,this.subscribe(q,{properties:q[E[R]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},_.prototype._onConnect=function(E){if(this.disconnected)return void this.emit("connect",E);var R=this;this.connackPacket=E,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0,function q(){var Z=R.outgoingStore.createStream();function K(){R._storeProcessing=!1,R._packetIdsDuringStoreProcessing={}}function z(){Z.destroy(),Z=null,R._flushStoreProcessingQueue(),K()}R.once("close",z),Z.on("error",function(j){K(),R._flushStoreProcessingQueue(),R.removeListener("close",z),R.emit("error",j)}),Z.on("end",function(){var j=!0;for(var H in R._packetIdsDuringStoreProcessing)if(!R._packetIdsDuringStoreProcessing[H]){j=!1;break}j?(K(),R.removeListener("close",z),R._invokeAllStoreProcessingQueue(),R.emit("connect",E)):q()}),function j(){if(!!Z){R._storeProcessing=!0;var H=Z.read(1),A;H?R._packetIdsDuringStoreProcessing[H.messageId]?j():R.disconnecting||R.reconnectTimer?Z.destroy&&Z.destroy():(A=R.outgoing[H.messageId]?R.outgoing[H.messageId].cb:null,R.outgoing[H.messageId]={volatile:!1,cb:function(rt,$){A&&A(rt,$),j()}},R._packetIdsDuringStoreProcessing[H.messageId]=!0,R.messageIdProvider.register(H.messageId)?R._sendPacket(H):y("messageId: %d has already used.",H.messageId)):Z.once("readable",j)}}()}()},_.prototype._invokeStoreProcessingQueue=function(){if(this._storeProcessingQueue.length>0){var E=this._storeProcessingQueue[0];if(E&&E.invoke())return this._storeProcessingQueue.shift(),!0}return!1},_.prototype._invokeAllStoreProcessingQueue=function(){for(;this._invokeStoreProcessingQueue(););},_.prototype._flushStoreProcessingQueue=function(){var E=Ct(this._storeProcessingQueue),R;try{for(E.s();!(R=E.n()).done;){var q=R.value;q.cbStorePut&&q.cbStorePut(new Error("Connection closed")),q.callback&&q.callback(new Error("Connection closed"))}}catch(Z){E.e(Z)}finally{E.f()}this._storeProcessingQueue.splice(0)},V.exports=_}).call(this)}).call(this,D("_process"),typeof ct.g!="undefined"?ct.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./default-message-id-provider":7,"./store":8,"./topic-alias-recv":9,"./topic-alias-send":10,"./validations":11,_process:50,debug:18,events:22,inherits:24,"mqtt-packet":40,"readable-stream":69,reinterval:70,"rfdc/default":71,xtend:81}],2:[function(D,V,P){"use strict";var L=D("buffer"),b=L.Buffer,w=D("readable-stream").Transform,C=D("duplexify"),c,s,l,d=!1;V.exports=function(a,u){if(u.hostname=u.hostname||u.host,!u.hostname)throw new Error("Could not determine host. Specify host manually.");var v=u.protocolId==="MQIsdp"&&u.protocolVersion===3?"mqttv3.1":"mqtt";(function(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})})(u);var m=function(g,k){var y=g.protocol==="alis"?"wss":"ws",T=y+"://"+g.hostname+g.path;return g.port&&g.port!==80&&g.port!==443&&(T=y+"://"+g.hostname+":"+g.port+g.path),typeof g.transformWsUrl=="function"&&(T=g.transformWsUrl(T,g,k)),T}(u,a);return(c=u.my).connectSocket({url:m,protocols:v}),s=function(){var g=new w;return g._write=function(k,y,T){c.sendSocketMessage({data:k.buffer,success:function(){T()},fail:function(){T(new Error)}})},g._flush=function(k){c.closeSocket({success:function(){k()}})},g}(),l=C.obj(),d||(d=!0,c.onSocketOpen(function(){l.setReadable(s),l.setWritable(s),l.emit("connect")}),c.onSocketMessage(function(g){if(typeof g.data=="string"){var k=b.from(g.data,"base64");s.push(k)}else{var y=new FileReader;y.addEventListener("load",function(){var T=y.result;T=T instanceof ArrayBuffer?b.from(T):b.from(T,"utf8"),s.push(T)}),y.readAsArrayBuffer(g.data)}}),c.onSocketClose(function(){l.end(),l.destroy()}),c.onSocketError(function(g){l.destroy(g)})),l}},{buffer:17,duplexify:20,"readable-stream":69}],3:[function(D,V,P){"use strict";var L=D("net"),b=D("debug")("mqttjs:tcp");V.exports=function(w,C){C.port=C.port||1883,C.hostname=C.hostname||C.host||"localhost";var c=C.port,s=C.hostname;return b("port %d and host %s",c,s),L.createConnection(c,s)}},{debug:18,net:16}],4:[function(D,V,P){"use strict";var L=D("tls"),b=D("net"),w=D("debug")("mqttjs:tls");V.exports=function(C,c){c.port=c.port||8883,c.host=c.hostname||c.host||"localhost",b.isIP(c.host)===0&&(c.servername=c.host),c.rejectUnauthorized=c.rejectUnauthorized!==!1,delete c.path,w("port %d host %s rejectUnauthorized %b",c.port,c.host,c.rejectUnauthorized);var s=L.connect(c);function l(d){c.rejectUnauthorized&&C.emit("error",d),s.end()}return s.on("secureConnect",function(){c.rejectUnauthorized&&!s.authorized?s.emit("error",new Error("TLS not authorized")):s.removeListener("error",l)}),s.on("error",l),s}},{debug:18,net:16,tls:16}],5:[function(D,V,P){(function(L){(function(){"use strict";var b=D("buffer"),w=b.Buffer,C=D("ws"),c=D("debug")("mqttjs:ws"),s=D("duplexify"),l=D("readable-stream").Transform,d=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],a=L!==void 0&&L.title==="browser"||typeof ct=="function";function u(m,g){var k=m.protocol+"://"+m.hostname+":"+m.port+m.path;return typeof m.transformWsUrl=="function"&&(k=m.transformWsUrl(k,m,g)),k}function v(m){var g=m;return m.hostname||(g.hostname="localhost"),m.port||(m.protocol==="wss"?g.port=443:g.port=80),m.path||(g.path="/"),m.wsOptions||(g.wsOptions={}),a||m.protocol!=="wss"||d.forEach(function(k){Object.prototype.hasOwnProperty.call(m,k)&&!Object.prototype.hasOwnProperty.call(m.wsOptions,k)&&(g.wsOptions[k]=m[k])}),g}V.exports=a?function(m,g){var k;c("browserStreamBuilder");var y=function(E){var R=v(E);if(R.hostname||(R.hostname=R.host),!R.hostname){if(typeof document=="undefined")throw new Error("Could not determine host. Specify host manually.");var q=new URL(document.URL);R.hostname=q.hostname,R.port||(R.port=q.port)}return R.objectMode===void 0&&(R.objectMode=!(R.binary===!0||R.binary===void 0)),R}(g).browserBufferSize||524288,T=g.browserBufferTimeout||1e3,O=!g.objectMode,M=function(E,R){var q=R.protocolId==="MQIsdp"&&R.protocolVersion===3?"mqttv3.1":"mqtt",Z=u(R,E),K=new WebSocket(Z,[q]);return K.binaryType="arraybuffer",K}(m,g),Y=function(E,R,q){var Z=new l({objectModeMode:E.objectMode});return Z._write=R,Z._flush=q,Z}(g,function E(R,q,Z){M.bufferedAmount>y&&setTimeout(E,T,R,q,Z),O&&typeof R=="string"&&(R=w.from(R,"utf8"));try{M.send(R)}catch(K){return Z(K)}Z()},function(E){M.close(),E()});g.objectMode||(Y._writev=_),Y.on("close",function(){M.close()});var N=M.addEventListener!==void 0;function G(){k.setReadable(Y),k.setWritable(Y),k.emit("connect")}function et(){k.end(),k.destroy()}function F(E){k.destroy(E)}function S(E){var R=E.data;R=R instanceof ArrayBuffer?w.from(R):w.from(R,"utf8"),Y.push(R)}function _(E,R){for(var q=new Array(E.length),Z=0;Z<E.length;Z++)typeof E[Z].chunk=="string"?q[Z]=w.from(E[Z],"utf8"):q[Z]=E[Z].chunk;this._write(w.concat(q),"binary",R)}return M.readyState===M.OPEN?k=Y:(k=k=s(void 0,void 0,g),g.objectMode||(k._writev=_),N?M.addEventListener("open",G):M.onopen=G),k.socket=M,N?(M.addEventListener("close",et),M.addEventListener("error",F),M.addEventListener("message",S)):(M.onclose=et,M.onerror=F,M.onmessage=S),k}:function(m,g){c("streamBuilder");var k=v(g),y=u(k,m),T=function(M,Y,N){c("createWebSocket"),c("protocol: "+N.protocolId+" "+N.protocolVersion);var G=N.protocolId==="MQIsdp"&&N.protocolVersion===3?"mqttv3.1":"mqtt";return c("creating new Websocket for url: "+Y+" and protocol: "+G),new C(Y,[G],N.wsOptions)}(0,y,k),O=C.createWebSocketStream(T,k.wsOptions);return O.url=y,T.on("close",function(){O.destroy()}),O}}).call(this)}).call(this,D("_process"))},{_process:50,buffer:17,debug:18,duplexify:20,"readable-stream":69,ws:80}],6:[function(D,V,P){"use strict";var L=D("buffer"),b=L.Buffer,w=D("readable-stream").Transform,C=D("duplexify"),c,s,l;V.exports=function(d,a){if(a.hostname=a.hostname||a.host,!a.hostname)throw new Error("Could not determine host. Specify host manually.");var u=a.protocolId==="MQIsdp"&&a.protocolVersion===3?"mqttv3.1":"mqtt";(function(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})})(a);var v=function(g,k){var y=g.protocol==="wxs"?"wss":"ws",T=y+"://"+g.hostname+g.path;return g.port&&g.port!==80&&g.port!==443&&(T=y+"://"+g.hostname+":"+g.port+g.path),typeof g.transformWsUrl=="function"&&(T=g.transformWsUrl(T,g,k)),T}(a,d);c=wx.connectSocket({url:v,protocols:[u]}),s=function(){var g=new w;return g._write=function(k,y,T){c.send({data:k.buffer,success:function(){T()},fail:function(M){T(new Error(M))}})},g._flush=function(k){c.close({success:function(){k()}})},g}(),(l=C.obj())._destroy=function(g,k){c.close({success:function(){k&&k(g)}})};var m=l.destroy;return l.destroy=function(){l.destroy=m;var g=this;setTimeout(function(){c.close({fail:function(){g._destroy(new Error)}})},0)}.bind(l),c.onOpen(function(){l.setReadable(s),l.setWritable(s),l.emit("connect")}),c.onMessage(function(g){var k=g.data;k=k instanceof ArrayBuffer?b.from(k):b.from(k,"utf8"),s.push(k)}),c.onClose(function(){l.end(),l.destroy()}),c.onError(function(g){l.destroy(new Error(g.errMsg))}),l}},{buffer:17,duplexify:20,"readable-stream":69}],7:[function(D,V,P){"use strict";function L(){if(!(this instanceof L))return new L;this.nextId=Math.max(1,Math.floor(65535*Math.random()))}L.prototype.allocate=function(){var b=this.nextId++;return this.nextId===65536&&(this.nextId=1),b},L.prototype.getLastAllocated=function(){return this.nextId===1?65535:this.nextId-1},L.prototype.register=function(b){return!0},L.prototype.deallocate=function(b){},L.prototype.clear=function(){},V.exports=L},{}],8:[function(D,V,P){"use strict";var L=D("xtend"),b=D("readable-stream").Readable,w={objectMode:!0},C={clean:!0};function c(s){if(!(this instanceof c))return new c(s);this.options=s||{},this.options=L(C,s),this._inflights=new Map}c.prototype.put=function(s,l){return this._inflights.set(s.messageId,s),l&&l(),this},c.prototype.createStream=function(){var s=new b(w),l=[],d=!1,a=0;return this._inflights.forEach(function(u,v){l.push(u)}),s._read=function(){!d&&a<l.length?this.push(l[a++]):this.push(null)},s.destroy=function(){if(!d){var u=this;d=!0,setTimeout(function(){u.emit("close")},0)}},s},c.prototype.del=function(s,l){return(s=this._inflights.get(s.messageId))?(this._inflights.delete(s.messageId),l(null,s)):l&&l(new Error("missing packet")),this},c.prototype.get=function(s,l){return(s=this._inflights.get(s.messageId))?l(null,s):l&&l(new Error("missing packet")),this},c.prototype.close=function(s){this.options.clean&&(this._inflights=null),s&&s()},V.exports=c},{"readable-stream":69,xtend:81}],9:[function(D,V,P){"use strict";function L(b){if(!(this instanceof L))return new L(b);this.aliasToTopic={},this.max=b}L.prototype.put=function(b,w){return!(w===0||w>this.max)&&(this.aliasToTopic[w]=b,this.length=Object.keys(this.aliasToTopic).length,!0)},L.prototype.getTopicByAlias=function(b){return this.aliasToTopic[b]},L.prototype.clear=function(){this.aliasToTopic={}},V.exports=L},{}],10:[function(D,V,P){"use strict";var L=D("lru-cache"),b=D("number-allocator").NumberAllocator;function w(C){if(!(this instanceof w))return new w(C);C>0&&(this.aliasToTopic=new L({max:C}),this.topicToAlias={},this.numberAllocator=new b(1,C),this.max=C,this.length=0)}w.prototype.put=function(C,c){if(c===0||c>this.max)return!1;var s=this.aliasToTopic.get(c);return s&&delete this.topicToAlias[s],this.aliasToTopic.set(c,C),this.topicToAlias[C]=c,this.numberAllocator.use(c),this.length=this.aliasToTopic.length,!0},w.prototype.getTopicByAlias=function(C){return this.aliasToTopic.get(C)},w.prototype.getAliasByTopic=function(C){var c=this.topicToAlias[C];return c!==void 0&&this.aliasToTopic.get(c),c},w.prototype.clear=function(){this.aliasToTopic.reset(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0},w.prototype.getLruAlias=function(){var C=this.numberAllocator.firstVacant();return C||this.aliasToTopic.keys()[this.aliasToTopic.length-1]},V.exports=w},{"lru-cache":37,"number-allocator":46}],11:[function(D,V,P){"use strict";function L(b){for(var w=b.split("/"),C=0;C<w.length;C++)if(w[C]!=="+"){if(w[C]==="#")return C===w.length-1;if(w[C].indexOf("+")!==-1||w[C].indexOf("#")!==-1)return!1}return!0}V.exports={validateTopics:function(w){if(w.length===0)return"empty_topic_list";for(var C=0;C<w.length;C++)if(!L(w[C]))return w[C];return null}}},{}],12:[function(D,V,P){(function(L){(function(){"use strict";var b=D("../client"),w=D("../store"),C=D("url"),c=D("xtend"),s=D("debug")("mqttjs"),l={};function d(a,u){if(s("connecting to an MQTT broker..."),typeof a!="object"||u||(u=a,a=null),u=u||{},a){var v=C.parse(a,!0);if(v.port!=null&&(v.port=Number(v.port)),(u=c(v,u)).protocol===null)throw new Error("Missing protocol");u.protocol=u.protocol.replace(/:$/,"")}if(function(k){var y;k.auth&&((y=k.auth.match(/^(.+):(.+)$/))?(k.username=y[1],k.password=y[2]):k.username=k.auth)}(u),u.query&&typeof u.query.clientId=="string"&&(u.clientId=u.query.clientId),u.cert&&u.key){if(!u.protocol)throw new Error("Missing secure protocol key");if(["mqtts","wss","wxs","alis"].indexOf(u.protocol)===-1)switch(u.protocol){case"mqtt":u.protocol="mqtts";break;case"ws":u.protocol="wss";break;case"wx":u.protocol="wxs";break;case"ali":u.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+u.protocol+'"!')}}if(!l[u.protocol]){var m=["mqtts","wss"].indexOf(u.protocol)!==-1;u.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(k,y){return(!m||y%2!=0)&&typeof l[k]=="function"})[0]}if(u.clean===!1&&!u.clientId)throw new Error("Missing clientId for unclean clients");u.protocol&&(u.defaultProtocol=u.protocol);var g=new b(function(k){return u.servers&&(k._reconnectCount&&k._reconnectCount!==u.servers.length||(k._reconnectCount=0),u.host=u.servers[k._reconnectCount].host,u.port=u.servers[k._reconnectCount].port,u.protocol=u.servers[k._reconnectCount].protocol?u.servers[k._reconnectCount].protocol:u.defaultProtocol,u.hostname=u.host,k._reconnectCount++),s("calling streambuilder for",u.protocol),l[u.protocol](k,u)},u);return g.on("error",function(){}),g}L!==void 0&&L.title!=="browser"||typeof ct!="function"?(l.mqtt=D("./tcp"),l.tcp=D("./tcp"),l.ssl=D("./tls"),l.tls=D("./tls"),l.mqtts=D("./tls")):(l.wx=D("./wx"),l.wxs=D("./wx"),l.ali=D("./ali"),l.alis=D("./ali")),l.ws=D("./ws"),l.wss=D("./ws"),V.exports=d,V.exports.connect=d,V.exports.MqttClient=b,V.exports.Store=w}).call(this)}).call(this,D("_process"))},{"../client":1,"../store":8,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:50,debug:18,url:76,xtend:81}],13:[function(D,V,P){"use strict";P.byteLength=function(a){var u=l(a),v=u[0],m=u[1];return 3*(v+m)/4-m},P.toByteArray=function(a){var u,v,m=l(a),g=m[0],k=m[1],y=new w(function(M,Y,N){return 3*(Y+N)/4-N}(0,g,k)),T=0,O=k>0?g-4:g;for(v=0;v<O;v+=4)u=b[a.charCodeAt(v)]<<18|b[a.charCodeAt(v+1)]<<12|b[a.charCodeAt(v+2)]<<6|b[a.charCodeAt(v+3)],y[T++]=u>>16&255,y[T++]=u>>8&255,y[T++]=255&u;return k===2&&(u=b[a.charCodeAt(v)]<<2|b[a.charCodeAt(v+1)]>>4,y[T++]=255&u),k===1&&(u=b[a.charCodeAt(v)]<<10|b[a.charCodeAt(v+1)]<<4|b[a.charCodeAt(v+2)]>>2,y[T++]=u>>8&255,y[T++]=255&u),y},P.fromByteArray=function(a){for(var u,v=a.length,m=v%3,g=[],k=0,y=v-m;k<y;k+=16383)g.push(d(a,k,k+16383>y?y:k+16383));return m===1?(u=a[v-1],g.push(L[u>>2]+L[u<<4&63]+"==")):m===2&&(u=(a[v-2]<<8)+a[v-1],g.push(L[u>>10]+L[u>>4&63]+L[u<<2&63]+"=")),g.join("")};for(var L=[],b=[],w=typeof Uint8Array!="undefined"?Uint8Array:Array,C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,s=C.length;c<s;++c)L[c]=C[c],b[C.charCodeAt(c)]=c;function l(a){var u=a.length;if(u%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var v=a.indexOf("=");return v===-1&&(v=u),[v,v===u?0:4-v%4]}function d(a,u,v){for(var m,g,k=[],y=u;y<v;y+=3)m=(a[y]<<16&16711680)+(a[y+1]<<8&65280)+(255&a[y+2]),k.push(L[(g=m)>>18&63]+L[g>>12&63]+L[g>>6&63]+L[63&g]);return k.join("")}b["-".charCodeAt(0)]=62,b["_".charCodeAt(0)]=63},{}],14:[function(D,V,P){"use strict";var L=D("buffer"),b=L.Buffer,w=Symbol.for("BufferList");function C(c){if(!(this instanceof C))return new C(c);C._init.call(this,c)}C._init=function(c){Object.defineProperty(this,w,{value:!0}),this._bufs=[],this.length=0,c&&this.append(c)},C.prototype._new=function(c){return new C(c)},C.prototype._offset=function(c){if(c===0)return[0,0];for(var s=0,l=0;l<this._bufs.length;l++){var d=s+this._bufs[l].length;if(c<d||l===this._bufs.length-1)return[l,c-s];s=d}},C.prototype._reverseOffset=function(c){for(var s=c[0],l=c[1],d=0;d<s;d++)l+=this._bufs[d].length;return l},C.prototype.get=function(c){if(!(c>this.length||c<0)){var s=this._offset(c);return this._bufs[s[0]][s[1]]}},C.prototype.slice=function(c,s){return typeof c=="number"&&c<0&&(c+=this.length),typeof s=="number"&&s<0&&(s+=this.length),this.copy(null,0,c,s)},C.prototype.copy=function(c,s,l,d){if((typeof l!="number"||l<0)&&(l=0),(typeof d!="number"||d>this.length)&&(d=this.length),l>=this.length||d<=0)return c||b.alloc(0);var a=!!c,u=this._offset(l),v=d-l,m=v,g=a&&s||0,k=u[1];if(l===0&&d===this.length){if(!a)return this._bufs.length===1?this._bufs[0]:b.concat(this._bufs,this.length);for(var y=0;y<this._bufs.length;y++)this._bufs[y].copy(c,g),g+=this._bufs[y].length;return c}if(m<=this._bufs[u[0]].length-k)return a?this._bufs[u[0]].copy(c,s,k,k+m):this._bufs[u[0]].slice(k,k+m);a||(c=b.allocUnsafe(v));for(var T=u[0];T<this._bufs.length;T++){var O=this._bufs[T].length-k;if(!(m>O)){this._bufs[T].copy(c,g,k,k+m),g+=O;break}this._bufs[T].copy(c,g,k),g+=O,m-=O,k&&(k=0)}return c.length>g?c.slice(0,g):c},C.prototype.shallowSlice=function(c,s){if(c=c||0,s=typeof s!="number"?this.length:s,c<0&&(c+=this.length),s<0&&(s+=this.length),c===s)return this._new();var l=this._offset(c),d=this._offset(s),a=this._bufs.slice(l[0],d[0]+1);return d[1]===0?a.pop():a[a.length-1]=a[a.length-1].slice(0,d[1]),l[1]!==0&&(a[0]=a[0].slice(l[1])),this._new(a)},C.prototype.toString=function(c,s,l){return this.slice(s,l).toString(c)},C.prototype.consume=function(c){if(c=Math.trunc(c),Number.isNaN(c)||c<=0)return this;for(;this._bufs.length;){if(!(c>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(c),this.length-=c;break}c-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},C.prototype.duplicate=function(){for(var c=this._new(),s=0;s<this._bufs.length;s++)c.append(this._bufs[s]);return c},C.prototype.append=function(c){if(c==null)return this;if(c.buffer)this._appendBuffer(b.from(c.buffer,c.byteOffset,c.byteLength));else if(Array.isArray(c))for(var s=0;s<c.length;s++)this.append(c[s]);else if(this._isBufferList(c))for(var l=0;l<c._bufs.length;l++)this.append(c._bufs[l]);else typeof c=="number"&&(c=c.toString()),this._appendBuffer(b.from(c));return this},C.prototype._appendBuffer=function(c){this._bufs.push(c),this.length+=c.length},C.prototype.indexOf=function(c,s,l){if(l===void 0&&typeof s=="string"&&(l=s,s=void 0),typeof c=="function"||Array.isArray(c))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof c=="number"?c=b.from([c]):typeof c=="string"?c=b.from(c,l):this._isBufferList(c)?c=c.slice():Array.isArray(c.buffer)?c=b.from(c.buffer,c.byteOffset,c.byteLength):b.isBuffer(c)||(c=b.from(c)),s=Number(s||0),isNaN(s)&&(s=0),s<0&&(s=this.length+s),s<0&&(s=0),c.length===0)return s>this.length?this.length:s;for(var d=this._offset(s),a=d[0],u=d[1];a<this._bufs.length;a++){for(var v=this._bufs[a];u<v.length;)if(v.length-u>=c.length){var m=v.indexOf(c,u);if(m!==-1)return this._reverseOffset([a,m]);u=v.length-c.length+1}else{var g=this._reverseOffset([a,u]);if(this._match(g,c))return g;u++}u=0}return-1},C.prototype._match=function(c,s){if(this.length-c<s.length)return!1;for(var l=0;l<s.length;l++)if(this.get(c+l)!==s[l])return!1;return!0},function(){var c={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(var s in c)(function(l){C.prototype[l]=c[l]===null?function(d,a){return this.slice(d,d+a)[l](0,a)}:function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.slice(d,d+c[l])[l](0)}})(s)}(),C.prototype._isBufferList=function(c){return c instanceof C||C.isBufferList(c)},C.isBufferList=function(c){return c!=null&&c[w]},V.exports=C},{buffer:17}],15:[function(D,V,P){"use strict";var L=D("readable-stream").Duplex,b=D("inherits"),w=D("./BufferList");function C(c){if(!(this instanceof C))return new C(c);if(typeof c=="function"){this._callback=c;var s=function(l){this._callback&&(this._callback(l),this._callback=null)}.bind(this);this.on("pipe",function(l){l.on("error",s)}),this.on("unpipe",function(l){l.removeListener("error",s)}),c=null}w._init.call(this,c),L.call(this)}b(C,L),Object.assign(C.prototype,w.prototype),C.prototype._new=function(c){return new C(c)},C.prototype._write=function(c,s,l){this._appendBuffer(c),typeof l=="function"&&l()},C.prototype._read=function(c){if(!this.length)return this.push(null);c=Math.min(c,this.length),this.push(this.slice(0,c)),this.consume(c)},C.prototype.end=function(c){L.prototype.end.call(this,c),this._callback&&(this._callback(null,this.slice()),this._callback=null)},C.prototype._destroy=function(c,s){this._bufs.length=0,this.length=0,s(c)},C.prototype._isBufferList=function(c){return c instanceof C||c instanceof w||C.isBufferList(c)},C.isBufferList=w.isBufferList,V.exports=C,V.exports.BufferListStream=C,V.exports.BufferList=w},{"./BufferList":14,inherits:24,"readable-stream":69}],16:[function(D,V,P){},{}],17:[function(D,V,P){(function(L){(function(){"use strict";var b=D("base64-js"),w=D("ieee754");P.Buffer=s,P.SlowBuffer=function(h){return+h!=h&&(h=0),s.alloc(+h)},P.INSPECT_MAX_BYTES=50;var C=2147483647;function c(h){if(h>C)throw new RangeError('The value "'+h+'" is invalid for option "size"');var f=new Uint8Array(h);return f.__proto__=s.prototype,f}function s(h,f,I){if(typeof h=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return a(h)}return l(h,f,I)}function l(h,f,I){if(typeof h=="string")return function(Q,ot){if(typeof ot=="string"&&ot!==""||(ot="utf8"),!s.isEncoding(ot))throw new TypeError("Unknown encoding: "+ot);var pt=0|m(Q,ot),ft=c(pt),xt=ft.write(Q,ot);return xt!==pt&&(ft=ft.slice(0,xt)),ft}(h,f);if(ArrayBuffer.isView(h))return u(h);if(h==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);if(nt(h,ArrayBuffer)||h&&nt(h.buffer,ArrayBuffer))return function(Q,ot,pt){if(ot<0||Q.byteLength<ot)throw new RangeError('"offset" is outside of buffer bounds');if(Q.byteLength<ot+(pt||0))throw new RangeError('"length" is outside of buffer bounds');var ft;return ft=ot===void 0&&pt===void 0?new Uint8Array(Q):pt===void 0?new Uint8Array(Q,ot):new Uint8Array(Q,ot,pt),ft.__proto__=s.prototype,ft}(h,f,I);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var B=h.valueOf&&h.valueOf();if(B!=null&&B!==h)return s.from(B,f,I);var X=function(Q){if(s.isBuffer(Q)){var ot=0|v(Q.length),pt=c(ot);return pt.length===0||Q.copy(pt,0,0,ot),pt}if(Q.length!==void 0)return typeof Q.length!="number"||st(Q.length)?c(0):u(Q);if(Q.type==="Buffer"&&Array.isArray(Q.data))return u(Q.data)}(h);if(X)return X;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return s.from(h[Symbol.toPrimitive]("string"),f,I);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h)}function d(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(h<0)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function a(h){return d(h),c(h<0?0:0|v(h))}function u(h){for(var f=h.length<0?0:0|v(h.length),I=c(f),B=0;B<f;B+=1)I[B]=255&h[B];return I}function v(h){if(h>=C)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+C.toString(16)+" bytes");return 0|h}function m(h,f){if(s.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||nt(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof h);var I=h.length,B=arguments.length>2&&arguments[2]===!0;if(!B&&I===0)return 0;for(var X=!1;;)switch(f){case"ascii":case"latin1":case"binary":return I;case"utf8":case"utf-8":return rt(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*I;case"hex":return I>>>1;case"base64":return $(h).length;default:if(X)return B?-1:rt(h).length;f=(""+f).toLowerCase(),X=!0}}function g(h,f,I){var B=h[f];h[f]=h[I],h[I]=B}function k(h,f,I,B,X){if(h.length===0)return-1;if(typeof I=="string"?(B=I,I=0):I>2147483647?I=2147483647:I<-2147483648&&(I=-2147483648),st(I=+I)&&(I=X?0:h.length-1),I<0&&(I=h.length+I),I>=h.length){if(X)return-1;I=h.length-1}else if(I<0){if(!X)return-1;I=0}if(typeof f=="string"&&(f=s.from(f,B)),s.isBuffer(f))return f.length===0?-1:y(h,f,I,B,X);if(typeof f=="number")return f&=255,typeof Uint8Array.prototype.indexOf=="function"?X?Uint8Array.prototype.indexOf.call(h,f,I):Uint8Array.prototype.lastIndexOf.call(h,f,I):y(h,[f],I,B,X);throw new TypeError("val must be string, number or Buffer")}function y(h,f,I,B,X){var Q,ot=1,pt=h.length,ft=f.length;if(B!==void 0&&((B=String(B).toLowerCase())==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(h.length<2||f.length<2)return-1;ot=2,pt/=2,ft/=2,I/=2}function xt(Ht,bt){return ot===1?Ht[bt]:Ht.readUInt16BE(bt*ot)}if(X){var Tt=-1;for(Q=I;Q<pt;Q++)if(xt(h,Q)===xt(f,Tt===-1?0:Q-Tt)){if(Tt===-1&&(Tt=Q),Q-Tt+1===ft)return Tt*ot}else Tt!==-1&&(Q-=Q-Tt),Tt=-1}else for(I+ft>pt&&(I=pt-ft),Q=I;Q>=0;Q--){for(var Kt=!0,Dt=0;Dt<ft;Dt++)if(xt(h,Q+Dt)!==xt(f,Dt)){Kt=!1;break}if(Kt)return Q}return-1}function T(h,f,I,B){I=Number(I)||0;var X=h.length-I;B?(B=Number(B))>X&&(B=X):B=X;var Q=f.length;B>Q/2&&(B=Q/2);for(var ot=0;ot<B;++ot){var pt=parseInt(f.substr(2*ot,2),16);if(st(pt))return ot;h[I+ot]=pt}return ot}function O(h,f,I,B){return at(rt(f,h.length-I),h,I,B)}function M(h,f,I,B){return at(function(X){for(var Q=[],ot=0;ot<X.length;++ot)Q.push(255&X.charCodeAt(ot));return Q}(f),h,I,B)}function Y(h,f,I,B){return M(h,f,I,B)}function N(h,f,I,B){return at($(f),h,I,B)}function G(h,f,I,B){return at(function(X,Q){for(var ot,pt,ft,xt=[],Tt=0;Tt<X.length&&!((Q-=2)<0);++Tt)ot=X.charCodeAt(Tt),pt=ot>>8,ft=ot%256,xt.push(ft),xt.push(pt);return xt}(f,h.length-I),h,I,B)}function et(h,f,I){return f===0&&I===h.length?b.fromByteArray(h):b.fromByteArray(h.slice(f,I))}function F(h,f,I){I=Math.min(h.length,I);for(var B=[],X=f;X<I;){var Q,ot,pt,ft,xt=h[X],Tt=null,Kt=xt>239?4:xt>223?3:xt>191?2:1;if(X+Kt<=I)switch(Kt){case 1:xt<128&&(Tt=xt);break;case 2:(192&(Q=h[X+1]))==128&&(ft=(31&xt)<<6|63&Q)>127&&(Tt=ft);break;case 3:Q=h[X+1],ot=h[X+2],(192&Q)==128&&(192&ot)==128&&(ft=(15&xt)<<12|(63&Q)<<6|63&ot)>2047&&(ft<55296||ft>57343)&&(Tt=ft);break;case 4:Q=h[X+1],ot=h[X+2],pt=h[X+3],(192&Q)==128&&(192&ot)==128&&(192&pt)==128&&(ft=(15&xt)<<18|(63&Q)<<12|(63&ot)<<6|63&pt)>65535&&ft<1114112&&(Tt=ft)}Tt===null?(Tt=65533,Kt=1):Tt>65535&&(Tt-=65536,B.push(Tt>>>10&1023|55296),Tt=56320|1023&Tt),B.push(Tt),X+=Kt}return function(Dt){var Ht=Dt.length;if(Ht<=S)return String.fromCharCode.apply(String,Dt);for(var bt="",_t=0;_t<Ht;)bt+=String.fromCharCode.apply(String,Dt.slice(_t,_t+=S));return bt}(B)}P.kMaxLength=C,s.TYPED_ARRAY_SUPPORT=function(){try{var h=new Uint8Array(1);return h.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},h.foo()===42}catch(f){return!1}}(),s.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),typeof Symbol!="undefined"&&Symbol.species!=null&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(h,f,I){return l(h,f,I)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(h,f,I){return function(B,X,Q){return d(B),B<=0?c(B):X!==void 0?typeof Q=="string"?c(B).fill(X,Q):c(B).fill(X):c(B)}(h,f,I)},s.allocUnsafe=function(h){return a(h)},s.allocUnsafeSlow=function(h){return a(h)},s.isBuffer=function(h){return h!=null&&h._isBuffer===!0&&h!==s.prototype},s.compare=function(h,f){if(nt(h,Uint8Array)&&(h=s.from(h,h.offset,h.byteLength)),nt(f,Uint8Array)&&(f=s.from(f,f.offset,f.byteLength)),!s.isBuffer(h)||!s.isBuffer(f))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(h===f)return 0;for(var I=h.length,B=f.length,X=0,Q=Math.min(I,B);X<Q;++X)if(h[X]!==f[X]){I=h[X],B=f[X];break}return I<B?-1:B<I?1:0},s.isEncoding=function(h){switch(String(h).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(h,f){if(!Array.isArray(h))throw new TypeError('"list" argument must be an Array of Buffers');if(h.length===0)return s.alloc(0);var I;if(f===void 0)for(f=0,I=0;I<h.length;++I)f+=h[I].length;var B=s.allocUnsafe(f),X=0;for(I=0;I<h.length;++I){var Q=h[I];if(nt(Q,Uint8Array)&&(Q=s.from(Q)),!s.isBuffer(Q))throw new TypeError('"list" argument must be an Array of Buffers');Q.copy(B,X),X+=Q.length}return B},s.byteLength=m,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var h=this.length;if(h%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var f=0;f<h;f+=2)g(this,f,f+1);return this},s.prototype.swap32=function(){var h=this.length;if(h%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var f=0;f<h;f+=4)g(this,f,f+3),g(this,f+1,f+2);return this},s.prototype.swap64=function(){var h=this.length;if(h%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var f=0;f<h;f+=8)g(this,f,f+7),g(this,f+1,f+6),g(this,f+2,f+5),g(this,f+3,f+4);return this},s.prototype.toString=function(){var h=this.length;return h===0?"":arguments.length===0?F(this,0,h):function(f,I,B){var X=!1;if((I===void 0||I<0)&&(I=0),I>this.length||((B===void 0||B>this.length)&&(B=this.length),B<=0)||(B>>>=0)<=(I>>>=0))return"";for(f||(f="utf8");;)switch(f){case"hex":return R(this,I,B);case"utf8":case"utf-8":return F(this,I,B);case"ascii":return _(this,I,B);case"latin1":case"binary":return E(this,I,B);case"base64":return et(this,I,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,I,B);default:if(X)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase(),X=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(h){if(!s.isBuffer(h))throw new TypeError("Argument must be a Buffer");return this===h||s.compare(this,h)===0},s.prototype.inspect=function(){var h="",f=P.INSPECT_MAX_BYTES;return h=this.toString("hex",0,f).replace(/(.{2})/g,"$1 ").trim(),this.length>f&&(h+=" ... "),"<Buffer "+h+">"},s.prototype.compare=function(h,f,I,B,X){if(nt(h,Uint8Array)&&(h=s.from(h,h.offset,h.byteLength)),!s.isBuffer(h))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof h);if(f===void 0&&(f=0),I===void 0&&(I=h?h.length:0),B===void 0&&(B=0),X===void 0&&(X=this.length),f<0||I>h.length||B<0||X>this.length)throw new RangeError("out of range index");if(B>=X&&f>=I)return 0;if(B>=X)return-1;if(f>=I)return 1;if(f>>>=0,I>>>=0,B>>>=0,X>>>=0,this===h)return 0;for(var Q=X-B,ot=I-f,pt=Math.min(Q,ot),ft=this.slice(B,X),xt=h.slice(f,I),Tt=0;Tt<pt;++Tt)if(ft[Tt]!==xt[Tt]){Q=ft[Tt],ot=xt[Tt];break}return Q<ot?-1:ot<Q?1:0},s.prototype.includes=function(h,f,I){return this.indexOf(h,f,I)!==-1},s.prototype.indexOf=function(h,f,I){return k(this,h,f,I,!0)},s.prototype.lastIndexOf=function(h,f,I){return k(this,h,f,I,!1)},s.prototype.write=function(h,f,I,B){if(f===void 0)B="utf8",I=this.length,f=0;else if(I===void 0&&typeof f=="string")B=f,I=this.length,f=0;else{if(!isFinite(f))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");f>>>=0,isFinite(I)?(I>>>=0,B===void 0&&(B="utf8")):(B=I,I=void 0)}var X=this.length-f;if((I===void 0||I>X)&&(I=X),h.length>0&&(I<0||f<0)||f>this.length)throw new RangeError("Attempt to write outside buffer bounds");B||(B="utf8");for(var Q=!1;;)switch(B){case"hex":return T(this,h,f,I);case"utf8":case"utf-8":return O(this,h,f,I);case"ascii":return M(this,h,f,I);case"latin1":case"binary":return Y(this,h,f,I);case"base64":return N(this,h,f,I);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,h,f,I);default:if(Q)throw new TypeError("Unknown encoding: "+B);B=(""+B).toLowerCase(),Q=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function _(h,f,I){var B="";I=Math.min(h.length,I);for(var X=f;X<I;++X)B+=String.fromCharCode(127&h[X]);return B}function E(h,f,I){var B="";I=Math.min(h.length,I);for(var X=f;X<I;++X)B+=String.fromCharCode(h[X]);return B}function R(h,f,I){var B=h.length;(!f||f<0)&&(f=0),(!I||I<0||I>B)&&(I=B);for(var X="",Q=f;Q<I;++Q)X+=J(h[Q]);return X}function q(h,f,I){for(var B=h.slice(f,I),X="",Q=0;Q<B.length;Q+=2)X+=String.fromCharCode(B[Q]+256*B[Q+1]);return X}function Z(h,f,I){if(h%1!=0||h<0)throw new RangeError("offset is not uint");if(h+f>I)throw new RangeError("Trying to access beyond buffer length")}function K(h,f,I,B,X,Q){if(!s.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>X||f<Q)throw new RangeError('"value" argument is out of bounds');if(I+B>h.length)throw new RangeError("Index out of range")}function z(h,f,I,B,X,Q){if(I+B>h.length)throw new RangeError("Index out of range");if(I<0)throw new RangeError("Index out of range")}function j(h,f,I,B,X){return f=+f,I>>>=0,X||z(h,0,I,4),w.write(h,f,I,B,23,4),I+4}function H(h,f,I,B,X){return f=+f,I>>>=0,X||z(h,0,I,8),w.write(h,f,I,B,52,8),I+8}s.prototype.slice=function(h,f){var I=this.length;h=~~h,f=f===void 0?I:~~f,h<0?(h+=I)<0&&(h=0):h>I&&(h=I),f<0?(f+=I)<0&&(f=0):f>I&&(f=I),f<h&&(f=h);var B=this.subarray(h,f);return B.__proto__=s.prototype,B},s.prototype.readUIntLE=function(h,f,I){h>>>=0,f>>>=0,I||Z(h,f,this.length);for(var B=this[h],X=1,Q=0;++Q<f&&(X*=256);)B+=this[h+Q]*X;return B},s.prototype.readUIntBE=function(h,f,I){h>>>=0,f>>>=0,I||Z(h,f,this.length);for(var B=this[h+--f],X=1;f>0&&(X*=256);)B+=this[h+--f]*X;return B},s.prototype.readUInt8=function(h,f){return h>>>=0,f||Z(h,1,this.length),this[h]},s.prototype.readUInt16LE=function(h,f){return h>>>=0,f||Z(h,2,this.length),this[h]|this[h+1]<<8},s.prototype.readUInt16BE=function(h,f){return h>>>=0,f||Z(h,2,this.length),this[h]<<8|this[h+1]},s.prototype.readUInt32LE=function(h,f){return h>>>=0,f||Z(h,4,this.length),(this[h]|this[h+1]<<8|this[h+2]<<16)+16777216*this[h+3]},s.prototype.readUInt32BE=function(h,f){return h>>>=0,f||Z(h,4,this.length),16777216*this[h]+(this[h+1]<<16|this[h+2]<<8|this[h+3])},s.prototype.readIntLE=function(h,f,I){h>>>=0,f>>>=0,I||Z(h,f,this.length);for(var B=this[h],X=1,Q=0;++Q<f&&(X*=256);)B+=this[h+Q]*X;return B>=(X*=128)&&(B-=Math.pow(2,8*f)),B},s.prototype.readIntBE=function(h,f,I){h>>>=0,f>>>=0,I||Z(h,f,this.length);for(var B=f,X=1,Q=this[h+--B];B>0&&(X*=256);)Q+=this[h+--B]*X;return Q>=(X*=128)&&(Q-=Math.pow(2,8*f)),Q},s.prototype.readInt8=function(h,f){return h>>>=0,f||Z(h,1,this.length),128&this[h]?-1*(255-this[h]+1):this[h]},s.prototype.readInt16LE=function(h,f){h>>>=0,f||Z(h,2,this.length);var I=this[h]|this[h+1]<<8;return 32768&I?4294901760|I:I},s.prototype.readInt16BE=function(h,f){h>>>=0,f||Z(h,2,this.length);var I=this[h+1]|this[h]<<8;return 32768&I?4294901760|I:I},s.prototype.readInt32LE=function(h,f){return h>>>=0,f||Z(h,4,this.length),this[h]|this[h+1]<<8|this[h+2]<<16|this[h+3]<<24},s.prototype.readInt32BE=function(h,f){return h>>>=0,f||Z(h,4,this.length),this[h]<<24|this[h+1]<<16|this[h+2]<<8|this[h+3]},s.prototype.readFloatLE=function(h,f){return h>>>=0,f||Z(h,4,this.length),w.read(this,h,!0,23,4)},s.prototype.readFloatBE=function(h,f){return h>>>=0,f||Z(h,4,this.length),w.read(this,h,!1,23,4)},s.prototype.readDoubleLE=function(h,f){return h>>>=0,f||Z(h,8,this.length),w.read(this,h,!0,52,8)},s.prototype.readDoubleBE=function(h,f){return h>>>=0,f||Z(h,8,this.length),w.read(this,h,!1,52,8)},s.prototype.writeUIntLE=function(h,f,I,B){h=+h,f>>>=0,I>>>=0,B||K(this,h,f,I,Math.pow(2,8*I)-1,0);var X=1,Q=0;for(this[f]=255&h;++Q<I&&(X*=256);)this[f+Q]=h/X&255;return f+I},s.prototype.writeUIntBE=function(h,f,I,B){h=+h,f>>>=0,I>>>=0,B||K(this,h,f,I,Math.pow(2,8*I)-1,0);var X=I-1,Q=1;for(this[f+X]=255&h;--X>=0&&(Q*=256);)this[f+X]=h/Q&255;return f+I},s.prototype.writeUInt8=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,1,255,0),this[f]=255&h,f+1},s.prototype.writeUInt16LE=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,2,65535,0),this[f]=255&h,this[f+1]=h>>>8,f+2},s.prototype.writeUInt16BE=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,2,65535,0),this[f]=h>>>8,this[f+1]=255&h,f+2},s.prototype.writeUInt32LE=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,4,4294967295,0),this[f+3]=h>>>24,this[f+2]=h>>>16,this[f+1]=h>>>8,this[f]=255&h,f+4},s.prototype.writeUInt32BE=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,4,4294967295,0),this[f]=h>>>24,this[f+1]=h>>>16,this[f+2]=h>>>8,this[f+3]=255&h,f+4},s.prototype.writeIntLE=function(h,f,I,B){if(h=+h,f>>>=0,!B){var X=Math.pow(2,8*I-1);K(this,h,f,I,X-1,-X)}var Q=0,ot=1,pt=0;for(this[f]=255&h;++Q<I&&(ot*=256);)h<0&&pt===0&&this[f+Q-1]!==0&&(pt=1),this[f+Q]=(h/ot>>0)-pt&255;return f+I},s.prototype.writeIntBE=function(h,f,I,B){if(h=+h,f>>>=0,!B){var X=Math.pow(2,8*I-1);K(this,h,f,I,X-1,-X)}var Q=I-1,ot=1,pt=0;for(this[f+Q]=255&h;--Q>=0&&(ot*=256);)h<0&&pt===0&&this[f+Q+1]!==0&&(pt=1),this[f+Q]=(h/ot>>0)-pt&255;return f+I},s.prototype.writeInt8=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,1,127,-128),h<0&&(h=255+h+1),this[f]=255&h,f+1},s.prototype.writeInt16LE=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,2,32767,-32768),this[f]=255&h,this[f+1]=h>>>8,f+2},s.prototype.writeInt16BE=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,2,32767,-32768),this[f]=h>>>8,this[f+1]=255&h,f+2},s.prototype.writeInt32LE=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,4,2147483647,-2147483648),this[f]=255&h,this[f+1]=h>>>8,this[f+2]=h>>>16,this[f+3]=h>>>24,f+4},s.prototype.writeInt32BE=function(h,f,I){return h=+h,f>>>=0,I||K(this,h,f,4,2147483647,-2147483648),h<0&&(h=4294967295+h+1),this[f]=h>>>24,this[f+1]=h>>>16,this[f+2]=h>>>8,this[f+3]=255&h,f+4},s.prototype.writeFloatLE=function(h,f,I){return j(this,h,f,!0,I)},s.prototype.writeFloatBE=function(h,f,I){return j(this,h,f,!1,I)},s.prototype.writeDoubleLE=function(h,f,I){return H(this,h,f,!0,I)},s.prototype.writeDoubleBE=function(h,f,I){return H(this,h,f,!1,I)},s.prototype.copy=function(h,f,I,B){if(!s.isBuffer(h))throw new TypeError("argument should be a Buffer");if(I||(I=0),B||B===0||(B=this.length),f>=h.length&&(f=h.length),f||(f=0),B>0&&B<I&&(B=I),B===I||h.length===0||this.length===0)return 0;if(f<0)throw new RangeError("targetStart out of bounds");if(I<0||I>=this.length)throw new RangeError("Index out of range");if(B<0)throw new RangeError("sourceEnd out of bounds");B>this.length&&(B=this.length),h.length-f<B-I&&(B=h.length-f+I);var X=B-I;if(this===h&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(f,I,B);else if(this===h&&I<f&&f<B)for(var Q=X-1;Q>=0;--Q)h[Q+f]=this[Q+I];else Uint8Array.prototype.set.call(h,this.subarray(I,B),f);return X},s.prototype.fill=function(h,f,I,B){if(typeof h=="string"){if(typeof f=="string"?(B=f,f=0,I=this.length):typeof I=="string"&&(B=I,I=this.length),B!==void 0&&typeof B!="string")throw new TypeError("encoding must be a string");if(typeof B=="string"&&!s.isEncoding(B))throw new TypeError("Unknown encoding: "+B);if(h.length===1){var X=h.charCodeAt(0);(B==="utf8"&&X<128||B==="latin1")&&(h=X)}}else typeof h=="number"&&(h&=255);if(f<0||this.length<f||this.length<I)throw new RangeError("Out of range index");if(I<=f)return this;var Q;if(f>>>=0,I=I===void 0?this.length:I>>>0,h||(h=0),typeof h=="number")for(Q=f;Q<I;++Q)this[Q]=h;else{var ot=s.isBuffer(h)?h:s.from(h,B),pt=ot.length;if(pt===0)throw new TypeError('The value "'+h+'" is invalid for argument "value"');for(Q=0;Q<I-f;++Q)this[Q+f]=ot[Q%pt]}return this};var A=/[^+/0-9A-Za-z-_]/g;function J(h){return h<16?"0"+h.toString(16):h.toString(16)}function rt(h,f){var I;f=f||1/0;for(var B=h.length,X=null,Q=[],ot=0;ot<B;++ot){if((I=h.charCodeAt(ot))>55295&&I<57344){if(!X){if(I>56319){(f-=3)>-1&&Q.push(239,191,189);continue}if(ot+1===B){(f-=3)>-1&&Q.push(239,191,189);continue}X=I;continue}if(I<56320){(f-=3)>-1&&Q.push(239,191,189),X=I;continue}I=65536+(X-55296<<10|I-56320)}else X&&(f-=3)>-1&&Q.push(239,191,189);if(X=null,I<128){if((f-=1)<0)break;Q.push(I)}else if(I<2048){if((f-=2)<0)break;Q.push(I>>6|192,63&I|128)}else if(I<65536){if((f-=3)<0)break;Q.push(I>>12|224,I>>6&63|128,63&I|128)}else{if(!(I<1114112))throw new Error("Invalid code point");if((f-=4)<0)break;Q.push(I>>18|240,I>>12&63|128,I>>6&63|128,63&I|128)}}return Q}function $(h){return b.toByteArray(function(f){if((f=(f=f.split("=")[0]).trim().replace(A,"")).length<2)return"";for(;f.length%4!=0;)f+="=";return f}(h))}function at(h,f,I,B){for(var X=0;X<B&&!(X+I>=f.length||X>=h.length);++X)f[X+I]=h[X];return X}function nt(h,f){return h instanceof f||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===f.name}function st(h){return h!=h}}).call(this)}).call(this,D("buffer").Buffer)},{"base64-js":13,buffer:17,ieee754:23}],18:[function(D,V,P){(function(L){(function(){P.formatArgs=function(w){if(w[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+w[0]+(this.useColors?"%c ":" ")+"+"+V.exports.humanize(this.diff),!!this.useColors){var C="color: "+this.color;w.splice(1,0,C,"color: inherit");var c=0,s=0;w[0].replace(/%[a-zA-Z%]/g,function(l){l!=="%%"&&l==="%c"&&(s=++c)}),w.splice(s,0,C)}},P.save=function(w){try{w?P.storage.setItem("debug",w):P.storage.removeItem("debug")}catch(C){}},P.load=function(){var w;try{w=P.storage.getItem("debug")}catch(C){}return!w&&L!==void 0&&"env"in L&&(w=L.env.DEBUG),w},P.useColors=function(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},P.storage=function(){try{return localStorage}catch(w){}}(),P.destroy=function(){var w=!1;return function(){w||(w=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),P.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],P.log=console.debug||console.log||function(){},V.exports=D("./common")(P);var b=V.exports.formatters;b.j=function(w){try{return JSON.stringify(w)}catch(C){return"[UnexpectedJSONParseError]: "+C.message}}}).call(this)}).call(this,D("_process"))},{"./common":19,_process:50}],19:[function(D,V,P){V.exports=function(L){function b(c){var s,l,d,a=null;function u(){for(var v=arguments.length,m=new Array(v),g=0;g<v;g++)m[g]=arguments[g];if(!!u.enabled){var k=u,y=Number(new Date),T=y-(s||y);k.diff=T,k.prev=s,k.curr=y,s=y,m[0]=b.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");var O=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,function(M,Y){if(M==="%%")return"%";O++;var N=b.formatters[Y];if(typeof N=="function"){var G=m[O];M=N.call(k,G),m.splice(O,1),O--}return M}),b.formatArgs.call(k,m),(k.log||b.log).apply(k,m)}}return u.namespace=c,u.useColors=b.useColors(),u.color=b.selectColor(c),u.extend=w,u.destroy=b.destroy,Object.defineProperty(u,"enabled",{enumerable:!0,configurable:!1,get:function(){return a!==null?a:(l!==b.namespaces&&(l=b.namespaces,d=b.enabled(c)),d)},set:function(m){a=m}}),typeof b.init=="function"&&b.init(u),u}function w(c,s){var l=b(this.namespace+(s===void 0?":":s)+c);return l.log=this.log,l}function C(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}return b.debug=b,b.default=b,b.coerce=function(c){return c instanceof Error?c.stack||c.message:c},b.disable=function(){var c=[].concat(ut(b.names.map(C)),ut(b.skips.map(C).map(function(s){return"-"+s}))).join(",");return b.enable(""),c},b.enable=function(c){var s;b.save(c),b.namespaces=c,b.names=[],b.skips=[];var l=(typeof c=="string"?c:"").split(/[\s,]+/),d=l.length;for(s=0;s<d;s++)l[s]&&((c=l[s].replace(/\*/g,".*?"))[0]==="-"?b.skips.push(new RegExp("^"+c.substr(1)+"$")):b.names.push(new RegExp("^"+c+"$")))},b.enabled=function(c){if(c[c.length-1]==="*")return!0;var s,l;for(s=0,l=b.skips.length;s<l;s++)if(b.skips[s].test(c))return!1;for(s=0,l=b.names.length;s<l;s++)if(b.names[s].test(c))return!0;return!1},b.humanize=D("ms"),b.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(L).forEach(function(c){b[c]=L[c]}),b.names=[],b.skips=[],b.formatters={},b.selectColor=function(c){for(var s=0,l=0;l<c.length;l++)s=(s<<5)-s+c.charCodeAt(l),s|=0;return b.colors[Math.abs(s)%b.colors.length]},b.enable(b.load()),b}},{ms:45}],20:[function(D,V,P){(function(L,b){(function(){var w=D("readable-stream"),C=D("end-of-stream"),c=D("inherits"),s=D("stream-shift"),l=b.from&&b.from!==Uint8Array.from?b.from([0]):new b([0]),d=function(g,k){g._corked?g.once("uncork",k):k()},a=function(g,k){return function(y){y?function(T,O){T._autoDestroy&&T.destroy(O)}(g,y.message==="premature close"?null:y):k&&!g._ended&&g.end()}},u=function(){},v=function m(g,k,y){if(!(this instanceof m))return new m(g,k,y);w.Duplex.call(this,y),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!y||y.autoDestroy!==!1,this._forwardDestroy=!y||y.destroy!==!1,this._forwardEnd=!y||y.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,g&&this.setWritable(g),k&&this.setReadable(k)};c(v,w.Duplex),v.obj=function(m,g,k){return k||(k={}),k.objectMode=!0,k.highWaterMark=16,new v(m,g,k)},v.prototype.cork=function(){++this._corked==1&&this.emit("cork")},v.prototype.uncork=function(){this._corked&&--this._corked==0&&this.emit("uncork")},v.prototype.setWritable=function(m){if(this._unwrite&&this._unwrite(),this.destroyed)m&&m.destroy&&m.destroy();else if(m!==null&&m!==!1){var g=this,k=C(m,{writable:!0,readable:!1},a(this,this._forwardEnd)),y=function(){var O=g._ondrain;g._ondrain=null,O&&O()};this._unwrite&&L.nextTick(y),this._writable=m,this._writable.on("drain",y),this._unwrite=function(){g._writable.removeListener("drain",y),k()},this.uncork()}else this.end()},v.prototype.setReadable=function(m){if(this._unread&&this._unread(),this.destroyed)m&&m.destroy&&m.destroy();else{if(m===null||m===!1)return this.push(null),void this.resume();var g,k=this,y=C(m,{writable:!1,readable:!0},a(this)),T=function(){k._forward()},O=function(){k.push(null)};this._drained=!0,this._readable=m,this._readable2=m._readableState?m:(g=m,new w.Readable({objectMode:!0,highWaterMark:16}).wrap(g)),this._readable2.on("readable",T),this._readable2.on("end",O),this._unread=function(){k._readable2.removeListener("readable",T),k._readable2.removeListener("end",O),y()},this._forward()}},v.prototype._read=function(){this._drained=!0,this._forward()},v.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var m;for(this._forwarding=!0;this._drained&&(m=s(this._readable2))!==null;)this.destroyed||(this._drained=this.push(m));this._forwarding=!1}},v.prototype.destroy=function(m,g){if(g||(g=u),this.destroyed)return g(null);this.destroyed=!0;var k=this;L.nextTick(function(){k._destroy(m),g(null)})},v.prototype._destroy=function(m){if(m){var g=this._ondrain;this._ondrain=null,g?g(m):this.emit("error",m)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},v.prototype._write=function(m,g,k){if(!this.destroyed)return this._corked?d(this,this._write.bind(this,m,g,k)):m===l?this._finish(k):this._writable?void(this._writable.write(m)===!1?this._ondrain=k:this.destroyed||k()):k()},v.prototype._finish=function(m){var g=this;this.emit("preend"),d(this,function(){var k,y;k=g._forwardEnd&&g._writable,y=function(){g._writableState.prefinished===!1&&(g._writableState.prefinished=!0),g.emit("prefinish"),d(g,m)},k?k._writableState&&k._writableState.finished?y():k._writableState?k.end(y):(k.end(),y()):y()})},v.prototype.end=function(m,g,k){return typeof m=="function"?this.end(null,null,m):typeof g=="function"?this.end(m,null,g):(this._ended=!0,m&&this.write(m),this._writableState.ending||this._writableState.destroyed||this.write(l),w.Writable.prototype.end.call(this,k))},V.exports=v}).call(this)}).call(this,D("_process"),D("buffer").Buffer)},{_process:50,buffer:17,"end-of-stream":21,inherits:24,"readable-stream":69,"stream-shift":74}],21:[function(D,V,P){(function(L){(function(){var b=D("once"),w=function(){},C=function c(s,l,d){if(typeof l=="function")return c(s,null,l);l||(l={}),d=b(d||w);var a=s._writableState,u=s._readableState,v=l.readable||l.readable!==!1&&s.readable,m=l.writable||l.writable!==!1&&s.writable,g=!1,k=function(){s.writable||y()},y=function(){m=!1,v||d.call(s)},T=function(){v=!1,m||d.call(s)},O=function(F){d.call(s,F?new Error("exited with error code: "+F):null)},M=function(F){d.call(s,F)},Y=function(){L.nextTick(N)},N=function(){if(!g)return(!v||u&&u.ended&&!u.destroyed)&&(!m||a&&a.ended&&!a.destroyed)?void 0:d.call(s,new Error("premature close"))},G=function(){s.req.on("finish",y)};return function(et){return et.setHeader&&typeof et.abort=="function"}(s)?(s.on("complete",y),s.on("abort",Y),s.req?G():s.on("request",G)):m&&!a&&(s.on("end",k),s.on("close",k)),function(et){return et.stdio&&Array.isArray(et.stdio)&&et.stdio.length===3}(s)&&s.on("exit",O),s.on("end",T),s.on("finish",y),l.error!==!1&&s.on("error",M),s.on("close",Y),function(){g=!0,s.removeListener("complete",y),s.removeListener("abort",Y),s.removeListener("request",G),s.req&&s.req.removeListener("finish",y),s.removeListener("end",k),s.removeListener("close",k),s.removeListener("finish",y),s.removeListener("exit",O),s.removeListener("end",T),s.removeListener("error",M),s.removeListener("close",Y)}};V.exports=C}).call(this)}).call(this,D("_process"))},{_process:50,once:48}],22:[function(D,V,P){var L=Object.create||function(y){var T=function(){};return T.prototype=y,new T},b=Object.keys||function(y){var T=[];for(var O in y)Object.prototype.hasOwnProperty.call(y,O)&&T.push(O);return O},w=Function.prototype.bind||function(y){var T=this;return function(){return T.apply(y,arguments)}};function C(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=L(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}V.exports=C,C.EventEmitter=C,C.prototype._events=void 0,C.prototype._maxListeners=void 0;var c,s=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),c=l.x===0}catch(y){c=!1}function d(y){return y._maxListeners===void 0?C.defaultMaxListeners:y._maxListeners}function a(y,T,O,M){var Y,N,G;if(typeof O!="function")throw new TypeError('"listener" argument must be a function');if((N=y._events)?(N.newListener&&(y.emit("newListener",T,O.listener?O.listener:O),N=y._events),G=N[T]):(N=y._events=L(null),y._eventsCount=0),G){if(typeof G=="function"?G=N[T]=M?[O,G]:[G,O]:M?G.unshift(O):G.push(O),!G.warned&&(Y=d(y))&&Y>0&&G.length>Y){G.warned=!0;var et=new Error("Possible EventEmitter memory leak detected. "+G.length+' "'+String(T)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');et.name="MaxListenersExceededWarning",et.emitter=y,et.type=T,et.count=G.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",et.name,et.message)}}else G=N[T]=O,++y._eventsCount;return y}function u(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var y=new Array(arguments.length),T=0;T<y.length;++T)y[T]=arguments[T];this.listener.apply(this.target,y)}}function v(y,T,O){var M={fired:!1,wrapFn:void 0,target:y,type:T,listener:O},Y=w.call(u,M);return Y.listener=O,M.wrapFn=Y,Y}function m(y,T,O){var M=y._events;if(!M)return[];var Y=M[T];return Y?typeof Y=="function"?O?[Y.listener||Y]:[Y]:O?function(N){for(var G=new Array(N.length),et=0;et<G.length;++et)G[et]=N[et].listener||N[et];return G}(Y):k(Y,Y.length):[]}function g(y){var T=this._events;if(T){var O=T[y];if(typeof O=="function")return 1;if(O)return O.length}return 0}function k(y,T){for(var O=new Array(T),M=0;M<T;++M)O[M]=y[M];return O}c?Object.defineProperty(C,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(T){if(typeof T!="number"||T<0||T!=T)throw new TypeError('"defaultMaxListeners" must be a positive number');s=T}}):C.defaultMaxListeners=s,C.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||isNaN(y))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=y,this},C.prototype.getMaxListeners=function(){return d(this)},C.prototype.emit=function(y){var T,O,M,Y,N,G,et=y==="error";if(G=this._events)et=et&&G.error==null;else if(!et)return!1;if(et){if(arguments.length>1&&(T=arguments[1]),T instanceof Error)throw T;var F=new Error('Unhandled "error" event. ('+T+")");throw F.context=T,F}if(!(O=G[y]))return!1;var S=typeof O=="function";switch(M=arguments.length){case 1:(function(_,E,R){if(E)_.call(R);else for(var q=_.length,Z=k(_,q),K=0;K<q;++K)Z[K].call(R)})(O,S,this);break;case 2:(function(_,E,R,q){if(E)_.call(R,q);else for(var Z=_.length,K=k(_,Z),z=0;z<Z;++z)K[z].call(R,q)})(O,S,this,arguments[1]);break;case 3:(function(_,E,R,q,Z){if(E)_.call(R,q,Z);else for(var K=_.length,z=k(_,K),j=0;j<K;++j)z[j].call(R,q,Z)})(O,S,this,arguments[1],arguments[2]);break;case 4:(function(_,E,R,q,Z,K){if(E)_.call(R,q,Z,K);else for(var z=_.length,j=k(_,z),H=0;H<z;++H)j[H].call(R,q,Z,K)})(O,S,this,arguments[1],arguments[2],arguments[3]);break;default:for(Y=new Array(M-1),N=1;N<M;N++)Y[N-1]=arguments[N];(function(_,E,R,q){if(E)_.apply(R,q);else for(var Z=_.length,K=k(_,Z),z=0;z<Z;++z)K[z].apply(R,q)})(O,S,this,Y)}return!0},C.prototype.addListener=function(y,T){return a(this,y,T,!1)},C.prototype.on=C.prototype.addListener,C.prototype.prependListener=function(y,T){return a(this,y,T,!0)},C.prototype.once=function(y,T){if(typeof T!="function")throw new TypeError('"listener" argument must be a function');return this.on(y,v(this,y,T)),this},C.prototype.prependOnceListener=function(y,T){if(typeof T!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(y,v(this,y,T)),this},C.prototype.removeListener=function(y,T){var O,M,Y,N,G;if(typeof T!="function")throw new TypeError('"listener" argument must be a function');if(!(M=this._events))return this;if(!(O=M[y]))return this;if(O===T||O.listener===T)--this._eventsCount==0?this._events=L(null):(delete M[y],M.removeListener&&this.emit("removeListener",y,O.listener||T));else if(typeof O!="function"){for(Y=-1,N=O.length-1;N>=0;N--)if(O[N]===T||O[N].listener===T){G=O[N].listener,Y=N;break}if(Y<0)return this;Y===0?O.shift():function(et,F){for(var S=F,_=S+1,E=et.length;_<E;S+=1,_+=1)et[S]=et[_];et.pop()}(O,Y),O.length===1&&(M[y]=O[0]),M.removeListener&&this.emit("removeListener",y,G||T)}return this},C.prototype.removeAllListeners=function(y){var T,O,M;if(!(O=this._events))return this;if(!O.removeListener)return arguments.length===0?(this._events=L(null),this._eventsCount=0):O[y]&&(--this._eventsCount==0?this._events=L(null):delete O[y]),this;if(arguments.length===0){var Y,N=b(O);for(M=0;M<N.length;++M)(Y=N[M])!=="removeListener"&&this.removeAllListeners(Y);return this.removeAllListeners("removeListener"),this._events=L(null),this._eventsCount=0,this}if(typeof(T=O[y])=="function")this.removeListener(y,T);else if(T)for(M=T.length-1;M>=0;M--)this.removeListener(y,T[M]);return this},C.prototype.listeners=function(y){return m(this,y,!0)},C.prototype.rawListeners=function(y){return m(this,y,!1)},C.listenerCount=function(y,T){return typeof y.listenerCount=="function"?y.listenerCount(T):g.call(y,T)},C.prototype.listenerCount=g,C.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],23:[function(D,V,P){P.read=function(L,b,w,C,c){var s,l,d=8*c-C-1,a=(1<<d)-1,u=a>>1,v=-7,m=w?c-1:0,g=w?-1:1,k=L[b+m];for(m+=g,s=k&(1<<-v)-1,k>>=-v,v+=d;v>0;s=256*s+L[b+m],m+=g,v-=8);for(l=s&(1<<-v)-1,s>>=-v,v+=C;v>0;l=256*l+L[b+m],m+=g,v-=8);if(s===0)s=1-u;else{if(s===a)return l?NaN:1/0*(k?-1:1);l+=Math.pow(2,C),s-=u}return(k?-1:1)*l*Math.pow(2,s-C)},P.write=function(L,b,w,C,c,s){var l,d,a,u=8*s-c-1,v=(1<<u)-1,m=v>>1,g=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=C?0:s-1,y=C?1:-1,T=b<0||b===0&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(d=isNaN(b)?1:0,l=v):(l=Math.floor(Math.log(b)/Math.LN2),b*(a=Math.pow(2,-l))<1&&(l--,a*=2),(b+=l+m>=1?g/a:g*Math.pow(2,1-m))*a>=2&&(l++,a/=2),l+m>=v?(d=0,l=v):l+m>=1?(d=(b*a-1)*Math.pow(2,c),l+=m):(d=b*Math.pow(2,m-1)*Math.pow(2,c),l=0));c>=8;L[w+k]=255&d,k+=y,d/=256,c-=8);for(l=l<<c|d,u+=c;u>0;L[w+k]=255&l,k+=y,l/=256,u-=8);L[w+k-y]|=128*T}},{}],24:[function(D,V,P){typeof Object.create=="function"?V.exports=function(L,b){b&&(L.super_=b,L.prototype=Object.create(b.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}))}:V.exports=function(L,b){if(b){L.super_=b;var w=function(){};w.prototype=b.prototype,L.prototype=new w,L.prototype.constructor=L}}},{}],25:[function(D,V,P){"use strict";Object.defineProperty(P,"__esModule",{value:!0});var L=function(){function b(w,C){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=w,this.value=C}return b.prototype.rotateLeft=function(){var w=this.parent,C=this.brother,c=this.leftChild,s=this.rightChild;if(!s)throw new Error("unknown error");var l=s.leftChild,d=s.rightChild;return w&&(w.leftChild===this?w.leftChild=s:w.rightChild===this&&(w.rightChild=s)),s.parent=w,s.brother=C,s.leftChild=this,s.rightChild=d,C&&(C.brother=s),this.parent=s,this.brother=d,this.leftChild=c,this.rightChild=l,d&&(d.parent=s,d.brother=this),c&&(c.parent=this,c.brother=l),l&&(l.parent=this,l.brother=c),s},b.prototype.rotateRight=function(){var w=this.parent,C=this.brother,c=this.leftChild;if(!c)throw new Error("unknown error");var s=this.rightChild,l=c.leftChild,d=c.rightChild;return w&&(w.leftChild===this?w.leftChild=c:w.rightChild===this&&(w.rightChild=c)),c.parent=w,c.brother=C,c.leftChild=l,c.rightChild=this,C&&(C.brother=c),l&&(l.parent=c,l.brother=this),this.parent=c,this.brother=l,this.leftChild=d,this.rightChild=s,d&&(d.parent=this,d.brother=s),s&&(s.parent=this,s.brother=d),c},b.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},b.TreeNodeColorType={red:!0,black:!1},b}();Object.freeze(L),P.default=L},{}],26:[function(D,V,P){"use strict";var L=this&&this.__generator||function(w,C){var c,s,l,d,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return d={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function u(v){return function(m){return function(g){if(c)throw new TypeError("Generator is already executing.");for(;a;)try{if(c=1,s&&(l=2&g[0]?s.return:g[0]?s.throw||((l=s.return)&&l.call(s),0):s.next)&&!(l=l.call(s,g[1])).done)return l;switch(s=0,l&&(g=[2&g[0],l.value]),g[0]){case 0:case 1:l=g;break;case 4:return a.label++,{value:g[1],done:!1};case 5:a.label++,s=g[1],g=[0];continue;case 7:g=a.ops.pop(),a.trys.pop();continue;default:if(!(l=(l=a.trys).length>0&&l[l.length-1])&&(g[0]===6||g[0]===2)){a=0;continue}if(g[0]===3&&(!l||g[1]>l[0]&&g[1]<l[3])){a.label=g[1];break}if(g[0]===6&&a.label<l[1]){a.label=l[1],l=g;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(g);break}l[2]&&a.ops.pop(),a.trys.pop();continue}g=C.call(w,a)}catch(k){g=[6,k],s=0}finally{c=l=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([v,m])}}};function b(w){var C=this;w===void 0&&(w=[]);var c=[],s=0,l=0,d=0,a=0,u=0,v=0;this.size=function(){return v},this.empty=function(){return v===0},this.clear=function(){s=d=l=a=u=v=0,g.call(this,b.bucketSize),v=0},this.front=function(){return c[s][l]},this.back=function(){return c[d][a]},this.forEach=function(k){if(!this.empty()){var y=0;if(s!==d){for(O=l;O<b.bucketSize;++O)k(c[s][O],y++);for(O=s+1;O<d;++O)for(var T=0;T<b.bucketSize;++T)k(c[O][T],y++);for(O=0;O<=a;++O)k(c[d][O],y++)}else for(var O=l;O<=a;++O)k(c[s][O],y++)}};var m=function(y){var T=s*b.bucketSize+l,O=T+y,M=d*b.bucketSize+a;if(O<T||O>M)throw new Error("pos should more than 0 and less than queue's size");return{curNodeBucketIndex:Math.floor(O/b.bucketSize),curNodePointerIndex:O%b.bucketSize}};this.getElementByPos=function(k){var y=m(k),T=y.curNodeBucketIndex,O=y.curNodePointerIndex;return c[T][O]},this.eraseElementByPos=function(k){var y=this;if(k<0||k>v)throw new Error("pos should more than 0 and less than queue's size");if(k===0)this.popFront();else if(k===this.size())this.popBack();else{for(var T=[],O=k+1;O<v;++O)T.push(this.getElementByPos(O));this.cut(k),this.popBack(),T.forEach(function(M){return y.pushBack(M)})}},this.eraseElementByValue=function(k){if(!this.empty()){var y=[];this.forEach(function(M){M!==k&&y.push(M)});for(var T=y.length,O=0;O<T;++O)this.setElementByPos(O,y[O]);this.cut(T-1)}};var g=function(y){for(var T=[],O=y*b.sigma,M=Math.max(Math.ceil(O/b.bucketSize),2),Y=0;Y<M;++Y)T.push(new Array(b.bucketSize));var N=Math.ceil(y/b.bucketSize),G=Math.floor(M/2)-Math.floor(N/2),et=G,F=0;if(this.size())for(Y=0;Y<N;++Y){for(var S=0;S<b.bucketSize;++S)if(T[G+Y][S]=this.front(),this.popFront(),this.empty()){et=G+Y,F=S;break}if(this.empty())break}c=T,s=G,l=0,d=et,a=F,u=M,v=y};this.pushBack=function(k){this.empty()||(d===u-1&&a===b.bucketSize-1&&g.call(this,this.size()),a<b.bucketSize-1?++a:d<u-1&&(++d,a=0)),++v,c[d][a]=k},this.popBack=function(){this.empty()||(this.size()!==1&&(a>0?--a:s<d&&(--d,a=b.bucketSize-1)),v>0&&--v)},this.setElementByPos=function(k,y){var T=m(k),O=T.curNodeBucketIndex,M=T.curNodePointerIndex;c[O][M]=y},this.insert=function(k,y,T){var O=this;if(T===void 0&&(T=1),k===0)for(;T--;)this.pushFront(y);else if(k===this.size())for(;T--;)this.pushBack(y);else{for(var M=[],Y=k;Y<v;++Y)M.push(this.getElementByPos(Y));for(this.cut(k-1),Y=0;Y<T;++Y)this.pushBack(y);M.forEach(function(N){return O.pushBack(N)})}},this.find=function(k){if(s===d){for(var y=l;y<=a;++y)if(c[s][y]===k)return!0;return!1}for(y=l;y<b.bucketSize;++y)if(c[s][y]===k)return!0;for(y=s+1;y<d;++y)for(var T=0;T<b.bucketSize;++T)if(c[y][T]===k)return!0;for(y=0;y<=a;++y)if(c[d][y]===k)return!0;return!1},this.reverse=function(){for(var k=0,y=v-1;k<y;){var T=this.getElementByPos(k);this.setElementByPos(k,this.getElementByPos(y)),this.setElementByPos(y,T),++k,--y}},this.unique=function(){if(!this.empty()){var k=[],y=this.front();this.forEach(function(O,M){M!==0&&O===y||(k.push(O),y=O)});for(var T=0;T<v;++T)this.setElementByPos(T,k[T]);this.cut(k.length-1)}},this.sort=function(k){var y=[];this.forEach(function(O){y.push(O)}),y.sort(k);for(var T=0;T<v;++T)this.setElementByPos(T,y[T])},this.pushFront=function(k){this.empty()||(s===0&&l===0&&g.call(this,this.size()),l>0?--l:s>0&&(--s,l=b.bucketSize-1)),++v,c[s][l]=k},this.popFront=function(){this.empty()||(this.size()!==1&&(l<b.bucketSize-1?++l:s<d&&(++s,l=0)),v>0&&--v)},this.shrinkToFit=function(){var k=this,y=[];this.forEach(function(Y){y.push(Y)});var T=y.length;c=[];for(var O=Math.ceil(T/b.bucketSize),M=0;M<O;++M)c.push(new Array(b.bucketSize));this.clear(),y.forEach(function(Y){return k.pushBack(Y)})},this.cut=function(k){if(k<0)this.clear();else{var y=m(k),T=y.curNodeBucketIndex,O=y.curNodePointerIndex;d=T,a=O,v=k+1}},this[Symbol.iterator]=function(){return function(){var k,y;return L(this,function(T){switch(T.label){case 0:if(v===0)return[2];if(s!==d)return[3,5];y=l,T.label=1;case 1:return y<=a?[4,c[s][y]]:[3,4];case 2:T.sent(),T.label=3;case 3:return++y,[3,1];case 4:return[2];case 5:y=l,T.label=6;case 6:return y<b.bucketSize?[4,c[s][y]]:[3,9];case 7:T.sent(),T.label=8;case 8:return++y,[3,6];case 9:y=s+1,T.label=10;case 10:if(!(y<d))return[3,15];k=0,T.label=11;case 11:return k<b.bucketSize?[4,c[y][k]]:[3,14];case 12:T.sent(),T.label=13;case 13:return++k,[3,11];case 14:return++y,[3,10];case 15:y=0,T.label=16;case 16:return y<=a?[4,c[d][y]]:[3,19];case 17:T.sent(),T.label=18;case 18:return++y,[3,16];case 19:return[2]}})}()},function(){var k=b.bucketSize;w.size?k=w.size():w.length&&(k=w.length);var y=k*b.sigma;u=Math.ceil(y/b.bucketSize),u=Math.max(u,3);for(var T=0;T<u;++T)c.push(new Array(b.bucketSize));var O=Math.ceil(k/b.bucketSize);s=Math.floor(u/2)-Math.floor(O/2),d=s,w.forEach(function(M){return C.pushBack(M)})}(),Object.freeze(this)}Object.defineProperty(P,"__esModule",{value:!0}),b.sigma=3,b.bucketSize=5e3,Object.freeze(b),P.default=b},{}],27:[function(D,V,P){"use strict";var L=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(k){return function(y){return function(T){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&T[0]?a.return:T[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,T[1])).done)return u;switch(a=0,u&&(T=[2&T[0],u.value]),T[0]){case 0:case 1:u=T;break;case 4:return m.label++,{value:T[1],done:!1};case 5:m.label++,a=T[1],T=[0];continue;case 7:T=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(T[0]===6||T[0]===2)){m=0;continue}if(T[0]===3&&(!u||T[1]>u[0]&&T[1]<u[3])){m.label=T[1];break}if(T[0]===6&&m.label<u[1]){m.label=u[1],u=T;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(T);break}u[2]&&m.ops.pop(),m.trys.pop();continue}T=l.call(s,m)}catch(O){T=[6,O],a=0}finally{d=u=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([k,y])}}},b=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(P,"__esModule",{value:!0});var w=D("../LinkList/LinkList"),C=D("../Map/Map");function c(s,l,d){var a=this;if(s===void 0&&(s=[]),l===void 0&&(l=c.initSize),d=d||function(g){var k,y,T=0,O="";if(typeof g=="number")T=((T=Math.floor(g))<<5)-T,T&=T;else{O=typeof g!="string"?JSON.stringify(g):g;try{for(var M=b(O),Y=M.next();!Y.done;Y=M.next())T=(T<<5)-T+Y.value.charCodeAt(0),T&=T}catch(N){k={error:N}}finally{try{Y&&!Y.done&&(y=M.return)&&y.call(M)}finally{if(k)throw k.error}}}return T^=T>>>16},(l&l-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var u=0,v=[],m=Math.max(c.initSize,Math.min(c.maxSize,l));this.size=function(){return u},this.empty=function(){return u===0},this.clear=function(){u=0,m=l,v=[]},this.forEach=function(g){var k=0;v.forEach(function(y){y.forEach(function(T){g(T,k++)})})},this.setElement=function(g,k){var y,T;if(g==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(k!=null){var O=d(g)&m-1;if(v[O]){var M=v[O].size();if(v[O]instanceof w.default){try{for(var Y=b(v[O]),N=Y.next();!N.done;N=Y.next()){var G=N.value;if(G.key===g)return void(G.value=k)}}catch(F){y={error:F}}finally{try{N&&!N.done&&(T=Y.return)&&T.call(Y)}finally{if(y)throw y.error}}v[O].pushBack({key:g,value:k}),v[O].size()>=c.treeifyThreshold&&(v[O]=new C.default(v[O]))}else v[O].setElement(g,k);var et=v[O].size();u+=et-M}else++u,v[O]=new w.default([{key:g,value:k}]);u>m*c.sigma&&function(F){if(!(F>=c.maxSize)){m=2*F;var S=[];v.forEach(function(_,E){if(!_.empty()){if(_ instanceof w.default&&_.size()===1){var R=_.front(),q=R.key,Z=R.value;S[d(q)&m-1]=new w.default([{key:q,value:Z}])}else if(_ instanceof C.default){var K=new w.default,z=new w.default;_.forEach(function(A){(d(A.key)&F)==0?K.pushBack(A):z.pushBack(A)}),K.size()>c.untreeifyThreshold?S[E]=new C.default(K):K.size()&&(S[E]=K),z.size()>c.untreeifyThreshold?S[E+F]=new C.default(z):z.size()&&(S[E+F]=z)}else{var j=new w.default,H=new w.default;_.forEach(function(A){(d(A.key)&F)==0?j.pushBack(A):H.pushBack(A)}),j.size()&&(S[E]=j),H.size()&&(S[E+F]=H)}v[E].clear()}}),v=S}}.call(this,m)}else this.eraseElementByKey(g)},this.getElementByKey=function(g){var k,y,T=d(g)&m-1;if(v[T]){if(v[T]instanceof C.default)return v[T].getElementByKey(g);try{for(var O=b(v[T]),M=O.next();!M.done;M=O.next()){var Y=M.value;if(Y.key===g)return Y.value}}catch(N){k={error:N}}finally{try{M&&!M.done&&(y=O.return)&&y.call(O)}finally{if(k)throw k.error}}}},this.eraseElementByKey=function(g){var k,y,T=d(g)&m-1;if(v[T]){var O=v[T].size();if(v[T]instanceof C.default)v[T].eraseElementByKey(g),v[T].size()<=c.untreeifyThreshold&&(v[T]=new w.default(v[T]));else{var M=-1;try{for(var Y=b(v[T]),N=Y.next();!N.done;N=Y.next())if(++M,N.value.key===g){v[T].eraseElementByPos(M);break}}catch(et){k={error:et}}finally{try{N&&!N.done&&(y=Y.return)&&y.call(Y)}finally{if(k)throw k.error}}}var G=v[T].size();u+=G-O}},this.find=function(g){var k,y,T=d(g)&m-1;if(!v[T])return!1;if(v[T]instanceof C.default)return v[T].find(g);try{for(var O=b(v[T]),M=O.next();!M.done;M=O.next())if(M.value.key===g)return!0}catch(Y){k={error:Y}}finally{try{M&&!M.done&&(y=O.return)&&y.call(O)}finally{if(k)throw k.error}}return!1},this[Symbol.iterator]=function(){return function(){var g,k,y,T,O,M;return L(this,function(Y){switch(Y.label){case 0:g=0,Y.label=1;case 1:if(!(g<m))return[3,10];for(;g<m&&!v[g];)++g;if(g>=m)return[3,10];Y.label=2;case 2:Y.trys.push([2,7,8,9]),O=void 0,k=b(v[g]),y=k.next(),Y.label=3;case 3:return y.done?[3,6]:[4,y.value];case 4:Y.sent(),Y.label=5;case 5:return y=k.next(),[3,3];case 6:return[3,9];case 7:return T=Y.sent(),O={error:T},[3,9];case 8:try{y&&!y.done&&(M=k.return)&&M.call(k)}finally{if(O)throw O.error}return[7];case 9:return++g,[3,1];case 10:return[2]}})}()},s.forEach(function(g){var k=g.key,y=g.value;return a.setElement(k,y)}),Object.freeze(this)}c.initSize=16,c.maxSize=1<<30,c.sigma=.75,c.treeifyThreshold=8,c.untreeifyThreshold=6,c.minTreeifySize=64,Object.freeze(c),P.default=c},{"../LinkList/LinkList":29,"../Map/Map":30}],28:[function(D,V,P){"use strict";var L=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(k){return function(y){return function(T){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&T[0]?a.return:T[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,T[1])).done)return u;switch(a=0,u&&(T=[2&T[0],u.value]),T[0]){case 0:case 1:u=T;break;case 4:return m.label++,{value:T[1],done:!1};case 5:m.label++,a=T[1],T=[0];continue;case 7:T=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(T[0]===6||T[0]===2)){m=0;continue}if(T[0]===3&&(!u||T[1]>u[0]&&T[1]<u[3])){m.label=T[1];break}if(T[0]===6&&m.label<u[1]){m.label=u[1],u=T;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(T);break}u[2]&&m.ops.pop(),m.trys.pop();continue}T=l.call(s,m)}catch(O){T=[6,O],a=0}finally{d=u=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([k,y])}}},b=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(P,"__esModule",{value:!0});var w=D("../Set/Set"),C=D("../LinkList/LinkList");function c(s,l,d){var a=this;if(s===void 0&&(s=[]),l===void 0&&(l=c.initSize),d=d||function(g){var k=0,y="";if(typeof g=="number")k=((k=Math.floor(g))<<5)-k,k&=k;else{y=typeof g!="string"?JSON.stringify(g):g;for(var T=0;T<y.length;T++)k=(k<<5)-k+y.charCodeAt(T),k&=k}return k^=k>>>16},(l&l-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var u=0,v=[],m=Math.max(c.initSize,Math.min(c.maxSize,l));this.size=function(){return u},this.empty=function(){return u===0},this.clear=function(){u=0,m=l,v=[]},this.forEach=function(g){var k=0;v.forEach(function(y){y.forEach(function(T){g(T,k++)})})},this.insert=function(g){if(g==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");var k=d(g)&m-1;if(v[k]){var y=v[k].size();if(v[k]instanceof C.default){if(v[k].find(g))return;v[k].pushBack(g),v[k].size()>=c.treeifyThreshold&&(v[k]=new w.default(v[k]))}else v[k].insert(g);var T=v[k].size();u+=T-y}else v[k]=new C.default([g]),++u;u>m*c.sigma&&function(O){if(!(O>=c.maxSize)){m=2*O;var M=[];v.forEach(function(Y,N){if(!Y.empty()){if(Y instanceof C.default&&Y.size()===1){var G=Y.front();if(G===void 0)throw new Error("unknown error");M[d(G)&m-1]=new C.default([G])}else if(Y instanceof w.default){var et=new C.default,F=new C.default;Y.forEach(function(E){(d(E)&O)==0?et.pushBack(E):F.pushBack(E)}),et.size()>c.untreeifyThreshold?M[N]=new w.default(et):et.size()&&(M[N]=et),F.size()>c.untreeifyThreshold?M[N+O]=new w.default(F):F.size()&&(M[N+O]=F)}else{var S=new C.default,_=new C.default;Y.forEach(function(E){(d(E)&O)==0?S.pushBack(E):_.pushBack(E)}),S.size()&&(M[N]=S),_.size()&&(M[N+O]=_)}v[N].clear()}}),v=M}}.call(this,m)},this.eraseElementByValue=function(g){var k=d(g)&m-1;if(v[k]){var y=v[k].size();v[k].eraseElementByValue(g),v[k]instanceof w.default&&v[k].size()<=c.untreeifyThreshold&&(v[k]=new C.default(v[k]));var T=v[k].size();u+=T-y}},this.find=function(g){var k=d(g)&m-1;return!!v[k]&&v[k].find(g)},this[Symbol.iterator]=function(){return function(){var g,k,y,T,O,M;return L(this,function(Y){switch(Y.label){case 0:g=0,Y.label=1;case 1:if(!(g<m))return[3,10];for(;g<m&&!v[g];)++g;if(g>=m)return[3,10];Y.label=2;case 2:Y.trys.push([2,7,8,9]),O=void 0,k=b(v[g]),y=k.next(),Y.label=3;case 3:return y.done?[3,6]:[4,y.value];case 4:Y.sent(),Y.label=5;case 5:return y=k.next(),[3,3];case 6:return[3,9];case 7:return T=Y.sent(),O={error:T},[3,9];case 8:try{y&&!y.done&&(M=k.return)&&M.call(k)}finally{if(O)throw O.error}return[7];case 9:return++g,[3,1];case 10:return[2]}})}()},s.forEach(function(g){return a.insert(g)}),Object.freeze(this)}c.initSize=16,c.maxSize=1<<30,c.sigma=.75,c.treeifyThreshold=8,c.untreeifyThreshold=6,c.minTreeifySize=64,Object.freeze(c),P.default=c},{"../LinkList/LinkList":29,"../Set/Set":33}],29:[function(D,V,P){"use strict";var L=this&&this.__generator||function(C,c){var s,l,d,a,u={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return a={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function v(m){return function(g){return function(k){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,l&&(d=2&k[0]?l.return:k[0]?l.throw||((d=l.return)&&d.call(l),0):l.next)&&!(d=d.call(l,k[1])).done)return d;switch(l=0,d&&(k=[2&k[0],d.value]),k[0]){case 0:case 1:d=k;break;case 4:return u.label++,{value:k[1],done:!1};case 5:u.label++,l=k[1],k=[0];continue;case 7:k=u.ops.pop(),u.trys.pop();continue;default:if(!(d=(d=u.trys).length>0&&d[d.length-1])&&(k[0]===6||k[0]===2)){u=0;continue}if(k[0]===3&&(!d||k[1]>d[0]&&k[1]<d[3])){u.label=k[1];break}if(k[0]===6&&u.label<d[1]){u.label=d[1],d=k;break}if(d&&u.label<d[2]){u.label=d[2],u.ops.push(k);break}d[2]&&u.ops.pop(),u.trys.pop();continue}k=c.call(C,u)}catch(y){k=[6,y],l=0}finally{s=d=0}if(5&k[0])throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}([m,g])}}};Object.defineProperty(P,"__esModule",{value:!0});var b=function(){return function(C){this.value=void 0,this.pre=void 0,this.next=void 0,this.value=C}}();function w(C){var c=this;C===void 0&&(C=[]);var s=0,l=void 0,d=void 0;this.size=function(){return s},this.empty=function(){return s===0},this.clear=function(){l=d=void 0,s=0},this.front=function(){return l==null?void 0:l.value},this.back=function(){return d==null?void 0:d.value},this.forEach=function(a){for(var u=l,v=0;u;){if(u.value===void 0)throw new Error("unknown error");a(u.value,v++),u=u.next}},this.getElementByPos=function(a){if(a<0||a>=s)throw new Error("pos must more then 0 and less then the list length");for(var u=l;a--&&u;)u=u.next;if(!u||u.value===void 0)throw new Error("unknown error");return u.value},this.eraseElementByPos=function(a){if(a<0||a>=s)throw new Error("erase pos must more then 0 and less then the list length");if(a===0)this.popFront();else if(a===s-1)this.popBack();else{for(var u=l;a--;){if(!(u==null?void 0:u.next))throw new Error("unknown error");u=u.next}if(!u||!u.pre||!u.next)throw new Error("unknown error");var v=u.pre,m=u.next;m.pre=v,v.next=m,s>0&&--s}},this.eraseElementByValue=function(a){for(;l&&l.value===a;)this.popFront();for(;d&&d.value===a;)this.popBack();if(l)for(var u=l;u;){if(u.value===a){var v=u.pre,m=u.next;m&&(m.pre=v),v&&(v.next=m),s>0&&--s}u=u.next}},this.pushBack=function(a){if(a==null)throw new Error("you can't push null or undefined here");++s;var u=new b(a);d?(d.next=u,u.pre=d,d=u):l=d=u},this.popBack=function(){d&&(s>0&&--s,d&&(l===d?l=d=void 0:(d=d.pre)&&(d.next=void 0)))},this.setElementByPos=function(a,u){if(u==null)throw new Error("you can't set null or undefined here");if(a<0||a>=s)throw new Error("pos must more then 0 and less then the list length");for(var v=l;a--;){if(!v)throw new Error("unknown error");v=v.next}v&&(v.value=u)},this.insert=function(a,u,v){if(v===void 0&&(v=1),u==null)throw new Error("you can't insert null or undefined here");if(a<0||a>s)throw new Error("insert pos must more then 0 and less then or equal to the list length");if(v<0)throw new Error("insert size must more than 0");if(a===0)for(;v--;)this.pushFront(u);else if(a===s)for(;v--;)this.pushBack(u);else{for(var m=l,g=1;g<a;++g){if(!(m==null?void 0:m.next))throw new Error("unknown error");m=m==null?void 0:m.next}if(!m)throw new Error("unknown error");var k=m.next;for(s+=v;v--;)m.next=new b(u),m.next.pre=m,m=m.next;m.next=k,k&&(k.pre=m)}},this.find=function(a){for(var u=l;u;){if(u.value===a)return!0;u=u.next}return!1},this.reverse=function(){for(var a=l,u=d,v=0;a&&u&&2*v<s;){var m=a.value;a.value=u.value,u.value=m,a=a.next,u=u.pre,++v}},this.unique=function(){for(var a=l;a;){for(var u=a;u&&u.next&&u.value===u.next.value;)u=u.next,s>0&&--s;a.next=u.next,a.next&&(a.next.pre=a),a=a.next}},this.sort=function(a){var u=[];this.forEach(function(m){u.push(m)}),u.sort(a);var v=l;u.forEach(function(m){v&&(v.value=m,v=v.next)})},this.pushFront=function(a){if(a==null)throw new Error("you can't push null or undefined here");++s;var u=new b(a);l?(u.next=l,l.pre=u,l=u):l=d=u},this.popFront=function(){l&&(s>0&&--s,l&&(l===d?l=d=void 0:(l=l.next)&&(l.pre=void 0)))},this.merge=function(a){var u=this,v=l;a.forEach(function(m){for(;v&&v.value!==void 0&&v.value<=m;)v=v.next;if(v===void 0)u.pushBack(m),v=d;else if(v===l)u.pushFront(m),v=l;else{++s;var g=v.pre;g&&(g.next=new b(m),g.next.pre=g,g.next.next=v,v&&(v.pre=g.next))}})},this[Symbol.iterator]=function(){return function(){var a;return L(this,function(u){switch(u.label){case 0:a=l,u.label=1;case 1:if(a===void 0)return[3,3];if(!a.value)throw new Error("unknown error");return[4,a.value];case 2:return u.sent(),a=a.next,[3,1];case 3:return[2]}})}()},C.forEach(function(a){return c.pushBack(a)}),Object.freeze(this)}Object.freeze(w),P.default=w},{}],30:[function(D,V,P){"use strict";var L=this&&this.__generator||function(c,s){var l,d,a,u,v={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(g){return function(k){return function(y){if(l)throw new TypeError("Generator is already executing.");for(;v;)try{if(l=1,d&&(a=2&y[0]?d.return:y[0]?d.throw||((a=d.return)&&a.call(d),0):d.next)&&!(a=a.call(d,y[1])).done)return a;switch(d=0,a&&(y=[2&y[0],a.value]),y[0]){case 0:case 1:a=y;break;case 4:return v.label++,{value:y[1],done:!1};case 5:v.label++,d=y[1],y=[0];continue;case 7:y=v.ops.pop(),v.trys.pop();continue;default:if(!(a=(a=v.trys).length>0&&a[a.length-1])&&(y[0]===6||y[0]===2)){v=0;continue}if(y[0]===3&&(!a||y[1]>a[0]&&y[1]<a[3])){v.label=y[1];break}if(y[0]===6&&v.label<a[1]){v.label=a[1],a=y;break}if(a&&v.label<a[2]){v.label=a[2],v.ops.push(y);break}a[2]&&v.ops.pop(),v.trys.pop();continue}y=s.call(c,v)}catch(T){y=[6,T],d=0}finally{l=a=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([g,k])}}},b=this&&this.__values||function(c){var s=typeof Symbol=="function"&&Symbol.iterator,l=s&&c[s],d=0;if(l)return l.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(P,"__esModule",{value:!0});var w=D("../Base/TreeNode");function C(c,s){var l=this;c===void 0&&(c=[]),s=s||function(F,S){return F<S?-1:F>S?1:0};var d=0,a=new w.default;a.color=w.default.TreeNodeColorType.black,this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.key=a.value=void 0,a.leftChild=a.rightChild=a.brother=void 0};var u=function F(S){if(!S||S.key===void 0)throw new Error("unknown error");return S.leftChild?F(S.leftChild):S},v=function F(S){if(!S||S.key===void 0)throw new Error("unknown error");return S.rightChild?F(S.rightChild):S};this.front=function(){if(!this.empty()){var F=u(a);if(F.key===void 0||F.value===void 0)throw new Error("unknown error");return{key:F.key,value:F.value}}},this.back=function(){if(!this.empty()){var F=v(a);if(F.key===void 0||F.value===void 0)throw new Error("unknown error");return{key:F.key,value:F.value}}},this.forEach=function(F){var S,_,E=0;try{for(var R=b(this),q=R.next();!q.done;q=R.next())F(q.value,E++)}catch(Z){S={error:Z}}finally{try{q&&!q.done&&(_=R.return)&&_.call(R)}finally{if(S)throw S.error}}},this.getElementByPos=function(F){var S,_;if(F<0||F>=this.size())throw new Error("pos must more than 0 and less than set's size");var E=0;try{for(var R=b(this),q=R.next();!q.done;q=R.next()){var Z=q.value;if(E===F)return Z;++E}}catch(K){S={error:K}}finally{try{q&&!q.done&&(_=R.return)&&_.call(R)}finally{if(S)throw S.error}}throw new Error("unknown Error")};var m=function F(S,_){if(S&&S.key!==void 0&&S.value!==void 0){var E=s(S.key,_);return E===0?{key:S.key,value:S.value}:E<0?F(S.rightChild,_):F(S.leftChild,_)||{key:S.key,value:S.value}}};this.lowerBound=function(F){return m(a,F)};var g=function F(S,_){if(S&&S.key!==void 0&&S.value!==void 0)return s(S.key,_)<=0?F(S.rightChild,_):F(S.leftChild,_)||{key:S.key,value:S.value}};this.upperBound=function(F){return g(a,F)};var k=function F(S,_){if(S&&S.key!==void 0&&S.value!==void 0){var E=s(S.key,_);return E===0?{key:S.key,value:S.value}:E>0?F(S.leftChild,_):F(S.rightChild,_)||{key:S.key,value:S.value}}};this.reverseLowerBound=function(F){return k(a,F)};var y=function F(S,_){if(S&&S.key!==void 0&&S.value!==void 0)return s(S.key,_)>=0?F(S.leftChild,_):F(S.rightChild,_)||{key:S.key,value:S.value}};this.reverseUpperBound=function(F){return y(a,F)};var T=function F(S){var _=S.parent;if(!_){if(S===a)return;throw new Error("unknown error")}if(S.color!==w.default.TreeNodeColorType.red){var E=S.brother;if(!E)throw new Error("unknown error");if(S===_.leftChild)if(E.color===w.default.TreeNodeColorType.red){E.color=w.default.TreeNodeColorType.black,_.color=w.default.TreeNodeColorType.red;var R=_.rotateLeft();a===_&&(a=R),F(S)}else E.color===w.default.TreeNodeColorType.black&&(E.rightChild&&E.rightChild.color===w.default.TreeNodeColorType.red?(E.color=_.color,_.color=w.default.TreeNodeColorType.black,E.rightChild&&(E.rightChild.color=w.default.TreeNodeColorType.black),R=_.rotateLeft(),a===_&&(a=R),S.color=w.default.TreeNodeColorType.black):E.rightChild&&E.rightChild.color!==w.default.TreeNodeColorType.black||!E.leftChild||E.leftChild.color!==w.default.TreeNodeColorType.red?E.leftChild&&E.leftChild.color!==w.default.TreeNodeColorType.black||E.rightChild&&E.rightChild.color!==w.default.TreeNodeColorType.black||(E.color=w.default.TreeNodeColorType.red,F(_)):(E.color=w.default.TreeNodeColorType.red,E.leftChild&&(E.leftChild.color=w.default.TreeNodeColorType.black),R=E.rotateRight(),a===E&&(a=R),F(S)));else S===_.rightChild&&(E.color===w.default.TreeNodeColorType.red?(E.color=w.default.TreeNodeColorType.black,_.color=w.default.TreeNodeColorType.red,R=_.rotateRight(),a===_&&(a=R),F(S)):E.color===w.default.TreeNodeColorType.black&&(E.leftChild&&E.leftChild.color===w.default.TreeNodeColorType.red?(E.color=_.color,_.color=w.default.TreeNodeColorType.black,E.leftChild&&(E.leftChild.color=w.default.TreeNodeColorType.black),R=_.rotateRight(),a===_&&(a=R),S.color=w.default.TreeNodeColorType.black):E.leftChild&&E.leftChild.color!==w.default.TreeNodeColorType.black||!E.rightChild||E.rightChild.color!==w.default.TreeNodeColorType.red?E.leftChild&&E.leftChild.color!==w.default.TreeNodeColorType.black||E.rightChild&&E.rightChild.color!==w.default.TreeNodeColorType.black||(E.color=w.default.TreeNodeColorType.red,F(_)):(E.color=w.default.TreeNodeColorType.red,E.rightChild&&(E.rightChild.color=w.default.TreeNodeColorType.black),R=E.rotateLeft(),a===E&&(a=R),F(S))))}else S.color=w.default.TreeNodeColorType.black},O=function(S){for(var _=S;_.leftChild||_.rightChild;){if(_.rightChild){_=u(_.rightChild);var E=S.key;S.key=_.key,_.key=E;var R=S.value;S.value=_.value,_.value=R,S=_}_.leftChild&&(_=v(_.leftChild),E=S.key,S.key=_.key,_.key=E,R=S.value,S.value=_.value,_.value=R,S=_)}T(_),_&&_.remove(),--d,a.color=w.default.TreeNodeColorType.black},M=function F(S,_){return!(!S||S.key===void 0)&&(!!F(S.leftChild,_)||!!_(S)||F(S.rightChild,_))};this.eraseElementByPos=function(F){if(F<0||F>=d)throw new Error("pos must more than 0 and less than set's size");var S=0;M(a,function(_){return F===S?(O(_),!0):(++S,!1)})},this.eraseElementByKey=function(F){if(!this.empty()){var S=G(a,F);S!==void 0&&S.key!==void 0&&s(S.key,F)===0&&O(S)}};var Y=function F(S,_){if(!S||S.key===void 0)throw new Error("unknown error");var E=s(_,S.key);return E<0?S.leftChild?F(S.leftChild,_):(S.leftChild=new w.default,S.leftChild.parent=S,S.leftChild.brother=S.rightChild,S.rightChild&&(S.rightChild.brother=S.leftChild),S.leftChild):E>0?S.rightChild?F(S.rightChild,_):(S.rightChild=new w.default,S.rightChild.parent=S,S.rightChild.brother=S.leftChild,S.leftChild&&(S.leftChild.brother=S.rightChild),S.rightChild):S},N=function F(S){var _=S.parent;if(!_){if(S===a)return;throw new Error("unknown error")}if(_.color!==w.default.TreeNodeColorType.black&&_.color===w.default.TreeNodeColorType.red){var E=_.brother,R=_.parent;if(!R)throw new Error("unknown error");if(E&&E.color===w.default.TreeNodeColorType.red)E.color=_.color=w.default.TreeNodeColorType.black,R.color=w.default.TreeNodeColorType.red,F(R);else if(!E||E.color===w.default.TreeNodeColorType.black)if(_===R.leftChild)if(S===_.leftChild){_.color=w.default.TreeNodeColorType.black,R.color=w.default.TreeNodeColorType.red;var q=R.rotateRight();R===a&&(a=q)}else S===_.rightChild&&(q=_.rotateLeft(),R===a&&(a=q),F(_));else _===R.rightChild&&(S===_.leftChild?(q=_.rotateRight(),R===a&&(a=q),F(_)):S===_.rightChild&&(_.color=w.default.TreeNodeColorType.black,R.color=w.default.TreeNodeColorType.red,q=R.rotateLeft(),R===a&&(a=q)))}};this.setElement=function(F,S){if(F==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(S!=null){if(this.empty())return++d,a.key=F,a.value=S,void(a.color=w.default.TreeNodeColorType.black);var _=Y(a,F);_.key===void 0||s(_.key,F)!==0?(++d,_.key=F,_.value=S,N(_),a.color=w.default.TreeNodeColorType.black):_.value=S}else this.eraseElementByKey(F)};var G=function F(S,_){if(S&&S.key!==void 0){var E=s(_,S.key);return E<0?F(S.leftChild,_):E>0?F(S.rightChild,_):S}};this.find=function(F){return!!G(a,F)},this.getElementByKey=function(F){var S=G(a,F);if((S==null?void 0:S.key)===void 0||(S==null?void 0:S.value)===void 0)throw new Error("unknown error");return S.value},this.union=function(F){var S=this;F.forEach(function(_){var E=_.key,R=_.value;return S.setElement(E,R)})},this.getHeight=function(){if(this.empty())return 0;var F=function S(_){return _?Math.max(S(_.leftChild),S(_.rightChild))+1:1};return F(a)};var et=function F(S){return L(this,function(_){switch(_.label){case 0:return S&&S.key!==void 0&&S.value!==void 0?[5,b(F(S.leftChild))]:[2];case 1:return _.sent(),[4,{key:S.key,value:S.value}];case 2:return _.sent(),[5,b(F(S.rightChild))];case 3:return _.sent(),[2]}})};this[Symbol.iterator]=function(){return et(a)},c.forEach(function(F){var S=F.key,_=F.value;return l.setElement(S,_)}),Object.freeze(this)}Object.freeze(C),P.default=C},{"../Base/TreeNode":25}],31:[function(D,V,P){"use strict";function L(b,w){b===void 0&&(b=[]),w=w||function(d,a){return d>a?-1:d<a?1:0};var C=[];b.forEach(function(d){return C.push(d)});var c=C.length,s=function(a,u){if(a<0||a>=c)throw new Error("unknown error");if(u<0||u>=c)throw new Error("unknown error");var v=C[a];C[a]=C[u],C[u]=v},l=function(a){if(a<0||a>=c)throw new Error("unknown error");var u=2*a+1,v=2*a+2;u<c&&w(C[a],C[u])>0&&s(a,u),v<c&&w(C[a],C[v])>0&&s(a,v)};(function(){for(var d=Math.floor((c-1)/2);d>=0;--d)for(var a=d,u=2*a+1;u<c;){var v=u+1,m=u;if(v<c&&w(C[u],C[v])>0&&(m=v),w(C[a],C[m])<=0)break;s(a,m),u=2*(a=m)+1}})(),this.size=function(){return c},this.empty=function(){return c===0},this.clear=function(){c=0,C.length=0},this.push=function(d){if(C.push(d),++c!=1)for(var a=c-1;a>0;){var u=Math.floor((a-1)/2);if(w(C[u],d)<=0)break;l(u),a=u}},this.pop=function(){if(!this.empty())if(this.size()!==1){var d=C[c-1];--c;for(var a=0;a<this.size();){var u=2*a+1,v=2*a+2;if(u>=this.size())break;var m=u;if(v<this.size()&&w(C[u],C[v])>0&&(m=v),w(C[m],d)>=0)break;C[a]=C[m],a=m}C[a]=d}else--c},this.top=function(){return C[0]},Object.freeze(this)}Object.defineProperty(P,"__esModule",{value:!0}),Object.freeze(L),P.default=L},{}],32:[function(D,V,P){"use strict";Object.defineProperty(P,"__esModule",{value:!0});var L=D("../LinkList/LinkList");function b(w){w===void 0&&(w=[]);var C=new L.default(w);this.size=function(){return C.size()},this.empty=function(){return C.empty()},this.clear=function(){C.clear()},this.push=function(c){C.pushBack(c)},this.pop=function(){C.popFront()},this.front=function(){return C.front()},Object.freeze(this)}Object.freeze(b),P.default=b},{"../LinkList/LinkList":29}],33:[function(D,V,P){"use strict";var L=this&&this.__generator||function(c,s){var l,d,a,u,v={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(g){return function(k){return function(y){if(l)throw new TypeError("Generator is already executing.");for(;v;)try{if(l=1,d&&(a=2&y[0]?d.return:y[0]?d.throw||((a=d.return)&&a.call(d),0):d.next)&&!(a=a.call(d,y[1])).done)return a;switch(d=0,a&&(y=[2&y[0],a.value]),y[0]){case 0:case 1:a=y;break;case 4:return v.label++,{value:y[1],done:!1};case 5:v.label++,d=y[1],y=[0];continue;case 7:y=v.ops.pop(),v.trys.pop();continue;default:if(!(a=(a=v.trys).length>0&&a[a.length-1])&&(y[0]===6||y[0]===2)){v=0;continue}if(y[0]===3&&(!a||y[1]>a[0]&&y[1]<a[3])){v.label=y[1];break}if(y[0]===6&&v.label<a[1]){v.label=a[1],a=y;break}if(a&&v.label<a[2]){v.label=a[2],v.ops.push(y);break}a[2]&&v.ops.pop(),v.trys.pop();continue}y=s.call(c,v)}catch(T){y=[6,T],d=0}finally{l=a=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([g,k])}}},b=this&&this.__values||function(c){var s=typeof Symbol=="function"&&Symbol.iterator,l=s&&c[s],d=0;if(l)return l.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&d>=c.length&&(c=void 0),{value:c&&c[d++],done:!c}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(P,"__esModule",{value:!0});var w=D("../Base/TreeNode");function C(c,s){var l=this;c===void 0&&(c=[]),s=s||function(F,S){return F<S?-1:F>S?1:0};var d=0,a=new w.default;a.color=w.default.TreeNodeColorType.black,this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.key=void 0,a.leftChild=a.rightChild=a.brother=a.parent=void 0,a.color=w.default.TreeNodeColorType.black};var u=function F(S){if(!S||S.key===void 0)throw new Error("unknown error");return S.leftChild?F(S.leftChild):S},v=function F(S){if(!S||S.key===void 0)throw new Error("unknown error");return S.rightChild?F(S.rightChild):S};this.front=function(){if(!this.empty())return u(a).key},this.back=function(){if(!this.empty())return v(a).key},this.forEach=function(F){var S,_,E=0;try{for(var R=b(this),q=R.next();!q.done;q=R.next())F(q.value,E++)}catch(Z){S={error:Z}}finally{try{q&&!q.done&&(_=R.return)&&_.call(R)}finally{if(S)throw S.error}}},this.getElementByPos=function(F){var S,_;if(F<0||F>=this.size())throw new Error("pos must more than 0 and less than set's size");var E=0;try{for(var R=b(this),q=R.next();!q.done;q=R.next()){var Z=q.value;if(E===F)return Z;++E}}catch(K){S={error:K}}finally{try{q&&!q.done&&(_=R.return)&&_.call(R)}finally{if(S)throw S.error}}throw new Error("unknown error")};var m=function F(S){var _=S.parent;if(!_){if(S===a)return;throw new Error("unknown error")}if(S.color!==w.default.TreeNodeColorType.red){var E=S.brother;if(!E)throw new Error("unknown error");if(S===_.leftChild)if(E.color===w.default.TreeNodeColorType.red){E.color=w.default.TreeNodeColorType.black,_.color=w.default.TreeNodeColorType.red;var R=_.rotateLeft();a===_&&(a=R),F(S)}else E.color===w.default.TreeNodeColorType.black&&(E.rightChild&&E.rightChild.color===w.default.TreeNodeColorType.red?(E.color=_.color,_.color=w.default.TreeNodeColorType.black,E.rightChild&&(E.rightChild.color=w.default.TreeNodeColorType.black),R=_.rotateLeft(),a===_&&(a=R),S.color=w.default.TreeNodeColorType.black):E.rightChild&&E.rightChild.color!==w.default.TreeNodeColorType.black||!E.leftChild||E.leftChild.color!==w.default.TreeNodeColorType.red?E.leftChild&&E.leftChild.color!==w.default.TreeNodeColorType.black||E.rightChild&&E.rightChild.color!==w.default.TreeNodeColorType.black||(E.color=w.default.TreeNodeColorType.red,F(_)):(E.color=w.default.TreeNodeColorType.red,E.leftChild&&(E.leftChild.color=w.default.TreeNodeColorType.black),R=E.rotateRight(),a===E&&(a=R),F(S)));else S===_.rightChild&&(E.color===w.default.TreeNodeColorType.red?(E.color=w.default.TreeNodeColorType.black,_.color=w.default.TreeNodeColorType.red,R=_.rotateRight(),a===_&&(a=R),F(S)):E.color===w.default.TreeNodeColorType.black&&(E.leftChild&&E.leftChild.color===w.default.TreeNodeColorType.red?(E.color=_.color,_.color=w.default.TreeNodeColorType.black,E.leftChild&&(E.leftChild.color=w.default.TreeNodeColorType.black),R=_.rotateRight(),a===_&&(a=R),S.color=w.default.TreeNodeColorType.black):E.leftChild&&E.leftChild.color!==w.default.TreeNodeColorType.black||!E.rightChild||E.rightChild.color!==w.default.TreeNodeColorType.red?E.leftChild&&E.leftChild.color!==w.default.TreeNodeColorType.black||E.rightChild&&E.rightChild.color!==w.default.TreeNodeColorType.black||(E.color=w.default.TreeNodeColorType.red,F(_)):(E.color=w.default.TreeNodeColorType.red,E.rightChild&&(E.rightChild.color=w.default.TreeNodeColorType.black),R=E.rotateLeft(),a===E&&(a=R),F(S))))}else S.color=w.default.TreeNodeColorType.black},g=function(S){for(var _=S;_.leftChild||_.rightChild;){if(_.rightChild){_=u(_.rightChild);var E=S.key;S.key=_.key,_.key=E,S=_}_.leftChild&&(_=v(_.leftChild),E=S.key,S.key=_.key,_.key=E,S=_)}m(_),_&&_.remove(),--d,a.color=w.default.TreeNodeColorType.black},k=function F(S,_){return!(!S||S.key===void 0)&&(!!F(S.leftChild,_)||!!_(S)||F(S.rightChild,_))};this.eraseElementByPos=function(F){if(F<0||F>=d)throw new Error("pos must more than 0 and less than set's size");var S=0;k(a,function(_){return F===S?(g(_),!0):(++S,!1)})},this.eraseElementByValue=function(F){if(!this.empty()){var S=O(a,F);S!==void 0&&S.key!==void 0&&s(S.key,F)===0&&g(S)}};var y=function F(S,_){if(!S||S.key===void 0)throw new Error("unknown error");var E=s(_,S.key);return E<0?S.leftChild?F(S.leftChild,_):(S.leftChild=new w.default,S.leftChild.parent=S,S.leftChild.brother=S.rightChild,S.rightChild&&(S.rightChild.brother=S.leftChild),S.leftChild):E>0?S.rightChild?F(S.rightChild,_):(S.rightChild=new w.default,S.rightChild.parent=S,S.rightChild.brother=S.leftChild,S.leftChild&&(S.leftChild.brother=S.rightChild),S.rightChild):S},T=function F(S){var _=S.parent;if(!_){if(S===a)return;throw new Error("unknown error")}if(_.color!==w.default.TreeNodeColorType.black&&_.color===w.default.TreeNodeColorType.red){var E=_.brother,R=_.parent;if(!R)throw new Error("unknown error");if(E&&E.color===w.default.TreeNodeColorType.red)E.color=_.color=w.default.TreeNodeColorType.black,R.color=w.default.TreeNodeColorType.red,F(R);else if(!E||E.color===w.default.TreeNodeColorType.black)if(_===R.leftChild)if(S===_.leftChild){_.color=w.default.TreeNodeColorType.black,R.color=w.default.TreeNodeColorType.red;var q=R.rotateRight();R===a&&(a=q)}else S===_.rightChild&&(q=_.rotateLeft(),R===a&&(a=q),F(_));else _===R.rightChild&&(S===_.leftChild?(q=_.rotateRight(),R===a&&(a=q),F(_)):S===_.rightChild&&(_.color=w.default.TreeNodeColorType.black,R.color=w.default.TreeNodeColorType.red,q=R.rotateLeft(),R===a&&(a=q)))}};this.insert=function(F){if(F==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty())return++d,a.key=F,void(a.color=w.default.TreeNodeColorType.black);var S=y(a,F);S.key!==void 0&&s(S.key,F)===0||(++d,S.key=F,T(S),a.color=w.default.TreeNodeColorType.black)};var O=function F(S,_){if(S&&S.key!==void 0){var E=s(_,S.key);return E<0?F(S.leftChild,_):E>0?F(S.rightChild,_):S}};this.find=function(F){var S=O(a,F);return S!==void 0&&S.key!==void 0&&s(S.key,F)===0};var M=function F(S,_){if(S&&S.key!==void 0){var E=s(S.key,_);if(E===0)return S.key;if(E<0)return F(S.rightChild,_);var R=F(S.leftChild,_);return R!==void 0?R:S.key}};this.lowerBound=function(F){return M(a,F)};var Y=function F(S,_){if(S&&S.key!==void 0){if(s(S.key,_)<=0)return F(S.rightChild,_);var E=F(S.leftChild,_);return E!==void 0?E:S.key}};this.upperBound=function(F){return Y(a,F)};var N=function F(S,_){if(S&&S.key!==void 0){var E=s(S.key,_);if(E===0)return S.key;if(E>0)return F(S.leftChild,_);var R=F(S.rightChild,_);return R!==void 0?R:S.key}};this.reverseLowerBound=function(F){return N(a,F)};var G=function F(S,_){if(S&&S.key!==void 0){if(s(S.key,_)>=0)return F(S.leftChild,_);var E=F(S.rightChild,_);return E!==void 0?E:S.key}};this.reverseUpperBound=function(F){return G(a,F)},this.union=function(F){var S=this;F.forEach(function(_){return S.insert(_)})},this.getHeight=function(){if(this.empty())return 0;var F=function S(_){return _?Math.max(S(_.leftChild),S(_.rightChild))+1:1};return F(a)};var et=function F(S){return L(this,function(_){switch(_.label){case 0:return S&&S.key!==void 0?[5,b(F(S.leftChild))]:[2];case 1:return _.sent(),[4,S.key];case 2:return _.sent(),[5,b(F(S.rightChild))];case 3:return _.sent(),[2]}})};this[Symbol.iterator]=function(){return et(a)},c.forEach(function(F){return l.insert(F)}),Object.freeze(this)}Object.freeze(C),P.default=C},{"../Base/TreeNode":25}],34:[function(D,V,P){"use strict";function L(b){var w=this;b===void 0&&(b=[]);var C=0,c=[];this.size=function(){return C},this.empty=function(){return C===0},this.clear=function(){C=0,c.length=0},this.push=function(s){c.push(s),++C},this.pop=function(){c.pop(),C>0&&--C},this.top=function(){return c[C-1]},b.forEach(function(s){return w.push(s)}),Object.freeze(this)}Object.defineProperty(P,"__esModule",{value:!0}),Object.freeze(L),P.default=L},{}],35:[function(D,V,P){"use strict";var L=this&&this.__generator||function(s,l){var d,a,u,v,m={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return v={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function g(k){return function(y){return function(T){if(d)throw new TypeError("Generator is already executing.");for(;m;)try{if(d=1,a&&(u=2&T[0]?a.return:T[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,T[1])).done)return u;switch(a=0,u&&(T=[2&T[0],u.value]),T[0]){case 0:case 1:u=T;break;case 4:return m.label++,{value:T[1],done:!1};case 5:m.label++,a=T[1],T=[0];continue;case 7:T=m.ops.pop(),m.trys.pop();continue;default:if(!(u=(u=m.trys).length>0&&u[u.length-1])&&(T[0]===6||T[0]===2)){m=0;continue}if(T[0]===3&&(!u||T[1]>u[0]&&T[1]<u[3])){m.label=T[1];break}if(T[0]===6&&m.label<u[1]){m.label=u[1],u=T;break}if(u&&m.label<u[2]){m.label=u[2],m.ops.push(T);break}u[2]&&m.ops.pop(),m.trys.pop();continue}T=l.call(s,m)}catch(O){T=[6,O],a=0}finally{d=u=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([k,y])}}},b=this&&this.__read||function(s,l){var d=typeof Symbol=="function"&&s[Symbol.iterator];if(!d)return s;var a,u,v=d.call(s),m=[];try{for(;(l===void 0||l-- >0)&&!(a=v.next()).done;)m.push(a.value)}catch(g){u={error:g}}finally{try{a&&!a.done&&(d=v.return)&&d.call(v)}finally{if(u)throw u.error}}return m},w=this&&this.__spreadArray||function(s,l,d){if(d||arguments.length===2)for(var a,u=0,v=l.length;u<v;u++)!a&&u in l||(a||(a=Array.prototype.slice.call(l,0,u)),a[u]=l[u]);return s.concat(a||Array.prototype.slice.call(l))},C=this&&this.__values||function(s){var l=typeof Symbol=="function"&&Symbol.iterator,d=l&&s[l],a=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};function c(s){var l=this;s===void 0&&(s=[]);var d=0,a=[];this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,a.length=0},this.front=function(){if(!this.empty())return a[0]},this.back=function(){if(!this.empty())return a[d-1]},this.forEach=function(u){a.forEach(u)},this.getElementByPos=function(u){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");return a[u]},this.eraseElementByPos=function(u){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");for(var v=u;v<d-1;++v)a[v]=a[v+1];this.popBack()},this.eraseElementByValue=function(u){var v=[];this.forEach(function(g){g!==u&&v.push(g)}),v.forEach(function(g,k){a[k]=g});for(var m=v.length;d>m;)this.popBack()},this.pushBack=function(u){a.push(u),++d},this.popBack=function(){a.pop(),d>0&&--d},this.setElementByPos=function(u,v){if(u<0||u>=d)throw new Error("pos must more than 0 and less than vector's size");a[u]=v},this.insert=function(u,v,m){if(m===void 0&&(m=1),u<0||u>d)throw new Error("pos must more than 0 and less than or equal to vector's size");a.splice.apply(a,w([u,0],b(new Array(m).fill(v)),!1)),d+=m},this.find=function(u){return a.includes(u)},this.reverse=function(){a.reverse()},this.unique=function(){var u,v=[];this.forEach(function(g,k){k!==0&&g===u||(v.push(g),u=g)}),v.forEach(function(g,k){a[k]=g});for(var m=v.length;d>m;)this.popBack()},this.sort=function(u){a.sort(u)},this[Symbol.iterator]=function(){return function(){return L(this,function(u){switch(u.label){case 0:return[5,C(a)];case 1:return[2,u.sent()]}})}()},s.forEach(function(u){return l.pushBack(u)}),Object.freeze(this)}Object.defineProperty(P,"__esModule",{value:!0}),Object.freeze(c),P.default=c},{}],36:[function(D,V,P){"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.HashMap=P.HashSet=P.Map=P.Set=P.PriorityQueue=P.Deque=P.LinkList=P.Queue=P.Stack=P.Vector=void 0;var L=D("./Vector/Vector");P.Vector=L.default;var b=D("./Stack/Stack");P.Stack=b.default;var w=D("./Queue/Queue");P.Queue=w.default;var C=D("./LinkList/LinkList");P.LinkList=C.default;var c=D("./Deque/Deque");P.Deque=c.default;var s=D("./PriorityQueue/PriorityQueue");P.PriorityQueue=s.default;var l=D("./Set/Set");P.Set=l.default;var d=D("./Map/Map");P.Map=d.default;var a=D("./HashSet/HashSet");P.HashSet=a.default;var u=D("./HashMap/HashMap");P.HashMap=u.default},{"./Deque/Deque":26,"./HashMap/HashMap":27,"./HashSet/HashSet":28,"./LinkList/LinkList":29,"./Map/Map":30,"./PriorityQueue/PriorityQueue":31,"./Queue/Queue":32,"./Set/Set":33,"./Stack/Stack":34,"./Vector/Vector":35}],37:[function(D,V,P){"use strict";var L=D("yallist"),b=Symbol("max"),w=Symbol("length"),C=Symbol("lengthCalculator"),c=Symbol("allowStale"),s=Symbol("maxAge"),l=Symbol("dispose"),d=Symbol("noDisposeOnSet"),a=Symbol("lruList"),u=Symbol("cache"),v=Symbol("updateAgeOnGet"),m=function(){return 1},g=function(N,G,et){var F=N[u].get(G);if(F){var S=F.value;if(k(N,S)){if(T(N,F),!N[c])return}else et&&(N[v]&&(F.value.now=Date.now()),N[a].unshiftNode(F));return S.value}},k=function(N,G){if(!G||!G.maxAge&&!N[s])return!1;var et=Date.now()-G.now;return G.maxAge?et>G.maxAge:N[s]&&et>N[s]},y=function(N){if(N[w]>N[b])for(var G=N[a].tail;N[w]>N[b]&&G!==null;){var et=G.prev;T(N,G),G=et}},T=function(N,G){if(G){var et=G.value;N[l]&&N[l](et.key,et.value),N[w]-=et.length,N[u].delete(et.key),N[a].removeNode(G)}},O=function Y(N,G,et,F,S){gt(this,Y),this.key=N,this.value=G,this.length=et,this.now=F,this.maxAge=S||0},M=function(N,G,et,F){var S=et.value;k(N,S)&&(T(N,et),N[c]||(S=void 0)),S&&G.call(F,S.value,S.key,N)};V.exports=function(){function Y(N){if(gt(this,Y),typeof N=="number"&&(N={max:N}),N||(N={}),N.max&&(typeof N.max!="number"||N.max<0))throw new TypeError("max must be a non-negative number");this[b]=N.max||1/0;var G=N.length||m;if(this[C]=typeof G!="function"?m:G,this[c]=N.stale||!1,N.maxAge&&typeof N.maxAge!="number")throw new TypeError("maxAge must be a number");this[s]=N.maxAge||0,this[l]=N.dispose,this[d]=N.noDisposeOnSet||!1,this[v]=N.updateAgeOnGet||!1,this.reset()}return St(Y,[{key:"max",get:function(){return this[b]},set:function(G){if(typeof G!="number"||G<0)throw new TypeError("max must be a non-negative number");this[b]=G||1/0,y(this)}},{key:"allowStale",get:function(){return this[c]},set:function(G){this[c]=!!G}},{key:"maxAge",get:function(){return this[s]},set:function(G){if(typeof G!="number")throw new TypeError("maxAge must be a non-negative number");this[s]=G,y(this)}},{key:"lengthCalculator",get:function(){return this[C]},set:function(G){var et=this;typeof G!="function"&&(G=m),G!==this[C]&&(this[C]=G,this[w]=0,this[a].forEach(function(F){F.length=et[C](F.value,F.key),et[w]+=F.length})),y(this)}},{key:"length",get:function(){return this[w]}},{key:"itemCount",get:function(){return this[a].length}},{key:"rforEach",value:function(G,et){et=et||this;for(var F=this[a].tail;F!==null;){var S=F.prev;M(this,G,F,et),F=S}}},{key:"forEach",value:function(G,et){et=et||this;for(var F=this[a].head;F!==null;){var S=F.next;M(this,G,F,et),F=S}}},{key:"keys",value:function(){return this[a].toArray().map(function(G){return G.key})}},{key:"values",value:function(){return this[a].toArray().map(function(G){return G.value})}},{key:"reset",value:function(){var G=this;this[l]&&this[a]&&this[a].length&&this[a].forEach(function(et){return G[l](et.key,et.value)}),this[u]=new Map,this[a]=new L,this[w]=0}},{key:"dump",value:function(){var G=this;return this[a].map(function(et){return!k(G,et)&&{k:et.key,v:et.value,e:et.now+(et.maxAge||0)}}).toArray().filter(function(et){return et})}},{key:"dumpLru",value:function(){return this[a]}},{key:"set",value:function(G,et,F){if((F=F||this[s])&&typeof F!="number")throw new TypeError("maxAge must be a number");var S=F?Date.now():0,_=this[C](et,G);if(this[u].has(G)){if(_>this[b])return T(this,this[u].get(G)),!1;var E=this[u].get(G).value;return this[l]&&(this[d]||this[l](G,E.value)),E.now=S,E.maxAge=F,E.value=et,this[w]+=_-E.length,E.length=_,this.get(G),y(this),!0}var R=new O(G,et,_,S,F);return R.length>this[b]?(this[l]&&this[l](G,et),!1):(this[w]+=R.length,this[a].unshift(R),this[u].set(G,this[a].head),y(this),!0)}},{key:"has",value:function(G){if(!this[u].has(G))return!1;var et=this[u].get(G).value;return!k(this,et)}},{key:"get",value:function(G){return g(this,G,!0)}},{key:"peek",value:function(G){return g(this,G,!1)}},{key:"pop",value:function(){var G=this[a].tail;return G?(T(this,G),G.value):null}},{key:"del",value:function(G){T(this,this[u].get(G))}},{key:"load",value:function(G){this.reset();for(var et=Date.now(),F=G.length-1;F>=0;F--){var S=G[F],_=S.e||0;if(_===0)this.set(S.k,S.v);else{var E=_-et;E>0&&this.set(S.k,S.v,E)}}}},{key:"prune",value:function(){var G=this;this[u].forEach(function(et,F){return g(G,F,!1)})}}]),Y}()},{yallist:83}],38:[function(D,V,P){(function(L){(function(){var b=V.exports;b.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},b.codes={};for(var w in b.types){var C=b.types[w];b.codes[C]=w}b.CMD_SHIFT=4,b.CMD_MASK=240,b.DUP_MASK=8,b.QOS_MASK=3,b.QOS_SHIFT=1,b.RETAIN_MASK=1,b.VARBYTEINT_MASK=127,b.VARBYTEINT_FIN_MASK=128,b.VARBYTEINT_MAX=268435455,b.SESSIONPRESENT_MASK=1,b.SESSIONPRESENT_HEADER=L.from([b.SESSIONPRESENT_MASK]),b.CONNACK_HEADER=L.from([b.codes.connack<<b.CMD_SHIFT]),b.USERNAME_MASK=128,b.PASSWORD_MASK=64,b.WILL_RETAIN_MASK=32,b.WILL_QOS_MASK=24,b.WILL_QOS_SHIFT=3,b.WILL_FLAG_MASK=4,b.CLEAN_SESSION_MASK=2,b.CONNECT_HEADER=L.from([b.codes.connect<<b.CMD_SHIFT]),b.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},b.propertiesCodes={};for(var c in b.properties){var s=b.properties[c];b.propertiesCodes[s]=c}function l(d){return[0,1,2].map(function(a){return[0,1].map(function(u){return[0,1].map(function(v){var m=L.alloc(1);return m.writeUInt8(b.codes[d]<<b.CMD_SHIFT|(u?b.DUP_MASK:0)|a<<b.QOS_SHIFT|v,0,!0),m})})})}b.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},b.PUBLISH_HEADER=l("publish"),b.SUBSCRIBE_HEADER=l("subscribe"),b.SUBSCRIBE_OPTIONS_QOS_MASK=3,b.SUBSCRIBE_OPTIONS_NL_MASK=1,b.SUBSCRIBE_OPTIONS_NL_SHIFT=2,b.SUBSCRIBE_OPTIONS_RAP_MASK=1,b.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,b.SUBSCRIBE_OPTIONS_RH_MASK=3,b.SUBSCRIBE_OPTIONS_RH_SHIFT=4,b.SUBSCRIBE_OPTIONS_RH=[0,16,32],b.SUBSCRIBE_OPTIONS_NL=4,b.SUBSCRIBE_OPTIONS_RAP=8,b.SUBSCRIBE_OPTIONS_QOS=[0,1,2],b.UNSUBSCRIBE_HEADER=l("unsubscribe"),b.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},b.SUBACK_HEADER=L.from([b.codes.suback<<b.CMD_SHIFT]),b.VERSION3=L.from([3]),b.VERSION4=L.from([4]),b.VERSION5=L.from([5]),b.VERSION131=L.from([131]),b.VERSION132=L.from([132]),b.QOS=[0,1,2].map(function(d){return L.from([d])}),b.EMPTY={pingreq:L.from([b.codes.pingreq<<4,0]),pingresp:L.from([b.codes.pingresp<<4,0]),disconnect:L.from([b.codes.disconnect<<4,0])}}).call(this)}).call(this,D("buffer").Buffer)},{buffer:17}],39:[function(D,V,P){(function(L){(function(){var b=D("./writeToStream"),w=D("events"),C=function(c){"use strict";vt(l,c);var s=dt(l);function l(){var d;return gt(this,l),d=s.call(this),d._array=new Array(20),d._i=0,d}return St(l,[{key:"write",value:function(a){return this._array[this._i++]=a,!0}},{key:"concat",value:function(){var a=0,u=new Array(this._array.length),v=this._array,m,g=0;for(m=0;m<v.length&&v[m]!==void 0;m++)typeof v[m]!="string"?u[m]=v[m].length:u[m]=L.byteLength(v[m]),a+=u[m];var k=L.allocUnsafe(a);for(m=0;m<v.length&&v[m]!==void 0;m++)typeof v[m]!="string"?(v[m].copy(k,g),g+=u[m]):(k.write(v[m],g),g+=u[m]);return k}}]),l}(w);V.exports=function(c,s){var l=new C;return b(c,l,s),l.concat()}}).call(this)}).call(this,D("buffer").Buffer)},{"./writeToStream":44,buffer:17,events:22}],40:[function(D,V,P){P.parser=D("./parser").parser,P.generate=D("./generate"),P.writeToStream=D("./writeToStream")},{"./generate":39,"./parser":43,"./writeToStream":44}],41:[function(D,V,P){(function(L){(function(){var b=65536,w={},C=L.isBuffer(L.from([1,2]).subarray(0,1));function c(s){var l=L.allocUnsafe(2);return l.writeUInt8(s>>8,0),l.writeUInt8(255&s,1),l}V.exports={cache:w,generateCache:function(){for(var l=0;l<b;l++)w[l]=c(l)},generateNumber:c,genBufVariableByteInt:function(l){var d=0,a=0,u=L.allocUnsafe(4);do d=l%128|0,(l=l/128|0)>0&&(d|=128),u.writeUInt8(d,a++);while(l>0&&a<4);return l>0&&(a=0),C?u.subarray(0,a):u.slice(0,a)},generate4ByteBuffer:function(l){var d=L.allocUnsafe(4);return d.writeUInt32BE(l,0),d}}}).call(this)}).call(this,D("buffer").Buffer)},{buffer:17}],42:[function(D,V,P){V.exports=function(){"use strict";function L(){gt(this,L),this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}return L}()},{}],43:[function(D,V,P){var L=D("bl"),b=D("events"),w=D("./packet"),C=D("./constants"),c=D("debug")("mqtt-packet:parser"),s=function(l){"use strict";vt(a,l);var d=dt(a);function a(){var u;return gt(this,a),u=d.call(this),u.parser=u.constructor.parser,u}return St(a,[{key:"_resetState",value:function(){c("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new w,this.error=null,this._list=L(),this._stateCounter=0}},{key:"parse",value:function(v){for(this.error&&this._resetState(),this._list.append(v),c("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,c("parse: state complete. _stateCounter is now: %d",this._stateCounter),c("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return c("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}},{key:"_parseHeader",value:function(){var v=this._list.readUInt8(0);return this.packet.cmd=C.types[v>>C.CMD_SHIFT],this.packet.retain=(v&C.RETAIN_MASK)!=0,this.packet.qos=v>>C.QOS_SHIFT&C.QOS_MASK,this.packet.dup=(v&C.DUP_MASK)!=0,c("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}},{key:"_parseLength",value:function(){var v=this._parseVarByteNum(!0);return v&&(this.packet.length=v.value,this._list.consume(v.bytes)),c("_parseLength %d",v.value),!!v}},{key:"_parsePayload",value:function(){c("_parsePayload: payload %O",this._list);var v=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}v=!0}return c("_parsePayload complete result: %s",v),v}},{key:"_parseConnect",value:function(){var v,m,g,k;c("_parseConnect");var y={},T=this.packet,O=this._parseString();if(O===null)return this._emitError(new Error("Cannot parse protocolId"));if(O!=="MQTT"&&O!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(T.protocolId=O,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(T.protocolVersion=this._list.readUInt8(this._pos),T.protocolVersion>=128&&(T.bridgeMode=!0,T.protocolVersion=T.protocolVersion-128),T.protocolVersion!==3&&T.protocolVersion!==4&&T.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(y.username=this._list.readUInt8(this._pos)&C.USERNAME_MASK,y.password=this._list.readUInt8(this._pos)&C.PASSWORD_MASK,y.will=this._list.readUInt8(this._pos)&C.WILL_FLAG_MASK,y.will&&(T.will={},T.will.retain=(this._list.readUInt8(this._pos)&C.WILL_RETAIN_MASK)!=0,T.will.qos=(this._list.readUInt8(this._pos)&C.WILL_QOS_MASK)>>C.WILL_QOS_SHIFT),T.clean=(this._list.readUInt8(this._pos)&C.CLEAN_SESSION_MASK)!=0,this._pos++,T.keepalive=this._parseNum(),T.keepalive===-1)return this._emitError(new Error("Packet too short"));if(T.protocolVersion===5){var M=this._parseProperties();Object.getOwnPropertyNames(M).length&&(T.properties=M)}var Y=this._parseString();if(Y===null)return this._emitError(new Error("Packet too short"));if(T.clientId=Y,c("_parseConnect: packet.clientId: %s",T.clientId),y.will){if(T.protocolVersion===5){var N=this._parseProperties();Object.getOwnPropertyNames(N).length&&(T.will.properties=N)}if((v=this._parseString())===null)return this._emitError(new Error("Cannot parse will topic"));if(T.will.topic=v,c("_parseConnect: packet.will.topic: %s",T.will.topic),(m=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse will payload"));T.will.payload=m,c("_parseConnect: packet.will.paylaod: %s",T.will.payload)}if(y.username){if((k=this._parseString())===null)return this._emitError(new Error("Cannot parse username"));T.username=k,c("_parseConnect: packet.username: %s",T.username)}if(y.password){if((g=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse password"));T.password=g}return this.settings=T,c("_parseConnect: complete"),T}},{key:"_parseConnack",value:function(){c("_parseConnack");var v=this.packet;if(this._list.length<1)return null;if(v.sessionPresent=!!(this._list.readUInt8(this._pos++)&C.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?v.reasonCode=this._list.readUInt8(this._pos++):v.reasonCode=0;else{if(this._list.length<2)return null;v.returnCode=this._list.readUInt8(this._pos++)}if(v.returnCode===-1||v.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}c("_parseConnack: complete")}},{key:"_parsePublish",value:function(){c("_parsePublish");var v=this.packet;if(v.topic=this._parseString(),v.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(v.qos>0)||this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}v.payload=this._list.slice(this._pos,v.length),c("_parsePublish: payload from buffer list: %o",v.payload)}}},{key:"_parseSubscribe",value:function(){c("_parseSubscribe");var v=this.packet,m,g,k,y,T,O,M;if(v.qos!==1)return this._emitError(new Error("Wrong subscribe header"));if(v.subscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var Y=this._parseProperties();Object.getOwnPropertyNames(Y).length&&(v.properties=Y)}for(;this._pos<v.length;){if((m=this._parseString())===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=v.length)return this._emitError(new Error("Malformed Subscribe Payload"));k=(g=this._parseByte())&C.SUBSCRIBE_OPTIONS_QOS_MASK,O=(g>>C.SUBSCRIBE_OPTIONS_NL_SHIFT&C.SUBSCRIBE_OPTIONS_NL_MASK)!=0,T=(g>>C.SUBSCRIBE_OPTIONS_RAP_SHIFT&C.SUBSCRIBE_OPTIONS_RAP_MASK)!=0,y=g>>C.SUBSCRIBE_OPTIONS_RH_SHIFT&C.SUBSCRIBE_OPTIONS_RH_MASK,M={topic:m,qos:k},this.settings.protocolVersion===5?(M.nl=O,M.rap=T,M.rh=y):this.settings.bridgeMode&&(M.rh=0,M.rap=!0,M.nl=!0),c("_parseSubscribe: push subscription `%s` to subscription",M),v.subscriptions.push(M)}}}},{key:"_parseSuback",value:function(){c("_parseSuback");var v=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}},{key:"_parseUnsubscribe",value:function(){c("_parseUnsubscribe");var v=this.packet;if(v.unsubscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}for(;this._pos<v.length;){var g=this._parseString();if(g===null)return this._emitError(new Error("Cannot parse topic"));c("_parseUnsubscribe: push topic `%s` to unsubscriptions",g),v.unsubscriptions.push(g)}}}},{key:"_parseUnsuback",value:function(){c("_parseUnsuback");var v=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(this.settings.protocolVersion===5){var m=this._parseProperties();for(Object.getOwnPropertyNames(m).length&&(v.properties=m),v.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}},{key:"_parseConfirmation",value:function(){c("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);var v=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5&&(v.length>2?(v.reasonCode=this._parseByte(),c("_parseConfirmation: packet.reasonCode `%d`",v.reasonCode)):v.reasonCode=0,v.length>3)){var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}return!0}},{key:"_parseDisconnect",value:function(){var v=this.packet;if(c("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?v.reasonCode=this._parseByte():v.reasonCode=0;var m=this._parseProperties();Object.getOwnPropertyNames(m).length&&(v.properties=m)}return c("_parseDisconnect result: true"),!0}},{key:"_parseAuth",value:function(){c("_parseAuth");var v=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));v.reasonCode=this._parseByte();var m=this._parseProperties();return Object.getOwnPropertyNames(m).length&&(v.properties=m),c("_parseAuth: result: true"),!0}},{key:"_parseMessageId",value:function(){var v=this.packet;return v.messageId=this._parseNum(),v.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(c("_parseMessageId: packet.messageId %d",v.messageId),!0)}},{key:"_parseString",value:function(v){var m=this._parseNum(),g=m+this._pos;if(m===-1||g>this._list.length||g>this.packet.length)return null;var k=this._list.toString("utf8",this._pos,g);return this._pos+=m,c("_parseString: result: %s",k),k}},{key:"_parseStringPair",value:function(){return c("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}},{key:"_parseBuffer",value:function(){var v=this._parseNum(),m=v+this._pos;if(v===-1||m>this._list.length||m>this.packet.length)return null;var g=this._list.slice(this._pos,m);return this._pos+=v,c("_parseBuffer: result: %o",g),g}},{key:"_parseNum",value:function(){if(this._list.length-this._pos<2)return-1;var v=this._list.readUInt16BE(this._pos);return this._pos+=2,c("_parseNum: result: %s",v),v}},{key:"_parse4ByteNum",value:function(){if(this._list.length-this._pos<4)return-1;var v=this._list.readUInt32BE(this._pos);return this._pos+=4,c("_parse4ByteNum: result: %s",v),v}},{key:"_parseVarByteNum",value:function(v){c("_parseVarByteNum");for(var m,g=0,k=1,y=0,T=!1,O=this._pos?this._pos:0;g<4&&O+g<this._list.length;){if(y+=k*((m=this._list.readUInt8(O+g++))&C.VARBYTEINT_MASK),k*=128,(m&C.VARBYTEINT_FIN_MASK)==0){T=!0;break}if(this._list.length<=g)break}return!T&&g===4&&this._list.length>=g&&this._emitError(new Error("Invalid variable byte integer")),O&&(this._pos+=g),c("_parseVarByteNum: result: %o",T=!!T&&(v?{bytes:g,value:y}:y)),T}},{key:"_parseByte",value:function(){var v;return this._pos<this._list.length&&(v=this._list.readUInt8(this._pos),this._pos++),c("_parseByte: result: %o",v),v}},{key:"_parseByType",value:function(v){switch(c("_parseByType: type: %s",v),v){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}},{key:"_parseProperties",value:function(){c("_parseProperties");for(var v=this._parseVarByteNum(),m=this._pos+v,g={};this._pos<m;){var k=this._parseByte();if(!k)return this._emitError(new Error("Cannot parse property code type")),!1;var y=C.propertiesCodes[k];if(!y)return this._emitError(new Error("Unknown property")),!1;if(y!=="userProperties")g[y]?Array.isArray(g[y])?g[y].push(this._parseByType(C.propertiesTypes[y])):(g[y]=[g[y]],g[y].push(this._parseByType(C.propertiesTypes[y]))):g[y]=this._parseByType(C.propertiesTypes[y]);else{g[y]||(g[y]=Object.create(null));var T=this._parseByType(C.propertiesTypes[y]);if(g[y][T.name])if(Array.isArray(g[y][T.name]))g[y][T.name].push(T.value);else{var O=g[y][T.name];g[y][T.name]=[O],g[y][T.name].push(T.value)}else g[y][T.name]=T.value}}return g}},{key:"_newPacket",value:function(){return c("_newPacket"),this.packet&&(this._list.consume(this.packet.length),c("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),c("_newPacket: new packet"),this.packet=new w,this._pos=0,!0}},{key:"_emitError",value:function(v){c("_emitError"),this.error=v,this.emit("error",v)}}],[{key:"parser",value:function(v){return this instanceof a?(this.settings=v||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new a().parser(v)}}]),a}(b);V.exports=s},{"./constants":38,"./packet":42,bl:15,debug:18,events:22}],44:[function(D,V,P){(function(L){(function(){var b=D("./constants"),w=L.allocUnsafe(0),C=L.from([0]),c=D("./numbers"),s=D("process-nextick-args").nextTick,l=D("debug")("mqtt-packet:writeToStream"),d=c.cache,a=c.generateNumber,u=c.generateCache,v=c.genBufVariableByteInt,m=c.generate4ByteBuffer,g=G,k=!0;function y(K,z,j){switch(l("generate called"),z.cork&&(z.cork(),s(T,z)),k&&(k=!1,u()),l("generate: packet.cmd: %s",K.cmd),K.cmd){case"connect":return function(H,A,J){var rt=H||{},$=rt.protocolId||"MQTT",at=rt.protocolVersion||4,nt=rt.will,st=rt.clean,h=rt.keepalive||0,f=rt.clientId||"",I=rt.username,B=rt.password,X=rt.properties;st===void 0&&(st=!0);var Q=0;if(!$||typeof $!="string"&&!L.isBuffer($))return A.emit("error",new Error("Invalid protocolId")),!1;if(Q+=$.length+2,at!==3&&at!==4&&at!==5)return A.emit("error",new Error("Invalid protocol version")),!1;if(Q+=1,(typeof f=="string"||L.isBuffer(f))&&(f||at>=4)&&(f||st))Q+=L.byteLength(f)+2;else{if(at<4)return A.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*st==0)return A.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof h!="number"||h<0||h>65535||h%1!=0)return A.emit("error",new Error("Invalid keepalive")),!1;if(Q+=2,Q+=1,at===5){var ot=S(A,X);if(!ot)return!1;Q+=ot.length}if(nt){if(typeof nt!="object")return A.emit("error",new Error("Invalid will")),!1;if(!nt.topic||typeof nt.topic!="string")return A.emit("error",new Error("Invalid will topic")),!1;if(Q+=L.byteLength(nt.topic)+2,Q+=2,nt.payload){if(!(nt.payload.length>=0))return A.emit("error",new Error("Invalid will payload")),!1;typeof nt.payload=="string"?Q+=L.byteLength(nt.payload):Q+=nt.payload.length}var pt={};if(at===5){if(!(pt=S(A,nt.properties)))return!1;Q+=pt.length}}var ft=!1;if(I!=null){if(!Z(I))return A.emit("error",new Error("Invalid username")),!1;ft=!0,Q+=L.byteLength(I)+2}if(B!=null){if(!ft)return A.emit("error",new Error("Username is required to use password")),!1;if(!Z(B))return A.emit("error",new Error("Invalid password")),!1;Q+=q(B)+2}A.write(b.CONNECT_HEADER),M(A,Q),F(A,$),rt.bridgeMode&&(at+=128),A.write(at===131?b.VERSION131:at===132?b.VERSION132:at===4?b.VERSION4:at===5?b.VERSION5:b.VERSION3);var xt=0;return xt|=I!=null?b.USERNAME_MASK:0,xt|=B!=null?b.PASSWORD_MASK:0,xt|=nt&&nt.retain?b.WILL_RETAIN_MASK:0,xt|=nt&&nt.qos?nt.qos<<b.WILL_QOS_SHIFT:0,xt|=nt?b.WILL_FLAG_MASK:0,xt|=st?b.CLEAN_SESSION_MASK:0,A.write(L.from([xt])),g(A,h),at===5&&ot.write(),F(A,f),nt&&(at===5&&pt.write(),Y(A,nt.topic),F(A,nt.payload)),I!=null&&F(A,I),B!=null&&F(A,B),!0}(K,z);case"connack":return function(H,A,J){var rt=J?J.protocolVersion:4,$=H||{},at=rt===5?$.reasonCode:$.returnCode,nt=$.properties,st=2;if(typeof at!="number")return A.emit("error",new Error("Invalid return code")),!1;var h=null;if(rt===5){if(!(h=S(A,nt)))return!1;st+=h.length}return A.write(b.CONNACK_HEADER),M(A,st),A.write($.sessionPresent?b.SESSIONPRESENT_HEADER:C),A.write(L.from([at])),h!=null&&h.write(),!0}(K,z,j);case"publish":return function(H,A,J){l("publish: packet: %o",H);var rt=J?J.protocolVersion:4,$=H||{},at=$.qos||0,nt=$.retain?b.RETAIN_MASK:0,st=$.topic,h=$.payload||w,f=$.messageId,I=$.properties,B=0;if(typeof st=="string")B+=L.byteLength(st)+2;else{if(!L.isBuffer(st))return A.emit("error",new Error("Invalid topic")),!1;B+=st.length+2}if(L.isBuffer(h)?B+=h.length:B+=L.byteLength(h),at&&typeof f!="number")return A.emit("error",new Error("Invalid messageId")),!1;at&&(B+=2);var X=null;if(rt===5){if(!(X=S(A,I)))return!1;B+=X.length}return A.write(b.PUBLISH_HEADER[at][$.dup?1:0][nt?1:0]),M(A,B),g(A,q(st)),A.write(st),at>0&&g(A,f),X!=null&&X.write(),l("publish: payload: %o",h),A.write(h)}(K,z,j);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(H,A,J){var rt=J?J.protocolVersion:4,$=H||{},at=$.cmd||"puback",nt=$.messageId,st=$.dup&&at==="pubrel"?b.DUP_MASK:0,h=0,f=$.reasonCode,I=$.properties,B=rt===5?3:2;if(at==="pubrel"&&(h=1),typeof nt!="number")return A.emit("error",new Error("Invalid messageId")),!1;var X=null;if(rt===5&&typeof I=="object"){if(!(X=_(A,I,J,B)))return!1;B+=X.length}return A.write(b.ACKS[at][h][st][0]),M(A,B),g(A,nt),rt===5&&A.write(L.from([f])),X!==null&&X.write(),!0}(K,z,j);case"subscribe":return function(H,A,J){l("subscribe: packet: ");var rt=J?J.protocolVersion:4,$=H||{},at=$.dup?b.DUP_MASK:0,nt=$.messageId,st=$.subscriptions,h=$.properties,f=0;if(typeof nt!="number")return A.emit("error",new Error("Invalid messageId")),!1;f+=2;var I=null;if(rt===5){if(!(I=S(A,h)))return!1;f+=I.length}if(typeof st!="object"||!st.length)return A.emit("error",new Error("Invalid subscriptions")),!1;for(var B=0;B<st.length;B+=1){var X=st[B].topic,Q=st[B].qos;if(typeof X!="string")return A.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if(typeof Q!="number")return A.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(rt===5){var ot=st[B].nl||!1;if(typeof ot!="boolean")return A.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;var pt=st[B].rap||!1;if(typeof pt!="boolean")return A.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var ft=st[B].rh||0;if(typeof ft!="number"||ft>2)return A.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}f+=L.byteLength(X)+2+1}l("subscribe: writing to stream: %o",b.SUBSCRIBE_HEADER),A.write(b.SUBSCRIBE_HEADER[1][at?1:0][0]),M(A,f),g(A,nt),I!==null&&I.write();var xt=!0,Tt=Ct(st),Kt;try{for(Tt.s();!(Kt=Tt.n()).done;){var Dt=Kt.value,Ht=Dt.topic,bt=Dt.qos,_t=+Dt.nl,Qt=+Dt.rap,oe=Dt.rh,Gt=void 0;Y(A,Ht),Gt=b.SUBSCRIBE_OPTIONS_QOS[bt],rt===5&&(Gt|=_t?b.SUBSCRIBE_OPTIONS_NL:0,Gt|=Qt?b.SUBSCRIBE_OPTIONS_RAP:0,Gt|=oe?b.SUBSCRIBE_OPTIONS_RH[oe]:0),xt=A.write(L.from([Gt]))}}catch(fe){Tt.e(fe)}finally{Tt.f()}return xt}(K,z,j);case"suback":return function(H,A,J){var rt=J?J.protocolVersion:4,$=H||{},at=$.messageId,nt=$.granted,st=$.properties,h=0;if(typeof at!="number")return A.emit("error",new Error("Invalid messageId")),!1;if(h+=2,typeof nt!="object"||!nt.length)return A.emit("error",new Error("Invalid qos vector")),!1;for(var f=0;f<nt.length;f+=1){if(typeof nt[f]!="number")return A.emit("error",new Error("Invalid qos vector")),!1;h+=1}var I=null;if(rt===5){if(!(I=_(A,st,J,h)))return!1;h+=I.length}return A.write(b.SUBACK_HEADER),M(A,h),g(A,at),I!==null&&I.write(),A.write(L.from(nt))}(K,z,j);case"unsubscribe":return function(H,A,J){var rt=J?J.protocolVersion:4,$=H||{},at=$.messageId,nt=$.dup?b.DUP_MASK:0,st=$.unsubscriptions,h=$.properties,f=0;if(typeof at!="number")return A.emit("error",new Error("Invalid messageId")),!1;if(f+=2,typeof st!="object"||!st.length)return A.emit("error",new Error("Invalid unsubscriptions")),!1;for(var I=0;I<st.length;I+=1){if(typeof st[I]!="string")return A.emit("error",new Error("Invalid unsubscriptions")),!1;f+=L.byteLength(st[I])+2}var B=null;if(rt===5){if(!(B=S(A,h)))return!1;f+=B.length}A.write(b.UNSUBSCRIBE_HEADER[1][nt?1:0][0]),M(A,f),g(A,at),B!==null&&B.write();for(var X=!0,Q=0;Q<st.length;Q++)X=Y(A,st[Q]);return X}(K,z,j);case"unsuback":return function(H,A,J){var rt=J?J.protocolVersion:4,$=H||{},at=$.messageId,nt=$.dup?b.DUP_MASK:0,st=$.granted,h=$.properties,f=$.cmd,I=2;if(typeof at!="number")return A.emit("error",new Error("Invalid messageId")),!1;if(rt===5){if(typeof st!="object"||!st.length)return A.emit("error",new Error("Invalid qos vector")),!1;for(var B=0;B<st.length;B+=1){if(typeof st[B]!="number")return A.emit("error",new Error("Invalid qos vector")),!1;I+=1}}var X=null;if(rt===5){if(!(X=_(A,h,J,I)))return!1;I+=X.length}return A.write(b.ACKS[f][0][nt][0]),M(A,I),g(A,at),X!==null&&X.write(),rt===5&&A.write(L.from(st)),!0}(K,z,j);case"pingreq":case"pingresp":return function(H,A,J){return A.write(b.EMPTY[H.cmd])}(K,z);case"disconnect":return function(H,A,J){var rt=J?J.protocolVersion:4,$=H||{},at=$.reasonCode,nt=$.properties,st=rt===5?1:0,h=null;if(rt===5){if(!(h=_(A,nt,J,st)))return!1;st+=h.length}return A.write(L.from([b.codes.disconnect<<4])),M(A,st),rt===5&&A.write(L.from([at])),h!==null&&h.write(),!0}(K,z,j);case"auth":return function(H,A,J){var rt=J?J.protocolVersion:4,$=H||{},at=$.reasonCode,nt=$.properties,st=rt===5?1:0;rt!==5&&A.emit("error",new Error("Invalid mqtt version for auth packet"));var h=_(A,nt,J,st);return h?(st+=h.length,A.write(L.from([b.codes.auth<<4])),M(A,st),A.write(L.from([at])),h!==null&&h.write(),!0):!1}(K,z,j);default:return z.emit("error",new Error("Unknown command")),!1}}function T(K){K.uncork()}Object.defineProperty(y,"cacheNumbers",{get:function(){return g===G},set:function(z){z?(d&&Object.keys(d).length!==0||(k=!0),g=G):(k=!1,g=et)}});var O={};function M(K,z){if(z>b.VARBYTEINT_MAX)return K.emit("error",new Error("Invalid variable byte integer: ".concat(z))),!1;var j=O[z];return j||(j=v(z),z<16384&&(O[z]=j)),l("writeVarByteInt: writing to stream: %o",j),K.write(j)}function Y(K,z){var j=L.byteLength(z);return g(K,j),l("writeString: %s",z),K.write(z,"utf8")}function N(K,z,j){Y(K,z),Y(K,j)}function G(K,z){return l("writeNumberCached: number: %d",z),l("writeNumberCached: %o",d[z]),K.write(d[z])}function et(K,z){var j=a(z);return l("writeNumberGenerated: %o",j),K.write(j)}function F(K,z){typeof z=="string"?Y(K,z):z?(g(K,z.length),K.write(z)):g(K,0)}function S(K,z){if(typeof z!="object"||z.length!=null)return{length:1,write:function(){R(K,{},0)}};var j=0;function H(nt,st){var h=0;switch(b.propertiesTypes[nt]){case"byte":if(typeof st!="boolean")return K.emit("error",new Error("Invalid ".concat(nt,": ").concat(st))),!1;h+=2;break;case"int8":if(typeof st!="number"||st<0||st>255)return K.emit("error",new Error("Invalid ".concat(nt,": ").concat(st))),!1;h+=2;break;case"binary":if(st&&st===null)return K.emit("error",new Error("Invalid ".concat(nt,": ").concat(st))),!1;h+=1+L.byteLength(st)+2;break;case"int16":if(typeof st!="number"||st<0||st>65535)return K.emit("error",new Error("Invalid ".concat(nt,": ").concat(st))),!1;h+=3;break;case"int32":if(typeof st!="number"||st<0||st>4294967295)return K.emit("error",new Error("Invalid ".concat(nt,": ").concat(st))),!1;h+=5;break;case"var":if(typeof st!="number"||st<0||st>268435455)return K.emit("error",new Error("Invalid ".concat(nt,": ").concat(st))),!1;h+=1+L.byteLength(v(st));break;case"string":if(typeof st!="string")return K.emit("error",new Error("Invalid ".concat(nt,": ").concat(st))),!1;h+=3+L.byteLength(st.toString());break;case"pair":if(typeof st!="object")return K.emit("error",new Error("Invalid ".concat(nt,": ").concat(st))),!1;h+=Object.getOwnPropertyNames(st).reduce(function(f,I){var B=st[I];return Array.isArray(B)?f+=B.reduce(function(X,Q){return X+=3+L.byteLength(I.toString())+2+L.byteLength(Q.toString())},0):f+=3+L.byteLength(I.toString())+2+L.byteLength(st[I].toString()),f},0);break;default:return K.emit("error",new Error("Invalid property ".concat(nt,": ").concat(st))),!1}return h}if(z)for(var A in z){var J=0,rt=0,$=z[A];if(Array.isArray($))for(var at=0;at<$.length;at++){if(!(rt=H(A,$[at])))return!1;J+=rt}else{if(!(rt=H(A,$)))return!1;J=rt}if(!J)return!1;j+=J}return{length:L.byteLength(v(j))+j,write:function(){R(K,z,j)}}}function _(K,z,j,H){var A=["reasonString","userProperties"],J=j&&j.properties&&j.properties.maximumPacketSize?j.properties.maximumPacketSize:0,rt=S(K,z);if(J)for(;H+rt.length>J;){var $=A.shift();if(!$||!z[$])return!1;delete z[$],rt=S(K,z)}return rt}function E(K,z,j){switch(b.propertiesTypes[z]){case"byte":K.write(L.from([b.properties[z]])),K.write(L.from([+j]));break;case"int8":K.write(L.from([b.properties[z]])),K.write(L.from([j]));break;case"binary":K.write(L.from([b.properties[z]])),F(K,j);break;case"int16":K.write(L.from([b.properties[z]])),g(K,j);break;case"int32":K.write(L.from([b.properties[z]])),function(H,A){var J=m(A);l("write4ByteNumber: %o",J),H.write(J)}(K,j);break;case"var":K.write(L.from([b.properties[z]])),M(K,j);break;case"string":K.write(L.from([b.properties[z]])),Y(K,j);break;case"pair":Object.getOwnPropertyNames(j).forEach(function(H){var A=j[H];Array.isArray(A)?A.forEach(function(J){K.write(L.from([b.properties[z]])),N(K,H.toString(),J.toString())}):(K.write(L.from([b.properties[z]])),N(K,H.toString(),A.toString()))});break;default:return K.emit("error",new Error("Invalid property ".concat(z," value: ").concat(j))),!1}}function R(K,z,j){M(K,j);for(var H in z)if(Object.prototype.hasOwnProperty.call(z,H)&&z[H]!==null){var A=z[H];if(Array.isArray(A))for(var J=0;J<A.length;J++)E(K,H,A[J]);else E(K,H,A)}}function q(K){return K?K instanceof L?K.length:L.byteLength(K):0}function Z(K){return typeof K=="string"||K instanceof L}V.exports=y}).call(this)}).call(this,D("buffer").Buffer)},{"./constants":38,"./numbers":41,buffer:17,debug:18,"process-nextick-args":49}],45:[function(D,V,P){var L=1e3,b=60*L,w=60*b,C=24*w,c=7*C,s=365.25*C;function l(d,a,u,v){var m=a>=1.5*u;return Math.round(d/u)+" "+v+(m?"s":"")}V.exports=function(d,a){a=a||{};var u=typeof d;if(u==="string"&&d.length>0)return function(v){if(!((v=String(v)).length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(v);if(!!m){var g=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return g*s;case"weeks":case"week":case"w":return g*c;case"days":case"day":case"d":return g*C;case"hours":case"hour":case"hrs":case"hr":case"h":return g*w;case"minutes":case"minute":case"mins":case"min":case"m":return g*b;case"seconds":case"second":case"secs":case"sec":case"s":return g*L;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}(d);if(u==="number"&&isFinite(d))return a.long?function(v){var m=Math.abs(v);return m>=C?l(v,m,C,"day"):m>=w?l(v,m,w,"hour"):m>=b?l(v,m,b,"minute"):m>=L?l(v,m,L,"second"):v+" ms"}(d):function(v){var m=Math.abs(v);return m>=C?Math.round(v/C)+"d":m>=w?Math.round(v/w)+"h":m>=b?Math.round(v/b)+"m":m>=L?Math.round(v/L)+"s":v+"ms"}(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],46:[function(D,V,P){var L=D("./lib/number-allocator.js");V.exports.NumberAllocator=L},{"./lib/number-allocator.js":47}],47:[function(D,V,P){"use strict";var L=D("js-sdsl").Set,b=D("debug")("number-allocator:trace"),w=D("debug")("number-allocator:error");function C(s,l){this.low=s,this.high=l}function c(s,l){if(!(this instanceof c))return new c(s,l);this.min=s,this.max=l,this.ss=new L([],function(d,a){return d.compare(a)}),b("Create"),this.clear()}C.prototype.equals=function(s){return this.low===s.low&&this.high===s.high},C.prototype.compare=function(s){return this.low<s.low&&this.high<s.low?-1:s.low<this.low&&s.high<this.low?1:0},c.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},c.prototype.alloc=function(){if(this.ss.size()===0)return b("alloc():empty"),null;var s=this.ss.front(),l=s.low;return l+1<=s.high?++s.low:this.ss.eraseElementByPos(0),b("alloc():"+l),l},c.prototype.use=function(s){var l=new C(s,s),d=this.ss.lowerBound(l);if(d){if(d.equals(l))return this.ss.eraseElementByValue(d),b("use():"+s),!0;if(d.low>s)return!1;if(d.low===s)return++d.low,b("use():"+s),!0;if(d.high===s)return--d.high,b("use():"+s),!0;var a=d.low;return d.low=s+1,this.ss.insert(new C(a,s-1)),b("use():"+s),!0}return b("use():failed"),!1},c.prototype.free=function(s){if(s<this.min||s>this.max)return void w("free():"+s+" is out of range");var l=new C(s,s),d=this.ss.lowerBound(l);if(d){if(d.low<=s&&s<=d.high)return void w("free():"+s+" has already been vacant");if(d===this.ss.front())s+1===d.low?--d.low:this.ss.insert(l);else{var a=this.ss.reverseLowerBound(l);a.high+1===s?s+1===d.low?(this.ss.eraseElementByValue(a),d.low=a.low):a.high=s:s+1===d.low?d.low=s:this.ss.insert(l)}}else{if(d===this.ss.front())return void this.ss.insert(l);var u=this.ss.reverseLowerBound(l);u.high+1===s?u.high=s:this.ss.insert(l)}b("free():"+s)},c.prototype.clear=function(){b("clear()"),this.ss.clear(),this.ss.insert(new C(this.min,this.max))},c.prototype.intervalCount=function(){return this.ss.size()},c.prototype.dump=function(){console.log("length:"+this.ss.size());var s=Ct(this.ss),l;try{for(s.s();!(l=s.n()).done;){var d=l.value;console.log(d)}}catch(a){s.e(a)}finally{s.f()}},V.exports=c},{debug:18,"js-sdsl":36}],48:[function(D,V,P){var L=D("wrappy");function b(C){var c=function s(){return s.called?s.value:(s.called=!0,s.value=C.apply(this,arguments))};return c.called=!1,c}function w(C){var c=function l(){if(l.called)throw new Error(l.onceError);return l.called=!0,l.value=C.apply(this,arguments)},s=C.name||"Function wrapped with `once`";return c.onceError=s+" shouldn't be called more than once",c.called=!1,c}V.exports=L(b),V.exports.strict=L(w),b.proto=b(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return b(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return w(this)},configurable:!0})})},{wrappy:79}],49:[function(D,V,P){(function(L){(function(){"use strict";L===void 0||!L.version||L.version.indexOf("v0.")===0||L.version.indexOf("v1.")===0&&L.version.indexOf("v1.8.")!==0?V.exports={nextTick:function(w,C,c,s){if(typeof w!="function")throw new TypeError('"callback" argument must be a function');var l,d,a=arguments.length;switch(a){case 0:case 1:return L.nextTick(w);case 2:return L.nextTick(function(){w.call(null,C)});case 3:return L.nextTick(function(){w.call(null,C,c)});case 4:return L.nextTick(function(){w.call(null,C,c,s)});default:for(l=new Array(a-1),d=0;d<l.length;)l[d++]=arguments[d];return L.nextTick(function(){w.apply(null,l)})}}}:V.exports=L}).call(this)}).call(this,D("_process"))},{_process:50}],50:[function(D,V,P){var L,b,w=V.exports={};function C(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function s(y){if(L===setTimeout)return setTimeout(y,0);if((L===C||!L)&&setTimeout)return L=setTimeout,setTimeout(y,0);try{return L(y,0)}catch(T){try{return L.call(null,y,0)}catch(O){return L.call(this,y,0)}}}(function(){try{L=typeof setTimeout=="function"?setTimeout:C}catch(y){L=C}try{b=typeof clearTimeout=="function"?clearTimeout:c}catch(y){b=c}})();var l,d=[],a=!1,u=-1;function v(){a&&l&&(a=!1,l.length?d=l.concat(d):u=-1,d.length&&m())}function m(){if(!a){var y=s(v);a=!0;for(var T=d.length;T;){for(l=d,d=[];++u<T;)l&&l[u].run();u=-1,T=d.length}l=null,a=!1,function(O){if(b===clearTimeout)return clearTimeout(O);if((b===c||!b)&&clearTimeout)return b=clearTimeout,clearTimeout(O);try{b(O)}catch(M){try{return b.call(null,O)}catch(Y){return b.call(this,O)}}}(y)}}function g(y,T){this.fun=y,this.array=T}function k(){}w.nextTick=function(y){var T=new Array(arguments.length-1);if(arguments.length>1)for(var O=1;O<arguments.length;O++)T[O-1]=arguments[O];d.push(new g(y,T)),d.length!==1||a||s(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=k,w.addListener=k,w.once=k,w.off=k,w.removeListener=k,w.removeAllListeners=k,w.emit=k,w.prependListener=k,w.prependOnceListener=k,w.listeners=function(y){return[]},w.binding=function(y){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(y){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],51:[function(D,V,P){(function(L){(function(){(function(b){var w=typeof P=="object"&&P&&!P.nodeType&&P,C=typeof V=="object"&&V&&!V.nodeType&&V,c=typeof L=="object"&&L;c.global!==c&&c.window!==c&&c.self!==c||(b=c);var s,l,d=2147483647,a=36,u=1,v=26,m=38,g=700,k=72,y=128,T="-",O=/^xn--/,M=/[^\x20-\x7E]/,Y=/[\x2E\u3002\uFF0E\uFF61]/g,N={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},G=a-u,et=Math.floor,F=String.fromCharCode;function S(H){throw new RangeError(N[H])}function _(H,A){for(var J=H.length,rt=[];J--;)rt[J]=A(H[J]);return rt}function E(H,A){var J=H.split("@"),rt="";return J.length>1&&(rt=J[0]+"@",H=J[1]),rt+_((H=H.replace(Y,".")).split("."),A).join(".")}function R(H){for(var A,J,rt=[],$=0,at=H.length;$<at;)(A=H.charCodeAt($++))>=55296&&A<=56319&&$<at?(64512&(J=H.charCodeAt($++)))==56320?rt.push(((1023&A)<<10)+(1023&J)+65536):(rt.push(A),$--):rt.push(A);return rt}function q(H){return _(H,function(A){var J="";return A>65535&&(J+=F((A-=65536)>>>10&1023|55296),A=56320|1023&A),J+=F(A)}).join("")}function Z(H,A){return H+22+75*(H<26)-((A!=0)<<5)}function K(H,A,J){var rt=0;for(H=J?et(H/g):H>>1,H+=et(H/A);H>G*v>>1;rt+=a)H=et(H/G);return et(rt+(G+1)*H/(H+m))}function z(H){var A,J,rt,$,at,nt,st,h,f,I,B,X=[],Q=H.length,ot=0,pt=y,ft=k;for((J=H.lastIndexOf(T))<0&&(J=0),rt=0;rt<J;++rt)H.charCodeAt(rt)>=128&&S("not-basic"),X.push(H.charCodeAt(rt));for($=J>0?J+1:0;$<Q;){for(at=ot,nt=1,st=a;$>=Q&&S("invalid-input"),((h=(B=H.charCodeAt($++))-48<10?B-22:B-65<26?B-65:B-97<26?B-97:a)>=a||h>et((d-ot)/nt))&&S("overflow"),ot+=h*nt,!(h<(f=st<=ft?u:st>=ft+v?v:st-ft));st+=a)nt>et(d/(I=a-f))&&S("overflow"),nt*=I;ft=K(ot-at,A=X.length+1,at==0),et(ot/A)>d-pt&&S("overflow"),pt+=et(ot/A),ot%=A,X.splice(ot++,0,pt)}return q(X)}function j(H){var A,J,rt,$,at,nt,st,h,f,I,B,X,Q,ot,pt,ft=[];for(X=(H=R(H)).length,A=y,J=0,at=k,nt=0;nt<X;++nt)(B=H[nt])<128&&ft.push(F(B));for(rt=$=ft.length,$&&ft.push(T);rt<X;){for(st=d,nt=0;nt<X;++nt)(B=H[nt])>=A&&B<st&&(st=B);for(st-A>et((d-J)/(Q=rt+1))&&S("overflow"),J+=(st-A)*Q,A=st,nt=0;nt<X;++nt)if((B=H[nt])<A&&++J>d&&S("overflow"),B==A){for(h=J,f=a;!(h<(I=f<=at?u:f>=at+v?v:f-at));f+=a)pt=h-I,ot=a-I,ft.push(F(Z(I+pt%ot,0))),h=et(pt/ot);ft.push(F(Z(h,0))),at=K(J,Q,rt==$),J=0,++rt}++J,++A}return ft.join("")}if(s={version:"1.4.1",ucs2:{decode:R,encode:q},decode:z,encode:j,toASCII:function(A){return E(A,function(J){return M.test(J)?"xn--"+j(J):J})},toUnicode:function(A){return E(A,function(J){return O.test(J)?z(J.slice(4).toLowerCase()):J})}},w&&C)if(V.exports==w)C.exports=s;else for(l in s)s.hasOwnProperty(l)&&(w[l]=s[l]);else b.punycode=s})(this)}).call(this)}).call(this,typeof ct.g!="undefined"?ct.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],52:[function(D,V,P){"use strict";function L(w,C){return Object.prototype.hasOwnProperty.call(w,C)}V.exports=function(w,C,c,s){C=C||"&",c=c||"=";var l={};if(typeof w!="string"||w.length===0)return l;var d=/\+/g;w=w.split(C);var a=1e3;s&&typeof s.maxKeys=="number"&&(a=s.maxKeys);var u=w.length;a>0&&u>a&&(u=a);for(var v=0;v<u;++v){var m,g,k,y,T=w[v].replace(d,"%20"),O=T.indexOf(c);O>=0?(m=T.substr(0,O),g=T.substr(O+1)):(m=T,g=""),k=decodeURIComponent(m),y=decodeURIComponent(g),L(l,k)?b(l[k])?l[k].push(y):l[k]=[l[k],y]:l[k]=y}return l};var b=Array.isArray||function(w){return Object.prototype.toString.call(w)==="[object Array]"}},{}],53:[function(D,V,P){"use strict";var L=function(s){switch(typeof s){case"string":return s;case"boolean":return s?"true":"false";case"number":return isFinite(s)?s:"";default:return""}};V.exports=function(c,s,l,d){return s=s||"&",l=l||"=",c===null&&(c=void 0),typeof c=="object"?w(C(c),function(a){var u=encodeURIComponent(L(a))+l;return b(c[a])?w(c[a],function(v){return u+encodeURIComponent(L(v))}).join(s):u+encodeURIComponent(L(c[a]))}).join(s):d?encodeURIComponent(L(d))+l+encodeURIComponent(L(c)):""};var b=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};function w(c,s){if(c.map)return c.map(s);for(var l=[],d=0;d<c.length;d++)l.push(s(c[d],d));return l}var C=Object.keys||function(c){var s=[];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&s.push(l);return s}},{}],54:[function(D,V,P){"use strict";P.decode=P.parse=D("./decode"),P.encode=P.stringify=D("./encode")},{"./decode":52,"./encode":53}],55:[function(D,V,P){"use strict";var L={};function b(C,c,s){s||(s=Error);var l=function(d){var a,u;function v(m,g,k){return d.call(this,function(y,T,O){return typeof c=="string"?c:c(y,T,O)}(m,g,k))||this}return u=d,(a=v).prototype=Object.create(u.prototype),a.prototype.constructor=a,a.__proto__=u,v}(s);l.prototype.name=s.name,l.prototype.code=C,L[C]=l}function w(C,c){if(Array.isArray(C)){var s=C.length;return C=C.map(function(l){return String(l)}),s>2?"one of ".concat(c," ").concat(C.slice(0,s-1).join(", "),", or ")+C[s-1]:s===2?"one of ".concat(c," ").concat(C[0]," or ").concat(C[1]):"of ".concat(c," ").concat(C[0])}return"of ".concat(c," ").concat(String(C))}b("ERR_INVALID_OPT_VALUE",function(C,c){return'The value "'+c+'" is invalid for option "'+C+'"'},TypeError),b("ERR_INVALID_ARG_TYPE",function(C,c,s){var l,d,a,u;if(typeof c=="string"&&(d="not ",c.substr(!a||a<0?0:+a,d.length)===d)?(l="must not be",c=c.replace(/^not /,"")):l="must be",function(m,g,k){return(k===void 0||k>m.length)&&(k=m.length),m.substring(k-g.length,k)===g}(C," argument"))u="The ".concat(C," ").concat(l," ").concat(w(c,"type"));else{var v=function(m,g,k){return typeof k!="number"&&(k=0),!(k+g.length>m.length)&&m.indexOf(g,k)!==-1}(C,".")?"property":"argument";u='The "'.concat(C,'" ').concat(v," ").concat(l," ").concat(w(c,"type"))}return u+=". Received type ".concat(typeof s)},TypeError),b("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),b("ERR_METHOD_NOT_IMPLEMENTED",function(C){return"The "+C+" method is not implemented"}),b("ERR_STREAM_PREMATURE_CLOSE","Premature close"),b("ERR_STREAM_DESTROYED",function(C){return"Cannot call "+C+" after a stream was destroyed"}),b("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),b("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),b("ERR_STREAM_WRITE_AFTER_END","write after end"),b("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),b("ERR_UNKNOWN_ENCODING",function(C){return"Unknown encoding: "+C},TypeError),b("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),V.exports.codes=L},{}],56:[function(D,V,P){(function(L){(function(){"use strict";var b=Object.keys||function(v){var m=[];for(var g in v)m.push(g);return m};V.exports=d;var w=D("./_stream_readable"),C=D("./_stream_writable");D("inherits")(d,w);for(var c=b(C.prototype),s=0;s<c.length;s++){var l=c[s];d.prototype[l]||(d.prototype[l]=C.prototype[l])}function d(v){if(!(this instanceof d))return new d(v);w.call(this,v),C.call(this,v),this.allowHalfOpen=!0,v&&(v.readable===!1&&(this.readable=!1),v.writable===!1&&(this.writable=!1),v.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}function a(){this._writableState.ended||L.nextTick(u,this)}function u(v){v.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(d.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(m){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=m,this._writableState.destroyed=m)}})}).call(this)}).call(this,D("_process"))},{"./_stream_readable":58,"./_stream_writable":60,_process:50,inherits:24}],57:[function(D,V,P){"use strict";V.exports=b;var L=D("./_stream_transform");function b(w){if(!(this instanceof b))return new b(w);L.call(this,w)}D("inherits")(b,L),b.prototype._transform=function(w,C,c){c(null,w)}},{"./_stream_transform":59,inherits:24}],58:[function(D,V,P){(function(L,b){(function(){"use strict";var w;V.exports=S,S.ReadableState=F,D("events").EventEmitter;var C=function(f,I){return f.listeners(I).length},c=D("./internal/streams/stream"),s=D("buffer").Buffer,l=b.Uint8Array||function(){},d,a=D("util");d=a&&a.debuglog?a.debuglog("stream"):function(){};var u,v,m,g=D("./internal/streams/buffer_list"),k=D("./internal/streams/destroy"),y=D("./internal/streams/state").getHighWaterMark,T=D("../errors").codes,O=T.ERR_INVALID_ARG_TYPE,M=T.ERR_STREAM_PUSH_AFTER_EOF,Y=T.ERR_METHOD_NOT_IMPLEMENTED,N=T.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;D("inherits")(S,c);var G=k.errorOrDestroy,et=["error","close","destroy","pause","resume"];function F(h,f,I){w=w||D("./_stream_duplex"),h=h||{},typeof I!="boolean"&&(I=f instanceof w),this.objectMode=!!h.objectMode,I&&(this.objectMode=this.objectMode||!!h.readableObjectMode),this.highWaterMark=y(this,h,"readableHighWaterMark",I),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=h.emitClose!==!1,this.autoDestroy=!!h.autoDestroy,this.destroyed=!1,this.defaultEncoding=h.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,h.encoding&&(u||(u=D("string_decoder/").StringDecoder),this.decoder=new u(h.encoding),this.encoding=h.encoding)}function S(h){if(w=w||D("./_stream_duplex"),!(this instanceof S))return new S(h);var f=this instanceof w;this._readableState=new F(h,this,f),this.readable=!0,h&&(typeof h.read=="function"&&(this._read=h.read),typeof h.destroy=="function"&&(this._destroy=h.destroy)),c.call(this)}function _(h,f,I,B,X){d("readableAddChunk",f);var Q,ot=h._readableState;if(f===null)ot.reading=!1,function(pt,ft){if(d("onEofChunk"),!ft.ended){if(ft.decoder){var xt=ft.decoder.end();xt&&xt.length&&(ft.buffer.push(xt),ft.length+=ft.objectMode?1:xt.length)}ft.ended=!0,ft.sync?Z(pt):(ft.needReadable=!1,ft.emittedReadable||(ft.emittedReadable=!0,K(pt)))}}(h,ot);else if(X||(Q=function(pt,ft){var xt;Tt=ft,s.isBuffer(Tt)||Tt instanceof l||typeof ft=="string"||ft===void 0||pt.objectMode||(xt=new O("chunk",["string","Buffer","Uint8Array"],ft));var Tt;return xt}(ot,f)),Q)G(h,Q);else if(ot.objectMode||f&&f.length>0)if(typeof f=="string"||ot.objectMode||Object.getPrototypeOf(f)===s.prototype||(f=function(pt){return s.from(pt)}(f)),B)ot.endEmitted?G(h,new N):E(h,ot,f,!0);else if(ot.ended)G(h,new M);else{if(ot.destroyed)return!1;ot.reading=!1,ot.decoder&&!I?(f=ot.decoder.write(f),ot.objectMode||f.length!==0?E(h,ot,f,!1):z(h,ot)):E(h,ot,f,!1)}else B||(ot.reading=!1,z(h,ot));return!ot.ended&&(ot.length<ot.highWaterMark||ot.length===0)}function E(h,f,I,B){f.flowing&&f.length===0&&!f.sync?(f.awaitDrain=0,h.emit("data",I)):(f.length+=f.objectMode?1:I.length,B?f.buffer.unshift(I):f.buffer.push(I),f.needReadable&&Z(h)),z(h,f)}Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(f){this._readableState&&(this._readableState.destroyed=f)}}),S.prototype.destroy=k.destroy,S.prototype._undestroy=k.undestroy,S.prototype._destroy=function(h,f){f(h)},S.prototype.push=function(h,f){var I,B=this._readableState;return B.objectMode?I=!0:typeof h=="string"&&((f=f||B.defaultEncoding)!==B.encoding&&(h=s.from(h,f),f=""),I=!0),_(this,h,f,!1,I)},S.prototype.unshift=function(h){return _(this,h,null,!0,!1)},S.prototype.isPaused=function(){return this._readableState.flowing===!1},S.prototype.setEncoding=function(h){u||(u=D("string_decoder/").StringDecoder);var f=new u(h);this._readableState.decoder=f,this._readableState.encoding=this._readableState.decoder.encoding;for(var I=this._readableState.buffer.head,B="";I!==null;)B+=f.write(I.data),I=I.next;return this._readableState.buffer.clear(),B!==""&&this._readableState.buffer.push(B),this._readableState.length=B.length,this};var R=1073741824;function q(h,f){return h<=0||f.length===0&&f.ended?0:f.objectMode?1:h!=h?f.flowing&&f.length?f.buffer.head.data.length:f.length:(h>f.highWaterMark&&(f.highWaterMark=function(I){return I>=R?I=R:(I--,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,I|=I>>>16,I++),I}(h)),h<=f.length?h:f.ended?f.length:(f.needReadable=!0,0))}function Z(h){var f=h._readableState;d("emitReadable",f.needReadable,f.emittedReadable),f.needReadable=!1,f.emittedReadable||(d("emitReadable",f.flowing),f.emittedReadable=!0,L.nextTick(K,h))}function K(h){var f=h._readableState;d("emitReadable_",f.destroyed,f.length,f.ended),f.destroyed||!f.length&&!f.ended||(h.emit("readable"),f.emittedReadable=!1),f.needReadable=!f.flowing&&!f.ended&&f.length<=f.highWaterMark,rt(h)}function z(h,f){f.readingMore||(f.readingMore=!0,L.nextTick(j,h,f))}function j(h,f){for(;!f.reading&&!f.ended&&(f.length<f.highWaterMark||f.flowing&&f.length===0);){var I=f.length;if(d("maybeReadMore read 0"),h.read(0),I===f.length)break}f.readingMore=!1}function H(h){var f=h._readableState;f.readableListening=h.listenerCount("readable")>0,f.resumeScheduled&&!f.paused?f.flowing=!0:h.listenerCount("data")>0&&h.resume()}function A(h){d("readable nexttick read 0"),h.read(0)}function J(h,f){d("resume",f.reading),f.reading||h.read(0),f.resumeScheduled=!1,h.emit("resume"),rt(h),f.flowing&&!f.reading&&h.read(0)}function rt(h){var f=h._readableState;for(d("flow",f.flowing);f.flowing&&h.read()!==null;);}function $(h,f){return f.length===0?null:(f.objectMode?I=f.buffer.shift():!h||h>=f.length?(I=f.decoder?f.buffer.join(""):f.buffer.length===1?f.buffer.first():f.buffer.concat(f.length),f.buffer.clear()):I=f.buffer.consume(h,f.decoder),I);var I}function at(h){var f=h._readableState;d("endReadable",f.endEmitted),f.endEmitted||(f.ended=!0,L.nextTick(nt,f,h))}function nt(h,f){if(d("endReadableNT",h.endEmitted,h.length),!h.endEmitted&&h.length===0&&(h.endEmitted=!0,f.readable=!1,f.emit("end"),h.autoDestroy)){var I=f._writableState;(!I||I.autoDestroy&&I.finished)&&f.destroy()}}function st(h,f){for(var I=0,B=h.length;I<B;I++)if(h[I]===f)return I;return-1}S.prototype.read=function(h){d("read",h),h=parseInt(h,10);var f=this._readableState,I=h;if(h!==0&&(f.emittedReadable=!1),h===0&&f.needReadable&&((f.highWaterMark!==0?f.length>=f.highWaterMark:f.length>0)||f.ended))return d("read: emitReadable",f.length,f.ended),f.length===0&&f.ended?at(this):Z(this),null;if((h=q(h,f))===0&&f.ended)return f.length===0&&at(this),null;var B,X=f.needReadable;return d("need readable",X),(f.length===0||f.length-h<f.highWaterMark)&&d("length less than watermark",X=!0),f.ended||f.reading?d("reading or ended",X=!1):X&&(d("do read"),f.reading=!0,f.sync=!0,f.length===0&&(f.needReadable=!0),this._read(f.highWaterMark),f.sync=!1,f.reading||(h=q(I,f))),(B=h>0?$(h,f):null)===null?(f.needReadable=f.length<=f.highWaterMark,h=0):(f.length-=h,f.awaitDrain=0),f.length===0&&(f.ended||(f.needReadable=!0),I!==h&&f.ended&&at(this)),B!==null&&this.emit("data",B),B},S.prototype._read=function(h){G(this,new Y("_read()"))},S.prototype.pipe=function(h,f){var I=this,B=this._readableState;switch(B.pipesCount){case 0:B.pipes=h;break;case 1:B.pipes=[B.pipes,h];break;default:B.pipes.push(h)}B.pipesCount+=1,d("pipe count=%d opts=%j",B.pipesCount,f);var X=(!f||f.end!==!1)&&h!==L.stdout&&h!==L.stderr?ot:Ht;function Q(bt,_t){d("onunpipe"),bt===I&&_t&&_t.hasUnpiped===!1&&(_t.hasUnpiped=!0,d("cleanup"),h.removeListener("close",Kt),h.removeListener("finish",Dt),h.removeListener("drain",pt),h.removeListener("error",Tt),h.removeListener("unpipe",Q),I.removeListener("end",ot),I.removeListener("end",Ht),I.removeListener("data",xt),ft=!0,!B.awaitDrain||h._writableState&&!h._writableState.needDrain||pt())}function ot(){d("onend"),h.end()}B.endEmitted?L.nextTick(X):I.once("end",X),h.on("unpipe",Q);var pt=function(bt){return function(){var _t=bt._readableState;d("pipeOnDrain",_t.awaitDrain),_t.awaitDrain&&_t.awaitDrain--,_t.awaitDrain===0&&C(bt,"data")&&(_t.flowing=!0,rt(bt))}}(I);h.on("drain",pt);var ft=!1;function xt(bt){d("ondata");var _t=h.write(bt);d("dest.write",_t),_t===!1&&((B.pipesCount===1&&B.pipes===h||B.pipesCount>1&&st(B.pipes,h)!==-1)&&!ft&&(d("false write response, pause",B.awaitDrain),B.awaitDrain++),I.pause())}function Tt(bt){d("onerror",bt),Ht(),h.removeListener("error",Tt),C(h,"error")===0&&G(h,bt)}function Kt(){h.removeListener("finish",Dt),Ht()}function Dt(){d("onfinish"),h.removeListener("close",Kt),Ht()}function Ht(){d("unpipe"),I.unpipe(h)}return I.on("data",xt),function(bt,_t,Qt){if(typeof bt.prependListener=="function")return bt.prependListener(_t,Qt);bt._events&&bt._events[_t]?Array.isArray(bt._events[_t])?bt._events[_t].unshift(Qt):bt._events[_t]=[Qt,bt._events[_t]]:bt.on(_t,Qt)}(h,"error",Tt),h.once("close",Kt),h.once("finish",Dt),h.emit("pipe",I),B.flowing||(d("pipe resume"),I.resume()),h},S.prototype.unpipe=function(h){var f=this._readableState,I={hasUnpiped:!1};if(f.pipesCount===0)return this;if(f.pipesCount===1)return h&&h!==f.pipes?this:(h||(h=f.pipes),f.pipes=null,f.pipesCount=0,f.flowing=!1,h&&h.emit("unpipe",this,I),this);if(!h){var B=f.pipes,X=f.pipesCount;f.pipes=null,f.pipesCount=0,f.flowing=!1;for(var Q=0;Q<X;Q++)B[Q].emit("unpipe",this,{hasUnpiped:!1});return this}var ot=st(f.pipes,h);return ot===-1?this:(f.pipes.splice(ot,1),f.pipesCount-=1,f.pipesCount===1&&(f.pipes=f.pipes[0]),h.emit("unpipe",this,I),this)},S.prototype.on=function(h,f){var I=c.prototype.on.call(this,h,f),B=this._readableState;return h==="data"?(B.readableListening=this.listenerCount("readable")>0,B.flowing!==!1&&this.resume()):h==="readable"&&(B.endEmitted||B.readableListening||(B.readableListening=B.needReadable=!0,B.flowing=!1,B.emittedReadable=!1,d("on readable",B.length,B.reading),B.length?Z(this):B.reading||L.nextTick(A,this))),I},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(h,f){var I=c.prototype.removeListener.call(this,h,f);return h==="readable"&&L.nextTick(H,this),I},S.prototype.removeAllListeners=function(h){var f=c.prototype.removeAllListeners.apply(this,arguments);return h!=="readable"&&h!==void 0||L.nextTick(H,this),f},S.prototype.resume=function(){var h=this._readableState;return h.flowing||(d("resume"),h.flowing=!h.readableListening,function(f,I){I.resumeScheduled||(I.resumeScheduled=!0,L.nextTick(J,f,I))}(this,h)),h.paused=!1,this},S.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},S.prototype.wrap=function(h){var f=this,I=this._readableState,B=!1;for(var X in h.on("end",function(){if(d("wrapped end"),I.decoder&&!I.ended){var ot=I.decoder.end();ot&&ot.length&&f.push(ot)}f.push(null)}),h.on("data",function(ot){d("wrapped data"),I.decoder&&(ot=I.decoder.write(ot)),(!I.objectMode||ot!=null)&&(I.objectMode||ot&&ot.length)&&(f.push(ot)||(B=!0,h.pause()))}),h)this[X]===void 0&&typeof h[X]=="function"&&(this[X]=function(ot){return function(){return h[ot].apply(h,arguments)}}(X));for(var Q=0;Q<et.length;Q++)h.on(et[Q],this.emit.bind(this,et[Q]));return this._read=function(ot){d("wrapped _read",ot),B&&(B=!1,h.resume())},this},typeof Symbol=="function"&&(S.prototype[Symbol.asyncIterator]=function(){return v===void 0&&(v=D("./internal/streams/async_iterator")),v(this)}),Object.defineProperty(S.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(S.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(S.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(f){this._readableState&&(this._readableState.flowing=f)}}),S._fromList=$,Object.defineProperty(S.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(S.from=function(h,f){return m===void 0&&(m=D("./internal/streams/from")),m(S,h,f)})}).call(this)}).call(this,D("_process"),typeof ct.g!="undefined"?ct.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/async_iterator":61,"./internal/streams/buffer_list":62,"./internal/streams/destroy":63,"./internal/streams/from":65,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,events:22,inherits:24,"string_decoder/":75,util:16}],59:[function(D,V,P){"use strict";V.exports=l;var L=D("../errors").codes,b=L.ERR_METHOD_NOT_IMPLEMENTED,w=L.ERR_MULTIPLE_CALLBACK,C=L.ERR_TRANSFORM_ALREADY_TRANSFORMING,c=L.ERR_TRANSFORM_WITH_LENGTH_0,s=D("./_stream_duplex");function l(u){if(!(this instanceof l))return new l(u);s.call(this,u),this._transformState={afterTransform:function(v,m){var g=this._transformState;g.transforming=!1;var k=g.writecb;if(k===null)return this.emit("error",new w);g.writechunk=null,g.writecb=null,m!=null&&this.push(m),k(v);var y=this._readableState;y.reading=!1,(y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,u&&(typeof u.transform=="function"&&(this._transform=u.transform),typeof u.flush=="function"&&(this._flush=u.flush)),this.on("prefinish",d)}function d(){var u=this;typeof this._flush!="function"||this._readableState.destroyed?a(this,null,null):this._flush(function(v,m){a(u,v,m)})}function a(u,v,m){if(v)return u.emit("error",v);if(m!=null&&u.push(m),u._writableState.length)throw new c;if(u._transformState.transforming)throw new C;return u.push(null)}D("inherits")(l,s),l.prototype.push=function(u,v){return this._transformState.needTransform=!1,s.prototype.push.call(this,u,v)},l.prototype._transform=function(u,v,m){m(new b("_transform()"))},l.prototype._write=function(u,v,m){var g=this._transformState;if(g.writecb=m,g.writechunk=u,g.writeencoding=v,!g.transforming){var k=this._readableState;(g.needTransform||k.needReadable||k.length<k.highWaterMark)&&this._read(k.highWaterMark)}},l.prototype._read=function(u){var v=this._transformState;v.writechunk===null||v.transforming?v.needTransform=!0:(v.transforming=!0,this._transform(v.writechunk,v.writeencoding,v.afterTransform))},l.prototype._destroy=function(u,v){s.prototype._destroy.call(this,u,function(m){v(m)})}},{"../errors":55,"./_stream_duplex":56,inherits:24}],60:[function(D,V,P){(function(L,b){(function(){"use strict";function w(z){var j=this;this.next=null,this.entry=null,this.finish=function(){(function(H,A,J){var rt=H.entry;for(H.entry=null;rt;){var $=rt.callback;A.pendingcb--,$(J),rt=rt.next}A.corkedRequestsFree.next=H})(j,z)}}var C;V.exports=S,S.WritableState=F;var c={deprecate:D("util-deprecate")},s=D("./internal/streams/stream"),l=D("buffer").Buffer,d=b.Uint8Array||function(){},a,u=D("./internal/streams/destroy"),v=D("./internal/streams/state").getHighWaterMark,m=D("../errors").codes,g=m.ERR_INVALID_ARG_TYPE,k=m.ERR_METHOD_NOT_IMPLEMENTED,y=m.ERR_MULTIPLE_CALLBACK,T=m.ERR_STREAM_CANNOT_PIPE,O=m.ERR_STREAM_DESTROYED,M=m.ERR_STREAM_NULL_VALUES,Y=m.ERR_STREAM_WRITE_AFTER_END,N=m.ERR_UNKNOWN_ENCODING,G=u.errorOrDestroy;function et(){}function F(z,j,H){C=C||D("./_stream_duplex"),z=z||{},typeof H!="boolean"&&(H=j instanceof C),this.objectMode=!!z.objectMode,H&&(this.objectMode=this.objectMode||!!z.writableObjectMode),this.highWaterMark=v(this,z,"writableHighWaterMark",H),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var A=z.decodeStrings===!1;this.decodeStrings=!A,this.defaultEncoding=z.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(J){(function(rt,$){var at=rt._writableState,nt=at.sync,st=at.writecb;if(typeof st!="function")throw new y;if(function(f){f.writing=!1,f.writecb=null,f.length-=f.writelen,f.writelen=0}(at),$)(function(f,I,B,X,Q){--I.pendingcb,B?(L.nextTick(Q,X),L.nextTick(K,f,I),f._writableState.errorEmitted=!0,G(f,X)):(Q(X),f._writableState.errorEmitted=!0,G(f,X),K(f,I))})(rt,at,nt,$,st);else{var h=q(at)||rt.destroyed;h||at.corked||at.bufferProcessing||!at.bufferedRequest||R(rt,at),nt?L.nextTick(E,rt,at,h,st):E(rt,at,h,st)}})(j,J)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=z.emitClose!==!1,this.autoDestroy=!!z.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}function S(z){var j=this instanceof(C=C||D("./_stream_duplex"));if(!j&&!a.call(S,this))return new S(z);this._writableState=new F(z,this,j),this.writable=!0,z&&(typeof z.write=="function"&&(this._write=z.write),typeof z.writev=="function"&&(this._writev=z.writev),typeof z.destroy=="function"&&(this._destroy=z.destroy),typeof z.final=="function"&&(this._final=z.final)),s.call(this)}function _(z,j,H,A,J,rt,$){j.writelen=A,j.writecb=$,j.writing=!0,j.sync=!0,j.destroyed?j.onwrite(new O("write")):H?z._writev(J,j.onwrite):z._write(J,rt,j.onwrite),j.sync=!1}function E(z,j,H,A){H||function(J,rt){rt.length===0&&rt.needDrain&&(rt.needDrain=!1,J.emit("drain"))}(z,j),j.pendingcb--,A(),K(z,j)}function R(z,j){j.bufferProcessing=!0;var H=j.bufferedRequest;if(z._writev&&H&&H.next){var A=j.bufferedRequestCount,J=new Array(A),rt=j.corkedRequestsFree;rt.entry=H;for(var $=0,at=!0;H;)J[$]=H,H.isBuf||(at=!1),H=H.next,$+=1;J.allBuffers=at,_(z,j,!0,j.length,J,"",rt.finish),j.pendingcb++,j.lastBufferedRequest=null,rt.next?(j.corkedRequestsFree=rt.next,rt.next=null):j.corkedRequestsFree=new w(j),j.bufferedRequestCount=0}else{for(;H;){var nt=H.chunk,st=H.encoding,h=H.callback;if(_(z,j,!1,j.objectMode?1:nt.length,nt,st,h),H=H.next,j.bufferedRequestCount--,j.writing)break}H===null&&(j.lastBufferedRequest=null)}j.bufferedRequest=H,j.bufferProcessing=!1}function q(z){return z.ending&&z.length===0&&z.bufferedRequest===null&&!z.finished&&!z.writing}function Z(z,j){z._final(function(H){j.pendingcb--,H&&G(z,H),j.prefinished=!0,z.emit("prefinish"),K(z,j)})}function K(z,j){var H=q(j);if(H&&(function(J,rt){rt.prefinished||rt.finalCalled||(typeof J._final!="function"||rt.destroyed?(rt.prefinished=!0,J.emit("prefinish")):(rt.pendingcb++,rt.finalCalled=!0,L.nextTick(Z,J,rt)))}(z,j),j.pendingcb===0&&(j.finished=!0,z.emit("finish"),j.autoDestroy))){var A=z._readableState;(!A||A.autoDestroy&&A.endEmitted)&&z.destroy()}return H}D("inherits")(S,s),F.prototype.getBuffer=function(){for(var z=this.bufferedRequest,j=[];z;)j.push(z),z=z.next;return j},function(){try{Object.defineProperty(F.prototype,"buffer",{get:c.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(z){}}(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(j){return!!a.call(this,j)||this===S&&j&&j._writableState instanceof F}})):a=function(j){return j instanceof this},S.prototype.pipe=function(){G(this,new T)},S.prototype.write=function(z,j,H){var A,J=this._writableState,rt=!1,$=!J.objectMode&&(A=z,l.isBuffer(A)||A instanceof d);return $&&!l.isBuffer(z)&&(z=function(at){return l.from(at)}(z)),typeof j=="function"&&(H=j,j=null),$?j="buffer":j||(j=J.defaultEncoding),typeof H!="function"&&(H=et),J.ending?function(at,nt){var st=new Y;G(at,st),L.nextTick(nt,st)}(this,H):($||function(at,nt,st,h){var f;return st===null?f=new M:typeof st=="string"||nt.objectMode||(f=new g("chunk",["string","Buffer"],st)),!f||(G(at,f),L.nextTick(h,f),!1)}(this,J,z,H))&&(J.pendingcb++,rt=function(at,nt,st,h,f,I){if(!st){var B=function(pt,ft,xt){return pt.objectMode||pt.decodeStrings===!1||typeof ft!="string"||(ft=l.from(ft,xt)),ft}(nt,h,f);h!==B&&(st=!0,f="buffer",h=B)}var X=nt.objectMode?1:h.length;nt.length+=X;var Q=nt.length<nt.highWaterMark;if(Q||(nt.needDrain=!0),nt.writing||nt.corked){var ot=nt.lastBufferedRequest;nt.lastBufferedRequest={chunk:h,encoding:f,isBuf:st,callback:I,next:null},ot?ot.next=nt.lastBufferedRequest:nt.bufferedRequest=nt.lastBufferedRequest,nt.bufferedRequestCount+=1}else _(at,nt,!1,X,h,f,I);return Q}(this,J,$,z,j,H)),rt},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var z=this._writableState;z.corked&&(z.corked--,z.writing||z.corked||z.bufferProcessing||!z.bufferedRequest||R(this,z))},S.prototype.setDefaultEncoding=function(z){if(typeof z=="string"&&(z=z.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((z+"").toLowerCase())>-1))throw new N(z);return this._writableState.defaultEncoding=z,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(z,j,H){H(new k("_write()"))},S.prototype._writev=null,S.prototype.end=function(z,j,H){var A=this._writableState;return typeof z=="function"?(H=z,z=null,j=null):typeof j=="function"&&(H=j,j=null),z!=null&&this.write(z,j),A.corked&&(A.corked=1,this.uncork()),A.ending||function(J,rt,$){rt.ending=!0,K(J,rt),$&&(rt.finished?L.nextTick($):J.once("finish",$)),rt.ended=!0,J.writable=!1}(this,A,H),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(j){this._writableState&&(this._writableState.destroyed=j)}}),S.prototype.destroy=u.destroy,S.prototype._undestroy=u.undestroy,S.prototype._destroy=function(z,j){j(z)}}).call(this)}).call(this,D("_process"),typeof ct.g!="undefined"?ct.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/destroy":63,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,inherits:24,"util-deprecate":78}],61:[function(D,V,P){(function(L){(function(){"use strict";var b;function w(T,O,M){return O in T?Object.defineProperty(T,O,{value:M,enumerable:!0,configurable:!0,writable:!0}):T[O]=M,T}var C=D("./end-of-stream"),c=Symbol("lastResolve"),s=Symbol("lastReject"),l=Symbol("error"),d=Symbol("ended"),a=Symbol("lastPromise"),u=Symbol("handlePromise"),v=Symbol("stream");function m(T,O){return{value:T,done:O}}function g(T){var O=T[c];if(O!==null){var M=T[v].read();M!==null&&(T[a]=null,T[c]=null,T[s]=null,O(m(M,!1)))}}var k=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((w(b={get stream(){return this[v]},next:function(){var O=this,M=this[l];if(M!==null)return Promise.reject(M);if(this[d])return Promise.resolve(m(void 0,!0));if(this[v].destroyed)return new Promise(function(et,F){L.nextTick(function(){O[l]?F(O[l]):et(m(void 0,!0))})});var Y,N=this[a];if(N)Y=new Promise(function(et,F){return function(S,_){et.then(function(){F[d]?S(m(void 0,!0)):F[u](S,_)},_)}}(N,this));else{var G=this[v].read();if(G!==null)return Promise.resolve(m(G,!1));Y=new Promise(this[u])}return this[a]=Y,Y}},Symbol.asyncIterator,function(){return this}),w(b,"return",function(){var T=this;return new Promise(function(O,M){T[v].destroy(null,function(Y){Y?M(Y):O(m(void 0,!0))})})}),b),k);V.exports=function(T){var O,M=Object.create(y,(w(O={},v,{value:T,writable:!0}),w(O,c,{value:null,writable:!0}),w(O,s,{value:null,writable:!0}),w(O,l,{value:null,writable:!0}),w(O,d,{value:T._readableState.endEmitted,writable:!0}),w(O,u,{value:function(N,G){var et=M[v].read();et?(M[a]=null,M[c]=null,M[s]=null,N(m(et,!1))):(M[c]=N,M[s]=G)},writable:!0}),O));return M[a]=null,C(T,function(Y){if(Y&&Y.code!=="ERR_STREAM_PREMATURE_CLOSE"){var N=M[s];return N!==null&&(M[a]=null,M[c]=null,M[s]=null,N(Y)),void(M[l]=Y)}var G=M[c];G!==null&&(M[a]=null,M[c]=null,M[s]=null,G(m(void 0,!0))),M[d]=!0}),T.on("readable",function(Y){L.nextTick(g,Y)}.bind(null,M)),M}}).call(this)}).call(this,D("_process"))},{"./end-of-stream":64,_process:50}],62:[function(D,V,P){"use strict";function L(l,d){var a=Object.keys(l);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(l);d&&(u=u.filter(function(v){return Object.getOwnPropertyDescriptor(l,v).enumerable})),a.push.apply(a,u)}return a}function b(l,d,a){return d in l?Object.defineProperty(l,d,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[d]=a,l}function w(l,d){for(var a=0;a<d.length;a++){var u=d[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(l,u.key,u)}}var C=D("buffer").Buffer,c=D("util").inspect,s=c&&c.custom||"inspect";V.exports=function(){function l(){(function(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,l),this.head=null,this.tail=null,this.length=0}var d,a,u;return d=l,(a=[{key:"push",value:function(m){var g={data:m,next:null};this.length>0?this.tail.next=g:this.head=g,this.tail=g,++this.length}},{key:"unshift",value:function(m){var g={data:m,next:this.head};this.length===0&&(this.tail=g),this.head=g,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var g=this.head,k=""+g.data;g=g.next;)k+=m+g.data;return k}},{key:"concat",value:function(m){if(this.length===0)return C.alloc(0);for(var g,k,y,T=C.allocUnsafe(m>>>0),O=this.head,M=0;O;)g=O.data,k=T,y=M,C.prototype.copy.call(g,k,y),M+=O.data.length,O=O.next;return T}},{key:"consume",value:function(m,g){var k;return m<this.head.data.length?(k=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):k=m===this.head.data.length?this.shift():g?this._getString(m):this._getBuffer(m),k}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var g=this.head,k=1,y=g.data;for(m-=y.length;g=g.next;){var T=g.data,O=m>T.length?T.length:m;if(O===T.length?y+=T:y+=T.slice(0,m),(m-=O)===0){O===T.length?(++k,g.next?this.head=g.next:this.head=this.tail=null):(this.head=g,g.data=T.slice(O));break}++k}return this.length-=k,y}},{key:"_getBuffer",value:function(m){var g=C.allocUnsafe(m),k=this.head,y=1;for(k.data.copy(g),m-=k.data.length;k=k.next;){var T=k.data,O=m>T.length?T.length:m;if(T.copy(g,g.length-m,0,O),(m-=O)===0){O===T.length?(++y,k.next?this.head=k.next:this.head=this.tail=null):(this.head=k,k.data=T.slice(O));break}++y}return this.length-=y,g}},{key:s,value:function(m,g){return c(this,function(k){for(var y=1;y<arguments.length;y++){var T=arguments[y]!=null?arguments[y]:{};y%2?L(Object(T),!0).forEach(function(O){b(k,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(T)):L(Object(T)).forEach(function(O){Object.defineProperty(k,O,Object.getOwnPropertyDescriptor(T,O))})}return k}({},g,{depth:0,customInspect:!1}))}}])&&w(d.prototype,a),u&&w(d,u),l}()},{buffer:17,util:16}],63:[function(D,V,P){(function(L){(function(){"use strict";function b(c,s){C(c,s),w(c)}function w(c){c._writableState&&!c._writableState.emitClose||c._readableState&&!c._readableState.emitClose||c.emit("close")}function C(c,s){c.emit("error",s)}V.exports={destroy:function(s,l){var d=this,a=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return a||u?(l?l(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,L.nextTick(C,this,s)):L.nextTick(C,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(v){!l&&v?d._writableState?d._writableState.errorEmitted?L.nextTick(w,d):(d._writableState.errorEmitted=!0,L.nextTick(b,d,v)):L.nextTick(b,d,v):l?(L.nextTick(w,d),l(v)):L.nextTick(w,d)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(s,l){var d=s._readableState,a=s._writableState;d&&d.autoDestroy||a&&a.autoDestroy?s.destroy(l):s.emit("error",l)}}}).call(this)}).call(this,D("_process"))},{_process:50}],64:[function(D,V,P){"use strict";var L=D("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function b(){}V.exports=function w(C,c,s){if(typeof c=="function")return w(C,null,c);c||(c={}),s=function(O){var M=!1;return function(){if(!M){M=!0;for(var Y=arguments.length,N=new Array(Y),G=0;G<Y;G++)N[G]=arguments[G];O.apply(this,N)}}}(s||b);var l=c.readable||c.readable!==!1&&C.readable,d=c.writable||c.writable!==!1&&C.writable,a=function(){C.writable||v()},u=C._writableState&&C._writableState.finished,v=function(){d=!1,u=!0,l||s.call(C)},m=C._readableState&&C._readableState.endEmitted,g=function(){l=!1,m=!0,d||s.call(C)},k=function(M){s.call(C,M)},y=function(){var M;return l&&!m?(C._readableState&&C._readableState.ended||(M=new L),s.call(C,M)):d&&!u?(C._writableState&&C._writableState.ended||(M=new L),s.call(C,M)):void 0},T=function(){C.req.on("finish",v)};return function(O){return O.setHeader&&typeof O.abort=="function"}(C)?(C.on("complete",v),C.on("abort",y),C.req?T():C.on("request",T)):d&&!C._writableState&&(C.on("end",a),C.on("close",a)),C.on("end",g),C.on("finish",v),c.error!==!1&&C.on("error",k),C.on("close",y),function(){C.removeListener("complete",v),C.removeListener("abort",y),C.removeListener("request",T),C.req&&C.req.removeListener("finish",v),C.removeListener("end",a),C.removeListener("close",a),C.removeListener("finish",v),C.removeListener("end",g),C.removeListener("error",k),C.removeListener("close",y)}}},{"../../../errors":55}],65:[function(D,V,P){V.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],66:[function(D,V,P){"use strict";var L,b=D("../../../errors").codes,w=b.ERR_MISSING_ARGS,C=b.ERR_STREAM_DESTROYED;function c(d){if(d)throw d}function s(d){d()}function l(d,a){return d.pipe(a)}V.exports=function(){for(var d=arguments.length,a=new Array(d),u=0;u<d;u++)a[u]=arguments[u];var v,m=function(k){return k.length?typeof k[k.length-1]!="function"?c:k.pop():c}(a);if(Array.isArray(a[0])&&(a=a[0]),a.length<2)throw new w("streams");var g=a.map(function(k,y){var T=y<a.length-1;return function(O,M,Y,N){N=function(F){var S=!1;return function(){S||(S=!0,F.apply(void 0,arguments))}}(N);var G=!1;O.on("close",function(){G=!0}),L===void 0&&(L=D("./end-of-stream")),L(O,{readable:M,writable:Y},function(F){if(F)return N(F);G=!0,N()});var et=!1;return function(F){if(!G&&!et)return et=!0,function(S){return S.setHeader&&typeof S.abort=="function"}(O)?O.abort():typeof O.destroy=="function"?O.destroy():void N(F||new C("pipe"))}}(k,T,y>0,function(O){v||(v=O),O&&g.forEach(s),T||(g.forEach(s),m(v))})});return a.reduce(l)}},{"../../../errors":55,"./end-of-stream":64}],67:[function(D,V,P){"use strict";var L=D("../../../errors").codes.ERR_INVALID_OPT_VALUE;V.exports={getHighWaterMark:function(w,C,c,s){var l=function(d,a,u){return d.highWaterMark!=null?d.highWaterMark:a?d[u]:null}(C,s,c);if(l!=null){if(!isFinite(l)||Math.floor(l)!==l||l<0)throw new L(s?c:"highWaterMark",l);return Math.floor(l)}return w.objectMode?16:16384}}},{"../../../errors":55}],68:[function(D,V,P){V.exports=D("events").EventEmitter},{events:22}],69:[function(D,V,P){(P=V.exports=D("./lib/_stream_readable.js")).Stream=P,P.Readable=P,P.Writable=D("./lib/_stream_writable.js"),P.Duplex=D("./lib/_stream_duplex.js"),P.Transform=D("./lib/_stream_transform.js"),P.PassThrough=D("./lib/_stream_passthrough.js"),P.finished=D("./lib/internal/streams/end-of-stream.js"),P.pipeline=D("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":56,"./lib/_stream_passthrough.js":57,"./lib/_stream_readable.js":58,"./lib/_stream_transform.js":59,"./lib/_stream_writable.js":60,"./lib/internal/streams/end-of-stream.js":64,"./lib/internal/streams/pipeline.js":66}],70:[function(D,V,P){"use strict";V.exports=function(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("interval needed");var L;if(arguments.length>0){L=new Array(arguments.length-2);for(var b=0;b<L.length;b++)L[b]=arguments[b+2]}return new function(w,C,c){var s=this;this._callback=w,this._args=c,this._interval=setInterval(w,C,this._args),this.reschedule=function(l){l||(l=s._interval),s._interval&&clearInterval(s._interval),s._interval=setInterval(s._callback,l,s._args)},this.clear=function(){s._interval&&(clearInterval(s._interval),s._interval=void 0)},this.destroy=function(){s._interval&&clearInterval(s._interval),s._callback=void 0,s._interval=void 0,s._args=void 0}}(arguments[0],arguments[1],L)}},{}],71:[function(D,V,P){"use strict";V.exports=D("./index.js")()},{"./index.js":72}],72:[function(D,V,P){(function(L){(function(){"use strict";function b(w){return w instanceof L?L.from(w):new w.constructor(w.buffer.slice(),w.byteOffset,w.length)}V.exports=function(w){return(w=w||{}).circles?function(c){var s=[],l=[];return c.proto?function a(u){if(typeof u!="object"||u===null)return u;if(u instanceof Date)return new Date(u);if(Array.isArray(u))return d(u,a);if(u instanceof Map)return new Map(d(Array.from(u),a));if(u instanceof Set)return new Set(d(Array.from(u),a));var v={};for(var m in s.push(u),l.push(v),u){var g=u[m];if(typeof g!="object"||g===null)v[m]=g;else if(g instanceof Date)v[m]=new Date(g);else if(g instanceof Map)v[m]=new Map(d(Array.from(g),a));else if(g instanceof Set)v[m]=new Set(d(Array.from(g),a));else if(ArrayBuffer.isView(g))v[m]=b(g);else{var k=s.indexOf(g);v[m]=k!==-1?l[k]:a(g)}}return s.pop(),l.pop(),v}:function a(u){if(typeof u!="object"||u===null)return u;if(u instanceof Date)return new Date(u);if(Array.isArray(u))return d(u,a);if(u instanceof Map)return new Map(d(Array.from(u),a));if(u instanceof Set)return new Set(d(Array.from(u),a));var v={};for(var m in s.push(u),l.push(v),u)if(Object.hasOwnProperty.call(u,m)!==!1){var g=u[m];if(typeof g!="object"||g===null)v[m]=g;else if(g instanceof Date)v[m]=new Date(g);else if(g instanceof Map)v[m]=new Map(d(Array.from(g),a));else if(g instanceof Set)v[m]=new Set(d(Array.from(g),a));else if(ArrayBuffer.isView(g))v[m]=b(g);else{var k=s.indexOf(g);v[m]=k!==-1?l[k]:a(g)}}return s.pop(),l.pop(),v};function d(a,u){for(var v=Object.keys(a),m=new Array(v.length),g=0;g<v.length;g++){var k=v[g],y=a[k];if(typeof y!="object"||y===null)m[k]=y;else if(y instanceof Date)m[k]=new Date(y);else if(ArrayBuffer.isView(y))m[k]=b(y);else{var T=s.indexOf(y);m[k]=T!==-1?l[T]:u(y)}}return m}}(w):w.proto?function c(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return C(s,c);if(s instanceof Map)return new Map(C(Array.from(s),c));if(s instanceof Set)return new Set(C(Array.from(s),c));var l={};for(var d in s){var a=s[d];typeof a!="object"||a===null?l[d]=a:a instanceof Date?l[d]=new Date(a):a instanceof Map?l[d]=new Map(C(Array.from(a),c)):a instanceof Set?l[d]=new Set(C(Array.from(a),c)):ArrayBuffer.isView(a)?l[d]=b(a):l[d]=c(a)}return l}:function c(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return C(s,c);if(s instanceof Map)return new Map(C(Array.from(s),c));if(s instanceof Set)return new Set(C(Array.from(s),c));var l={};for(var d in s)if(Object.hasOwnProperty.call(s,d)!==!1){var a=s[d];typeof a!="object"||a===null?l[d]=a:a instanceof Date?l[d]=new Date(a):a instanceof Map?l[d]=new Map(C(Array.from(a),c)):a instanceof Set?l[d]=new Set(C(Array.from(a),c)):ArrayBuffer.isView(a)?l[d]=b(a):l[d]=c(a)}return l};function C(c,s){for(var l=Object.keys(c),d=new Array(l.length),a=0;a<l.length;a++){var u=l[a],v=c[u];typeof v!="object"||v===null?d[u]=v:v instanceof Date?d[u]=new Date(v):ArrayBuffer.isView(v)?d[u]=b(v):d[u]=s(v)}return d}}}).call(this)}).call(this,D("buffer").Buffer)},{buffer:17}],73:[function(D,V,P){var L=D("buffer"),b=L.Buffer;function w(c,s){for(var l in c)s[l]=c[l]}function C(c,s,l){return b(c,s,l)}b.from&&b.alloc&&b.allocUnsafe&&b.allocUnsafeSlow?V.exports=L:(w(L,P),P.Buffer=C),C.prototype=Object.create(b.prototype),w(b,C),C.from=function(c,s,l){if(typeof c=="number")throw new TypeError("Argument must not be a number");return b(c,s,l)},C.alloc=function(c,s,l){if(typeof c!="number")throw new TypeError("Argument must be a number");var d=b(c);return s!==void 0?typeof l=="string"?d.fill(s,l):d.fill(s):d.fill(0),d},C.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return b(c)},C.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return L.SlowBuffer(c)}},{buffer:17}],74:[function(D,V,P){V.exports=function(L){var b=L._readableState;return b?b.objectMode||typeof L._duplexState=="number"?L.read():L.read((w=b,w.buffer.length?w.buffer.head?w.buffer.head.data.length:w.buffer[0].length:w.length)):null;var w}},{}],75:[function(D,V,P){"use strict";var L=D("safe-buffer").Buffer,b=L.isEncoding||function(m){switch((m=""+m)&&m.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function w(m){var g;switch(this.encoding=function(k){var y=function(T){if(!T)return"utf8";for(var O;;)switch(T){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return T;default:if(O)return;T=(""+T).toLowerCase(),O=!0}}(k);if(typeof y!="string"&&(L.isEncoding===b||!b(k)))throw new Error("Unknown encoding: "+k);return y||k}(m),this.encoding){case"utf16le":this.text=s,this.end=l,g=4;break;case"utf8":this.fillLast=c,g=4;break;case"base64":this.text=d,this.end=a,g=3;break;default:return this.write=u,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=L.allocUnsafe(g)}function C(m){return m<=127?0:m>>5==6?2:m>>4==14?3:m>>3==30?4:m>>6==2?-1:-2}function c(m){var g=this.lastTotal-this.lastNeed,k=function(y,T,O){if((192&T[0])!=128)return y.lastNeed=0,"\uFFFD";if(y.lastNeed>1&&T.length>1){if((192&T[1])!=128)return y.lastNeed=1,"\uFFFD";if(y.lastNeed>2&&T.length>2&&(192&T[2])!=128)return y.lastNeed=2,"\uFFFD"}}(this,m);return k!==void 0?k:this.lastNeed<=m.length?(m.copy(this.lastChar,g,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(m.copy(this.lastChar,g,0,m.length),void(this.lastNeed-=m.length))}function s(m,g){if((m.length-g)%2==0){var k=m.toString("utf16le",g);if(k){var y=k.charCodeAt(k.length-1);if(y>=55296&&y<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1],k.slice(0,-1)}return k}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=m[m.length-1],m.toString("utf16le",g,m.length-1)}function l(m){var g=m&&m.length?this.write(m):"";if(this.lastNeed){var k=this.lastTotal-this.lastNeed;return g+this.lastChar.toString("utf16le",0,k)}return g}function d(m,g){var k=(m.length-g)%3;return k===0?m.toString("base64",g):(this.lastNeed=3-k,this.lastTotal=3,k===1?this.lastChar[0]=m[m.length-1]:(this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1]),m.toString("base64",g,m.length-k))}function a(m){var g=m&&m.length?this.write(m):"";return this.lastNeed?g+this.lastChar.toString("base64",0,3-this.lastNeed):g}function u(m){return m.toString(this.encoding)}function v(m){return m&&m.length?this.write(m):""}P.StringDecoder=w,w.prototype.write=function(m){if(m.length===0)return"";var g,k;if(this.lastNeed){if((g=this.fillLast(m))===void 0)return"";k=this.lastNeed,this.lastNeed=0}else k=0;return k<m.length?g?g+this.text(m,k):this.text(m,k):g||""},w.prototype.end=function(m){var g=m&&m.length?this.write(m):"";return this.lastNeed?g+"\uFFFD":g},w.prototype.text=function(m,g){var k=function(T,O,M){var Y=O.length-1;if(Y<M)return 0;var N=C(O[Y]);return N>=0?(N>0&&(T.lastNeed=N-1),N):--Y<M||N===-2?0:(N=C(O[Y]))>=0?(N>0&&(T.lastNeed=N-2),N):--Y<M||N===-2?0:(N=C(O[Y]))>=0?(N>0&&(N===2?N=0:T.lastNeed=N-3),N):0}(this,m,g);if(!this.lastNeed)return m.toString("utf8",g);this.lastTotal=k;var y=m.length-(k-this.lastNeed);return m.copy(this.lastChar,0,y),m.toString("utf8",g,y)},w.prototype.fillLast=function(m){if(this.lastNeed<=m.length)return m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,m.length),this.lastNeed-=m.length}},{"safe-buffer":73}],76:[function(D,V,P){"use strict";var L=D("punycode"),b=D("./util");function w(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}P.parse=O,P.resolve=function(M,Y){return O(M,!1,!0).resolve(Y)},P.resolveObject=function(M,Y){return M?O(M,!1,!0).resolveObject(Y):Y},P.format=function(M){return b.isString(M)&&(M=O(M)),M instanceof w?M.format():w.prototype.format.call(M)},P.Url=w;var C=/^([a-z0-9.+-]+:)/i,c=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),d=["'"].concat(l),a=["%","/","?",";","#"].concat(d),u=["/","?","#"],v=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},k={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},T=D("querystring");function O(M,Y,N){if(M&&b.isObject(M)&&M instanceof w)return M;var G=new w;return G.parse(M,Y,N),G}w.prototype.parse=function(M,Y,N){if(!b.isString(M))throw new TypeError("Parameter 'url' must be a string, not "+typeof M);var G=M.indexOf("?"),et=G!==-1&&G<M.indexOf("#")?"?":"#",F=M.split(et);F[0]=F[0].replace(/\\/g,"/");var S=M=F.join(et);if(S=S.trim(),!N&&M.split("#").length===1){var _=s.exec(S);if(_)return this.path=S,this.href=S,this.pathname=_[1],_[2]?(this.search=_[2],this.query=Y?T.parse(this.search.substr(1)):this.search.substr(1)):Y&&(this.search="",this.query={}),this}var E=C.exec(S);if(E){var R=(E=E[0]).toLowerCase();this.protocol=R,S=S.substr(E.length)}if(N||E||S.match(/^\/\/[^@\/]+@[^@\/]+/)){var q=S.substr(0,2)==="//";!q||E&&k[E]||(S=S.substr(2),this.slashes=!0)}if(!k[E]&&(q||E&&!y[E])){for(var Z,K,z=-1,j=0;j<u.length;j++)(H=S.indexOf(u[j]))!==-1&&(z===-1||H<z)&&(z=H);for((K=z===-1?S.lastIndexOf("@"):S.lastIndexOf("@",z))!==-1&&(Z=S.slice(0,K),S=S.slice(K+1),this.auth=decodeURIComponent(Z)),z=-1,j=0;j<a.length;j++){var H;(H=S.indexOf(a[j]))!==-1&&(z===-1||H<z)&&(z=H)}z===-1&&(z=S.length),this.host=S.slice(0,z),S=S.slice(z),this.parseHost(),this.hostname=this.hostname||"";var A=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!A)for(var J=this.hostname.split(/\./),rt=(j=0,J.length);j<rt;j++){var $=J[j];if($&&!$.match(v)){for(var at="",nt=0,st=$.length;nt<st;nt++)$.charCodeAt(nt)>127?at+="x":at+=$[nt];if(!at.match(v)){var h=J.slice(0,j),f=J.slice(j+1),I=$.match(m);I&&(h.push(I[1]),f.unshift(I[2])),f.length&&(S="/"+f.join(".")+S),this.hostname=h.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=L.toASCII(this.hostname));var B=this.port?":"+this.port:"",X=this.hostname||"";this.host=X+B,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),S[0]!=="/"&&(S="/"+S))}if(!g[R])for(j=0,rt=d.length;j<rt;j++){var Q=d[j];if(S.indexOf(Q)!==-1){var ot=encodeURIComponent(Q);ot===Q&&(ot=escape(Q)),S=S.split(Q).join(ot)}}var pt=S.indexOf("#");pt!==-1&&(this.hash=S.substr(pt),S=S.slice(0,pt));var ft=S.indexOf("?");if(ft!==-1?(this.search=S.substr(ft),this.query=S.substr(ft+1),Y&&(this.query=T.parse(this.query)),S=S.slice(0,ft)):Y&&(this.search="",this.query={}),S&&(this.pathname=S),y[R]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var xt=this.search||"";this.path=B+xt}return this.href=this.format(),this},w.prototype.format=function(){var M=this.auth||"";M&&(M=(M=encodeURIComponent(M)).replace(/%3A/i,":"),M+="@");var Y=this.protocol||"",N=this.pathname||"",G=this.hash||"",et=!1,F="";this.host?et=M+this.host:this.hostname&&(et=M+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(et+=":"+this.port)),this.query&&b.isObject(this.query)&&Object.keys(this.query).length&&(F=T.stringify(this.query));var S=this.search||F&&"?"+F||"";return Y&&Y.substr(-1)!==":"&&(Y+=":"),this.slashes||(!Y||y[Y])&&et!==!1?(et="//"+(et||""),N&&N.charAt(0)!=="/"&&(N="/"+N)):et||(et=""),G&&G.charAt(0)!=="#"&&(G="#"+G),S&&S.charAt(0)!=="?"&&(S="?"+S),Y+et+(N=N.replace(/[?#]/g,function(_){return encodeURIComponent(_)}))+(S=S.replace("#","%23"))+G},w.prototype.resolve=function(M){return this.resolveObject(O(M,!1,!0)).format()},w.prototype.resolveObject=function(M){if(b.isString(M)){var Y=new w;Y.parse(M,!1,!0),M=Y}for(var N=new w,G=Object.keys(this),et=0;et<G.length;et++){var F=G[et];N[F]=this[F]}if(N.hash=M.hash,M.href==="")return N.href=N.format(),N;if(M.slashes&&!M.protocol){for(var S=Object.keys(M),_=0;_<S.length;_++){var E=S[_];E!=="protocol"&&(N[E]=M[E])}return y[N.protocol]&&N.hostname&&!N.pathname&&(N.path=N.pathname="/"),N.href=N.format(),N}if(M.protocol&&M.protocol!==N.protocol){if(!y[M.protocol]){for(var R=Object.keys(M),q=0;q<R.length;q++){var Z=R[q];N[Z]=M[Z]}return N.href=N.format(),N}if(N.protocol=M.protocol,M.host||k[M.protocol])N.pathname=M.pathname;else{for(var K=(M.pathname||"").split("/");K.length&&!(M.host=K.shift()););M.host||(M.host=""),M.hostname||(M.hostname=""),K[0]!==""&&K.unshift(""),K.length<2&&K.unshift(""),N.pathname=K.join("/")}if(N.search=M.search,N.query=M.query,N.host=M.host||"",N.auth=M.auth,N.hostname=M.hostname||M.host,N.port=M.port,N.pathname||N.search){var z=N.pathname||"",j=N.search||"";N.path=z+j}return N.slashes=N.slashes||M.slashes,N.href=N.format(),N}var H=N.pathname&&N.pathname.charAt(0)==="/",A=M.host||M.pathname&&M.pathname.charAt(0)==="/",J=A||H||N.host&&M.pathname,rt=J,$=N.pathname&&N.pathname.split("/")||[],at=(K=M.pathname&&M.pathname.split("/")||[],N.protocol&&!y[N.protocol]);if(at&&(N.hostname="",N.port=null,N.host&&($[0]===""?$[0]=N.host:$.unshift(N.host)),N.host="",M.protocol&&(M.hostname=null,M.port=null,M.host&&(K[0]===""?K[0]=M.host:K.unshift(M.host)),M.host=null),J=J&&(K[0]===""||$[0]==="")),A)N.host=M.host||M.host===""?M.host:N.host,N.hostname=M.hostname||M.hostname===""?M.hostname:N.hostname,N.search=M.search,N.query=M.query,$=K;else if(K.length)$||($=[]),$.pop(),$=$.concat(K),N.search=M.search,N.query=M.query;else if(!b.isNullOrUndefined(M.search))return at&&(N.hostname=N.host=$.shift(),(I=!!(N.host&&N.host.indexOf("@")>0)&&N.host.split("@"))&&(N.auth=I.shift(),N.host=N.hostname=I.shift())),N.search=M.search,N.query=M.query,b.isNull(N.pathname)&&b.isNull(N.search)||(N.path=(N.pathname?N.pathname:"")+(N.search?N.search:"")),N.href=N.format(),N;if(!$.length)return N.pathname=null,N.search?N.path="/"+N.search:N.path=null,N.href=N.format(),N;for(var nt=$.slice(-1)[0],st=(N.host||M.host||$.length>1)&&(nt==="."||nt==="..")||nt==="",h=0,f=$.length;f>=0;f--)(nt=$[f])==="."?$.splice(f,1):nt===".."?($.splice(f,1),h++):h&&($.splice(f,1),h--);if(!J&&!rt)for(;h--;h)$.unshift("..");!J||$[0]===""||$[0]&&$[0].charAt(0)==="/"||$.unshift(""),st&&$.join("/").substr(-1)!=="/"&&$.push("");var I,B=$[0]===""||$[0]&&$[0].charAt(0)==="/";return at&&(N.hostname=N.host=B?"":$.length?$.shift():"",(I=!!(N.host&&N.host.indexOf("@")>0)&&N.host.split("@"))&&(N.auth=I.shift(),N.host=N.hostname=I.shift())),(J=J||N.host&&$.length)&&!B&&$.unshift(""),$.length?N.pathname=$.join("/"):(N.pathname=null,N.path=null),b.isNull(N.pathname)&&b.isNull(N.search)||(N.path=(N.pathname?N.pathname:"")+(N.search?N.search:"")),N.auth=M.auth||N.auth,N.slashes=N.slashes||M.slashes,N.href=N.format(),N},w.prototype.parseHost=function(){var M=this.host,Y=c.exec(M);Y&&((Y=Y[0])!==":"&&(this.port=Y.substr(1)),M=M.substr(0,M.length-Y.length)),M&&(this.hostname=M)}},{"./util":77,punycode:51,querystring:54}],77:[function(D,V,P){"use strict";V.exports={isString:function(b){return typeof b=="string"},isObject:function(b){return typeof b=="object"&&b!==null},isNull:function(b){return b===null},isNullOrUndefined:function(b){return b==null}}},{}],78:[function(D,V,P){(function(L){(function(){function b(w){try{if(!L.localStorage)return!1}catch(c){return!1}var C=L.localStorage[w];return C!=null&&String(C).toLowerCase()==="true"}V.exports=function(w,C){if(b("noDeprecation"))return w;var c=!1;return function(){if(!c){if(b("throwDeprecation"))throw new Error(C);b("traceDeprecation")?console.trace(C):console.warn(C),c=!0}return w.apply(this,arguments)}}}).call(this)}).call(this,typeof ct.g!="undefined"?ct.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],79:[function(D,V,P){V.exports=function L(b,w){if(b&&w)return L(b)(w);if(typeof b!="function")throw new TypeError("need wrapper function");return Object.keys(b).forEach(function(c){C[c]=b[c]}),C;function C(){for(var c=new Array(arguments.length),s=0;s<c.length;s++)c[s]=arguments[s];var l=b.apply(this,c),d=c[c.length-1];return typeof l=="function"&&l!==d&&Object.keys(d).forEach(function(a){l[a]=d[a]}),l}}},{}],80:[function(D,V,P){"use strict";V.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],81:[function(D,V,P){V.exports=function(){for(var b={},w=0;w<arguments.length;w++){var C=arguments[w];for(var c in C)L.call(C,c)&&(b[c]=C[c])}return b};var L=Object.prototype.hasOwnProperty},{}],82:[function(D,V,P){"use strict";V.exports=function(L){L.prototype[Symbol.iterator]=tt.mark(function b(){var w;return tt.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:w=this.head;case 1:if(!w){c.next=7;break}return c.next=4,w.value;case 4:w=w.next,c.next=1;break;case 7:case"end":return c.stop()}},b,this)})}},{}],83:[function(D,V,P){"use strict";function L(s){var l=this;if(l instanceof L||(l=new L),l.tail=null,l.head=null,l.length=0,s&&typeof s.forEach=="function")s.forEach(function(u){l.push(u)});else if(arguments.length>0)for(var d=0,a=arguments.length;d<a;d++)l.push(arguments[d]);return l}function b(s,l,d){var a=l===s.head?new c(d,null,l,s):new c(d,l,l.next,s);return a.next===null&&(s.tail=a),a.prev===null&&(s.head=a),s.length++,a}function w(s,l){s.tail=new c(l,s.tail,null,s),s.head||(s.head=s.tail),s.length++}function C(s,l){s.head=new c(l,null,s.head,s),s.tail||(s.tail=s.head),s.length++}function c(s,l,d,a){if(!(this instanceof c))return new c(s,l,d,a);this.list=a,this.value=s,l?(l.next=this,this.prev=l):this.prev=null,d?(d.prev=this,this.next=d):this.next=null}V.exports=L,L.Node=c,L.create=L,L.prototype.removeNode=function(s){if(s.list!==this)throw new Error("removing node which does not belong to this list");var l=s.next,d=s.prev;return l&&(l.prev=d),d&&(d.next=l),s===this.head&&(this.head=l),s===this.tail&&(this.tail=d),s.list.length--,s.next=null,s.prev=null,s.list=null,l},L.prototype.unshiftNode=function(s){if(s!==this.head){s.list&&s.list.removeNode(s);var l=this.head;s.list=this,s.next=l,l&&(l.prev=s),this.head=s,this.tail||(this.tail=s),this.length++}},L.prototype.pushNode=function(s){if(s!==this.tail){s.list&&s.list.removeNode(s);var l=this.tail;s.list=this,s.prev=l,l&&(l.next=s),this.tail=s,this.head||(this.head=s),this.length++}},L.prototype.push=function(){for(var s=0,l=arguments.length;s<l;s++)w(this,arguments[s]);return this.length},L.prototype.unshift=function(){for(var s=0,l=arguments.length;s<l;s++)C(this,arguments[s]);return this.length},L.prototype.pop=function(){if(this.tail){var s=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,s}},L.prototype.shift=function(){if(this.head){var s=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,s}},L.prototype.forEach=function(s,l){l=l||this;for(var d=this.head,a=0;d!==null;a++)s.call(l,d.value,a,this),d=d.next},L.prototype.forEachReverse=function(s,l){l=l||this;for(var d=this.tail,a=this.length-1;d!==null;a--)s.call(l,d.value,a,this),d=d.prev},L.prototype.get=function(s){for(var l=0,d=this.head;d!==null&&l<s;l++)d=d.next;if(l===s&&d!==null)return d.value},L.prototype.getReverse=function(s){for(var l=0,d=this.tail;d!==null&&l<s;l++)d=d.prev;if(l===s&&d!==null)return d.value},L.prototype.map=function(s,l){l=l||this;for(var d=new L,a=this.head;a!==null;)d.push(s.call(l,a.value,this)),a=a.next;return d},L.prototype.mapReverse=function(s,l){l=l||this;for(var d=new L,a=this.tail;a!==null;)d.push(s.call(l,a.value,this)),a=a.prev;return d},L.prototype.reduce=function(s,l){var d,a=this.head;if(arguments.length>1)d=l;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");a=this.head.next,d=this.head.value}for(var u=0;a!==null;u++)d=s(d,a.value,u),a=a.next;return d},L.prototype.reduceReverse=function(s,l){var d,a=this.tail;if(arguments.length>1)d=l;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");a=this.tail.prev,d=this.tail.value}for(var u=this.length-1;a!==null;u--)d=s(d,a.value,u),a=a.prev;return d},L.prototype.toArray=function(){for(var s=new Array(this.length),l=0,d=this.head;d!==null;l++)s[l]=d.value,d=d.next;return s},L.prototype.toArrayReverse=function(){for(var s=new Array(this.length),l=0,d=this.tail;d!==null;l++)s[l]=d.value,d=d.prev;return s},L.prototype.slice=function(s,l){(l=l||this.length)<0&&(l+=this.length),(s=s||0)<0&&(s+=this.length);var d=new L;if(l<s||l<0)return d;s<0&&(s=0),l>this.length&&(l=this.length);for(var a=0,u=this.head;u!==null&&a<s;a++)u=u.next;for(;u!==null&&a<l;a++,u=u.next)d.push(u.value);return d},L.prototype.sliceReverse=function(s,l){(l=l||this.length)<0&&(l+=this.length),(s=s||0)<0&&(s+=this.length);var d=new L;if(l<s||l<0)return d;s<0&&(s=0),l>this.length&&(l=this.length);for(var a=this.length,u=this.tail;u!==null&&a>l;a--)u=u.prev;for(;u!==null&&a>s;a--,u=u.prev)d.push(u.value);return d},L.prototype.splice=function(s,l){s>this.length&&(s=this.length-1),s<0&&(s=this.length+s);for(var d=0,a=this.head;a!==null&&d<s;d++)a=a.next;var u=[];for(d=0;a&&d<l;d++)u.push(a.value),a=this.removeNode(a);for(a===null&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev),d=0;d<(arguments.length<=2?0:arguments.length-2);d++)a=b(this,a,d+2<2||arguments.length<=d+2?void 0:arguments[d+2]);return u},L.prototype.reverse=function(){for(var s=this.head,l=this.tail,d=s;d!==null;d=d.prev){var a=d.prev;d.prev=d.next,d.next=a}return this.head=l,this.tail=s,this};try{D("./iterator.js")(L)}catch(s){}},{"./iterator.js":82}]},{},[12])(12)})}}]);
